import{_ as $e}from"./B9zpn3Od.js";import{o as s,c as o,a as e,e as se,x as G,I as We,t as l,f as m,U as Ye,n as h,T as Ke,m as Q,J as te,V as ue,g as be,p as me,A as ie,h as r,b as M,d as D,F as N,r as W,E as ze,i as O,v as E,w as de,s as Se,y as ee,l as S,k as _e,K as Ge}from"./DkTmUuRE.js";import{u as xe}from"./CeaxSyyw.js";import{u as Je,C as Ze}from"./DHALBtHD.js";import{s as Ce}from"./qjwKZoPi.js";import{r as re}from"./D6AEb5JG.js";import{r as Te}from"./D6fWPSh7.js";import{r as Xe}from"./4LM0syr0.js";import{r as et}from"./DXAkmB2P.js";import{r as tt}from"./ChXoReGe.js";import{r as st}from"./YuGRr4fW.js";import{r as rt}from"./DLqZqMLY.js";function ot(c,a){return s(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M5.636 4.575a.75.75 0 0 1 0 1.061 9 9 0 0 0 0 12.728.75.75 0 1 1-1.06 1.06c-4.101-4.1-4.101-10.748 0-14.849a.75.75 0 0 1 1.06 0Zm12.728 0a.75.75 0 0 1 1.06 0c4.101 4.1 4.101 10.75 0 14.85a.75.75 0 1 1-1.06-1.061 9 9 0 0 0 0-12.728.75.75 0 0 1 0-1.06ZM7.757 6.697a.75.75 0 0 1 0 1.06 6 6 0 0 0 0 8.486.75.75 0 0 1-1.06 1.06 7.5 7.5 0 0 1 0-10.606.75.75 0 0 1 1.06 0Zm8.486 0a.75.75 0 0 1 1.06 0 7.5 7.5 0 0 1 0 10.606.75.75 0 0 1-1.06-1.06 6 6 0 0 0 0-8.486.75.75 0 0 1 0-1.06ZM9.879 8.818a.75.75 0 0 1 0 1.06 3 3 0 0 0 0 4.243.75.75 0 1 1-1.061 1.061 4.5 4.5 0 0 1 0-6.364.75.75 0 0 1 1.06 0Zm4.242 0a.75.75 0 0 1 1.061 0 4.5 4.5 0 0 1 0 6.364.75.75 0 0 1-1.06-1.06 3 3 0 0 0 0-4.243.75.75 0 0 1 0-1.061ZM10.875 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Z","clip-rule":"evenodd"})])}const at={class:"bg-gray-800 rounded-xl border border-gray-700 p-5 w-full max-w-md max-h-[85vh] overflow-y-auto shadow-xl"},nt={class:"text-base sm:text-lg font-semibold text-gray-100 mb-2"},lt={class:"text-sm text-gray-300 mb-3"},it={key:0,class:"p-3 bg-yellow-900/20 border border-yellow-800/30 rounded-lg mb-4"},dt={class:"text-sm text-yellow-400"},ut={key:1,class:"p-3 bg-red-900/20 border border-red-800/30 rounded-lg mb-4"},ct={class:"text-sm text-red-400"},gt={key:2,class:"p-3 bg-blue-900/20 border border-blue-800/30 rounded-lg mb-4"},pt={class:"text-sm text-blue-400"},bt={class:"flex gap-3 mt-4"},mt=["disabled"],xt={key:3,class:"text-sm text-red-400 mt-3"},yt={key:4,class:"text-sm text-green-400 mt-3"},ft=se({__name:"ConfirmModal",props:{visible:{type:Boolean},title:{},message:{},warning:{},danger:{},info:{},confirmText:{default:"Confirm"},cancelText:{default:"Cancel"},variant:{default:"default"},loading:{type:Boolean},error:{},success:{}},emits:["confirm","cancel"],setup(c){const a=c,v=Q(()=>{switch(a.variant){case"danger":return"bg-red-600 hover:bg-red-500";case"warning":return"bg-yellow-600 hover:bg-yellow-500";case"info":return"bg-blue-600 hover:bg-blue-500";default:return"bg-spider-green-600 hover:bg-spider-green-700"}});return(d,b)=>(s(),G(Ke,{to:"body"},[c.visible?(s(),o("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4",onClick:b[2]||(b[2]=We(k=>d.$emit("cancel"),["self"]))},[e("div",at,[e("h3",nt,l(c.title),1),e("p",lt,l(c.message),1),c.warning?(s(),o("div",it,[e("p",dt,l(c.warning),1)])):m("",!0),c.danger?(s(),o("div",ut,[e("p",ct,l(c.danger),1)])):m("",!0),c.info?(s(),o("div",gt,[e("p",pt,l(c.info),1)])):m("",!0),Ye(d.$slots,"default"),e("div",bt,[e("button",{onClick:b[0]||(b[0]=k=>d.$emit("cancel")),class:"flex-1 py-2.5 bg-gray-700 text-gray-200 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors"},l(c.cancelText),1),e("button",{onClick:b[1]||(b[1]=k=>d.$emit("confirm")),disabled:c.loading,class:h(["flex-1 py-2.5 rounded-lg text-sm font-medium text-white transition-colors disabled:opacity-50",v.value])},l(c.loading?"Working...":c.confirmText),11,mt)]),c.error?(s(),o("p",xt,l(c.error),1)):m("",!0),c.success?(s(),o("p",yt,l(c.success),1)):m("",!0)])])):m("",!0)]))}}),Pe=Object.assign(ft,{__name:"ConfirmModal"}),vt={class:"rounded-xl bg-gray-800/40 border border-gray-700/50 p-2.5 sm:p-3"},ht={class:"flex items-center justify-between mb-1.5"},wt={class:"flex items-center gap-2 min-w-0"},kt={class:"text-xs font-medium text-white truncate"},_t={key:0,class:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs text-gray-400 mb-2"},$t={key:0},St={key:1,class:"text-xs text-gray-500 mb-2"},Ct={key:2,class:"text-xs text-gray-500 mb-2"},Tt={key:3,class:"text-xs text-gray-500 mb-2"},Pt={key:4,class:"flex gap-1.5 mt-2"},Rt=["disabled"],At=["disabled"],Dt=se({__name:"ServiceCard",props:{service:{},restarting:{type:Boolean},stopping:{type:Boolean}},emits:["restart","stop"],setup(c){const a={"s4r-web":"Web Interface","s4r-ingest":"Sensor Logger","s4r-retention":"Data Cleanup","s4r-supervisor":"Device Monitor","s4r-mosquitto":"Message Broker","s4r-proxy":"Privacy Proxy","s4r-cameras":"Camera Service","s4r-relay":"Relay Node","s4r-tunnel":"Remote Access","spiderapp-web":"Web Interface","spiderapp-ingest":"Sensor Logger","spiderapp-retention":"Data Cleanup","spiderapp-supervisor":"Device Monitor","spiderapp-mosquitto":"Message Broker","spiderapp-proxy":"Privacy Proxy","spiderapp-cameras":"Camera Service","spiderapp-relay":"Relay Node","spiderapp-tunnel":"Remote Access",questdb:"Database",go2rtc:"Video Streaming","appdata-sync":"Asset Sync","docker-engine":"Docker Engine","cloud-bridge":"Cloud Bridge",websocket:"WebSocket Server",automation:"Automation Engine"},v=new Set(["docker-engine","cloud-bridge","websocket","automation","appdata-sync","go2rtc"]);function d(p){return a[p]||p}function b(p){return!v.has(p)}function k(p){return p<1024*1024?`${(p/1024).toFixed(0)} KB`:`${(p/(1024*1024)).toFixed(1)} MB`}function P(p){const C=Math.floor(p/1e3);if(C<60)return`${C}s`;const T=Math.floor(C/60);if(T<60)return`${T}m`;const _=Math.floor(T/60);return _<24?`${_}h ${T%60}m`:`${Math.floor(_/24)}d ${_%24}h`}return(p,C)=>(s(),o("div",vt,[e("div",ht,[e("div",wt,[e("span",{class:h(["w-2 h-2 rounded-full shrink-0",{"bg-spider-green-400 shadow-lg shadow-spider-green-400/50":c.service.status==="online","bg-red-400 shadow-lg shadow-red-400/50":c.service.status==="errored","bg-gray-500":c.service.status==="stopped","bg-yellow-400 shadow-lg shadow-yellow-400/50":c.service.status==="unknown"}])},null,2),e("span",kt,l(d(c.service.name)),1)]),e("span",{class:h(["text-[10px] font-semibold px-1.5 py-0.5 rounded-md shrink-0 ml-1 uppercase tracking-wider",{"bg-spider-green-500/20 text-spider-green-400":c.service.status==="online","bg-red-500/20 text-red-400":c.service.status==="errored","bg-gray-600/50 text-gray-400":c.service.status==="stopped","bg-yellow-500/20 text-yellow-400":c.service.status==="unknown"}])},l(c.service.status),3)]),c.service.status==="online"&&c.service.memory>0?(s(),o("div",_t,[e("div",null,"CPU "+l(c.service.cpu.toFixed(1))+"%",1),e("div",null,l(k(c.service.memory)),1),e("div",null,l(P(c.service.uptime)),1),c.service.restarts>0?(s(),o("div",$t,l(c.service.restarts)+" restarts",1)):m("",!0)])):m("",!0),c.service.name==="cloud-bridge"&&c.service.status==="online"?(s(),o("div",St,l(c.service.restarts)+" active connection"+l(c.service.restarts!==1?"s":""),1)):c.service.name==="automation"&&c.service.status==="online"?(s(),o("div",Ct,l(c.service.restarts)+" active flow"+l(c.service.restarts!==1?"s":""),1)):c.service.name==="appdata-sync"?(s(),o("div",Tt,l(c.service.restarts)+" synced file"+l(c.service.restarts!==1?"s":""),1)):m("",!0),b(c.service.name)?(s(),o("div",Pt,[e("button",{onClick:C[0]||(C[0]=T=>p.$emit("restart",c.service.name)),disabled:c.restarting,class:"flex-1 text-xs py-1.5 px-2 rounded-lg font-medium transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50"},l(c.restarting?"...":"Restart"),9,Rt),c.service.status==="online"?(s(),o("button",{key:0,onClick:C[1]||(C[1]=T=>p.$emit("stop",c.service.name)),disabled:c.stopping,class:"flex-1 text-xs py-1.5 px-2 rounded-lg font-medium transition-all bg-red-500/20 text-red-400 hover:bg-red-500/30 disabled:opacity-50"},l(c.stopping?"...":"Stop"),9,At)):m("",!0)])):m("",!0)]))}}),Mt=Object.assign(Dt,{__name:"SystemServiceCard"}),Ut={class:"space-y-5"},Ot={class:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-5"},Et={class:"space-y-4"},Bt={class:"flex items-center justify-between mb-2"},Ht={key:0,class:"text-center py-6 text-gray-400 text-sm rounded-xl bg-gray-800/40 border border-gray-700/50"},Lt={key:1,class:"grid grid-cols-2 gap-2"},It={class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50"},Nt={class:"flex items-center gap-4"},Ft={class:"flex-1"},jt={class:"text-xs text-gray-400 mt-0.5"},qt={key:0,class:"mt-2.5 pt-2.5 border-t border-gray-700/30 flex items-center gap-5"},Qt={class:"flex items-center gap-2"},Vt={class:"text-sm text-white font-mono"},Wt={class:"flex items-center gap-2"},Yt={class:"text-sm text-white font-mono"},Kt={class:"mt-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-3"},zt={class:"text-xs text-gray-300"},Gt={key:0,class:"mt-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},Jt={class:"text-xs text-gray-400 font-medium"},Zt={class:"flex flex-wrap gap-1 mt-0.5"},Xt={class:"mt-2 p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"},es={class:"text-xs text-blue-300/80 space-y-1 list-decimal list-inside"},ts={class:"text-blue-200 font-mono"},ss={class:"text-blue-200 font-mono"},rs={class:"space-y-4"},os={class:"grid grid-cols-3 gap-2"},as={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},ns=["placeholder"],ls={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},is={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},ds=["placeholder"],us={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},cs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},gs=["placeholder"],ps={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},bs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},ms=["placeholder"],xs={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},ys={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},fs={class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-400"},vs={key:0,class:"text-xs text-gray-500 mt-0.5"},hs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},ws=["placeholder"],ks={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},_s={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},$s=["placeholder"],Ss={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},Cs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},Ts=["placeholder"],Ps={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},Rs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},As=["placeholder"],Ds={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500"},Ms={key:0},Us={class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"},Os={class:"flex-1"},Es={class:"text-xs text-gray-400 mt-0.5"},Bs={key:0,class:"mt-2 p-2.5 rounded-xl bg-amber-900/20 border border-amber-600/30"},Hs={class:"space-y-2"},Ls={class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"},Is={class:"flex-1"},Ns={class:"text-base text-gray-400 mt-0.5"},Fs={key:0,class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},js={class:"flex items-center justify-between mb-2"},qs={class:"flex items-center gap-2"},Qs=["onClick"],Vs={class:"space-y-1.5 mb-2"},Ws={class:"text-base font-medium text-gray-200"},Ys={key:0,class:"text-base text-spider-green-400"},Ks={class:"text-base text-gray-500 font-mono ml-auto"},zs={class:"flex items-center gap-3 text-base text-gray-500"},Gs={key:0,class:"text-red-400"},Js={class:"grid grid-cols-2 gap-2"},Zs={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},Xs=["placeholder"],er={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},tr={class:"flex items-center gap-1.5"},sr=["placeholder"],rr={class:"flex items-center justify-between p-3 rounded-xl bg-gray-800/40 border border-gray-700/50"},or={key:1},ar={class:"space-y-2"},nr={class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"},lr={class:"flex-1"},ir={class:"text-xs text-gray-400 mt-0.5"},dr={key:0,class:"space-y-2"},ur={class:"flex flex-wrap gap-2"},cr={class:"flex-1 min-w-[140px] p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},gr={key:0,class:"flex items-center gap-1"},pr=["value"],br={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-gray-500"},mr={key:0,class:"w-[80px] p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},xr={key:1,class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-gray-500"},yr={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},fr={key:0,class:"p-2 rounded-xl bg-purple-900/20 border border-purple-600/30"},vr={key:1,class:"p-2 rounded-xl bg-blue-900/20 border border-blue-600/30"},hr={class:"flex items-center justify-between mb-2"},wr={key:0,class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 mb-3 space-y-2.5"},kr=["value"],_r={class:"grid grid-cols-2 gap-2"},$r={class:"grid grid-cols-6 gap-2"},Sr={class:"col-span-3"},Cr={class:"col-span-1"},Tr={class:"col-span-2"},Pr={class:"grid grid-cols-2 gap-2"},Rr={class:"flex items-center gap-2 pt-1"},Ar=["disabled"],Dr=["disabled"],Mr={key:1,class:"max-h-[520px] overflow-y-auto space-y-2.5 pr-0.5"},Ur={key:1,class:"aspect-video bg-gray-900/60 flex items-center justify-center"},Or={class:"text-base text-gray-500"},Er={class:"flex items-center gap-2 px-3 py-2 bg-gray-900/40"},Br={class:"text-base text-gray-300 flex-1 truncate"},Hr={class:"text-xs text-gray-500 font-mono"},Lr=["onClick"],Ir=["onClick"],Nr=["onClick"],Fr={key:2,class:"text-center py-6 text-gray-400 text-base rounded-xl bg-gray-800/40 border border-gray-700/50"},jr={key:3,class:"mt-2 flex items-center gap-2"},qr={class:"text-xs text-gray-400"},Qr={key:0,class:"flex items-center gap-3 pt-4 border-t border-gray-700/50 relative overflow-visible"},Vr=["disabled"],Wr=se({__name:"ServerSection",setup(c){const a=xe(),{getAuthHeaders:v,authenticated:d}=te(),{requireAuth:b}=ue(),k=Q(()=>a.updateStatus?.autoUpdate??!1);async function P(){try{await b()}catch{return}await a.toggleAutoUpdate()}const p=ee({enabled:!1,active:!1,serverIp:"",brokerPort:1884,entityCount:0,devices:[],hasData:!1}),C=S(""),T=S(!1),_=S(""),H=S(!1),R=S(null),F=S(""),j=S(null),g=ee({}),u=ee({privateMode:!1,remoteEnabled:!1,remoteHost:"",remotePort:null}),B=Q(()=>/^https?:\/\//i.test(u.remoteHost));function A(i){u.remoteHost=i.target.value.trim()}const K=Q(()=>a.config?.APP_PASSWORD?"••••••••":"No password set"),J=Q(()=>{const i=[],t=["API_PORT","WS_PORT","MQTT_PORT","MQTT_LAN_PORT","QUESTDB_PG_PORT","QUESTDB_HTTP_PORT","QUESTDB_ILP_PORT"];for(const $ of t)g[$]&&g[$]!==a.config?.[$]&&i.push($.replace(/_/g," ").replace("QUESTDB ","DB "));return i}),x=Q(()=>["QUESTDB_PG_PORT","QUESTDB_HTTP_PORT","QUESTDB_ILP_PORT"].filter(t=>g[t]&&g[t]!==a.config?.[t])),y=Q(()=>g.APP_PASSWORD&&g.APP_PASSWORD!==a.config?.APP_PASSWORD),w=Q(()=>{const i=Object.keys(g).some($=>g[$]&&g[$]!==a.config?.[$]),t=a.proxyConfig&&(u.privateMode!==a.proxyConfig.privateMode||u.remoteEnabled!==(a.proxyConfig.remoteEnabled??!1)||u.remoteHost!==a.proxyConfig.remoteHost||u.remotePort!==a.proxyConfig.remotePort);return i||t});async function U(){try{const i=await $fetch("/api/system/ha-config");Object.assign(p,i)}catch{}}async function q(){try{await b()}catch{return}const i=!p.enabled;try{await $fetch("/api/system/ha-config",{method:"POST",headers:v(),body:{enabled:i}}),p.enabled=i,i?setTimeout(()=>U(),4e3):(p.active=!1,p.entityCount=0)}catch{}}function I(i){navigator.clipboard.writeText(i).catch(()=>{})}const{cameras:Z,loading:Ta,go2rtcRunning:ye,fetchCameras:Pa,addCamera:Re,updateCamera:fe,deleteCamera:Ae,testCamera:Ra}=Je(),oe=S(!1),z=S(null),ae=S(!1),ne=S(!1),Y=S(null),f=ee({name:"",protocol:"rtsp",host:"",port:554,path:"/stream1",username:"",password:""}),ve=[{label:"IP Webcam (Android)",protocol:"rtsp",port:8080,path:"/h264_ulaw.sdp"},{label:"Generic RTSP (main)",protocol:"rtsp",port:554,path:"/stream1"},{label:"Hikvision",protocol:"rtsp",port:554,path:"/Streaming/Channels/101"},{label:"Dahua",protocol:"rtsp",port:554,path:"/cam/realmonitor?channel=1&subtype=0"},{label:"Reolink",protocol:"rtsp",port:554,path:"/h264Preview_01_main"},{label:"Tapo (TP-Link)",protocol:"rtsp",port:554,path:"/stream1"},{label:"ONVIF (auto)",protocol:"onvif",port:80,path:""},{label:"HTTP Camera (MJPEG)",protocol:"http-mjpeg",port:80,path:"/"}];function he(i){i?(z.value=i.id,f.name=i.name,f.protocol=i.protocol,f.host=i.host,f.port=i.port,f.path=i.path,f.username=i.username,f.password=i.password):(z.value=null,f.name="",f.protocol="rtsp",f.host="",f.port=554,f.path="/stream1",f.username="",f.password=""),Y.value=null,oe.value=!0}function we(){oe.value=!1,z.value=null,Y.value=null}function De(i){const t=i.target.value,$=ve.find(X=>X.label===t);$&&(f.protocol=$.protocol,f.port=$.port,f.path=$.path)}async function Me(){try{await b()}catch{return}ae.value=!0;try{z.value?await fe(z.value,{...f}):await Re({...f,enabled:!0}),we()}catch{}finally{ae.value=!1}}async function Ue(){ne.value=!0,Y.value=null;try{const{getAuthHeaders:i}=te();Y.value=await $fetch("/api/cameras/test",{method:"POST",headers:i(),body:{host:f.host,port:f.port}})}catch{Y.value={success:!1,message:"Test failed"}}finally{ne.value=!1}}async function Oe(i){try{await b()}catch{return}await fe(i.id,{enabled:!i.enabled})}async function Ee(i){try{await b()}catch{return}confirm(`Delete camera "${i.name}"?`)&&await Ae(i.id)}async function Be(){try{await b()}catch{return}u.privateMode=!u.privateMode}async function He(){try{await b()}catch{return}u.remoteEnabled=!u.remoteEnabled}async function ke(i,t){try{await b()}catch{return}F.value="",R.value={name:i,action:t}}async function Le(){if(!R.value)return;const{name:i,action:t}=R.value;C.value=`${i}-${t}`,F.value="";try{await a.controlService(i,t),R.value=null}catch($){F.value=$.data?.message||`Failed to ${t} service`}finally{C.value=""}}async function Ie(){try{await b()}catch{return}H.value=!0}async function Ne(){T.value=!0;try{const i={};for(const[t,$]of Object.entries(g))$&&$!==a.config?.[t]&&(i[t]=$);if(Object.keys(i).length>0&&(await a.saveConfig(i),i.APP_PASSWORD)){const{setPassword:t}=te();t(i.APP_PASSWORD)}a.proxyConfig&&(u.privateMode!==a.proxyConfig.privateMode||u.remoteEnabled!==(a.proxyConfig.remoteEnabled??!1)||u.remoteHost!==a.proxyConfig.remoteHost||u.remotePort!==a.proxyConfig.remotePort)&&await a.saveProxyConfig(u),Object.keys(g).forEach(t=>delete g[t]),H.value=!1,setTimeout(()=>a.fetchServices(),2e3)}catch{}finally{T.value=!1}}async function Fe(i){try{await b()}catch{i.preventDefault();return}}async function je(i){const t=i.target;if(t.files?.length){_.value="";try{const $=new FormData;for(const X of t.files)$.append("certs",X);await $fetch("/api/system/cert-upload",{method:"POST",headers:v(),body:$}),_.value="Uploaded successfully"}catch($){_.value=`Error: ${$.data?.message||"Upload failed"}`}t.value=""}}const le=S([]),V=ee({mode:"allow-all",allowedUids:[]});let ce=null;async function ge(){try{const i=await $fetch("/api/system/mqtt-sources");le.value=i.sources||[],V.mode=i.filter?.mode||"allow-all",V.allowedUids=i.filter?.allowedUids||[]}catch{}}async function qe(){try{await b()}catch{return}if(V.mode==="allow-all"){const i=le.value[0]?.uid;if(!i)return;await pe("whitelist",[i])}else await pe("allow-all",[])}async function Qe(i){try{await b()}catch{return}await pe("whitelist",[i])}async function pe(i,t){try{await $fetch("/api/system/mqtt-sources",{method:"POST",headers:v(),body:{mode:i,allowedUids:t}}),V.mode=i,V.allowedUids=t,await ge()}catch{}}function Ve(i){const t=Math.floor((Date.now()-i)/1e3);return t<5?"just now":t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}return be(()=>{a.fetchServices(),a.fetchConfig(),a.fetchProxyConfig(),a.fetchUpdateStatus(),U(),ge(),ce=Ce(ge,1e4)}),me(()=>{ce&&clearInterval(ce)}),ie(()=>a.proxyConfig,i=>{i&&(u.privateMode=i.privateMode,u.remoteEnabled=i.remoteEnabled??!1,u.remoteHost=i.remoteHost,u.remotePort=i.remotePort??null)}),(i,t)=>{const $=$e,X=Pe;return s(),o("div",Ut,[e("div",Ot,[e("div",Et,[e("div",Bt,[t[26]||(t[26]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider"},"Services",-1)),e("button",{onClick:t[0]||(t[0]=n=>r(a).fetchServices()),class:"text-xs text-gray-400 hover:text-spider-green-400 transition-colors flex items-center gap-1.5"},[M(r(re),{class:"w-3.5 h-3.5"}),t[25]||(t[25]=D(" Refresh ",-1))])]),r(a).services.length===0&&!r(a).servicesLoading?(s(),o("div",Ht," No services detected. Run pm2-start.sh first. ")):(s(),o("div",Lt,[(s(!0),o(N,null,W(r(a).services,n=>(s(),G(Mt,{key:n.name,service:n,restarting:C.value===n.name+"-restart",stopping:C.value===n.name+"-stop",onRestart:L=>ke(n.name,"restart"),onStop:L=>ke(n.name,"stop")},null,8,["service","restarting","stopping","onRestart","onStop"]))),128))])),e("div",null,[t[40]||(t[40]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Home Assistant",-1)),e("div",It,[e("div",Nt,[e("div",Ft,[t[27]||(t[27]=e("span",{class:"text-sm font-medium text-gray-200"},"MQTT Discovery Bridge",-1)),e("p",jt,l(p.enabled?"Devices auto-discovered in Home Assistant via MQTT":"Disabled — HA cannot see your grow devices"),1)]),e("button",{onClick:q,class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",p.enabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":p.enabled}])},null,2)],2)]),p.enabled?(s(),o("div",qt,[e("div",Qt,[t[29]||(t[29]=e("span",{class:"text-xs text-gray-500"},"Broker",-1)),e("span",Vt,l(p.serverIp||"..."),1),p.serverIp?(s(),o("button",{key:0,onClick:t[1]||(t[1]=n=>I(p.serverIp)),class:"text-gray-500 hover:text-spider-green-400 transition-colors shrink-0",title:"Copy"},[...t[28]||(t[28]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])):m("",!0)]),e("div",Wt,[t[30]||(t[30]=e("span",{class:"text-xs text-gray-500"},"Port",-1)),e("span",Yt,l(p.brokerPort||"1884"),1)])])):m("",!0)]),p.enabled?(s(),o(N,{key:0},[e("div",Kt,[e("span",{class:h(["w-2 h-2 rounded-full shrink-0",p.active?"bg-green-400 shadow-lg shadow-green-400/50":"bg-yellow-400"])},null,2),e("span",zt,l(p.active?`Bridge active — ${p.entityCount} entities published`:"Bridge starting..."),1),e("button",{onClick:U,class:"ml-auto text-gray-400 hover:text-spider-green-400 transition-colors"},[M(r(re),{class:"w-3.5 h-3.5"})])]),p.devices?.length?(s(),o("div",Gt,[t[31]||(t[31]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1.5"},"Published Entities",-1)),(s(!0),o(N,null,W(p.devices,n=>(s(),o("div",{key:n.mac,class:"mb-1.5 last:mb-0"},[e("span",Jt,l(n.type),1),e("div",Zt,[(s(!0),o(N,null,W(n.entities,L=>(s(),o("span",{key:L,class:"text-xs px-1.5 py-0.5 rounded bg-gray-700/60 text-gray-300"},l(L),1))),128))])]))),128))])):m("",!0),e("div",Xt,[t[38]||(t[38]=e("p",{class:"text-xs text-blue-400 font-semibold uppercase tracking-wider mb-1.5"},"Setup in Home Assistant",-1)),e("ol",es,[t[34]||(t[34]=e("li",null,[D("Go to "),e("span",{class:"text-blue-200"},"Settings → Devices & Services → Add Integration")],-1)),t[35]||(t[35]=e("li",null,[D("Search for "),e("span",{class:"text-blue-200"},"MQTT"),D(" and select it")],-1)),e("li",null,[t[32]||(t[32]=D("Enter broker: ",-1)),e("span",ts,l(p.serverIp),1),t[33]||(t[33]=D(" port: ",-1)),e("span",ss,l(p.brokerPort),1)]),t[36]||(t[36]=e("li",null,[D("Leave username and password "),e("span",{class:"text-blue-200"},"empty")],-1)),t[37]||(t[37]=e("li",null,[D("Your devices will appear automatically under "),e("span",{class:"text-blue-200"},"MQTT devices")],-1))])]),t[39]||(t[39]=ze('<div class="mt-2 p-2.5 rounded-xl bg-amber-900/20 border border-amber-600/30"><p class="text-xs text-amber-300/80"> Control from HA is allowed in <span class="text-amber-200 font-semibold">Manual</span> and <span class="text-amber-200 font-semibold">Trigger</span> modes. Outlets (Time, Cycle, Temp, Humi, CO2, Drip), Blowers (Time, Cycle, Env), and Lights (Time Slot, PPFD Auto) automation modes are protected — HA commands will be rejected. </p><p class="text-xs text-amber-300/60 mt-1"> In Trigger mode, configured triggers will still fire independently of HA commands. </p></div>',1))],64)):m("",!0)])]),e("div",rs,[e("div",null,[t[50]||(t[50]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Network Ports",-1)),e("div",os,[e("div",as,[t[41]||(t[41]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Web App",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[2]||(t[2]=n=>g.API_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.API_PORT||"3000"},null,8,ns)),[[E,g.API_PORT]]):(s(),o("div",ls,"Hidden"))]),e("div",is,[t[42]||(t[42]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Live Updates",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[3]||(t[3]=n=>g.WS_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.WS_PORT||"3001"},null,8,ds)),[[E,g.WS_PORT]]):(s(),o("div",us,"Hidden"))]),e("div",cs,[t[43]||(t[43]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Broker",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[4]||(t[4]=n=>g.MQTT_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.MQTT_PORT||"1883"},null,8,gs)),[[E,g.MQTT_PORT]]):(s(),o("div",ps,"Hidden"))]),e("div",bs,[t[44]||(t[44]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Broker LAN",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[5]||(t[5]=n=>g.MQTT_LAN_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.MQTT_LAN_PORT||"1884"},null,8,ms)),[[E,g.MQTT_LAN_PORT]]):(s(),o("div",xs,"Hidden"))]),e("div",ys,[t[45]||(t[45]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"MQTT Proxy",-1)),e("div",fs,l(r(d)?r(a).config?.PROXY_PORT||"8883":"Hidden"),1),r(d)?(s(),o("p",vs,"Fixed (binary)")):m("",!0)]),e("div",hs,[t[46]||(t[46]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Database",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[6]||(t[6]=n=>g.QUESTDB_PG_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.QUESTDB_PG_PORT||"8812"},null,8,ws)),[[E,g.QUESTDB_PG_PORT]]):(s(),o("div",ks,"Hidden"))]),e("div",_s,[t[47]||(t[47]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"DB Console",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[7]||(t[7]=n=>g.QUESTDB_HTTP_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.QUESTDB_HTTP_PORT||"9000"},null,8,$s)),[[E,g.QUESTDB_HTTP_PORT]]):(s(),o("div",Ss,"Hidden"))]),e("div",Cs,[t[48]||(t[48]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"DB Writer",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[8]||(t[8]=n=>g.QUESTDB_ILP_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.QUESTDB_ILP_PORT||"9009"},null,8,Ts)),[[E,g.QUESTDB_ILP_PORT]]):(s(),o("div",Ps,"Hidden"))]),e("div",Rs,[t[49]||(t[49]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Relay Node",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[9]||(t[9]=n=>g.RELAY_PORT=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.RELAY_PORT||"9443"},null,8,As)),[[E,g.RELAY_PORT]]):(s(),o("div",Ds,"Hidden"))])])]),r(a).proxyConfig?(s(),o("div",Ms,[t[53]||(t[53]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Privacy Mode",-1)),e("div",Us,[e("div",Os,[t[51]||(t[51]=e("span",{class:"text-sm font-medium text-gray-200"},"Stop sending data to the cloud",-1)),e("p",Es,l(u.privateMode?"Your data stays local — nothing leaves your network":"Devices are sharing data with Spider Farmer servers"),1)]),e("button",{onClick:Be,class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",u.privateMode?"bg-gradient-to-r from-red-500 to-red-600 shadow-lg shadow-red-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":u.privateMode}])},null,2)],2)]),u.privateMode?(s(),o("div",Bs,[...t[52]||(t[52]=[e("p",{class:"text-xs text-amber-300/90"}," While active: you won't be able to control devices from the official Spider Farmer app, and no historical data will be stored in their cloud. Anything not sent while private cannot be recovered later. ",-1)])])):m("",!0)])):m("",!0),e("div",null,[t[56]||(t[56]=e("h3",{class:"text-base font-semibold text-white uppercase tracking-wider mb-2"},"Data Sources",-1)),e("div",Hs,[e("div",Ls,[e("div",Is,[t[54]||(t[54]=e("span",{class:"text-base font-medium text-gray-200"},"Source Filter",-1)),e("p",Ns,l(V.mode==="whitelist"?"Only selected source is processed":"All sources accepted"),1)]),e("button",{onClick:qe,class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",V.mode==="whitelist"?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":V.mode==="whitelist"}])},null,2)],2)]),le.value.length===0?(s(),o("div",Fs,[...t[55]||(t[55]=[e("p",{class:"text-base text-gray-500"},"No data sources detected yet. Waiting for MQTT messages...",-1)])])):m("",!0),(s(!0),o(N,null,W(le.value,n=>(s(),o("div",{key:n.uid,class:h(["p-3 rounded-xl border transition-all",n.allowed?"bg-gray-800/40 border-gray-700/50":"bg-red-900/10 border-red-800/30"])},[e("div",js,[e("div",qs,[e("span",{class:h(["w-2 h-2 rounded-full",n.allowed?"bg-spider-green-400 shadow-lg shadow-spider-green-400/50":"bg-red-500/70"])},null,2),e("span",{class:h(["text-base px-1.5 py-0.5 rounded",n.allowed?"bg-spider-green-500/20 text-spider-green-400":"bg-red-500/20 text-red-400"])},l(n.allowed?"Active":"Blocked"),3)]),V.mode==="whitelist"?(s(),o("button",{key:0,onClick:L=>Qe(n.uid),class:h(["px-2.5 py-1 text-base rounded-lg font-medium transition-all",n.allowed?"bg-spider-green-500/20 text-spider-green-400 border border-spider-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-gray-200"])},l(n.allowed?"Selected":"Select"),11,Qs)):m("",!0)]),e("div",Vs,[(s(!0),o(N,null,W(n.devices,L=>(s(),o("div",{key:L.mac,class:"flex items-center gap-2 px-2 py-1.5 rounded-lg bg-gray-700/40"},[e("span",Ws,l(L.typeName||L.type.toUpperCase()),1),L.customName?(s(),o("span",Ys,l(L.customName),1)):m("",!0),e("span",Ks,l(L.mac),1)]))),128))]),e("div",zs,[e("span",null,"UID "+l(n.uid),1),e("span",null,l(n.totalMessages.toLocaleString())+" msgs",1),n.blockedMessages>0?(s(),o("span",Gs,l(n.blockedMessages.toLocaleString())+" blocked",1)):m("",!0),e("span",null,l(Ve(n.lastSeen)),1)])],2))),128))])]),e("div",null,[t[62]||(t[62]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Security & Storage",-1)),e("div",Js,[e("div",Zs,[t[57]||(t[57]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"App Password",-1)),O(e("input",{"onUpdate:modelValue":t[10]||(t[10]=n=>g.APP_PASSWORD=n),type:"text",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:K.value},null,8,Xs),[[E,g.APP_PASSWORD]]),t[58]||(t[58]=e("p",{class:"text-xs text-gray-500 mt-1"},"Unlocks controls",-1))]),e("div",er,[t[60]||(t[60]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Keep history",-1)),e("div",tr,[O(e("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>g.DATA_RETENTION_DAYS=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(a).config?.DATA_RETENTION_DAYS||"90"},null,8,sr),[[E,g.DATA_RETENTION_DAYS]]),t[59]||(t[59]=e("span",{class:"text-xs text-gray-400 shrink-0"},"days",-1))]),t[61]||(t[61]=e("p",{class:"text-xs text-gray-500 mt-1"},"Older data is deleted",-1))])])]),e("div",null,[t[64]||(t[64]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Software Updates",-1)),e("div",rr,[t[63]||(t[63]=e("div",null,[e("p",{class:"text-sm font-medium text-gray-200"},"Auto-update"),e("p",{class:"text-xs text-gray-400"},"Automatically install updates when available")],-1)),e("button",{onClick:P,class:h(["relative inline-flex h-6 w-11 items-center rounded-full transition-all shrink-0 ml-3",k.value?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])},[e("span",{class:h(["inline-block h-4 w-4 rounded-full bg-white transition-transform shadow",k.value?"translate-x-[22px]":"translate-x-[3px]"])},null,2)],2)])]),r(a).proxyConfig?(s(),o("div",or,[t[74]||(t[74]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2"},"Send Data to Your Server",-1)),e("div",ar,[e("div",nr,[e("div",lr,[t[65]||(t[65]=e("span",{class:"text-sm font-medium text-gray-200"},"Clone device data to another server",-1)),e("p",ir,l(u.remoteEnabled?"A copy of all device data is being sent to your server":"Disabled — data only stays on this system"),1)]),e("button",{onClick:He,class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",u.remoteEnabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":u.remoteEnabled}])},null,2)],2)]),u.remoteEnabled?(s(),o("div",dr,[e("div",ur,[e("div",cr,[t[67]||(t[67]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Server address",-1)),r(d)?(s(),o("div",gr,[e("input",{value:u.remoteHost,onInput:A,type:"text",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:"192.168.1.100 or https://myserver.ddns.net"},null,40,pr),u.remoteHost?(s(),o("button",{key:0,onClick:t[12]||(t[12]=n=>u.remoteHost=""),class:"text-gray-500 hover:text-red-400 transition-colors shrink-0 p-1",title:"Clear"},[...t[66]||(t[66]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):m("",!0)])):(s(),o("div",br,l(u.remoteHost?"••••••••":"Not configured"),1))]),B.value?m("",!0):(s(),o("div",mr,[t[68]||(t[68]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"MQTT Port",-1)),r(d)?O((s(),o("input",{key:0,"onUpdate:modelValue":t[13]||(t[13]=n=>u.remotePort=n),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:"1884"},null,512)),[[E,u.remotePort,void 0,{number:!0}]]):(s(),o("div",xr,"••••"))])),e("div",yr,[t[70]||(t[70]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Certificates",-1)),M($,null,{default:de(()=>[e("label",{class:"inline-flex items-center gap-1.5 text-xs text-blue-400 hover:text-blue-300 cursor-pointer transition-colors",onClick:Fe},[M(r(Te),{class:"w-3.5 h-3.5"}),t[69]||(t[69]=D(" Upload ",-1)),e("input",{ref_key:"certFileInput",ref:j,type:"file",multiple:"",accept:".pem,.crt,.key",class:"hidden",onChange:je},null,544)])]),_:1}),_.value?(s(),o("p",{key:0,class:h(["text-xs mt-1",_.value.startsWith("Error")?"text-red-400":"text-spider-green-400"])},l(_.value),3)):m("",!0)])]),B.value?(s(),o("div",fr,[...t[71]||(t[71]=[e("p",{class:"text-xs text-purple-300/80"},[D(" MQTT over WebSocket (WSS) — connects through your reverse proxy on port 443. The remote Mosquitto must have a WebSocket listener and Nginx must proxy "),e("code",{class:"text-purple-400"},"/mqtt"),D(" to it. ")],-1)])])):(s(),o("div",vr,[...t[72]||(t[72]=[e("p",{class:"text-xs text-blue-300/80"}," Direct MQTT connection to the remote Mosquitto broker on the specified port (default 1884). ",-1)])])),t[73]||(t[73]=e("div",{class:"p-2 rounded-xl bg-blue-900/20 border border-blue-600/30"},[e("p",{class:"text-xs text-blue-300/80"},"Data is duplicated — your local system and Spider Farmer keep receiving data normally.")],-1))])):m("",!0)])])):m("",!0),e("div",null,[e("div",hr,[t[76]||(t[76]=e("h3",{class:"text-xs sm:text-sm font-semibold text-white uppercase tracking-wider"},"IP Cameras",-1)),e("button",{onClick:t[14]||(t[14]=n=>he()),class:"text-xs text-gray-400 hover:text-spider-green-400 transition-colors flex items-center gap-1.5"},[...t[75]||(t[75]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),D(" Add Camera ",-1)])])]),oe.value?(s(),o("div",wr,[e("div",null,[t[78]||(t[78]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Preset",-1)),e("select",{onChange:t[15]||(t[15]=n=>De(n)),class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},[t[77]||(t[77]=e("option",{value:""},"Custom configuration",-1)),(s(),o(N,null,W(ve,n=>e("option",{key:n.label,value:n.label},l(n.label),9,kr)),64))],32)]),e("div",_r,[e("div",null,[t[79]||(t[79]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Name",-1)),O(e("input",{"onUpdate:modelValue":t[16]||(t[16]=n=>f.name=n),type:"text",placeholder:"Grow Room 1",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.name]])]),e("div",null,[t[81]||(t[81]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Protocol",-1)),O(e("select",{"onUpdate:modelValue":t[17]||(t[17]=n=>f.protocol=n),class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},[...t[80]||(t[80]=[e("option",{value:"rtsp"},"RTSP",-1),e("option",{value:"rtsp-tcp"},"RTSP over TCP",-1),e("option",{value:"onvif"},"ONVIF",-1),e("option",{value:"http-mjpeg"},"HTTP (MJPEG)",-1)])],512),[[Se,f.protocol]])])]),e("div",$r,[e("div",Sr,[t[82]||(t[82]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Host / IP",-1)),O(e("input",{"onUpdate:modelValue":t[18]||(t[18]=n=>f.host=n),type:"text",placeholder:"192.168.1.50",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.host]])]),e("div",Cr,[t[83]||(t[83]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Port",-1)),O(e("input",{"onUpdate:modelValue":t[19]||(t[19]=n=>f.port=n),type:"number",placeholder:"554",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.port,void 0,{number:!0}]])]),e("div",Tr,[t[84]||(t[84]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Path",-1)),O(e("input",{"onUpdate:modelValue":t[20]||(t[20]=n=>f.path=n),type:"text",placeholder:"/stream1",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.path]])])]),e("div",Pr,[e("div",null,[t[85]||(t[85]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},[D("Username "),e("span",{class:"text-gray-600"},"(optional)")],-1)),O(e("input",{"onUpdate:modelValue":t[21]||(t[21]=n=>f.username=n),type:"text",placeholder:"",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.username]])]),e("div",null,[t[86]||(t[86]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},[D("Password "),e("span",{class:"text-gray-600"},"(optional)")],-1)),O(e("input",{"onUpdate:modelValue":t[22]||(t[22]=n=>f.password=n),type:"password",placeholder:"",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"},null,512),[[E,f.password]])])]),e("div",Rr,[e("button",{onClick:Me,disabled:!f.name||!f.host||!f.port||ae.value,class:"px-4 py-1.5 bg-gradient-to-r from-spider-green-500 to-spider-green-600 text-white text-base font-medium rounded-lg shadow-lg shadow-spider-green-500/20 hover:shadow-spider-green-500/40 transition-all disabled:opacity-40 disabled:cursor-not-allowed"},l(ae.value?"Saving...":z.value?"Update":"Add Camera"),9,Ar),!z.value&&f.host&&f.port?(s(),o("button",{key:0,onClick:Ue,disabled:ne.value,class:"px-4 py-1.5 bg-gray-700/60 text-gray-300 hover:bg-gray-600/60 text-base rounded-lg transition-colors disabled:opacity-40"},l(ne.value?"Testing...":"Test Connection"),9,Dr)):m("",!0),e("button",{onClick:we,class:"px-4 py-1.5 text-gray-400 hover:text-white text-base transition-colors"}," Cancel "),Y.value?(s(),o("span",{key:1,class:h(["text-base ml-2",Y.value.success?"text-green-400":"text-red-400"])},l(Y.value.message),3)):m("",!0)])])):m("",!0),r(Z).length>0?(s(),o("div",Mr,[(s(!0),o(N,null,W(r(Z),n=>(s(),o("div",{key:n.id,class:"rounded-xl bg-gray-800/40 border border-gray-700/50 overflow-hidden"},[n.enabled?(s(),G(Ze,{key:0,"camera-id":n.id,"camera-name":n.name},null,8,["camera-id","camera-name"])):(s(),o("div",Ur,[e("span",Or,l(n.name)+" — disabled",1)])),e("div",Er,[e("span",Br,l(n.name),1),e("span",Hr,l(n.host)+":"+l(n.port),1),e("button",{onClick:L=>Oe(n),class:h(["relative w-9 h-5 rounded-full transition-all shrink-0",n.enabled?"bg-spider-green-500":"bg-gray-600"]),title:"Enable/Disable"},[e("span",{class:h(["absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-4":n.enabled}])},null,2)],10,Lr),e("button",{onClick:L=>he(n),class:"text-gray-400 hover:text-spider-green-400 transition-colors",title:"Edit"},[...t[87]||(t[87]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Ir),e("button",{onClick:L=>Ee(n),class:"text-gray-400 hover:text-red-400 transition-colors",title:"Delete"},[...t[88]||(t[88]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Nr)])]))),128))])):oe.value?m("",!0):(s(),o("div",Fr," No cameras configured. Add an IP camera to see live video. ")),r(Z).length>0?(s(),o("div",jr,[e("span",{class:h(["w-2 h-2 rounded-full shrink-0",r(ye)?"bg-green-400 shadow-lg shadow-green-400/50":"bg-yellow-400"])},null,2),e("span",qr,l(r(ye)?"go2rtc streaming engine running":"go2rtc starting..."),1)])):m("",!0)])])]),M($,null,{default:de(()=>[w.value?(s(),o("div",Qr,[t[89]||(t[89]=e("div",{class:"absolute -top-2 -left-2 w-20 h-20 rounded-full blur-2xl pointer-events-none bg-spider-green-500/30"},null,-1)),e("button",{onClick:Ie,disabled:T.value,class:"relative bg-gradient-to-r from-spider-green-500 to-spider-green-600 hover:from-spider-green-400 hover:to-spider-green-500 disabled:from-gray-600 disabled:to-gray-700 text-white text-xs font-semibold py-2.5 px-6 rounded-xl transition-all flex items-center gap-2 shadow-lg shadow-spider-green-500/20 disabled:shadow-none"},[T.value?(s(),G(r(re),{key:1,class:"w-4 h-4 animate-spin"})):(s(),G(r(Xe),{key:0,class:"w-4 h-4"})),D(" "+l(T.value?"Saving...":"Save All Changes"),1)],8,Vr),t[90]||(t[90]=e("span",{class:"text-xs text-yellow-400 font-medium"},"Unsaved changes",-1))])):m("",!0)]),_:1}),M(X,{visible:!!R.value,title:R.value?.action==="restart"?"Restart Service":"Stop Service",message:`Are you sure you want to ${R.value?.action} '${R.value?.name}'?`,warning:R.value?.action==="stop"?"Stopping this service may interrupt data collection or app functionality until it is restarted.":void 0,info:R.value?.action==="restart"?"The service will be briefly unavailable during restart.":void 0,"confirm-text":R.value?.action==="restart"?"Restart":"Stop",variant:R.value?.action==="stop"?"danger":"warning",loading:!!C.value,error:F.value,"cancel-text":"Cancel",onConfirm:Le,onCancel:t[23]||(t[23]=n=>{R.value=null,F.value=""})},null,8,["visible","title","message","warning","info","confirm-text","variant","loading","error"]),M(X,{visible:H.value,title:"Save Configuration",message:"You are about to modify the application configuration. Some changes may require service restarts.",warning:J.value.length>0?`Port changes detected (${J.value.join(", ")}). Affected services will be restarted automatically.${x.value.length>0?" QuestDB Docker container will be recreated (data is preserved).":""}`:void 0,info:y.value?"The new password takes effect immediately — no restart needed.":void 0,"confirm-text":"Save Changes",variant:"warning",loading:T.value,"cancel-text":"Cancel",onConfirm:Ne,onCancel:t[24]||(t[24]=n=>H.value=!1)},null,8,["visible","warning","info","loading"])])}}}),Yr=Object.assign(Wr,{__name:"SystemServerSection"}),Kr={class:"space-y-4"},zr={class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"},Gr={class:"flex-1"},Jr={class:"text-base text-gray-400 mt-0.5"},Zr=["disabled"],Xr={key:0,class:"p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"},eo={class:"flex-1"},to={class:"text-base text-gray-400 mt-0.5"},so=["disabled"],ro={key:1,class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-3"},oo={class:"text-base text-gray-300"},ao={key:2,class:"grid grid-cols-3 gap-2"},no={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},lo={class:"text-xl font-bold text-spider-green-400"},io={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},uo={class:"text-xl font-bold text-blue-400"},co={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},go={class:"text-xl font-bold text-purple-400"},po={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},bo={class:"text-xl font-bold text-amber-400"},mo={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},xo={class:"text-xl font-bold text-teal-400"},yo={key:0,class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"},fo=["title"],vo={key:3,class:"space-y-2"},ho={class:"grid grid-cols-3 gap-2"},wo={class:"p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},ko={class:"col-span-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"},_o={class:"flex items-center gap-2"},$o=["placeholder"],So={key:0,class:"text-base text-gray-500 mt-1"},Co={class:"p-2 rounded-lg bg-gray-900/40 border border-gray-700/30 flex items-center gap-2"},To={key:0,class:"ml-auto px-2 py-0.5 rounded text-base bg-yellow-500/15 text-yellow-400"},Po={key:1,class:"ml-auto px-2 py-0.5 rounded text-base bg-green-500/15 text-green-400"},Ro={key:0,class:"flex items-center gap-3"},Ao=["disabled"],Do={class:"p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"},Mo={class:"text-base text-blue-300/60 mt-1.5"},Uo=se({__name:"RelaySection",setup(c){const{requireAuth:a}=ue(),{getAuthHeaders:v}=te(),d=ee({enabled:!1,trackerEnabled:!1,port:9443,publicUrl:"",detectedUrl:"",publicKey:"",signPublicKey:"",peers:0,circuits:0,rooms:0,tunnelHosts:0,tunnelSessions:0,status:"stopped"}),b=S(9443),k=S(""),P=S(""),p=S(!1),C=S(!1),T=S(!1);let _=null,H=!1;const R=Q(()=>{const x=k.value||P.value;return!x||/^\d{1,3}(\.\d{1,3}){3}$/.test(x)}),F=Q(()=>{const x=k.value||P.value||"your-ip";return R.value?`ws://${x}:${b.value}`:`wss://${x.replace(/\/relay\/?$/,"")}/relay`});function j(x){return x?x.replace(/^wss?:\/\//,"").replace(/:\d+$/,"").replace(/\/relay\/?$/,""):""}function g(x,y){return x?/^\d{1,3}(\.\d{1,3}){3}$/.test(x)?`ws://${x}:${y}`:`wss://${x.replace(/\/relay\/?$/,"")}/relay`:""}const u=Q(()=>{const x=g(k.value,b.value);return b.value!==d.port||x!==d.publicUrl});async function B(){try{const x=await $fetch("/api/system/relay");if(Object.assign(d,x),x.detectedUrl){const y=j(x.detectedUrl);/^\d{1,3}(\.\d{1,3}){3}$/.test(y)&&(P.value=y)}(!H||!u.value)&&(b.value=x.port||9443,k.value=x.publicUrl?j(x.publicUrl):"",H=!0)}catch{}}async function A(){try{await a()}catch{return}p.value=!0;try{const x=!d.enabled;await $fetch("/api/system/relay",{method:"POST",headers:v(),body:{enabled:x}}),d.enabled=x,x?(b.value=d.port,k.value=d.publicUrl?j(d.publicUrl):"",setTimeout(B,3e3)):(d.status="stopped",d.circuits=0,d.rooms=0,d.peers=0,d.tunnelHosts=0,d.tunnelSessions=0)}catch{}finally{p.value=!1}}async function K(){try{await a()}catch{return}C.value=!0;try{const x=!d.trackerEnabled;await $fetch("/api/system/relay",{method:"POST",headers:v(),body:{trackerEnabled:x}}),d.trackerEnabled=x,setTimeout(B,3e3)}catch{}finally{C.value=!1}}async function J(){try{await a()}catch{return}T.value=!0;try{const x=g(k.value,b.value);await $fetch("/api/system/relay",{method:"POST",headers:v(),body:{enabled:!0,port:b.value,publicUrl:x}}),d.port=b.value,d.publicUrl=x,H=!1,setTimeout(B,3e3)}catch{}finally{T.value=!1}}return be(()=>{B(),_=Ce(B,15e3)}),me(()=>{_&&clearInterval(_)}),(x,y)=>(s(),o("div",Kr,[e("div",zr,[e("div",Gr,[y[2]||(y[2]=e("span",{class:"text-base font-medium text-gray-200"},"Public Relay Node",-1)),e("p",Jr,l(r(d).enabled?"This machine is part of the decentralized network — helping others connect securely":"Disabled — this machine does not relay traffic for the network"),1)]),e("button",{onClick:A,disabled:r(p),class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",r(d).enabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":r(d).enabled}])},null,2)],10,Zr)]),r(d).enabled?(s(),o("div",Xr,[e("div",eo,[y[3]||(y[3]=e("span",{class:"text-base font-medium text-gray-200"},"Room Tracker",-1)),e("p",to,l(r(d).trackerEnabled?"This node indexes public rooms — users can discover games hosted on the network":"Disabled — this node only relays encrypted traffic, does not index rooms"),1)]),e("button",{onClick:K,disabled:r(C),class:h(["relative w-11 h-6 rounded-full transition-all shrink-0",r(d).trackerEnabled?"bg-gradient-to-r from-purple-500 to-purple-600 shadow-lg shadow-purple-500/30":"bg-gray-600"])},[e("span",{class:h(["absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow",{"translate-x-5":r(d).trackerEnabled}])},null,2)],10,so)])):m("",!0),r(d).enabled?(s(),o("div",ro,[e("span",{class:h(["w-2 h-2 rounded-full shrink-0",r(d).status==="online"?"bg-green-400 shadow-lg shadow-green-400/50":r(d).status==="stopped"?"bg-yellow-400":"bg-red-400"])},null,2),e("span",oo,l(r(d).status==="online"?"Relay running":r(d).status==="stopped"?"Relay stopped":"Relay status unknown"),1),e("button",{onClick:B,class:"ml-auto text-gray-400 hover:text-spider-green-400 transition-colors"},[M(r(re),{class:"w-4 h-4"})])])):m("",!0),r(d).enabled&&r(d).status==="online"?(s(),o("div",ao,[e("div",no,[e("div",lo,l(r(d).peers),1),y[4]||(y[4]=e("div",{class:"text-base text-gray-500"},"Peers",-1))]),e("div",io,[e("div",uo,l(r(d).circuits),1),y[5]||(y[5]=e("div",{class:"text-base text-gray-500"},"Circuits",-1))]),e("div",co,[e("div",go,l(r(d).rooms),1),y[6]||(y[6]=e("div",{class:"text-base text-gray-500"},"Rooms",-1))]),e("div",po,[e("div",bo,l(r(d).tunnelHosts),1),y[7]||(y[7]=e("div",{class:"text-base text-gray-500"},"Tunnel Hosts",-1))]),e("div",mo,[e("div",xo,l(r(d).tunnelSessions),1),y[8]||(y[8]=e("div",{class:"text-base text-gray-500"},"Sessions",-1))]),r(d).publicKey?(s(),o("div",yo,[e("div",{class:"text-base font-mono text-gray-300 truncate",title:r(d).publicKey},l(r(d).publicKey.slice(0,8))+"...",9,fo),y[9]||(y[9]=e("div",{class:"text-base text-gray-500"},"Public Key",-1))])):m("",!0)])):m("",!0),r(d).enabled?(s(),o("div",vo,[e("div",ho,[e("div",wo,[y[10]||(y[10]=e("label",{class:"block text-base text-gray-500 uppercase tracking-wider font-medium mb-1"},"Port",-1)),O(e("input",{"onUpdate:modelValue":y[0]||(y[0]=w=>_e(b)?b.value=w:null),type:"number",class:"w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:"9443"},null,512),[[E,r(b),void 0,{number:!0}]])]),e("div",ko,[y[11]||(y[11]=e("label",{class:"block text-base text-gray-500 uppercase tracking-wider font-medium mb-1"},"Public Host",-1)),e("div",_o,[e("span",{class:h(["px-2 py-1 rounded-md text-base font-mono font-medium shrink-0",r(R)?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"])},l(r(R)?"ws://":"wss://"),3),O(e("input",{"onUpdate:modelValue":y[1]||(y[1]=w=>_e(k)?k.value=w:null),type:"text",class:"flex-1 bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none",placeholder:r(P)||"mydomain.com"},null,8,$o),[[E,r(k)]])]),r(P)&&!r(k)?(s(),o("p",So," Auto-detected IP: "+l(r(P)),1)):m("",!0)])]),e("div",Co,[y[12]||(y[12]=e("span",{class:"text-base text-gray-500"},"Public URL:",-1)),e("code",{class:h(["text-base font-mono",r(R)?"text-yellow-400":"text-green-400"])},l(r(F)),3),r(R)?(s(),o("span",To,"No SSL")):(s(),o("span",Po,"SSL Ready"))]),r(u)?(s(),o("div",Ro,[e("button",{onClick:J,disabled:r(T),class:"px-4 py-1.5 bg-gradient-to-r from-spider-green-500 to-spider-green-600 text-white text-base font-medium rounded-lg shadow-lg shadow-spider-green-500/20 hover:shadow-spider-green-500/40 transition-all disabled:opacity-40"},l(r(T)?"Saving...":"Save & Restart Relay"),9,Ao),y[13]||(y[13]=e("span",{class:"text-base text-yellow-400"},"Unsaved changes",-1))])):m("",!0)])):m("",!0),e("div",Do,[y[14]||(y[14]=e("p",{class:"text-base text-blue-300/80"},[D(" When enabled, this machine acts as a "),e("span",{class:"text-blue-200 font-semibold"},"public relay node"),D(" in the decentralized network. It helps route encrypted traffic between users without being able to read the contents. The more nodes in the network, the more secure and resilient it becomes. ")],-1)),e("p",Mo," Port "+l(r(d).port||9443)+" must be reachable from the internet for full relay functionality. The public URL is auto-detected from your IP if not set manually. ",1)])]))}}),Oo=Object.assign(Uo,{__name:"SystemRelaySection"}),Eo={class:"space-y-4"},Bo={class:"flex flex-wrap gap-2"},Ho=["disabled"],Lo={key:0,class:"text-center py-6 text-gray-400 text-xs rounded-xl bg-gray-800/40 border border-gray-700/50"},Io={key:1,class:"text-center py-8 text-gray-500 text-xs rounded-xl bg-gray-800/40 border border-gray-700/50"},No={key:2,class:"space-y-2"},Fo={class:"min-w-0 flex-1"},jo={class:"text-xs text-white truncate font-medium"},qo={class:"text-xs text-gray-400 mt-0.5"},Qo={key:0,class:"text-spider-green-400/70"},Vo={class:"flex gap-1.5 ml-3 shrink-0"},Wo=["onClick"],Yo=["onClick","disabled"],Ko=["onClick"],zo=se({__name:"BackupSection",setup(c){const a=xe(),{getAuthHeaders:v,authToken:d}=te(),{requireAuth:b}=ue(),k=S(!1),P=S(""),p=S(""),C=S(""),T=S(!1),_=S(""),H=S("");function R(w){return w<1024?`${w} B`:w<1024*1024?`${(w/1024).toFixed(1)} KB`:`${(w/(1024*1024)).toFixed(1)} MB`}function F(w){try{return new Date(w).toLocaleString()}catch{return w}}async function j(w){try{await b()}catch{return}const U=new URLSearchParams({file:w});d.value&&U.set("token",d.value);const q=document.createElement("a");q.href=`/api/system/backup-download?${U.toString()}`,q.download=w,q.click()}async function g(){try{await b()}catch{return}P.value="",k.value=!0}async function u(){P.value="";try{await a.createBackup(),k.value=!1}catch(w){P.value=w.data?.message||"Failed to create backup"}}async function B(w){try{await b()}catch{w.preventDefault();return}}async function A(w){const U=w.target;if(U.files?.length){try{await a.uploadBackup(U.files[0])}catch(q){alert(q.data?.message||"Failed to upload backup")}U.value=""}}async function K(w){try{await b()}catch{return}p.value=w,_.value="",H.value=""}async function J(w){try{await b()}catch{return}C.value=w,_.value=""}async function x(){T.value=!0,_.value="",H.value="";try{await a.restoreBackup(p.value),H.value="Backup restored successfully!",setTimeout(()=>{p.value=""},2e3)}catch(w){_.value=w.data?.message||"Restore failed"}finally{T.value=!1}}async function y(){T.value=!0,_.value="";try{await a.deleteBackup(C.value),C.value=""}catch(w){_.value=w.data?.message||"Delete failed"}finally{T.value=!1}}return be(()=>{a.fetchBackups()}),(w,U)=>{const q=Pe;return s(),o("div",Eo,[e("div",Bo,[e("button",{onClick:g,disabled:r(a).backupCreating,class:"bg-gradient-to-r from-spider-green-500 to-spider-green-600 hover:from-spider-green-400 hover:to-spider-green-500 disabled:from-gray-600 disabled:to-gray-700 text-white text-xs font-semibold py-2 px-4 rounded-xl transition-all flex items-center gap-2 shadow-lg shadow-spider-green-500/20 disabled:shadow-none"},[r(a).backupCreating?(s(),G(r(re),{key:1,class:"w-3.5 h-3.5 animate-spin"})):(s(),G(r(et),{key:0,class:"w-3.5 h-3.5"})),D(" "+l(r(a).backupCreating?"Creating...":"Create Backup"),1)],8,Ho),e("label",{class:"bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-xs font-semibold py-2 px-4 rounded-xl transition-all flex items-center gap-2 cursor-pointer",onClick:B},[M(r(Te),{class:"w-3.5 h-3.5"}),U[3]||(U[3]=D(" Upload Backup ",-1)),e("input",{type:"file",accept:".json,.json.gz,.gz",class:"hidden",onChange:A},null,32)])]),U[4]||(U[4]=e("div",{class:"p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"},[e("p",{class:"text-xs text-blue-300 font-semibold mb-1"},"What gets saved?"),e("p",{class:"text-xs text-gray-400 leading-relaxed"}," Everything: sensor readings, outlet history, light schedules, power events, device info, grow logs, and automation rules. Backups are compressed to save space. You can upload both compressed (.json.gz) and uncompressed (.json) files — they'll be compressed automatically. Restoring adds data without erasing what's already there. A safety copy is always made before restoring. ")],-1)),r(a).backupsLoading?(s(),o("div",Lo," Loading backups... ")):r(a).backups.length===0?(s(),o("div",Io," No backups found. Create one to start protecting your data. ")):(s(),o("div",No,[(s(!0),o(N,null,W(r(a).backups,I=>(s(),o("div",{key:I.filename,class:"flex items-center justify-between rounded-xl bg-gray-800/40 border border-gray-700/50 px-3 sm:px-4 py-2.5 sm:py-3"},[e("div",Fo,[e("p",jo,l(I.filename),1),e("p",qo,[D(l(R(I.size))+" ",1),I.compressed?(s(),o("span",Qo,"(compressed)")):m("",!0),D(" · "+l(F(I.created)),1)])]),e("div",Vo,[e("button",{onClick:Z=>j(I.filename),class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-gray-700/60 text-gray-300 hover:bg-gray-600/60"}," Download ",8,Wo),e("button",{onClick:Z=>K(I.filename),disabled:r(a).backupRestoring,class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50"}," Restore ",8,Yo),e("button",{onClick:Z=>J(I.filename),class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-red-500/20 text-red-400 hover:bg-red-500/30"}," Delete ",8,Ko)])]))),128))])),M(q,{visible:k.value,title:"Create Backup",message:"This will export all database tables to a JSON backup file.",info:"The backup will include all sensor data, outlet states, light states, events, and configuration. This may take a moment for large databases.","confirm-text":"Create Backup",variant:"default",loading:r(a).backupCreating,error:P.value,onConfirm:u,onCancel:U[0]||(U[0]=I=>{k.value=!1,P.value=""})},null,8,["visible","loading","error"]),M(q,{visible:!!p.value,title:"Restore Backup",message:`Restore data from: ${p.value}`,warning:"A safety backup will be created automatically before restoring. Existing data will NOT be deleted — the backup data will be merged with current records.","confirm-text":"Restore",variant:"warning",loading:T.value,error:_.value,success:H.value,onConfirm:x,onCancel:U[1]||(U[1]=I=>{p.value="",_.value="",H.value=""})},null,8,["visible","message","loading","error","success"]),M(q,{visible:!!C.value,title:"Delete Backup",message:`Permanently delete: ${C.value}`,danger:"This backup file will be permanently deleted. This action cannot be undone.","confirm-text":"Delete",variant:"danger",loading:T.value,error:_.value,onConfirm:y,onCancel:U[2]||(U[2]=I=>{C.value="",_.value=""})},null,8,["visible","message","loading","error"])])}}}),Go=Object.assign(zo,{__name:"SystemBackupSection"}),Jo={class:"flex flex-col h-full space-y-3"},Zo={class:"flex items-center gap-2 sm:gap-3 flex-wrap"},Xo={key:0},ea={class:"flex gap-1 flex-wrap"},ta=["disabled"],sa=["disabled"],ra=["disabled"],oa={class:"ml-auto text-xs text-gray-500 self-end pb-1"},aa={class:"flex-1 flex flex-col min-h-0"},na={key:0,class:"h-full flex items-center justify-center p-6 text-gray-500 text-xs text-center"},la={class:"flex items-center gap-2 sm:gap-3 mb-1.5 flex-wrap"},ia={class:"text-xs text-gray-500 shrink-0"},da={class:"text-xs text-gray-400 break-all"},ua={class:"text-xs text-gray-300 whitespace-pre-wrap break-words pl-3 border-l-2 border-gray-700/50 ml-1"},ca=se({__name:"RawDataSection",setup(c){const a=xe(),{getAuthHeaders:v}=te(),{requireAuth:d}=ue(),b=S(),k=S(!1);let P=null;function p(g){return new Date(g).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"})}function C(g){try{return JSON.stringify(g,null,2)}catch{return String(g)}}function T(g){return g==="ps5"?"Power Strip":g==="lc"?"Light Ctrl":g==="phoneApp"?"Server→Device":g.toUpperCase()}function _(g){return g==="ps5"?"bg-blue-500/20 text-blue-400":g==="lc"?"bg-purple-500/20 text-purple-400":g==="phoneApp"?"bg-orange-500/20 text-orange-400":"bg-gray-700/50 text-gray-400"}async function H(){try{await d()}catch{return}a.rawLive=!a.rawLive,R()}function R(){P&&(P.close(),P=null),a.rawFilter==="phoneApp"&&a.rawLive&&(P=new EventSource("/api/system/phone-app-stream"),P.onmessage=g=>{try{const u=JSON.parse(g.data);a.addRawMessage(u)}catch{}},P.onerror=()=>{setTimeout(()=>{a.rawFilter==="phoneApp"&&a.rawLive&&R()},2e3)})}ie(()=>a.rawFilter,()=>{a.clearRawMessages(),R()}),ie(()=>a.rawLive,()=>{R()});function F(g){const u=Date.now();return Array.from({length:g},(B,A)=>`${u}${A}`)}async function j(g){try{await d()}catch{return}k.value=g;const u=F(20);a.addPendingRequestIds(u);try{await $fetch("/api/system/device-request",{method:"POST",headers:v(),body:{type:g,msgIds:u}})}catch(B){a.addRawMessage({timestamp:Date.now(),topic:`request/${g}/error`,deviceType:"system",mac:"",payload:{error:B.data?.message||B.message||"Request failed"}})}finally{k.value=!1}}return ie(()=>a.rawMessages.length,()=>{b.value&&Ge(()=>{b.value.scrollTop=b.value.scrollHeight})}),me(()=>{a.rawLive=!1,P&&(P.close(),P=null)}),(g,u)=>{const B=$e;return s(),o("div",Jo,[M(B,null,{default:de(()=>[e("div",Zo,[e("div",null,[u[6]||(u[6]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Show",-1)),O(e("select",{"onUpdate:modelValue":u[0]||(u[0]=A=>r(a).rawFilter=A),class:"bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"},[...u[5]||(u[5]=[e("option",{value:"all"},"All devices",-1),e("option",{value:"ps5"},"Power Strip only",-1),e("option",{value:"lc"},"Light Controller only",-1),e("option",{value:"phoneApp"},"Phone App (Server→Device)",-1)])],512),[[Se,r(a).rawFilter]])]),e("div",null,[u[7]||(u[7]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Mode",-1)),e("button",{onClick:H,class:h(["flex items-center gap-2 text-xs py-1.5 px-3 rounded-lg transition-all font-medium",r(a).rawLive?"bg-spider-green-500/20 text-spider-green-400 border border-spider-green-500/30":"bg-gray-800/60 text-gray-400 border border-gray-600/50 hover:bg-gray-700/60"])},[e("span",{class:h(["w-2 h-2 rounded-full",r(a).rawLive?"bg-spider-green-400 shadow-lg shadow-spider-green-400/50 animate-pulse":"bg-gray-500"])},null,2),D(" "+l(r(a).rawLive?"Live":"Paused"),1)],2)]),r(a).rawFilter!=="phoneApp"?(s(),o("div",Xo,[u[8]||(u[8]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"},"Request",-1)),e("div",ea,[e("button",{onClick:u[1]||(u[1]=A=>j("status")),disabled:!!k.value,class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50"},l(k.value==="status"?"...":"Sensor"),9,ta),e("button",{onClick:u[2]||(u[2]=A=>j("settings")),disabled:!!k.value,class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 disabled:opacity-50"},l(k.value==="settings"?"...":"Settings"),9,sa),e("button",{onClick:u[3]||(u[3]=A=>j("system")),disabled:!!k.value,class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 disabled:opacity-50"},l(k.value==="system"?"...":"System"),9,ra)])])):m("",!0),e("div",null,[u[9]||(u[9]=e("label",{class:"block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1"}," ",-1)),e("button",{onClick:u[4]||(u[4]=A=>r(a).clearRawMessages()),class:"text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-gray-700/60 text-gray-400 hover:bg-gray-600/60 hover:text-gray-200"}," Clear ")]),e("div",oa,l(r(a).rawMessages.length)+" messages ",1)])]),_:1}),M(B,null,{default:de(()=>[e("div",aa,[e("div",{ref_key:"messagesContainer",ref:b,class:"rounded-xl bg-gray-900/60 border border-gray-700/50 overflow-y-auto font-mono flex-1",style:{minHeight:"300px"}},[r(a).rawMessages.length===0?(s(),o("div",na,[r(a).rawFilter==="phoneApp"?(s(),o(N,{key:0},[D(l(r(a).rawLive?`Waiting for commands from Spider Farmer server...
Use the Android app to send commands.`:"Press Live to start capturing commands from the Spider Farmer server (phone app)."),1)],64)):(s(),o(N,{key:1},[D(l(r(a).rawLive?"Waiting for device messages...":"Press Live to start listening, or use the request buttons above to fetch data on demand."),1)],64))])):m("",!0),(s(!0),o(N,null,W(r(a).rawMessages,(A,K)=>(s(),o("div",{key:K,class:"border-b border-gray-800/50 last:border-0 px-3 sm:px-4 py-2.5 hover:bg-gray-800/30"},[e("div",la,[e("span",ia,l(p(A.timestamp)),1),e("span",{class:h(["text-xs px-1.5 py-0.5 rounded-md font-semibold shrink-0 uppercase tracking-wider",_(A.deviceType)])},l(T(A.deviceType)),3),A.requestType?(s(),o("span",{key:0,class:h(["text-xs px-1.5 py-0.5 rounded-md font-semibold shrink-0 uppercase tracking-wider",{"bg-blue-500/20 text-blue-400":A.requestType==="status","bg-purple-500/20 text-purple-400":A.requestType==="settings","bg-amber-500/20 text-amber-400":A.requestType==="system"}])},l(A.requestType==="status"?"Sensor":A.requestType==="settings"?"Settings":"System"),3)):m("",!0),e("span",da,l(A.topic),1)]),e("pre",ua,l(C(A.payload)),1)]))),128))],512)])]),_:1})])}}}),ga=Object.assign(ca,{__name:"SystemRawDataSection"}),pa={class:"grid grid-cols-1 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 p-2 sm:p-4"},ba={class:"xl:col-span-2 rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"},ma={class:"flex items-center gap-3 mb-1 relative"},xa={class:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-spider-green-500/30 to-emerald-600/20 flex items-center justify-center"},ya={class:"flex flex-col gap-3 sm:gap-4 lg:gap-6"},fa={class:"rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"},va={class:"flex items-center gap-3 mb-1 relative"},ha={class:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-purple-500/30 to-purple-600/20 flex items-center justify-center"},wa={class:"rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"},ka={class:"flex items-center gap-3 mb-1 relative"},_a={class:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-blue-500/30 to-blue-600/20 flex items-center justify-center"},$a={class:"rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 flex-1 flex flex-col relative overflow-hidden"},Sa={class:"flex items-center gap-3 mb-1 relative"},Ca={class:"w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-yellow-500/30 to-amber-600/20 flex items-center justify-center"},ja={__name:"system",setup(c){return(a,v)=>(s(),o("div",pa,[e("div",ba,[v[1]||(v[1]=e("div",{class:"absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-spider-green-500/30"},null,-1)),e("div",ma,[e("div",xa,[M(r(tt),{class:"w-4 h-4 sm:w-5 sm:h-5 text-spider-green-400"})]),v[0]||(v[0]=e("h2",{class:"text-sm sm:text-lg lg:text-xl font-semibold text-white"},"Server & Services",-1))]),v[2]||(v[2]=e("p",{class:"text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative"},"Manage running services, network ports, privacy, and remote forwarding.",-1)),M(Yr)]),e("div",ya,[e("div",fa,[v[4]||(v[4]=e("div",{class:"absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-purple-500/30"},null,-1)),e("div",va,[e("div",ha,[M(r(st),{class:"w-4 h-4 sm:w-5 sm:h-5 text-purple-400"})]),v[3]||(v[3]=e("h2",{class:"text-sm sm:text-lg lg:text-xl font-semibold text-white"},"Relay Node",-1))]),v[5]||(v[5]=e("p",{class:"text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative"},"Join the decentralized network as a public relay and tracker node.",-1)),M(Oo)]),e("div",wa,[v[7]||(v[7]=e("div",{class:"absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-blue-500/30"},null,-1)),e("div",ka,[e("div",_a,[M(r(rt),{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-400"})]),v[6]||(v[6]=e("h2",{class:"text-sm sm:text-lg lg:text-xl font-semibold text-white"},"Database Backups",-1))]),v[8]||(v[8]=e("p",{class:"text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative"},"Save, restore, and manage copies of all your grow data.",-1)),M(Go)]),e("div",$a,[v[10]||(v[10]=e("div",{class:"absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-yellow-500/30"},null,-1)),e("div",Sa,[e("div",Ca,[M(r(ot),{class:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-400"})]),v[9]||(v[9]=e("h2",{class:"text-sm sm:text-lg lg:text-xl font-semibold text-white"},"Live Messages",-1))]),v[11]||(v[11]=e("p",{class:"text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative"},"See what your devices are reporting in real time, or request data on demand.",-1)),M(ga,{class:"flex-1"})])])]))}};export{ja as default};
