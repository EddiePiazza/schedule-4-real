const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DgvDcRgy.js","./entry.BzfH9u9r.css"])))=>i.map(i=>d[i]);
import{$ as h,_ as r}from"./DgvDcRgy.js";const d=h("system",{state:()=>({services:[],servicesLoading:!1,backups:[],backupsLoading:!1,backupCreating:!1,backupRestoring:!1,config:null,configLoading:!1,configSaving:!1,proxyConfig:null,proxyLoading:!1,proxySaving:!1,updateStatus:null,updateLoading:!1,updateApplying:!1,updateProgress:null,rawMessages:[],rawLive:!1,rawFilter:"all",pendingRequestIds:new Set}),actions:{async fetchServices(){this.servicesLoading=!0;try{const t=await $fetch("/api/system/services");this.services=t}catch{}finally{this.servicesLoading=!1}},async controlService(t,e){try{const{getAuthHeaders:a}=await r(()=>import("./DgvDcRgy.js").then(s=>s.aG),__vite__mapDeps([0,1]),import.meta.url).then(s=>({getAuthHeaders:s.useAuth().getAuthHeaders}));await $fetch("/api/system/service-control",{method:"POST",headers:a(),body:{name:t,action:e}}),await this.fetchServices()}catch(a){throw a}},async fetchBackups(){this.backupsLoading=!0;try{const t=await $fetch("/api/system/backups");this.backups=t}catch{}finally{this.backupsLoading=!1}},async createBackup(){this.backupCreating=!0;try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(e=>e.aG),__vite__mapDeps([0,1]),import.meta.url).then(e=>({getAuthHeaders:e.useAuth().getAuthHeaders}));await $fetch("/api/system/backups",{method:"POST",headers:t()}),await this.fetchBackups()}catch(t){throw t}finally{this.backupCreating=!1}},async deleteBackup(t){try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders}));await $fetch("/api/system/backup-delete",{method:"POST",headers:e(),body:{filename:t}}),await this.fetchBackups()}catch(e){throw e}},async restoreBackup(t){this.backupRestoring=!0;try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders}));await $fetch("/api/system/backup-restore",{method:"POST",headers:e(),body:{filename:t}})}catch(e){throw e}finally{this.backupRestoring=!1}},async uploadBackup(t){try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(s=>s.aG),__vite__mapDeps([0,1]),import.meta.url).then(s=>({getAuthHeaders:s.useAuth().getAuthHeaders})),a=new FormData;a.append("file",t),await $fetch("/api/system/backup-upload",{method:"POST",headers:e(),body:a}),await this.fetchBackups()}catch(e){throw e}},async fetchConfig(){this.configLoading=!0;try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders})),e=await $fetch("/api/system/config",{headers:t()});this.config=e}catch{}finally{this.configLoading=!1}},async saveConfig(t){this.configSaving=!0;try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders}));await $fetch("/api/system/config",{method:"POST",headers:e(),body:t}),await this.fetchConfig()}catch(e){throw e}finally{this.configSaving=!1}},async fetchProxyConfig(){this.proxyLoading=!0;try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders})),e=await $fetch("/api/system/proxy-config",{headers:t()});this.proxyConfig=e}catch{}finally{this.proxyLoading=!1}},async saveProxyConfig(t){this.proxySaving=!0;try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders}));await $fetch("/api/system/proxy-config",{method:"POST",headers:e(),body:t}),await this.fetchProxyConfig()}catch(e){throw e}finally{this.proxySaving=!1}},async fetchUpdateStatus(){this.updateLoading=!0;try{const t=await $fetch("/api/system/updates");this.updateStatus=t,t.inProgress&&t.updateProgress&&!this.updateProgress&&(this.updateProgress=t.updateProgress)}catch{}finally{this.updateLoading=!1}},async checkForUpdates(){this.updateLoading=!0;try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders})),e=await $fetch("/api/system/updates",{method:"POST",headers:t(),body:{action:"check"}});return await this.fetchUpdateStatus(),e}catch(t){throw t}finally{this.updateLoading=!1}},async applyUpdates(t=[]){this.updateApplying=!0,this.updateProgress={phase:"downloading",component:null,current:0,total:0,error:null,timestamp:Date.now()};try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(s=>s.aG),__vite__mapDeps([0,1]),import.meta.url).then(s=>({getAuthHeaders:s.useAuth().getAuthHeaders}));let a=null;try{a=await $fetch("/api/system/updates",{method:"POST",headers:e(),body:{action:"apply",components:t}})}catch(s){const i=!s?.statusCode;if(i&&this.updateProgress?.phase!=="downloading")return;if(i&&this.updateProgress?.phase==="downloading"){this.updateProgress={phase:"restarting",component:"web",current:0,total:0,error:null,timestamp:Date.now()};return}const o=s?.data?.message||s?.statusMessage||s?.message||"Request failed";throw new Error(o)}if(a&&a.success===!1){if(a.error?.includes("already in progress")){await this.fetchUpdateStatus();return}throw new Error(a.error||"Update failed on server")}await this.fetchUpdateStatus()}catch(e){throw this.updateProgress=null,e}finally{this.updateApplying=!1}},async rollbackUpdate(t){this.updateApplying=!0;try{const{getAuthHeaders:e}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders}));try{await $fetch("/api/system/updates",{method:"POST",headers:e(),body:{action:"rollback",timestamp:t}})}catch{}}catch(e){throw e}finally{this.updateApplying=!1}},async toggleAutoUpdate(){try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(a=>a.aG),__vite__mapDeps([0,1]),import.meta.url).then(a=>({getAuthHeaders:a.useAuth().getAuthHeaders})),e=await $fetch("/api/system/updates",{method:"POST",headers:t(),body:{action:"toggle-auto"}});return await this.fetchUpdateStatus(),e}catch(t){throw t}},async dismissChangelog(){this.updateStatus&&(this.updateStatus.showChangelog=!1),localStorage.setItem("sf_changelog_dismissed",new Date().toISOString());try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(e=>e.aG),__vite__mapDeps([0,1]),import.meta.url).then(e=>({getAuthHeaders:e.useAuth().getAuthHeaders}));await $fetch("/api/system/updates",{method:"POST",headers:t(),body:{action:"dismiss-changelog"}})}catch{}},async dismissAdvert(){this.updateStatus&&(this.updateStatus.advertDismissed=!0),localStorage.setItem("sf_advert_dismissed","true");try{const{getAuthHeaders:t}=await r(()=>import("./DgvDcRgy.js").then(e=>e.aG),__vite__mapDeps([0,1]),import.meta.url).then(e=>({getAuthHeaders:e.useAuth().getAuthHeaders}));await $fetch("/api/system/updates",{method:"POST",headers:t(),body:{action:"dismiss-advert"}})}catch{}},addRawMessage(t){if(this.rawFilter==="phoneApp"){if(t.deviceType!=="phoneApp")return}else if(t.deviceType==="phoneApp"||this.rawFilter!=="all"&&t.deviceType!==this.rawFilter)return;this.rawMessages.push(t),this.rawMessages.length>500&&this.rawMessages.splice(0,this.rawMessages.length-500)},addPendingRequestIds(t){for(const e of t)this.pendingRequestIds.add(e);setTimeout(()=>{for(const e of t)this.pendingRequestIds.delete(e)},5e3)},clearRawMessages(){this.rawMessages=[]}}});export{d as u};
