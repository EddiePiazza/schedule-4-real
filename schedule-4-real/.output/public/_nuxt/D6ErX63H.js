import{a as J,b as V,_ as $,c as I}from"./C9EZ_mge.js";import{e as D,Q as O,R as g,g as H,K,p as Q,h as e,x as X,c as Z,a as k,l as y,o as L}from"./DmxtK6KT.js";import"./D8fWBd82.js";import"./DXCei9NK.js";import"./c30dKgre.js";import"./ChY7hmwU.js";import"./CsP7wx5q.js";import"./DY9cJwVb.js";import"./CquA2nwV.js";import"./CL9Rll8R.js";import"./DlAUqK2U.js";import"./ePFIOiZJ.js";import"./Bt624CGs.js";import"./CaZK0e2f.js";import"./D08SmgA3.js";const z={key:1,class:"w-full h-full flex items-center justify-center bg-gray-950"},S="sf_room3d_guest_char",b="sf_room3d_guest_name",pe=D({__name:"[...slug]",setup(F){const _=O(),R=/^[A-Z0-9]{4}$/,c=Array.isArray(_.params.slug)?_.params.slug:[_.params.slug],l=c.length>=2&&c[0]==="join",T=l?c.slice(1).join("/"):"",d=c.length===1?String(c[0]||""):"",u=d.startsWith("sfr:")||d.startsWith("sfr%3A"),v=l?T:u?decodeURIComponent(d).slice(4):"",p=!l&&!u?d.toUpperCase():"";!l&&!u&&!R.test(p)&&g("/",{replace:!0});const m=V(),{lobbyCharLoading:N,availableCharacters:i,selectedCharacter:n,carouselSelectedIdx:A,loadAvailableCharacters:E,initLobbyScene:w,disposeLobbyScene:P,initCarouselPositions:W,lobbyPrevChar:j,lobbyNextChar:q,onLobbyWheel:B}=J();let x=!1;const f=y(!1),h=y(!1),C=y(""),a=y("");H(async()=>{const t=localStorage.getItem(b);t&&(a.value=t);const o=localStorage.getItem(S);if(l||u){if(v.length<10){f.value=!0;return}h.value=!0}else{if(!R.test(p))return;try{const s=await $fetch(`/api/room3d/room-link/${encodeURIComponent(p)}`);C.value=s.envId,h.value=!0}catch{f.value=!0;return}}if(await E(),!i.value.length){f.value=!0;return}if(o&&i.value.includes(o)){const s=i.value.indexOf(o);if(s>0){const r=[...i.value];r.splice(s,1),r.unshift(o),i.value=r}n.value=o}await K(),w(),W(),!l&&!u&&C.value&&(m.connect(),m.joinRoom(C.value,a.value.trim()||"Lobby",void 0,n.value))}),Q(()=>{P(),x||m.dispose()});function G(){const t=a.value.trim();t&&localStorage.setItem(b,t)}async function M(){if(!a.value.trim()||!h.value)return;localStorage.setItem(S,n.value),localStorage.setItem(b,a.value.trim());const t=I();t.autoJoinVoice.value&&await t.requestMicrophone(),x=!0,v?g({path:"/room3d",query:{sfr:v,name:a.value.trim(),char:n.value}}):g({path:"/room3d",query:{invite:p,name:a.value.trim(),char:n.value}})}async function U(t){const o=t.startsWith("sfr:")?t.slice(4):t;localStorage.setItem(S,n.value);const s=a.value.trim()||"Guest";localStorage.setItem(b,s);const r=I();r.autoJoinVoice.value&&await r.requestMicrophone(),x=!0,g({path:"/room3d",query:{sfr:o,name:s,char:n.value}})}return(t,o)=>{const s=$;return e(f)?(L(),Z("div",z,[...o[1]||(o[1]=[k("div",{class:"text-center"},[k("p",{class:"text-red-400 text-lg font-bold mb-2"},"Invalid Link"),k("p",{class:"text-white/40 text-base"},"The link you followed is not valid or has expired.")],-1)])])):(L(),X(s,{key:0,"guest-mode":"","guest-ready":!!e(a).trim()&&e(h),"guest-online-count":e(m).playerCount.value,"guest-connected":e(m).connected.value,environments:[],"available-characters":e(i),"selected-character":e(n),"carousel-selected-idx":e(A),"lobby-char-loading":e(N),"display-name":e(a),"is-dev":!1,"edit-mode":!1,authenticated:!1,"room-settings":{},"invite-tokens":{},"copied-token":"","active-room-idx":0,"hide-token-paste":!!e(v),onPrevChar:e(j),onNextChar:e(q),onLobbyWheel:e(B),"onUpdate:displayName":o[0]||(o[0]=r=>a.value=r),onSaveDisplayName:G,onEnterRoom:M,onJoinByToken:U},null,8,["guest-ready","guest-online-count","guest-connected","available-characters","selected-character","carousel-selected-idx","lobby-char-loading","display-name","hide-token-paste","onPrevChar","onNextChar","onLobbyWheel"]))}}});export{pe as default};
