import{a as V,b as $,c as S,_ as D}from"./CzCqiYtI.js";import{e as O,R as H,S as g,g as K,K as X,p as Z,h as e,x as z,c as F,a as R,l as y,o as T}from"./C4Z1jz3b.js";import"./Cjwj_ux1.js";import"./DdTT3sq1.js";import"./GX_aOqNe.js";import"./aa6uehi1.js";import"./D6TnxOrq.js";import"./BEf-rsLb.js";import"./NDPXTVhU.js";import"./BOX61QB3.js";import"./4Y_6vxGx.js";import"./DlAUqK2U.js";import"./5YbR_2uA.js";import"./wj__8HtH.js";import"./BQcPuWsl.js";import"./CfeDZA3L.js";const Q={key:1,class:"w-full h-full flex items-center justify-center bg-gray-950"},I="sf_room3d_guest_char",b="sf_room3d_guest_name",he=O({__name:"[...slug]",setup(Y){const _=H(),L=/^[A-Z0-9]{4}$/,c=Array.isArray(_.params.slug)?_.params.slug:[_.params.slug],i=c.length>=2&&c[0]==="join",N=i?c.slice(1).join("/"):"",d=c.length===1?String(c[0]||""):"",u=d.startsWith("sfr:")||d.startsWith("sfr%3A"),v=i?N:u?decodeURIComponent(d).slice(4):"",p=!i&&!u?d.toUpperCase():"";!i&&!u&&!L.test(p)&&g("/",{replace:!0});const m=$(),{lobbyCharLoading:A,availableCharacters:l,selectedCharacter:n,carouselSelectedIdx:E,loadAvailableCharacters:w,initLobbyScene:P,disposeLobbyScene:q,initCarouselPositions:M,lobbyPrevChar:W,lobbyNextChar:j,onLobbyWheel:B}=V();let x=!1;const f=y(!1),h=y(!1),C=y(""),a=y("");K(async()=>{const t=localStorage.getItem(b);t&&(a.value=t);const o=localStorage.getItem(I);if(i||u){if(v.length<10){f.value=!0;return}h.value=!0}else{if(!L.test(p))return;try{const s=await $fetch(`/api/room3d/room-link/${encodeURIComponent(p)}`);C.value=s.envId,h.value=!0}catch{f.value=!0;return}}if(await w(),!l.value.length){f.value=!0;return}if(o&&l.value.includes(o)){const s=l.value.indexOf(o);if(s>0){const k=[...l.value];k.splice(s,1),k.unshift(o),l.value=k}n.value=o}await X(),P(),M(),!i&&!u&&C.value&&(m.connect(),m.joinRoom(C.value,a.value.trim()||"Lobby",void 0,n.value));const r=S();r.autoJoinVoice.value&&r.requestMicrophone()}),Z(()=>{q(),x||m.dispose()});function G(){const t=a.value.trim();t&&localStorage.setItem(b,t)}async function J(){if(!a.value.trim()||!h.value)return;localStorage.setItem(I,n.value),localStorage.setItem(b,a.value.trim());const t=S();t.autoJoinVoice.value&&await t.requestMicrophone(),x=!0,v?g({path:"/room3d",query:{sfr:v,name:a.value.trim(),char:n.value}}):g({path:"/room3d",query:{invite:p,name:a.value.trim(),char:n.value}})}async function U(t){const o=t.startsWith("sfr:")?t.slice(4):t;localStorage.setItem(I,n.value);const r=a.value.trim()||"Guest";localStorage.setItem(b,r);const s=S();s.autoJoinVoice.value&&await s.requestMicrophone(),x=!0,g({path:"/room3d",query:{sfr:o,name:r,char:n.value}})}return(t,o)=>{const r=D;return e(f)?(T(),F("div",Q,[...o[1]||(o[1]=[R("div",{class:"text-center"},[R("p",{class:"text-red-400 text-lg font-bold mb-2"},"Invalid Link"),R("p",{class:"text-white/40 text-base"},"The link you followed is not valid or has expired.")],-1)])])):(T(),z(r,{key:0,"guest-mode":"","guest-ready":!!e(a).trim()&&e(h),"guest-online-count":e(m).playerCount.value,"guest-connected":e(m).connected.value,environments:[],"available-characters":e(l),"selected-character":e(n),"carousel-selected-idx":e(E),"lobby-char-loading":e(A),"display-name":e(a),"is-dev":!1,"edit-mode":!1,authenticated:!1,"room-settings":{},"invite-tokens":{},"copied-token":"","active-room-idx":0,"hide-token-paste":!!e(v),onPrevChar:e(W),onNextChar:e(j),onLobbyWheel:e(B),"onUpdate:displayName":o[0]||(o[0]=s=>a.value=s),onSaveDisplayName:G,onEnterRoom:J,onJoinByToken:U},null,8,["guest-ready","guest-online-count","guest-connected","available-characters","selected-character","carousel-selected-idx","lobby-char-loading","display-name","hide-token-paste","onPrevChar","onNextChar","onLobbyWheel"]))}}});export{he as default};
