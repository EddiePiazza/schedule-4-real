import{Z as m,J as c}from"./CMZ-0X6O.js";const T=m("settings",{state:()=>({targets:null,dayNight:null,loading:!1,saving:!1,loaded:!1}),getters:{isDaytime:t=>{if(!t.targets)return!0;const e=new Date,a=e.getHours()*60+e.getMinutes(),[s=0,r=0]=t.targets.dayTime.startTime.split(":").map(Number),[i=0,n=0]=t.targets.dayTime.endTime.split(":").map(Number),g=s*60+r,d=i*60+n;return a>=g&&a<d},currentTempTarget(t){return t.targets?this.isDaytime?t.targets.temp.targetDay:t.targets.temp.targetNight:null},currentHumiTarget(t){return t.targets?this.isDaytime?t.targets.humi.targetDay:t.targets.humi.targetNight:null},currentCo2Target(t){return t.targets?this.isDaytime?t.targets.co2.targetDay:t.targets.co2.targetNight:null},currentPeriod(t){const e=t.dayNight?.dayStart||t.targets?.dayTime?.startTime||"06:00",a=t.dayNight?.dayEnd||t.targets?.dayTime?.endTime||"00:00",s=new Date,r=s.getHours()*60+s.getMinutes(),[i=0,n=0]=e.split(":").map(Number),[g=0,d=0]=a.split(":").map(Number),o=i*60+n,h=g*60+d;let u;return o<=h?u=r>=o&&r<h:u=r>=o||r<h,u?"day":"night"}},actions:{async fetchDayNight(){try{const t=await $fetch("/api/settings/day-night");t&&(this.dayNight=t)}catch{}},async fetchTargets(){this.loading=!0;try{const t=await $fetch("/api/settings/targets");t&&(this.targets={dayTime:{startTime:t.dayTime?.startTime||"00:00",endTime:t.dayTime?.endTime||"12:00"},temp:t.temp,humi:t.humi,co2:t.co2},this.loaded=!0)}catch{}finally{this.loading=!1}},async saveTargets(){if(this.targets){this.saving=!0;try{const t={dayTime:{startTime:this.timeToSeconds(this.targets.dayTime.startTime),endTime:this.timeToSeconds(this.targets.dayTime.endTime)},temp:{targetDay:Math.round(this.targets.temp.targetDay),targetNight:Math.round(this.targets.temp.targetNight),deadband:Math.round(this.targets.temp.deadband)},humi:{targetDay:Math.round(this.targets.humi.targetDay),targetNight:Math.round(this.targets.humi.targetNight),deadband:Math.round(this.targets.humi.deadband)},co2:{targetDay:Math.round(this.targets.co2.targetDay),targetNight:Math.round(this.targets.co2.targetNight),deadband:Math.round(this.targets.co2.deadband)}},{getAuthHeaders:e}=c();await $fetch("/api/settings/targets",{method:"POST",headers:e(),body:t})}catch(t){throw t}finally{this.saving=!1}}},timeToSeconds(t){const[e=0,a=0]=t.split(":").map(Number);return e*3600+a*60},secondsToTime(t){const e=Math.floor(t/3600),a=Math.floor(t%3600/60);return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},updateTargets(t){this.targets&&(this.targets={...this.targets,...t})}}});export{T as u};
