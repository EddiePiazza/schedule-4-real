import{_ as t,c as n}from"./server.mjs";import{ref as r,computed as i,readonly as c,defineComponent as u,watch as b,mergeProps as v,unref as p,isRef as h,createVNode as m,resolveDynamicComponent as x,useSSRContext as f,reactive as y}from"vue";import{ssrRenderAttrs as g,ssrRenderComponent as k,ssrRenderStyle as _,ssrRenderClass as P,ssrInterpolate as I,ssrRenderAttr as C,ssrRenderList as T,ssrIncludeBooleanAttr as R,ssrRenderVNode as A,ssrRenderTeleport as S}from"vue/server-renderer";import{Bars3Icon as $,MicrophoneIcon as D,QuestionMarkCircleIcon as M,ChevronLeftIcon as E,ChevronRightIcon as U,KeyIcon as j,GlobeAltIcon as N,Cog6ToothIcon as V,DocumentDuplicateIcon as O,CheckIcon as L,LockClosedIcon as z,LockOpenIcon as K,PencilSquareIcon as F,XMarkIcon as B,ShieldCheckIcon as H,EyeSlashIcon as W,ArrowPathIcon as J,AdjustmentsHorizontalIcon as G,ServerStackIcon as Q,LinkIcon as Y,MagnifyingGlassIcon as q,StarIcon as X}from"@heroicons/vue/24/solid";import{s as Z}from"./_plugin-vue_export-helper-DlAUqK2U.mjs";import{StarIcon as ee}from"@heroicons/vue/24/outline";import*as te from"three";import{GLTFLoader as ae}from"three/addons/loaders/GLTFLoader.js";import{y as se,b as ne,U as oe}from"./useImmersiveMode-DuEjIo9R.mjs";var re=Object.defineProperty,__publicField=(t,n,r)=>((t,n,r)=>n in t?re(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r)(t,"symbol"!=typeof n?n+"":n,r);const Gt=()=>{},ie=u({__name:"Room3dPrivacyInfo",__ssrInlineRender:!0,props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup:(t,{emit:n})=>(n,r,i,c)=>{S(r,n=>{t.modelValue?(n('<div class="fixed inset-0 z-[200] flex items-center justify-center p-4" data-v-2c69e695><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" data-v-2c69e695></div><div class="relative w-full max-w-3xl max-h-[85vh] overflow-y-auto rounded-2xl border border-white/10 bg-gray-950/95 shadow-2xl custom-scrollbar" data-v-2c69e695><button class="absolute top-4 right-4 z-10 p-1.5 rounded-lg text-white/40 hover:text-white/80 hover:bg-white/10 transition-all" data-v-2c69e695>'),n(k(p(B),{class:"w-5 h-5"},null,i)),n('</button><div class="p-6 pb-4 border-b border-white/[0.06]" data-v-2c69e695><div class="flex items-center gap-3" data-v-2c69e695><div class="w-10 h-10 rounded-xl bg-emerald-500/20 border border-emerald-500/30 flex items-center justify-center" data-v-2c69e695>'),n(k(p(H),{class:"w-5 h-5 text-emerald-400"},null,i)),n('</div><div data-v-2c69e695><h2 class="text-xl font-bold text-white" data-v-2c69e695>Anonymous &amp; Private Rooms</h2><p class="text-base text-white/40" data-v-2c69e695>How your privacy is protected</p></div></div></div><div class="p-6 space-y-6" data-v-2c69e695><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(W),{class:"w-5 h-5 text-emerald-400"},null,i)),n(' Zero Knowledge Architecture </h3><p class="text-base text-white/60 leading-relaxed" data-v-2c69e695> Your rooms use <strong class="text-white/80" data-v-2c69e695>onion-routed encryption</strong> — the same principle behind Tor. When you share a room, neither the relay servers nor anyone monitoring the network can see who is connecting to whom, or what data is being exchanged. </p></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2" data-v-2c69e695>'),n(k(p(J),{class:"w-5 h-5 text-sky-400"},null,i)),n(' How It Works </h3><div class="bg-black/40 rounded-xl border border-white/[0.06] p-4 font-mono text-base" data-v-2c69e695><div class="space-y-2 text-white/50" data-v-2c69e695><div class="flex items-center gap-2" data-v-2c69e695><span class="text-emerald-400 font-bold w-16 shrink-0 text-right" data-v-2c69e695>You</span><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-emerald-500/15 text-emerald-400 px-2 py-0.5 rounded border border-emerald-500/20" data-v-2c69e695>encrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-sky-400" data-v-2c69e695>Relay A</span></div><div class="flex items-center gap-2 pl-20" data-v-2c69e695><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-sky-500/15 text-sky-400 px-2 py-0.5 rounded border border-sky-500/20" data-v-2c69e695>re-encrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-purple-400" data-v-2c69e695>Relay B</span></div><div class="flex items-center gap-2 pl-40" data-v-2c69e695><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-purple-500/15 text-purple-400 px-2 py-0.5 rounded border border-purple-500/20" data-v-2c69e695>decrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-amber-400 font-bold" data-v-2c69e695>Guest</span></div><div class="pt-2 border-t border-white/[0.06] text-white/30 text-base" data-v-2c69e695> Each relay only sees the previous and next hop — never both endpoints. </div></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(z),{class:"w-5 h-5 text-amber-400"},null,i)),n(' Encryption </h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-3" data-v-2c69e695><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Key Exchange</div><div class="text-base text-white/50" data-v-2c69e695>X25519 (Curve25519) — unique session keys per connection, forward secrecy</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Data Encryption</div><div class="text-base text-white/50" data-v-2c69e695>XChaCha20-Poly1305 AEAD — 256-bit authenticated encryption</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Packet Padding</div><div class="text-base text-white/50" data-v-2c69e695>All packets are fixed 512 bytes — traffic analysis impossible</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Chaff Traffic</div><div class="text-base text-white/50" data-v-2c69e695>Constant noise between relays — hides when real data flows</div></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2" data-v-2c69e695>'),n(k(p(G),{class:"w-5 h-5 text-purple-400"},null,i)),n(' Room Modes </h3><div class="space-y-3" data-v-2c69e695><div class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><div class="flex items-center gap-2 mb-2" data-v-2c69e695>'),n(k(p(j),{class:"w-4 h-4 text-emerald-400"},null,i)),n('<span class="text-base font-bold text-emerald-400" data-v-2c69e695>Invite Only</span></div><p class="text-base text-white/50 leading-relaxed" data-v-2c69e695> Your room is invisible to everyone. Only people with your encrypted invite link can join. The link contains an encrypted token that reveals nothing about your server or IP address. Share it via any messaging app — even if intercepted, it cannot be used to locate your server. </p></div><div class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><div class="flex items-center gap-2 mb-2" data-v-2c69e695>'),n(k(p(N),{class:"w-4 h-4 text-sky-400"},null,i)),n('<span class="text-base font-bold text-sky-400" data-v-2c69e695>Public</span></div><p class="text-base text-white/50 leading-relaxed" data-v-2c69e695> Your room appears in the Public Rooms browser so others can discover it. The listing is published through the onion network — the tracker that stores room listings is <strong class="text-white/70" data-v-2c69e695>blind</strong>: it only sees encrypted blobs and relay entry points, never your IP or room contents. Visitors connect through the same onion circuit, preserving both your anonymity and theirs. </p></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(Q),{class:"w-5 h-5 text-rose-400"},null,i)),n(' The Blind Tracker </h3><p class="text-base text-white/60 leading-relaxed mb-3" data-v-2c69e695> The room directory (tracker) is designed to be completely blind: </p><ul class="space-y-2 text-base text-white/50" data-v-2c69e695><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695>Stores only <strong class="text-white/70" data-v-2c69e695>encrypted blobs</strong> — cannot read room names, descriptions, or any metadata</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>No IP addresses</strong> are stored — rooms are identified by relay entry points only</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>Ephemeral storage</strong> — room listings expire automatically (TTL) and are never persisted to disk</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>No logs</strong> — relay servers keep zero logs of connections, traffic, or metadata</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695>Even if a relay is compromised, it only sees encrypted traffic — <strong class="text-white/70" data-v-2c69e695>no readable content</strong></span></li></ul></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(Y),{class:"w-5 h-5 text-teal-400"},null,i)),n(' Invite Links </h3><p class="text-base text-white/60 leading-relaxed" data-v-2c69e695> Invite links contain an encrypted token that can only be decrypted by the app itself. The link URL points to a relay domain — <strong class="text-white/70" data-v-2c69e695>not your server</strong>. If someone inspects the link, they see only the relay&#39;s address and an opaque encrypted string. No IP addresses, room names, or identifying information is embedded in the link. </p></section><section class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><h3 class="text-base font-bold text-white/60 uppercase tracking-wider mb-3" data-v-2c69e695>Technical Summary</h3><div class="grid grid-cols-2 gap-x-6 gap-y-2 text-base" data-v-2c69e695><div class="text-white/40" data-v-2c69e695>Protocol</div><div class="text-white/70" data-v-2c69e695>Onion routing (multi-hop)</div><div class="text-white/40" data-v-2c69e695>Key Exchange</div><div class="text-white/70" data-v-2c69e695>X25519 (Curve25519)</div><div class="text-white/40" data-v-2c69e695>Symmetric Cipher</div><div class="text-white/70" data-v-2c69e695>XChaCha20-Poly1305</div><div class="text-white/40" data-v-2c69e695>Hash Function</div><div class="text-white/70" data-v-2c69e695>BLAKE2b</div><div class="text-white/40" data-v-2c69e695>Packet Size</div><div class="text-white/70" data-v-2c69e695>Fixed 512 bytes</div><div class="text-white/40" data-v-2c69e695>Key Rotation</div><div class="text-white/70" data-v-2c69e695>Every 60 minutes</div><div class="text-white/40" data-v-2c69e695>Logging</div><div class="text-white/70" data-v-2c69e695>Zero — no logs anywhere</div><div class="text-white/40" data-v-2c69e695>Tracker Storage</div><div class="text-white/70" data-v-2c69e695>In-memory only (Redis ephemeral)</div><div class="text-white/40" data-v-2c69e695>Library</div><div class="text-white/70" data-v-2c69e695>libsodium (NaCl/TweetNaCl)</div></div></section></div></div></div>')):n("\x3c!----\x3e")},"body",!1,i)}}),le=ie.setup;ie.setup=(t,n)=>{const r=f();return(r.modules||(r.modules=new Set)).add("components/room3d/Room3dPrivacyInfo.vue"),le?le(t,n):void 0};const de=Object.assign(Z(ie,[["__scopeId","data-v-2c69e695"]]),{__name:"Room3dPrivacyInfo"}),ce=24,ue=16,be=32,ve=16,pe=32,he=48,me=49,xe=51,fe=64,we=65,ye=66,ge=67,ke=68,_e=69;let Pe=null,Ce=null;async function Re(){return Pe||(Ce||(Ce=import("libsodium-wrappers").then(async t=>{const n=t.default||t;return await n.ready,Pe=n,n})),Ce)}function Jt(t,n,r){const i=Pe,c=i.randombytes_buf(ce),u=new Uint8Array(4);new DataView(u.buffer).setUint32(0,r);const b=i.crypto_aead_xchacha20poly1305_ietf_encrypt(t,u,null,c,n),v=new Uint8Array(c.length+b.length);return v.set(c),v.set(b,c.length),v}function Qt(t,n,r){const i=Pe;if(t.length<40)return null;const c=t.subarray(0,ce),u=t.subarray(ce),b=new Uint8Array(4);new DataView(b.buffer).setUint32(0,r);try{return i.crypto_aead_xchacha20poly1305_ietf_decrypt(null,u,b,c,n)}catch{return null}}function at(t,n,r){const i=n?(new TextEncoder).encode(n):new Uint8Array(0),c=new Uint8Array(2+i.length+2+r.length);return c[0]=t,c[1]=i.length,c.set(i,2),new DataView(c.buffer).setUint16(2+i.length,r.length),c.set(r,4+i.length),c}function Ie(t){return Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("")}function st(t){const n=Pe,r=Pe.randombytes_buf(32),i=(new TextEncoder).encode(t),c=new Uint8Array(i.length+r.length);return c.set(i),c.set(r,i.length),n.crypto_generichash(32,c)}class ea{constructor(){__publicField(this,"hops",[]),__publicField(this,"ws",null),__publicField(this,"circuitId",0),__publicField(this,"messageQueue",[]),__publicField(this,"dataCallback",null),__publicField(this,"_destroyed",!1)}async build(t){const n=(await Re()).randombytes_buf(4);this.circuitId=new DataView(n.buffer).getUint32(0);const r=t[0];this.ws=new WebSocket(r.url),this.ws.binaryType="arraybuffer",await new Promise((t,n)=>{this.ws.onopen=()=>t(),this.ws.onerror=()=>n(new Error(`Failed to connect to relay ${r.url}`))}),this.ws.onclose=()=>{this._destroyed};const i=await this._handshakeWithRelay();this.hops.push({url:r.url,sessionRx:i.rx,sessionTx:i.tx,publicKey:i.serverPk}),this.ws.onmessage=t=>{const n=new Uint8Array(t.data);this._handleIncoming(n)};for(let n=1;n<t.length;n++){const r=t[n],i=await this._extendCircuit(r);this.hops.push({url:r.url,sessionRx:i.rx,sessionTx:i.tx,publicKey:i.serverPk})}}send(t,n,r=null){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let i=at(n,r,t);for(let t=this.hops.length-1;t>=0;t--){const n=this.hops[t];t===this.hops.length-1||(i=at(ve,this.hops[t+1].url,i));const r=Jt(i,n.sessionTx,this.circuitId),c=r.subarray(0,ce),u=r.subarray(ce);i=new Uint8Array(28+u.length),i.set(c,0),new DataView(i.buffer).setUint32(ce,this.circuitId),i.set(u,28)}this.ws.send(i)}onData(t){this.dataCallback=t}destroy(){this._destroyed=!0,this.ws&&(this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null);for(const t of this.hops)t.sessionRx.fill(0),t.sessionTx.fill(0);this.hops=[],this.messageQueue=[]}_handleIncoming(t){let n=t;for(const t of this.hops){const r=Qt(n,t.sessionRx,this.circuitId);if(!r)return;n=r}const r=function(t){if(t.length<4)return null;const n=t[0],r=t[1],i=r>0?(new TextDecoder).decode(t.subarray(2,2+r)):null,c=new DataView(t.buffer,t.byteOffset).getUint16(2+r);return{type:n,nextHop:i,payload:t.subarray(4+r,4+r+c)}}(n);if(r){if(this.messageQueue.length>0)return void this.messageQueue.shift().resolve({type:r.type,payload:r.payload});this.dataCallback&&this.dataCallback(r.type,r.payload)}}_waitForMessage(t=1e4){return new Promise((n,r)=>{const i=setTimeout(()=>{const t=this.messageQueue.findIndex(t=>t.resolve===n);t>=0&&this.messageQueue.splice(t,1),r(new Error("Timeout waiting for relay response"))},t);this.messageQueue.push({resolve:t=>{clearTimeout(i),n(t)}})})}async _handshakeWithRelay(){var t;const n=Pe,r=n.crypto_kx_keypair(),i=new Uint8Array(60),c=n.randombytes_buf(ce);i.set(c,0),new DataView(i.buffer).setUint32(ce,this.circuitId),i.set(r.publicKey,28),this.ws.send(function(t,n){if(t.length>=n)return t.subarray(0,n);const r=new Uint8Array(n);r.set(t);const i=Pe.randombytes_buf(n-t.length);return r.set(i,t.length),r}(i,512));const u=await new Promise((t,n)=>{const r=setTimeout(()=>{this.ws.onmessage=null,n(new Error("Handshake timeout"))},1e4);this.ws.onmessage=n=>{clearTimeout(r),t(new Uint8Array(n.data))}}),b=new Uint8Array([83,70,80,75]);let v,p,h;if(u.length>=4&&u[0]===b[0]&&u[1]===b[1]&&u[2]===b[2]&&u[3]===b[3])v=u.subarray(4,36),p=u.subarray(36,60),h=u.subarray(64);else{const r=0===this.hops.length?null==(t=this.ws)?void 0:t.url:"";if(!r)throw new Error("Cannot determine relay URL for PK fetch");const i=r.replace(/^wss:/,"https:").replace(/^ws:/,"http:")+"/pk",c=await fetch(i);if(!c.ok)throw new Error(`Failed to fetch relay PK from ${i}`);const b=await c.json();v=n.from_hex(b.publicKey),p=u.subarray(0,ce),h=u.subarray(28)}const m=n.crypto_kx_client_session_keys(r.publicKey,r.privateKey,v),x=h.subarray(0,49),f=new Uint8Array(4);new DataView(f.buffer).setUint32(0,this.circuitId);try{n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,x,f,p,m.sharedRx)}catch{throw new Error("Handshake verification failed — relay rejected or key mismatch")}return{rx:m.sharedRx,tx:m.sharedTx,serverPk:new Uint8Array(v)}}async _extendCircuit(t){const n=Pe,r=n.crypto_kx_keypair(),i=new Uint8Array(60),c=n.randombytes_buf(ce);i.set(c,0),new DataView(i.buffer).setUint32(ce,this.circuitId),i.set(r.publicKey,28),this.send(i,ve,t.url);const u=(await this._waitForMessage()).payload,b=new Uint8Array([83,70,80,75]),v=u.length>=4&&u[0]===b[0]&&u[1]===b[1]&&u[2]===b[2]&&u[3]===b[3]?4:0;if(u.length<v+be+ce+4+ue+1)throw new Error("Extend handshake reply too short");const p=u.subarray(v,v+be),h=n.crypto_kx_client_session_keys(r.publicKey,r.privateKey,p);return{rx:h.sharedRx,tx:h.sharedTx,serverPk:new Uint8Array(p)}}}class ot{constructor(){__publicField(this,"rx",new Uint8Array(0)),__publicField(this,"tx",new Uint8Array(0)),__publicField(this,"nonceCounter",0)}async initAsClient(t){const n=(await Re()).crypto_kx_keypair();return this._keypair=n,n.publicKey}async completeAsClient(t){const n=Pe,r=this._keypair,i=n.crypto_kx_client_session_keys(r.publicKey,r.privateKey,t);this.rx=i.sharedRx,this.tx=i.sharedTx}async initAsServer(t){const n=await Re(),r=n.crypto_kx_keypair(),i=n.crypto_kx_server_session_keys(r.publicKey,r.privateKey,t);return this.rx=i.sharedRx,this.tx=i.sharedTx,r.publicKey}encrypt(t){const n=Pe,r=n.randombytes_buf(ce),i=n.crypto_aead_xchacha20poly1305_ietf_encrypt(t,null,null,r,this.tx),c=new Uint8Array(r.length+i.length);return c.set(r),c.set(i,r.length),c}decrypt(t){const n=Pe;if(t.length<40)return null;const r=t.subarray(0,ce),i=t.subarray(ce);try{return n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,i,null,r,this.rx)}catch{return null}}destroy(){this.rx.fill(0),this.tx.fill(0)}}let Te=!1,Ae=[],Se="",$e=null;const De=[];let Me=null,Ee=null,Ue=null;function aa(){const t=r(!1),i=r(!1),u=r([]),b=r(!1),v=r(null);async function l(){if(Te)t.value=!0;else try{await Re();const r=n(),i=r.public.onionRelayA||"wss://schedule4real.com/rooms",c=r.public.onionRelayB||"wss://r2.imaset.com";Se=r.public.onionTracker||i,Ae=[{url:i,publicKey:new Uint8Array(be)},{url:c,publicKey:new Uint8Array(be)}];const u=Pe,b=(new TextEncoder).encode("spiderfarmer-room-metadata-v1");$e=u.crypto_generichash(32,b),Te=!0,t.value=!0}catch(t){v.value=t.message}}async function o(t){const n=new ea,r=t||[...Ae];return await n.build(r),De.push(n),n}function w(t){if(!$e||t.length<40)return null;const n=Pe,r=t.subarray(0,ce),i=t.subarray(ce);try{const t=n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,i,null,r,$e),c=(new TextDecoder).decode(t);return JSON.parse(c)}catch{return null}}return{isReady:c(t),isPublishing:c(i),isDiscovering:c(b),publicRooms:c(u),connectionError:c(v),init:l,publishRoom:async function(t){Te||await l(),i.value=!0,v.value=null;try{const n=st(t.envId),r=function(t){if(!$e)throw new Error("Not initialized");const n=Pe,r=JSON.stringify(t),i=(new TextEncoder).encode(r),c=n.randombytes_buf(ce),u=n.crypto_aead_xchacha20poly1305_ietf_encrypt(i,null,null,c,$e),b=new Uint8Array(c.length+u.length);return b.set(c),b.set(u,c.length),b}({envId:t.envId,name:t.name,description:t.description,capacity:t.capacity||8,tags:t.tags||[]}),c=await o([...Ae].reverse()),u=Ae[Ae.length-1].url,b=(new TextEncoder).encode(u),v=t.private?1:0,p=new Uint8Array(36+b.length+r.length);p[0]=fe,p[1]=v,p.set(n,2),new DataView(p.buffer).setUint16(34,b.length),p.set(b,36),p.set(r,36+b.length),c.send(p,fe);const h=Ie(n);Ue=void 0,Me=c,c.onData((n,r)=>{n===_e&&async function(t,n){const r=Pe;if(t.length<23)return;const i=t.subarray(0,20),c=new DataView(t.buffer,t.byteOffset+20).getUint16(0),u=(new TextDecoder).decode(t.subarray(22,22+c)),b=Ae.find(t=>t.url===u);if(!b)return;const v=[...Ae.filter(t=>t.url!==u),b],p=await o(v),h=r.crypto_kx_keypair(),m=new Uint8Array(52);m.set(i),m.set(h.publicKey,20),p.send(m,xe);const x=await Promise.race([new Promise(t=>{p.onData((n,r)=>{n===pe&&r.length>=be&&t(r.subarray(0,be))})}),new Promise((t,n)=>setTimeout(()=>n(new Error("Visitor PK timeout")),15e3))]),f=r.crypto_kx_server_session_keys(h.publicKey,h.privateKey,x),y=new ot;y.rx=f.sharedRx,y.tx=f.sharedTx;const g=(new TextEncoder).encode(JSON.stringify({envId:n})),k=y.encrypt(g);p.send(k,pe),setTimeout(()=>{y.destroy(),p.destroy();const t=De.indexOf(p);t>=0&&De.splice(t,1)},3e3)}(r,t.envId).catch(t=>{})});const m={roomId:h,keepAlive:()=>{var t;if((null==(t=c.ws)?void 0:t.readyState)===WebSocket.OPEN){const t=new Uint8Array(33);t[0]=ge,t.set(n,1),c.send(t,ge)}},unpublish:()=>{Ue&&clearInterval(Ue),Ue=null,c.destroy(),Me=null,Ee=null,i.value=!1}};return Ee=m,i.value=!1,m}catch(t){return v.value=t.message,i.value=!1,null}},discoverRooms:async function(){Te||await l(),b.value=!0,v.value=null;let t=[],n=null;try{const n=await o([...Ae].reverse()),r=new Uint8Array(7);r[0]=we,new DataView(r.buffer).setUint32(1,0),new DataView(r.buffer).setUint16(5,50);const i=new Promise(t=>{n.onData((n,r)=>{n===ye&&t(r)})});n.send(r,we);const c=await Promise.race([i,new Promise((t,n)=>setTimeout(()=>n(new Error("Tracker query timeout")),8e3))]);if(c.length>=6){const n=new DataView(c.buffer,c.byteOffset).getUint16(4);let r=6;for(let i=0;i<n&&r<c.length&&!(r+36>c.length);i++){const n=c.subarray(r,r+32),i=new DataView(c.buffer,c.byteOffset+r+32).getUint16(0),u=(new TextDecoder).decode(c.subarray(r+34,r+34+i)),b=new DataView(c.buffer,c.byteOffset+r+34+i).getUint16(0),v=c.subarray(r+36+i,r+36+i+b),p=Ie(n),h=w(v);h&&t.push({roomId:p,envId:h.envId,name:h.name,description:h.description,capacity:h.capacity,tags:h.tags,entryRelay:u}),r+=36+i+b}}n.destroy();const u=De.indexOf(n);u>=0&&De.splice(u,1)}catch(t){n=t.message}if(0===t.length)try{t=await async function(){const t=Pe,n=Ae.map(t=>t.url.replace("wss://","https://").replace("ws://","http://")),r=new Map,i=await Promise.allSettled(n.map(async t=>{const n=await fetch(`${t}/rooms`,{signal:AbortSignal.timeout(8e3)});if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}));for(const n of i)if("fulfilled"===n.status)for(const i of n.value.rooms)if(!r.has(i.id))try{const n=w(t.from_base64(i.metadata,t.base64_variants.ORIGINAL));n&&r.set(i.id,{roomId:i.id,envId:n.envId,name:n.name,description:n.description,capacity:n.capacity,tags:n.tags,entryRelay:i.relay})}catch{}return[...r.values()]}(),t.length}catch{}return 0===t.length&&n&&(v.value=n),u.value=t,b.value=!1,t},connectToRoom:async function(t){Te||await l(),v.value=null;try{const n=Pe,r=[...Ae],i=await o(r),c=r[r.length-1].url,u=n.randombytes_buf(20);if(i.send(new Uint8Array(u),he),!await Promise.race([new Promise(t=>{i.onData((n,r)=>{n===me&&t(1===r[0])})}),new Promise((t,n)=>setTimeout(()=>n(new Error("Rendezvous establish timeout")),1e4))]))throw i.destroy(),new Error("Failed to establish rendezvous");const b=await o([...Ae].reverse()),v=(new TextEncoder).encode(c),p=function(t){const n=new Uint8Array(t.length/2);for(let r=0;r<n.length;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}(t),h=new Uint8Array(55+v.length);h[0]=ke,h.set(p,1),h.set(u,33),new DataView(h.buffer).setUint16(53,v.length),h.set(v,55),b.send(h,ke);const m=new ot,x=await m.initAsClient(i),f=await Promise.race([new Promise(t=>{i.onData((n,r)=>{n===xe&&t(r.subarray(1))})}),new Promise((t,n)=>setTimeout(()=>n(new Error("Host join timeout (30s)")),3e4))]);i.send(x,pe),await m.completeAsClient(f),b.destroy();const y=De.indexOf(b);y>=0&&De.splice(y,1);const g=await Promise.race([new Promise(t=>{i.onData((n,r)=>{if(n===pe){const n=m.decrypt(r);if(n)try{const r=JSON.parse((new TextDecoder).decode(n));r.envId&&t(r.envId)}catch{}}})}),new Promise((t,n)=>setTimeout(()=>n(new Error("Room info timeout")),1e4))]),k={onData:null,onClose:null,send:t=>{const n=m.encrypt(t);i.send(n,pe)},close:()=>{var t;m.destroy(),i.destroy();const n=De.indexOf(i);n>=0&&De.splice(n,1),null==(t=k.onClose)||t.call(k)}};return i.onData((t,n)=>{var r;if(t===pe){const t=m.decrypt(n);t&&(null==(r=k.onData)||r.call(k,t))}}),{connection:k,envId:g}}catch(t){return v.value=t.message,null}},destroyAll:function(){Ue&&clearInterval(Ue),Ue=null;for(const t of De)t.destroy();De.length=0,Me=null,Ee=null,i.value=!1,b.value=!1},deriveRoomId:function(t){if(!Pe)throw new Error("Not initialized");return Ie(st(t))},generateInviteToken:function(t,n){if(!Pe||!$e)throw new Error("Not initialized");const r=Pe,i=(new TextEncoder).encode(t),c=r.randombytes_buf(ce),u=r.crypto_aead_xchacha20poly1305_ietf_encrypt(i,null,null,c,$e),b=new Uint8Array(c.length+u.length);return b.set(c),b.set(u,c.length),`${n}.${r.to_base64(b,r.base64_variants.URLSAFE_NO_PADDING)}`},parseInviteToken:function(t){if(!Pe||!$e)return null;const n=Pe;let r="",i="";if(t.startsWith("sfr:"))i=t.slice(4);else{const n=t.indexOf(".");if(n<1)return null;r=t.substring(0,n),i=t.substring(n+1)}try{const t=n.from_base64(i,n.base64_variants.URLSAFE_NO_PADDING);if(t.length<40)return null;const c=t.subarray(0,ce),u=t.subarray(ce),b=n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,u,null,c,$e);if(!b||0===b.length)return null;return{roomKey:r,envId:(new TextDecoder).decode(b)}}catch{return null}},fetchTunnelInfo:async function(){try{return await $fetch("/api/room3d/tunnel-info")}catch{return null}}}}const je=r([]),Ne=r({});function sa(){function e(t){je.value.some(n=>n.roomId===t.roomId)||je.value.push({roomId:t.roomId,name:t.name,addedAt:Date.now()})}function a(t){je.value=je.value.filter(n=>n.roomId!==t)}function s(t){return je.value.some(n=>n.roomId===t)}return{favorites:c(je),customNames:c(Ne),addFavorite:e,removeFavorite:a,isFavorite:s,toggleFavorite:function(t){s(t.roomId)?a(t.roomId):e(t)},setCustomName:function(t,n){n.trim()?Ne.value[t]=n.trim():delete Ne.value[t]},getDisplayName:function(t){return Ne.value[t.roomId]||t.name}}}const Ve=u({__name:"Room3dPublicBrowser",__ssrInlineRender:!0,props:{authenticated:{type:Boolean}},emits:["join-public-room"],setup(t,{emit:n}){aa();const c=sa(),u=r(""),b=r([]),h=r(!1),m=r(null),x=r(null),f=r("");r(null);const{getDisplayName:y,isFavorite:_}=c;const A=i(()=>{let t=b.value;if(u.value.trim()){const n=u.value.toLowerCase();t=t.filter(t=>{var r,i;return t.name.toLowerCase().includes(n)||(null==(r=t.description)?void 0:r.toLowerCase().includes(n))||(null==(i=t.tags)?void 0:i.some(t=>t.toLowerCase().includes(n)))})}return[...t].sort((t,n)=>{const r=_(t.roomId)?1:0,i=_(n.roomId)?1:0;return r!==i?i-r:t.name.localeCompare(n.name)})});return(t,n,r,i)=>{n(`<div${g(v({class:"w-full max-w-4xl mx-auto"},i))} data-v-be232ca8><div class="flex items-center gap-2 mb-3" data-v-be232ca8><div class="relative flex-1" data-v-be232ca8>`),n(k(p(q),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/25"},null,r)),n(`<input${C("value",p(u))} type="text" placeholder="Search rooms..." class="w-full bg-black/60 border border-white/20 rounded-xl pl-9 pr-3 py-2 text-white text-base placeholder-white/30 focus:border-emerald-500/40 focus:outline-none transition-colors" data-v-be232ca8></div><button${R(p(h))?" disabled":""} class="p-2 rounded-xl bg-black/60 border border-white/20 hover:bg-emerald-500/10 hover:border-emerald-500/30 transition-all disabled:opacity-30" title="Refresh" data-v-be232ca8>`),n(k(p(J),{class:["w-5 h-5 text-white/50",{"animate-spin":p(h)}]},null,r)),n('</button></div><div class="max-h-[30vh] sm:max-h-[35vh] overflow-y-auto pr-0.5 pub-scroll" data-v-be232ca8>'),p(h)&&!p(b).length?n('<div class="flex flex-col items-center py-8" data-v-be232ca8><div class="w-8 h-8 border-2 border-white/5 border-t-emerald-400 rounded-full animate-spin mb-3" data-v-be232ca8></div><p class="text-white/40 text-base" data-v-be232ca8>Discovering rooms...</p></div>'):p(m)?n(`<div class="text-center py-6" data-v-be232ca8><p class="text-red-400/70 text-base mb-2" data-v-be232ca8>${I(p(m))}</p><button class="text-base text-emerald-400/60 hover:text-emerald-400 transition-colors" data-v-be232ca8>Try again</button></div>`):p(A).length||p(h)?(n('<div class="space-y-2" data-v-be232ca8>\x3c!--[--\x3e'),T(p(A),t=>{var i;n(`<div class="space-y-0" data-v-be232ca8><button class="${P([[p(x)===t.roomId?"rounded-t-xl border-b-0 border-amber-500/30 bg-amber-500/[0.04]":"rounded-xl hover:border-emerald-500/30 hover:bg-emerald-500/[0.06]"],"group w-full text-left flex items-center gap-3 bg-black/50 border border-white/[0.12] px-4 py-3 transition-all"])}" data-v-be232ca8><div class="flex-1 min-w-0" data-v-be232ca8><div class="flex items-center gap-2" data-v-be232ca8><h4 class="text-base font-bold text-white/80 group-hover:text-emerald-300 transition-colors truncate" data-v-be232ca8>${I(p(y)(t))}</h4>`),t.passwordProtected?n(k(p(z),{class:"w-4 h-4 text-amber-400/60 flex-shrink-0"},null,r)):n("\x3c!----\x3e"),n("\x3c!--[--\x3e"),T(null==(i=t.tags)?void 0:i.slice(0,2),t=>{n(`<span class="hidden sm:inline px-1.5 py-0.5 rounded bg-white/[0.06] text-white/35 text-base leading-tight flex-shrink-0" data-v-be232ca8>${I(t)}</span>`)}),n("\x3c!--]--\x3e</div>"),t.description?n(`<p class="text-base text-white/35 truncate mt-0.5" data-v-be232ca8>${I(t.description)}</p>`):n("\x3c!----\x3e"),n('</div><div class="p-1 cursor-pointer flex-shrink-0" data-v-be232ca8>'),function(t){return _(t)}(t.roomId)?n(k(p(X),{class:"w-4 h-4 text-amber-400"},null,r)):n(k(p(ee),{class:"w-4 h-4 text-white/15 group-hover:text-white/30 transition-colors"},null,r)),n("</div></button>"),p(x)===t.roomId?(n('<div class="bg-black/50 border border-white/[0.12] border-t-0 border-amber-500/30 rounded-b-xl px-4 py-3 flex items-center gap-2" data-v-be232ca8>'),n(k(p(z),{class:"w-4 h-4 text-amber-400/50 flex-shrink-0"},null,r)),n(`<input${C("value",p(f))} type="password" placeholder="Enter room password" maxlength="32" class="flex-1 bg-black/60 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-amber-500/50 focus:outline-none transition-colors" data-v-be232ca8><button class="px-3 py-1.5 rounded-lg bg-amber-500/20 text-amber-300 text-base font-medium hover:bg-amber-500/30 transition-colors" data-v-be232ca8> Join </button></div>`)):n("\x3c!----\x3e"),n("</div>")}),n("\x3c!--]--\x3e</div>")):(n('<div class="text-center py-8" data-v-be232ca8>'),n(k(p(N),{class:"w-10 h-10 text-white/[0.08] mx-auto mb-2"},null,r)),n(`<p class="text-white/40 text-base" data-v-be232ca8>${I(p(u)?"No rooms match your search":"No public rooms yet")}</p></div>`)),n("</div></div>")}}}),Oe=Ve.setup;Ve.setup=(t,n)=>{const r=f();return(r.modules||(r.modules=new Set)).add("components/room3d/Room3dPublicBrowser.vue"),Oe?Oe(t,n):void 0};const Le=Object.assign(Z(Ve,[["__scopeId","data-v-be232ca8"]]),{__name:"Room3dPublicBrowser"}),ze=r();let Ke=null,Fe=null,Be=null,We=0,Je=0;const Ge=new te.Vector3,Qe=r(!1);let Ye=0;const qe=r([]),Xe=r(""),Ze="sf_room3d_user_name",et=r("");function na(){const t=et.value.trim();t?localStorage.setItem(Ze,t):localStorage.removeItem(Ze)}function ia(){et.value=localStorage.getItem(Ze)||""}const tt=r(),nt=r(0);function la(t){const n=t.target;if(!n)return;const r=n.scrollWidth/oe.length;nt.value=Math.round(n.scrollLeft/r)}const rt=r({}),it=r(""),lt=i(()=>"");let dt=null,ct=[],ut=0,bt=0;const vt=r(0);let pt=null;const mt=new Set;async function ua(){if(!ze.value||Be)return;const t="ontouchstart"in void 0||(void 0).maxTouchPoints>0;Ke=new te.Scene,Fe=new te.PerspectiveCamera(34,ze.value.clientWidth/ze.value.clientHeight,.1,50),Fe.position.set(0,1.25,4.8),Fe.lookAt(0,.6,0),Be=new te.WebGLRenderer({antialias:!t,alpha:!0}),Be.setPixelRatio(Math.min((void 0).devicePixelRatio,t?1.5:2)),Be.setSize(ze.value.clientWidth,ze.value.clientHeight),Be.setClearColor(0,0),Be.toneMapping=t?te.AgXToneMapping:te.ACESFilmicToneMapping,Be.toneMappingExposure=1.6,t||(Be.shadowMap.enabled=!0,Be.shadowMap.type=te.PCFSoftShadowMap),ze.value.appendChild(Be.domElement),Ke.fog=new te.FogExp2(394767,.06);const n=new te.DirectionalLight(16772829,3.5);n.position.set(2,5,5),t||(n.castShadow=!0,n.shadow.mapSize.set(1024,1024),n.shadow.camera.near=.5,n.shadow.camera.far=15,n.shadow.bias=-.002),Ke.add(n);const r=new te.DirectionalLight(6724044,.8);r.position.set(-4,2,3),Ke.add(r);const i=new te.DirectionalLight(1096065,2);if(i.position.set(0,3,-5),Ke.add(i),!t){const t=new te.SpotLight(16777215,4,12,Math.PI/8,.6,1);t.position.set(0,5,3),t.target.position.set(0,0,2.8),Ke.add(t),Ke.add(t.target)}Ke.add(new te.AmbientLight(3359829,t?1.2:.6)),dt=new te.Group,Ke.add(dt),(void 0).addEventListener("resize",ht);try{await Be.compileAsync(Ke,Fe)}catch{}Je=performance.now(),wt()}function ht(){if(!ze.value||!Be||!Fe)return;const t=ze.value.clientWidth,n=ze.value.clientHeight;Fe.aspect=t/n,Fe.updateProjectionMatrix(),Be.setSize(t,n)}async function va(){var t;if(!Ke||!dt||0===qe.value.length)return;Qe.value=!0;const n=++Ye,r=qe.value,i=r.length,c=2*Math.PI/i;if(!pt)try{const n=new ae,r=await new Promise((t,r)=>n.load("/data/appdata/models/characters/animations/Idle.glb",t,void 0,r));(null==(t=r.animations)?void 0:t.length)&&(pt=r.animations.find(t=>!t.name.includes("T-Pose"))||r.animations[r.animations.length-1])}catch{}if(n!==Ye)return;ct=[],mt.clear();for(let t=0;t<i;t++){const n=t*c,i=new te.Group;i.position.set(2.8*Math.sin(n),0,2.8*Math.cos(n)),dt.add(i),ct.push({wrapper:i,model:null,mixer:null,file:r[t],loaded:!1})}const u=r.indexOf(Xe.value);u>=0&&(vt.value=u,ut=bt=-u*c);const b=[vt.value];if(i>1&&b.push(((vt.value+1)%i+i)%i),i>2&&b.push(((vt.value-1)%i+i)%i),await Promise.all(b.map(t=>yt(t,n))),n===Ye&&Be&&Ke&&Fe){try{await Be.compileAsync(Ke,Fe)}catch{}for(const t of b){const n=ct[t];(null==n?void 0:n.model)&&(n.model.visible=!0)}const t=new Map;Ke.traverse(n=>{n.frustumCulled&&(t.set(n,!0),n.frustumCulled=!1)}),Be.render(Ke,Fe);for(const[n]of t)n.frustumCulled=!0;Be.info.reset()}else for(const t of b){const n=ct[t];(null==n?void 0:n.model)&&(n.model.visible=!0)}xt(),Qe.value=!1}async function yt(t,n){const r=null!=n?n:Ye;if(t<0||t>=ct.length)return;const i=ct[t];if(i&&!i.loaded&&!mt.has(t)){mt.add(t);try{const t=new ae,n=await new Promise((n,r)=>{t.load(`/data/appdata/models/characters/${encodeURIComponent(i.file)}`,n,void 0,r)});if(r!==Ye)return void n.scene.traverse(t=>{t.geometry&&t.geometry.dispose()});const c=n.scene,u=(new te.Box3).setFromObject(c),b=u.max.y-u.min.y;if(b>0){const t=1.4/b;c.scale.setScalar(t),c.position.y=-u.min.y*t,c.position.x=-(u.min.x+u.max.x)/2*t,c.position.z=-(u.min.z+u.max.z)/2*t}c.visible=!1,i.wrapper.add(c),i.model=c;const v=n.animations||[];let p=v.find(t=>/idle/i.test(t.name)&&!t.name.includes("T-Pose"));!p&&v.length>0&&(p=v.find(t=>!t.name.includes("T-Pose"))||v[0]),!p&&pt&&(p=pt),p&&(i.mixer=new te.AnimationMixer(c),i.mixer.clipAction(p).play()),i.loaded=!0}catch{}finally{mt.delete(t)}}}function ma(t,n){t.model&&t.model.traverse(t=>{if(t.isMesh&&t.material){const r=Array.isArray(t.material)?t.material:[t.material];for(const t of r)t.transparent=!0,t.opacity=n}})}function xt(){if(!ct.length)return;const t=ct.length;for(let n=0;n<t;n++){const r=((n-vt.value)%t+t)%t,i=r>t/2?t-r:r,c=0===i?1.05:1;ct[n].wrapper.scale.setScalar(c),ct[n].wrapper.visible=i<=2,ma(ct[n],i<=1?1:.25)}}let ft=0;function wt(){if(!Be||!Ke||!Fe)return;We=requestAnimationFrame(wt);const t=performance.now(),n=t,r=Math.min((n-Je)/1e3,.1);Je=n;for(const t of ct)t.mixer&&t.mixer.update(r);if(dt){const t=bt-ut;Math.abs(t)>.001?ut+=t*Math.min(1,4*r):ut=bt,dt.rotation.y=ut;const n=Fe.position;for(const t of ct){t.wrapper.getWorldPosition(Ge);const r=n.x-Ge.x,i=n.z-Ge.z,c=Math.atan2(r,i);t.wrapper.rotation.y=c-dt.rotation.y}}performance.now(),Be.render(Ke,Fe);const i=performance.now();i-t>50&&i-ft>2e3&&(ft=i,Be.info)}function He(t){const n=qe.value.length;if(n<2)return;const r=vt.value,i=2*Math.PI/n;for(vt.value=(t%n+n)%n,bt=-vt.value*i;bt-ut>Math.PI;)bt-=2*Math.PI;for(;bt-ut<-Math.PI;)bt+=2*Math.PI;Xe.value=qe.value[vt.value],xt();const c=vt.value>r||r===n-1&&0===vt.value?1:-1,u=((vt.value+c)%n+n)%n;yt(u).then(()=>{const t=ct[u];(null==t?void 0:t.model)&&!t.model.visible&&(Be&&Ke&&Fe?Be.compileAsync(Ke,Fe).then(()=>{t.model&&(t.model.visible=!0),Be&&Ke&&Fe&&(Be.render(Ke,Fe),Be.info.reset())}).catch(()=>{t.model&&(t.model.visible=!0)}):t.model&&(t.model.visible=!0))})}function gt(){He(vt.value-1)}function kt(){He(vt.value+1)}let _t=0;function fa(t){if(t.preventDefault(),qe.value.length<2)return;const n=Date.now();n-_t<200||(_t=n,t.deltaY>0?kt():t.deltaY<0&&gt())}function pa(){(void 0).removeEventListener("resize",ht),cancelAnimationFrame(We),We=0,Ye++,mt.clear();for(const t of ct)t.mixer&&t.mixer.stopAllAction(),ne(t.wrapper);ct=[],Ke&&(Ke.traverse(t=>{if(t.geometry&&t.geometry.dispose(),t.material){const n=Array.isArray(t.material)?t.material:[t.material];for(const t of n)t.dispose()}}),Ke=null),dt=null,Be&&(Be.domElement.remove(),Be.dispose(),Be=null),Fe=null}async function ha(){try{const t=await $fetch("/api/room3d/characters");if(null==t?void 0:t.length){const n=[...t];for(let t=n.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[n[t],n[r]]=[n[r],n[t]]}qe.value=n}!qe.value.includes(Xe.value)&&qe.value.length>0&&(Xe.value=qe.value[0])}catch{}}function ya(){return{lobbyCanvas:ze,lobbyCharLoading:Qe,availableCharacters:qe,selectedCharacter:Xe,displayName:et,saveDisplayName:na,loadDisplayName:ia,roomScrollContainer:tt,activeRoomIdx:nt,onRoomScroll:la,editingCode:rt,copiedCode:it,currentDomain:lt,carouselSelectedIdx:vt,initLobbyScene:ua,disposeLobbyScene:pa,initCarouselPositions:va,lobbyRotateToIndex:He,lobbyPrevChar:gt,lobbyNextChar:kt,onLobbyWheel:fa,loadAvailableCharacters:ha,charDisplayName:se}}const Pt={mode:"vad",muted:!1,volume:80,spatialAudio:!0,autoJoin:!0};const It=function(){try{const t=localStorage.getItem("room3d-voice-settings");if(t)return{...Pt,...JSON.parse(t)}}catch{}return{...Pt}}();function ga(){return{voiceEnabled:r(!1),voiceMode:r("ptt"),localMuted:r(!1),localSpeaking:r(!1),pttActive:r(!1),masterVolume:r(80),spatialEnabled:r(!0),autoJoinVoice:r(!0),showVoiceSettings:r(!1),peerVoiceStates:new Map,micPermissionState:r("unknown"),checkMicPermission:async()=>{},requestMicrophone:async()=>!1,setMultiplayerRef:()=>{},initVoice:async()=>{},disposeVoice:()=>{},connectToPeer:async()=>{},disconnectPeer:()=>{},updateSpatialPositions:()=>{},setVoiceMode:t=>{},setPTT:t=>{},toggleMute:()=>{},setMasterVolume:t=>{},setSpatialAudio:t=>{},setAutoJoin:t=>{},openVoiceSettings:()=>{},closeVoiceSettings:()=>{},onPeerSpeakingChanged:t=>{},getConnectedPeerIds:()=>[],getVoiceDebugInfo:()=>({}),forceEnableTransmit:()=>{}}}r(!1),r(It.mode),r(It.muted),r(!1),r(!1),r(It.volume),r(It.spatialAudio),r(It.autoJoin),r(!1),r("unknown"),y(new Map);const Ct=u({__name:"Room3dLobby",__ssrInlineRender:!0,props:{environments:{},availableCharacters:{},selectedCharacter:{},carouselSelectedIdx:{},lobbyCharLoading:{type:Boolean},displayName:{},isDev:{type:Boolean},editMode:{type:Boolean},authenticated:{type:Boolean},roomSettings:{},inviteTokens:{},copiedToken:{},activeRoomIdx:{},guestMode:{type:Boolean},guestReady:{type:Boolean},guestOnlineCount:{},guestConnected:{type:Boolean},hideTokenPaste:{type:Boolean}},emits:["select-environment","prev-char","next-char","lobby-wheel","update-room-settings","copy-link","update:displayName","update:editMode","save-display-name","room-scroll","enter-room","join-public-room","join-by-token"],setup(n,{emit:c}){const u={isPublic:!0,inviteOnly:!1,publicName:"",publicDescription:"",password:""},f={isPublic:!1,inviteOnly:!0,publicName:"",publicDescription:"",password:""},y=n,H=c,W=ga().micPermissionState,J=r(!1),G=r(!1),Q=r(""),Y=r(null),q=r(null),X=r(null);function d(t,n){const r=y.roomSettings[t];return r&&n in r?r[n]:("big_room"===t?u:f)[n]}const Z=i(()=>y.authenticated?y.environments:y.environments.filter(t=>!t.hidden)),ee=i({get:()=>y.displayName,set:t=>H("update:displayName",t)});i({get:()=>y.editMode,set:t=>H("update:editMode",t)});const te=r("rooms"),ae=r(),se=r();r();const ne=r(0),oe=r(3),re=i(()=>1===oe.value),ie=i(()=>re.value?Z.value.length:Math.max(1,Math.ceil(Z.value.length/oe.value))),le=i(()=>{const t=Z.value.length,n=oe.value;if(re.value)return Z.value;if(ne.value>=ie.value-1&&t>n)return Z.value.slice(t-n);const r=ne.value*n;return Z.value.slice(r,r+n)}),ce=ya();return b(ae,t=>{t&&(ce.lobbyCanvas.value=t)}),b(se,t=>{t&&(ce.roomScrollContainer.value=t)}),(r,i,c,u)=>{var b;const f=t,y=de,H=Le;i(`<div${g(v({class:"absolute inset-0 z-30 lobby-bg overflow-hidden"},u))} data-v-03547be6>`),n.guestMode?i("\x3c!----\x3e"):(i('<button class="absolute top-3 left-3 z-30 p-2 text-white/40 hover:text-white/70 transition-colors" data-v-03547be6>'),i(k(p($),{class:"w-6 h-6"},null,c)),i("</button>")),i(`<div class="lobby-particle lobby-p1" data-v-03547be6></div><div class="lobby-particle lobby-p2" data-v-03547be6></div><div class="lobby-particle lobby-p3" data-v-03547be6></div><div class="lobby-particle lobby-p4" data-v-03547be6></div><div class="lobby-particle lobby-p5" data-v-03547be6></div><div class="lobby-particle lobby-p6" data-v-03547be6></div><div class="lobby-particle lobby-p7" data-v-03547be6></div><div class="lobby-particle lobby-p8" data-v-03547be6></div><canvas class="absolute inset-0 w-full h-full object-cover pointer-events-none" style="${_({filter:"blur(4px)",opacity:"0.35"})}" data-v-03547be6></canvas><div class="absolute inset-0 z-[1]" data-v-03547be6></div><div class="absolute inset-0 pointer-events-none lobby-vignette z-[2]" data-v-03547be6></div>`),n.guestMode?i(`<div class="absolute top-4 right-4 z-30" data-v-03547be6><div class="px-3 py-1.5 rounded-full bg-black/70 backdrop-blur-sm border border-white/15 text-base text-gray-300 flex items-center gap-2" data-v-03547be6><div class="${P([n.guestConnected?"bg-emerald-400 animate-pulse":"bg-gray-600","w-2 h-2 rounded-full"])}" data-v-03547be6></div><span data-v-03547be6>${I(null!=(b=n.guestOnlineCount)?b:0)} online</span></div></div>`):i("\x3c!----\x3e"),n.lobbyCharLoading?i('<div class="absolute inset-0 z-10 flex items-center justify-center pointer-events-none" data-v-03547be6><div class="w-14 h-14 border-2 border-white/5 border-t-emerald-400 rounded-full animate-spin" data-v-03547be6></div></div>'):i("\x3c!----\x3e"),i(`<div class="absolute top-0 left-0 right-0 z-20 text-center pt-5 pointer-events-none" data-v-03547be6><div class="inline-block" data-v-03547be6><img${C("src","/data/appdata/images/SCHEDULE-4-REAL.svg")} alt="Schedule 4 Real" class="mx-auto h-16 sm:h-24 select-none lobby-title-glow" draggable="false" data-v-03547be6><div class="mx-auto mt-2 h-px w-56 bg-gradient-to-r from-transparent via-emerald-500/40 to-transparent" data-v-03547be6></div><div class="mt-2 flex items-center justify-center gap-2 flex-wrap" data-v-03547be6>`),n.authenticated||n.guestMode?i("\x3c!----\x3e"):i('<div class="inline-block bg-yellow-500/10 border border-yellow-500/30 rounded-full px-3 py-0.5" data-v-03547be6><span class="text-yellow-400/70 text-base font-medium" data-v-03547be6>Guest Mode</span></div>'),"denied"===p(W)||"error"===p(W)||"unavailable"===p(W)?(i('<button class="pointer-events-auto inline-flex items-center gap-1.5 px-3 py-0.5 rounded-full border text-base font-medium transition-all bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20 relative" data-v-03547be6>'),i(k(p(D),{class:"w-3.5 h-3.5"},null,c)),i("<span data-v-03547be6>Enable Mic</span>"),p(J)?i('<div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 bg-black/90 border border-red-500/30 rounded-lg p-3 text-left z-50 shadow-xl" data-v-03547be6><p class="text-red-300 text-base font-medium mb-1" data-v-03547be6>Mic blocked by browser</p><p class="text-white/50 text-base leading-snug" data-v-03547be6>Click the lock icon in the address bar, find Microphone, set to Allow, then reload.</p></div>'):i("\x3c!----\x3e"),i("</button>")):"prompt"===p(W)?(i('<button class="pointer-events-auto inline-flex items-center gap-1.5 px-3 py-0.5 rounded-full border text-base font-medium transition-all bg-amber-500/10 border-amber-500/30 text-amber-400 hover:bg-amber-500/20" data-v-03547be6>'),i(k(p(D),{class:"w-3.5 h-3.5"},null,c)),i("<span data-v-03547be6>Enable Mic</span></button>")):i("\x3c!----\x3e"),n.authenticated&&!n.guestMode?(i('<button class="pointer-events-auto inline-flex items-center gap-1.5 px-3 py-0.5 rounded-full bg-black/40 border border-white/10 text-white/40 hover:text-emerald-400 hover:border-emerald-500/30 hover:bg-emerald-500/10 transition-all text-base font-medium" title="How privacy works" data-v-03547be6>'),i(k(p(M),{class:"w-3.5 h-3.5"},null,c)),i("<span data-v-03547be6>Privacy info</span></button>")):i("\x3c!----\x3e"),i("</div></div>"),i(k(f,null,{},c)),i("</div>"),n.availableCharacters.length>1?(i('<button class="absolute left-2 sm:left-6 top-[45%] -translate-y-1/2 z-20 lobby-nav-btn group" data-v-03547be6>'),i(k(p(E),{class:"w-5 h-5 text-white/40 group-hover:text-emerald-300 transition-colors duration-200"},null,c)),i("</button>")):i("\x3c!----\x3e"),n.availableCharacters.length>1?(i('<button class="absolute right-2 sm:right-6 top-[45%] -translate-y-1/2 z-20 lobby-nav-btn group" data-v-03547be6>'),i(k(p(U),{class:"w-5 h-5 text-white/40 group-hover:text-emerald-300 transition-colors duration-200"},null,c)),i("</button>")):i("\x3c!----\x3e"),i('<div class="absolute bottom-0 left-0 right-0 z-20 lobby-bottom-fade pointer-events-none" data-v-03547be6>'),n.guestMode?(i('<div class="pointer-events-auto max-w-xs mx-auto px-4 pb-6 text-center" data-v-03547be6>'),n.availableCharacters.length>1?(i('<div class="flex items-center justify-center gap-1.5 mb-4" data-v-03547be6>\x3c!--[--\x3e'),T(n.availableCharacters,(t,r)=>{i(`<div class="${P([r===n.carouselSelectedIdx?"bg-emerald-400 w-4":"bg-white/15 w-1.5","h-1.5 rounded-full transition-all duration-300"])}" data-v-03547be6></div>`)}),i("\x3c!--]--\x3e</div>")):i("\x3c!----\x3e"),i(`<input${C("value",p(ee))} type="text" placeholder="Enter your name" maxlength="20" class="w-full bg-black/60 border border-white/20 rounded-xl px-4 py-2.5 text-white text-center text-base placeholder-white/30 focus:border-emerald-500/50 focus:outline-none transition-colors mb-3" data-v-03547be6><button${R(!n.guestReady||n.lobbyCharLoading)?" disabled":""} class="w-full py-3 rounded-xl font-bold text-base text-white transition-all bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 disabled:opacity-30 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/25" data-v-03547be6> Enter Room </button>`),n.hideTokenPaste?i("\x3c!----\x3e"):(i('<div class="mt-3 flex items-center gap-2" data-v-03547be6><div class="relative flex-1" data-v-03547be6>'),i(k(p(j),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/25"},null,c)),i(`<input${C("value",p(Q))} type="text" placeholder="Paste invite token" class="w-full bg-black/60 border border-white/20 rounded-xl pl-9 pr-3 py-2 text-white text-base placeholder-white/30 focus:border-emerald-500/40 focus:outline-none transition-colors font-mono" data-v-03547be6></div><button${R(!p(Q).startsWith("sfr:"))?" disabled":""} class="px-3 py-2 rounded-xl bg-emerald-500/25 border border-emerald-500/30 text-emerald-400 text-base font-bold hover:bg-emerald-500/35 transition-all disabled:opacity-20 disabled:cursor-not-allowed flex-shrink-0" data-v-03547be6> Join </button></div>`)),i("</div>")):(i('<div class="max-w-6xl mx-auto px-0 pb-3 sm:px-6 sm:pb-6" data-v-03547be6><div class="text-center mb-3 sm:mb-4" data-v-03547be6>'),n.availableCharacters.length>1?(i('<div class="hidden sm:flex items-center justify-center gap-1.5 mb-2" data-v-03547be6>\x3c!--[--\x3e'),T(n.availableCharacters,(t,r)=>{i(`<div class="${P([r===n.carouselSelectedIdx?"bg-emerald-400 w-4 rounded-full":"bg-white/15","w-1.5 h-1.5 rounded-full transition-all duration-300"])}" data-v-03547be6></div>`)}),i("\x3c!--]--\x3e</div>")):i("\x3c!----\x3e"),i(`<div class="flex justify-center" data-v-03547be6><input${C("value",p(ee))} type="text" placeholder="Your name" maxlength="20" class="pointer-events-auto w-48 sm:w-56 bg-black/60 border border-white/20 rounded-xl px-4 py-2 sm:py-2.5 text-white text-center text-base placeholder-white/30 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-03547be6></div></div><div class="flex items-center justify-center gap-3 sm:gap-4 mb-2 sm:mb-3 pointer-events-auto" data-v-03547be6><div class="hidden sm:block h-px w-12 bg-gradient-to-r from-transparent to-white/10" data-v-03547be6></div><div class="flex items-center bg-black/60 rounded-xl p-0.5 border border-white/15" data-v-03547be6><button class="${P(["rooms"===p(te)?"bg-white/[0.12] text-white/70":"text-white/30 hover:text-white/50","px-3 sm:px-4 py-1 sm:py-1.5 rounded-lg text-base font-bold tracking-wider uppercase transition-all"])}" data-v-03547be6> My Rooms </button><button class="${P(["public"===p(te)?"bg-white/[0.12] text-white/70":"text-white/30 hover:text-white/50","px-3 sm:px-4 py-1 sm:py-1.5 rounded-lg text-base font-bold tracking-wider uppercase transition-all flex items-center gap-1.5"])}" data-v-03547be6>`),i(k(p(N),{class:"w-3.5 h-3.5"},null,c)),i(' Public </button></div><div class="hidden sm:block h-px w-12 bg-gradient-to-l from-transparent to-white/10" data-v-03547be6></div></div>'),i(k(y,{modelValue:p(G),"onUpdate:modelValue":t=>h(G)?G.value=t:null},null,c)),"rooms"===p(te)?(i('<div class="pointer-events-auto relative" data-v-03547be6>'),p(ne)>0?(i('<button class="hidden sm:flex absolute -left-4 top-1/2 -translate-y-1/2 z-10 w-9 h-9 items-center justify-center rounded-full bg-black/70 backdrop-blur-sm border border-white/15 hover:bg-emerald-500/15 hover:border-emerald-500/30 transition-all" data-v-03547be6>'),i(k(p(E),{class:"w-4 h-4 text-white/60"},null,c)),i("</button>")):i("\x3c!----\x3e"),i(`<div class="flex gap-3 sm:gap-5 overflow-x-auto snap-x snap-mandatory scrollbar-hide sm:overflow-visible sm:justify-center sm:px-0 items-start" style="${_(p(re)?"padding-left: 7.5vw; padding-right: 7.5vw;":"")}" data-v-03547be6><div${g({name:"room-card",class:"contents"})} data-v-03547be6>`),T(p(le),t=>{i('<div class="flex flex-col items-stretch w-[85vw] sm:w-96 snap-center flex-shrink-0" data-v-03547be6><div class="lobby-room-card group relative overflow-hidden rounded-2xl transition-all duration-300 hover:scale-[1.03]" data-v-03547be6><button class="w-full text-left" data-v-03547be6><div class="relative h-44 sm:h-56 overflow-hidden" data-v-03547be6>'),t.image?i(`<img${C("src",t.image)}${C("alt",t.name)} class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" data-v-03547be6>`):(i('<div class="w-full h-full bg-gradient-to-br from-gray-800/80 to-gray-900/80 flex items-center justify-center" data-v-03547be6>'),A(i,m(x(t.icon),{class:"w-12 h-12 text-white/15"},null),c),i("</div>")),i('<div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-black/30" data-v-03547be6></div>'),t.hidden&&n.authenticated?i('<div class="absolute top-2 right-2 bg-amber-500/20 border border-amber-500/30 rounded-full px-2 py-0.5" data-v-03547be6><span class="text-amber-400 text-base font-medium" data-v-03547be6>Hidden</span></div>'):i("\x3c!----\x3e"),i(`<div class="absolute bottom-3 left-3 right-3" data-v-03547be6><h3 class="text-white font-bold text-lg sm:text-xl drop-shadow-lg group-hover:text-emerald-300 transition-colors leading-tight" data-v-03547be6>${I(d(t.id,"publicName")||t.name)}</h3>`),d(t.id,"publicDescription")?i(`<p class="text-white/50 text-base drop-shadow-lg truncate mt-0.5" data-v-03547be6>${I(d(t.id,"publicDescription"))}</p>`):i("\x3c!----\x3e"),i('</div><div class="hidden sm:flex absolute inset-0 items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300" data-v-03547be6><div class="w-14 h-14 rounded-full bg-emerald-500/20 backdrop-blur-sm flex items-center justify-center border border-emerald-400/30" data-v-03547be6><svg class="w-6 h-6 text-emerald-300 ml-0.5" fill="currentColor" viewBox="0 0 24 24" data-v-03547be6><path d="M8 5v14l11-7z" data-v-03547be6></path></svg></div></div></div></button>'),n.authenticated?(i('<div class="sm:hidden absolute top-2 left-2 flex items-center gap-1.5 z-10" data-v-03547be6><button class="flex items-center gap-1 px-2 py-1 rounded-lg bg-black/60 backdrop-blur-sm border border-white/15 text-white/60 active:bg-white/15 transition-all text-base font-bold" data-v-03547be6>'),i(k(p(V),{class:"w-3.5 h-3.5"},null,c)),i("<span data-v-03547be6>Options</span></button>"),n.inviteTokens[t.id]?(i(`<button class="${P([n.copiedToken===t.id?"bg-emerald-500/30 border-emerald-500/40 text-emerald-300":"bg-black/60 border-white/15 text-white/60 active:bg-white/15","flex items-center gap-1 px-2 py-1 rounded-lg backdrop-blur-sm border transition-all text-base font-bold"])}" data-v-03547be6>`),n.copiedToken!==t.id?i(k(p(O),{class:"w-3.5 h-3.5"},null,c)):i(k(p(L),{class:"w-3.5 h-3.5"},null,c)),i(`<span data-v-03547be6>${I(n.copiedToken===t.id?"Copied!":"Link")}</span></button>`)):i("\x3c!----\x3e"),i("</div>")):i("\x3c!----\x3e"),n.authenticated?(i(`<div class="hidden sm:block bg-black/80 border-t border-white/[0.08] px-3 py-1.5" data-v-03547be6><div class="space-y-1.5" data-v-03547be6><div class="flex items-center justify-between" data-v-03547be6><label class="flex items-center gap-1.5 cursor-pointer" data-v-03547be6><div class="relative inline-flex items-center" data-v-03547be6><input type="checkbox"${R(d(t.id,"isPublic"))?" checked":""} class="sr-only peer" data-v-03547be6><div class="w-7 h-4 bg-gray-700 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-3 after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all" data-v-03547be6></div></div><span class="${P([d(t.id,"isPublic")?"text-emerald-400/80":"text-white/35","text-base"])}" data-v-03547be6>${I(d(t.id,"isPublic")?"Public visible":"Not public")}</span></label><label class="flex items-center gap-1.5 cursor-pointer" data-v-03547be6><div class="relative inline-flex items-center" data-v-03547be6><input type="checkbox"${R(!d(t.id,"inviteOnly"))?" checked":""} class="sr-only peer" data-v-03547be6><div class="w-7 h-4 bg-gray-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-3 after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all" data-v-03547be6></div></div><span class="${P([d(t.id,"inviteOnly")?"text-white/35":"text-sky-400/80","text-base"])}" data-v-03547be6>${I(d(t.id,"inviteOnly")?"Hidden on lobby":"Visible on lobby")}</span></label></div><div class="flex items-center gap-2" data-v-03547be6><button class="${P([[d(t.id,"password")?"text-amber-400 bg-amber-500/10":"text-white/30 hover:text-white/50",p(q)===t.id?"ring-1 ring-amber-500/40":""],"flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-03547be6>`),d(t.id,"password")?i(k(p(z),{class:"w-3.5 h-3.5"},null,c)):i(k(p(K),{class:"w-3.5 h-3.5"},null,c)),i(`<span data-v-03547be6>${I(d(t.id,"password")?"Password set":"No password")}</span></button><button class="${P([p(Y)===t.id?"text-emerald-400 bg-emerald-500/10 ring-1 ring-emerald-500/40":"text-white/30 hover:text-white/50","flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-03547be6>`),i(k(p(F),{class:"w-3.5 h-3.5"},null,c)),i('<span data-v-03547be6>Edit info</span></button><div class="flex-1" data-v-03547be6></div>'),n.inviteTokens[t.id]?(i(`<button class="${P([n.copiedToken===t.id?"text-emerald-400 bg-emerald-500/10":"text-white/30 hover:text-white/50","flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-03547be6>`),n.copiedToken!==t.id?i(k(p(O),{class:"w-3.5 h-3.5"},null,c)):i(k(p(L),{class:"w-3.5 h-3.5"},null,c)),i(`<span data-v-03547be6>${I(n.copiedToken===t.id?"Copied!":"Copy link")}</span></button>`)):i("\x3c!----\x3e"),i("</div></div></div>")):i("\x3c!----\x3e"),i("</div>"),p(Y)===t.id?i(`<div class="mt-1.5 bg-black/70 backdrop-blur-sm border border-white/[0.12] rounded-xl px-3 py-2 space-y-1.5" data-v-03547be6><input type="text"${C("value",d(t.id,"publicName"))} maxlength="60"${C("placeholder",t.name)} class="w-full bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-03547be6><input type="text"${C("value",d(t.id,"publicDescription"))} maxlength="200" placeholder="Short description..." class="w-full bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-03547be6></div>`):i("\x3c!----\x3e"),p(q)===t.id?(i('<div class="mt-1.5 bg-black/70 backdrop-blur-sm border border-amber-500/20 rounded-xl px-3 py-2" data-v-03547be6><div class="flex items-center gap-2" data-v-03547be6>'),i(k(p(z),{class:"w-4 h-4 text-amber-400/50 flex-shrink-0"},null,c)),i(`<input type="text"${C("value",d(t.id,"password"))} maxlength="32" placeholder="Room password (leave empty to remove)" class="flex-1 bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-amber-500/50 focus:outline-none transition-colors" data-v-03547be6></div></div>`)):i("\x3c!----\x3e"),i("</div>")}),i("</div></div>"),p(ne)<p(ie)-1?(i('<button class="hidden sm:flex absolute -right-4 top-1/2 -translate-y-1/2 z-10 w-9 h-9 items-center justify-center rounded-full bg-black/70 backdrop-blur-sm border border-white/15 hover:bg-emerald-500/15 hover:border-emerald-500/30 transition-all" data-v-03547be6>'),i(k(p(U),{class:"w-4 h-4 text-white/60"},null,c)),i("</button>")):i("\x3c!----\x3e"),i("</div>")):i("\x3c!----\x3e"),"rooms"===p(te)&&p(ie)>1?(i('<div class="flex items-center justify-center gap-1.5 mt-3 pointer-events-auto" data-v-03547be6>\x3c!--[--\x3e'),T(p(ie),t=>{i(`<button class="${P([t-1===p(ne)?"bg-emerald-400 w-5":"bg-white/15 w-1.5 hover:bg-white/30","h-1.5 rounded-full transition-all duration-300 cursor-pointer"])}" data-v-03547be6></button>`)}),i("\x3c!--]--\x3e</div>")):i("\x3c!----\x3e"),"public"===p(te)?(i('<div class="pointer-events-auto" data-v-03547be6>'),i(k(H,{authenticated:n.authenticated,onJoinPublicRoom:t=>r.$emit("join-public-room",t)},null,c)),i("</div>")):i("\x3c!----\x3e"),i("</div>")),i("</div>"),S(i,t=>{var r;p(X)?(t('<div class="fixed inset-0 z-[100] flex items-end justify-center bg-black/70 backdrop-blur-sm" data-v-03547be6>'),p(X)?(t('<div class="w-full max-w-md bg-gray-900/95 backdrop-blur-xl border-t border-white/15 rounded-t-3xl px-5 py-5 pb-8 space-y-5" data-v-03547be6><div class="flex items-center justify-between" data-v-03547be6><h3 class="text-white font-bold text-lg" data-v-03547be6>Room Options</h3><button class="p-2 -mr-2 text-white/40 active:text-white/70" data-v-03547be6>'),t(k(p(B),{class:"w-5 h-5"},null,c)),t(`</button></div><div class="space-y-4" data-v-03547be6><label class="flex items-center justify-between cursor-pointer" data-v-03547be6><span class="${P([d(p(X),"isPublic")?"text-emerald-400":"text-white/50","text-base font-medium"])}" data-v-03547be6> Public visible </span><div class="relative inline-flex items-center" data-v-03547be6><input type="checkbox"${R(d(p(X),"isPublic"))?" checked":""} class="sr-only peer" data-v-03547be6><div class="w-10 h-6 bg-gray-700 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-4 after:content-[&#39;&#39;] after:absolute after:top-[3px] after:left-[3px] after:bg-white after:rounded-full after:h-[18px] after:w-[18px] after:transition-all" data-v-03547be6></div></div></label><label class="flex items-center justify-between cursor-pointer" data-v-03547be6><span class="${P([d(p(X),"inviteOnly")?"text-white/50":"text-sky-400","text-base font-medium"])}" data-v-03547be6> Visible on lobby </span><div class="relative inline-flex items-center" data-v-03547be6><input type="checkbox"${R(!d(p(X),"inviteOnly"))?" checked":""} class="sr-only peer" data-v-03547be6><div class="w-10 h-6 bg-gray-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-4 after:content-[&#39;&#39;] after:absolute after:top-[3px] after:left-[3px] after:bg-white after:rounded-full after:h-[18px] after:w-[18px] after:transition-all" data-v-03547be6></div></div></label></div><div class="space-y-2" data-v-03547be6><div class="flex items-center gap-2" data-v-03547be6>`),t(k(p(z),{class:["w-4 h-4",d(p(X),"password")?"text-amber-400":"text-white/30"]},null,c)),t(`<span class="${P([d(p(X),"password")?"text-amber-400":"text-white/40","text-base font-medium"])}" data-v-03547be6>Password</span></div><input type="text"${C("value",d(p(X),"password"))} maxlength="32" placeholder="Room password (leave empty to remove)" class="w-full bg-black/50 border border-white/15 rounded-xl px-3 py-2.5 text-white text-base placeholder-white/25 focus:border-amber-500/50 focus:outline-none transition-colors" data-v-03547be6></div><div class="space-y-2" data-v-03547be6><div class="flex items-center gap-2" data-v-03547be6>`),t(k(p(F),{class:"w-4 h-4 text-white/40"},null,c)),t(`<span class="text-base font-medium text-white/40" data-v-03547be6>Public info</span></div><input type="text"${C("value",d(p(X),"publicName"))} maxlength="60"${C("placeholder",(null==(r=n.environments.find(t=>t.id===p(X)))?void 0:r.name)||"Room name")} class="w-full bg-black/50 border border-white/15 rounded-xl px-3 py-2.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-03547be6><input type="text"${C("value",d(p(X),"publicDescription"))} maxlength="200" placeholder="Short description..." class="w-full bg-black/50 border border-white/15 rounded-xl px-3 py-2.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-03547be6></div></div>`)):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e")},"body",!1,c),i("</div>")}}}),Tt=Ct.setup;Ct.setup=(t,n)=>{const r=f();return(r.modules||(r.modules=new Set)).add("components/room3d/Room3dLobby.vue"),Tt?Tt(t,n):void 0};const Rt=Object.assign(Z(Ct,[["__scopeId","data-v-03547be6"]]),{__name:"Room3dLobby"}),At=r(!1);r(!1),r("");const St=r(new Map);function Na(){return{connected:r(!1),wsConnected:r(!1),localPeerId:r(""),playerCount:i(()=>0),remotePlayers:r(new Map),connect:()=>{},joinRoom:()=>{},leaveRoom:()=>{},sendLocalState:()=>{},sendRoomStateChanged:()=>{},onPlayerMoved:t=>{},onRoomStateChanged:t=>{},onPlayersInit:t=>{},sendObjectDelta:t=>{},onObjectDelta:t=>{},sendVoiceSignal:(t,n,r)=>{},sendVoiceState:t=>{},sendVoiceRelay:(t,n)=>{},onVoiceSignal:t=>{},onVoiceState:t=>{},getRoomId:()=>null,onPlayerLeft:t=>{},sendTVChanged:(t,n)=>{},onTVChanged:t=>{},onServerError:t=>{},dispose:()=>{}}}i(()=>St.value.size+(At.value?1:0));export{Gt as G,Rt as M,Na as N,aa as a,ga as g,sa as s,ya as y};
