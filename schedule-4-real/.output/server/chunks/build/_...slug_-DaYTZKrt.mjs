import{j as e,K as t,H as o,W as r}from"./useVoiceChat-B7yh-fVy.mjs";import{defineComponent as a,ref as s,unref as i,mergeProps as n,useSSRContext as l}from"vue";import{ssrRenderAttrs as m,ssrRenderComponent as p}from"vue/server-renderer";import{e as u,n as c}from"./server.mjs";import"@heroicons/vue/24/solid";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"@heroicons/vue/24/outline";import"three";import"three/addons/loaders/GLTFLoader.js";import"three-mesh-bvh";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"pinia";import"vue-router";const d="sf_room3d_guest_char",h="sf_room3d_guest_name",v=a({__name:"[...slug]",__ssrInlineRender:!0,setup(a){const l=u(),v=Array.isArray(l.params.slug)?l.params.slug:[l.params.slug],f=v.length>=2&&"join"===v[0],b=f?v.slice(1).join("/"):"",y=1===v.length?String(v[0]||""):"",g=y.startsWith("sfr:")||y.startsWith("sfr%3A"),x=f?b:g?decodeURIComponent(y).slice(4):"",C=f||g?"":y.toUpperCase();!f&&!g&&!/^[A-Z0-9]{4}$/.test(C)&&c("/",{replace:!0});const _=e(),{lobbyCharLoading:S,availableCharacters:j,selectedCharacter:I,carouselSelectedIdx:L,loadAvailableCharacters:k,initLobbyScene:w,disposeLobbyScene:A,initCarouselPositions:U,lobbyPrevChar:N,lobbyNextChar:V,onLobbyWheel:J}=r(),P=s(!1),R=s(!1);s("");const T=s("");function W(){const e=T.value.trim();e&&localStorage.setItem(h,e)}async function q(){if(!T.value.trim()||!R.value)return;localStorage.setItem(d,I.value),localStorage.setItem(h,T.value.trim());const e=o();e.autoJoinVoice.value&&await e.requestMicrophone(),c(x?{path:"/room3d",query:{sfr:x,name:T.value.trim(),char:I.value}}:{path:"/room3d",query:{invite:C,name:T.value.trim(),char:I.value}})}async function G(e){const t=e.startsWith("sfr:")?e.slice(4):e;localStorage.setItem(d,I.value);const r=T.value.trim()||"Guest";localStorage.setItem(h,r);const a=o();a.autoJoinVoice.value&&await a.requestMicrophone(),c({path:"/room3d",query:{sfr:t,name:r,char:I.value}})}return(e,o,r,a)=>{const s=t;i(P)?o(`<div${m(n({class:"w-full h-full flex items-center justify-center bg-gray-950"},a))}><div class="text-center"><p class="text-red-400 text-lg font-bold mb-2">Invalid Link</p><p class="text-white/40 text-base">The link you followed is not valid or has expired.</p></div></div>`):o(p(s,n({"guest-mode":"","guest-ready":!!i(T).trim()&&i(R),"guest-online-count":i(_).playerCount.value,"guest-connected":i(_).connected.value,environments:[],"available-characters":i(j),"selected-character":i(I),"carousel-selected-idx":i(L),"lobby-char-loading":i(S),"display-name":i(T),"is-dev":!1,"edit-mode":!1,authenticated:!1,"room-settings":{},"invite-tokens":{},"copied-token":"","active-room-idx":0,"hide-token-paste":!!i(x),onPrevChar:i(N),onNextChar:i(V),onLobbyWheel:i(J),"onUpdate:displayName":e=>T.value=e,onSaveDisplayName:W,onEnterRoom:q,onJoinByToken:G},a),null,r))}}}),f=v.setup;v.setup=(e,t)=>{const o=l();return(o.modules||(o.modules=new Set)).add("pages/[...slug].vue"),f?f(e,t):void 0};export{v as default};
