import{defineStore as t}from"pinia";import{u as a}from"./useAuthGate-BgxmmIEE.mjs";const e=t("settings",{state:()=>({targets:null,dayNight:null,loading:!1,saving:!1,loaded:!1}),getters:{isDaytime:t=>{if(!t.targets)return!0;const a=new Date,e=60*a.getHours()+a.getMinutes(),[i=0,r=0]=t.targets.dayTime.startTime.split(":").map(Number),[s=0,g=0]=t.targets.dayTime.endTime.split(":").map(Number);return e>=60*i+r&&e<60*s+g},currentTempTarget(t){return t.targets?this.isDaytime?t.targets.temp.targetDay:t.targets.temp.targetNight:null},currentHumiTarget(t){return t.targets?this.isDaytime?t.targets.humi.targetDay:t.targets.humi.targetNight:null},currentCo2Target(t){return t.targets?this.isDaytime?t.targets.co2.targetDay:t.targets.co2.targetNight:null},currentPeriod(t){var a,e,i,r,s,g;const n=(null==(a=t.dayNight)?void 0:a.dayStart)||(null==(i=null==(e=t.targets)?void 0:e.dayTime)?void 0:i.startTime)||"06:00",d=(null==(r=t.dayNight)?void 0:r.dayEnd)||(null==(g=null==(s=t.targets)?void 0:s.dayTime)?void 0:g.endTime)||"00:00",h=new Date,m=60*h.getHours()+h.getMinutes(),[o=0,u=0]=n.split(":").map(Number),[l=0,y=0]=d.split(":").map(Number),c=60*o+u,T=60*l+y;let p;return p=c<=T?m>=c&&m<T:m>=c||m<T,p?"day":"night"}},actions:{async fetchDayNight(){try{const t=await $fetch("/api/settings/day-night");t&&(this.dayNight=t)}catch{}},async fetchTargets(){var t,a;this.loading=!0;try{const e=await $fetch("/api/settings/targets");e&&(this.targets={dayTime:{startTime:(null==(t=e.dayTime)?void 0:t.startTime)||"00:00",endTime:(null==(a=e.dayTime)?void 0:a.endTime)||"12:00"},temp:e.temp,humi:e.humi,co2:e.co2},this.loaded=!0)}catch{}finally{this.loading=!1}},async saveTargets(){if(this.targets){this.saving=!0;try{const t={dayTime:{startTime:this.timeToSeconds(this.targets.dayTime.startTime),endTime:this.timeToSeconds(this.targets.dayTime.endTime)},temp:{targetDay:Math.round(this.targets.temp.targetDay),targetNight:Math.round(this.targets.temp.targetNight),deadband:Math.round(this.targets.temp.deadband)},humi:{targetDay:Math.round(this.targets.humi.targetDay),targetNight:Math.round(this.targets.humi.targetNight),deadband:Math.round(this.targets.humi.deadband)},co2:{targetDay:Math.round(this.targets.co2.targetDay),targetNight:Math.round(this.targets.co2.targetNight),deadband:Math.round(this.targets.co2.deadband)}},{getAuthHeaders:e}=a();await $fetch("/api/settings/targets",{method:"POST",headers:e(),body:t})}catch(t){throw t}finally{this.saving=!1}}},timeToSeconds(t){const[a=0,e=0]=t.split(":").map(Number);return 3600*a+60*e},secondsToTime(t){const a=Math.floor(t/3600),e=Math.floor(t%3600/60);return`${a.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},updateTargets(t){this.targets&&(this.targets={...this.targets,...t})}}});export{e as l};
