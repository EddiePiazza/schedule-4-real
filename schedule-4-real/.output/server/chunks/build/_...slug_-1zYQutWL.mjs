import{D as e,S as t,U as o,h as r}from"./useVoiceChat-CoK6OmDu.mjs";import{defineComponent as s,ref as a,unref as i,mergeProps as n,useSSRContext as l}from"vue";import{ssrRenderAttrs as m,ssrRenderComponent as u}from"vue/server-renderer";import{e as p,n as c}from"./server.mjs";import"@heroicons/vue/24/solid";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"@heroicons/vue/24/outline";import"three";import"three/addons/loaders/GLTFLoader.js";import"./useImmersiveMode-Bva7vE5g.mjs";import"three-mesh-bvh";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"pinia";import"vue-router";const d="sf_room3d_guest_char",v="sf_room3d_guest_name",h=s({__name:"[...slug]",__ssrInlineRender:!0,setup(s){const l=p(),h=Array.isArray(l.params.slug)?l.params.slug:[l.params.slug],f=h.length>=2&&"join"===h[0],b=f?h.slice(1).join("/"):"",g=1===h.length?String(h[0]||""):"",y=g.startsWith("sfr:")||g.startsWith("sfr%3A"),x=f?b:y?decodeURIComponent(g).slice(4):"",C=f||y?"":g.toUpperCase();!f&&!y&&!/^[A-Z0-9]{4}$/.test(C)&&c("/",{replace:!0});const S=e(),{lobbyCharLoading:_,availableCharacters:j,selectedCharacter:I,carouselSelectedIdx:L,loadAvailableCharacters:k,initLobbyScene:w,disposeLobbyScene:A,initCarouselPositions:U,lobbyPrevChar:D,lobbyNextChar:N,onLobbyWheel:J}=r(),M=a(!1),P=a(!1);a("");const R=a("");function q(){const e=R.value.trim();e&&localStorage.setItem(v,e)}async function G(){if(!R.value.trim()||!P.value)return;localStorage.setItem(d,I.value),localStorage.setItem(v,R.value.trim());const e=o();e.autoJoinVoice.value&&await e.requestMicrophone(),c(x?{path:"/room3d",query:{sfr:x,name:R.value.trim(),char:I.value}}:{path:"/room3d",query:{invite:C,name:R.value.trim(),char:I.value}})}async function W(e){const t=e.startsWith("sfr:")?e.slice(4):e;localStorage.setItem(d,I.value);const r=R.value.trim()||"Guest";localStorage.setItem(v,r);const s=o();s.autoJoinVoice.value&&await s.requestMicrophone(),c({path:"/room3d",query:{sfr:t,name:r,char:I.value}})}return(e,o,r,s)=>{const a=t;i(M)?o(`<div${m(n({class:"w-full h-full flex items-center justify-center bg-gray-950"},s))}><div class="text-center"><p class="text-red-400 text-lg font-bold mb-2">Invalid Link</p><p class="text-white/40 text-base">The link you followed is not valid or has expired.</p></div></div>`):o(u(a,n({"guest-mode":"","guest-ready":!!i(R).trim()&&i(P),"guest-online-count":i(S).playerCount.value,"guest-connected":i(S).connected.value,environments:[],"available-characters":i(j),"selected-character":i(I),"carousel-selected-idx":i(L),"lobby-char-loading":i(_),"display-name":i(R),"is-dev":!1,"edit-mode":!1,authenticated:!1,"room-settings":{},"invite-tokens":{},"copied-token":"","active-room-idx":0,"hide-token-paste":!!i(x),onPrevChar:i(D),onNextChar:i(N),onLobbyWheel:i(J),"onUpdate:displayName":e=>R.value=e,onSaveDisplayName:q,onEnterRoom:G,onJoinByToken:W},s),null,r))}}}),f=h.setup;h.setup=(e,t)=>{const o=l();return(o.modules||(o.modules=new Set)).add("pages/[...slug].vue"),f?f(e,t):void 0};export{h as default};
