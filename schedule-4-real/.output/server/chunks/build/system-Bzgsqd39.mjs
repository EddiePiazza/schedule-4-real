import{mergeProps as e,unref as t,defineComponent as r,computed as s,reactive as a,ref as o,watch as n,nextTick as d,useSSRContext as c}from"vue";import{ssrRenderAttrs as p,ssrRenderComponent as u,ssrRenderList as g,ssrInterpolate as b,ssrRenderClass as x,ssrRenderAttr as v,ssrIncludeBooleanAttr as m,ssrLooseContain as y,ssrLooseEqual as f,ssrRenderTeleport as h,ssrRenderSlot as w}from"vue/server-renderer";import{ServerStackIcon as k,GlobeAltIcon as S,CircleStackIcon as T,SignalIcon as P,ArrowPathIcon as _,PlusIcon as R,ArrowUpTrayIcon as C}from"@heroicons/vue/24/solid";import{_ as A}from"./server.mjs";import{n as D}from"./system-DQPSX4G2.mjs";import{u as M,a as B}from"./useAuthGate-BgxmmIEE.mjs";import{H as E,U as H}from"./useCameras-CufknfJN.mjs";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"pinia";import"vue-router";const j=r({__name:"ConfirmModal",__ssrInlineRender:!0,props:{visible:{type:Boolean},title:{},message:{},warning:{},danger:{},info:{},confirmText:{default:"Confirm"},cancelText:{default:"Cancel"},variant:{default:"default"},loading:{type:Boolean},error:{},success:{}},emits:["confirm","cancel"],setup(e){const t=e,r=s(()=>{switch(t.variant){case"danger":return"bg-red-600 hover:bg-red-500";case"warning":return"bg-yellow-600 hover:bg-yellow-500";case"info":return"bg-blue-600 hover:bg-blue-500";default:return"bg-spider-green-600 hover:bg-spider-green-700"}});return(t,s,a,o)=>{h(s,s=>{e.visible?(s(`<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 p-4"><div class="bg-gray-800 rounded-xl border border-gray-700 p-5 w-full max-w-md max-h-[85vh] overflow-y-auto shadow-xl"><h3 class="text-base sm:text-lg font-semibold text-gray-100 mb-2">${b(e.title)}</h3><p class="text-sm text-gray-300 mb-3">${b(e.message)}</p>`),e.warning?s(`<div class="p-3 bg-yellow-900/20 border border-yellow-800/30 rounded-lg mb-4"><p class="text-sm text-yellow-400">${b(e.warning)}</p></div>`):s("\x3c!----\x3e"),e.danger?s(`<div class="p-3 bg-red-900/20 border border-red-800/30 rounded-lg mb-4"><p class="text-sm text-red-400">${b(e.danger)}</p></div>`):s("\x3c!----\x3e"),e.info?s(`<div class="p-3 bg-blue-900/20 border border-blue-800/30 rounded-lg mb-4"><p class="text-sm text-blue-400">${b(e.info)}</p></div>`):s("\x3c!----\x3e"),w(t.$slots,"default",{},null,s,a),s(`<div class="flex gap-3 mt-4"><button class="flex-1 py-2.5 bg-gray-700 text-gray-200 rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors">${b(e.cancelText)}</button><button${m(e.loading)?" disabled":""} class="${x([r.value,"flex-1 py-2.5 rounded-lg text-sm font-medium text-white transition-colors disabled:opacity-50"])}">${b(e.loading?"Working...":e.confirmText)}</button></div>`),e.error?s(`<p class="text-sm text-red-400 mt-3">${b(e.error)}</p>`):s("\x3c!----\x3e"),e.success?s(`<p class="text-sm text-green-400 mt-3">${b(e.success)}</p>`):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e")},"body",!1,a)}}}),I=j.setup;j.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/ConfirmModal.vue"),I?I(e,t):void 0};const L=Object.assign(j,{__name:"ConfirmModal"}),N=r({__name:"ServiceCard",__ssrInlineRender:!0,props:{service:{},restarting:{type:Boolean},stopping:{type:Boolean}},emits:["restart","stop"],setup(t){const r={"s4r-web":"Web Interface","s4r-ingest":"Sensor Logger","s4r-retention":"Data Cleanup","s4r-supervisor":"Device Monitor","s4r-mosquitto":"Message Broker","s4r-proxy":"Privacy Proxy","s4r-cameras":"Camera Service","s4r-relay":"Relay Node","s4r-tunnel":"Remote Access","spiderapp-web":"Web Interface","spiderapp-ingest":"Sensor Logger","spiderapp-retention":"Data Cleanup","spiderapp-supervisor":"Device Monitor","spiderapp-mosquitto":"Message Broker","spiderapp-proxy":"Privacy Proxy","spiderapp-cameras":"Camera Service","spiderapp-relay":"Relay Node","spiderapp-tunnel":"Remote Access",questdb:"Database",go2rtc:"Video Streaming","appdata-sync":"Asset Sync","docker-engine":"Docker Engine","cloud-bridge":"Cloud Bridge",websocket:"WebSocket Server",automation:"Automation Engine"},s=new Set(["docker-engine","cloud-bridge","websocket","automation","appdata-sync","go2rtc"]);return(a,o,n,d)=>{o(`<div${p(e({class:"rounded-xl bg-gray-800/40 border border-gray-700/50 p-2.5 sm:p-3"},d))}><div class="flex items-center justify-between mb-1.5"><div class="flex items-center gap-2 min-w-0"><span class="${x([{"bg-spider-green-400 shadow-lg shadow-spider-green-400/50":"online"===t.service.status,"bg-red-400 shadow-lg shadow-red-400/50":"errored"===t.service.status,"bg-gray-500":"stopped"===t.service.status,"bg-yellow-400 shadow-lg shadow-yellow-400/50":"unknown"===t.service.status},"w-2 h-2 rounded-full shrink-0"])}"></span><span class="text-xs font-medium text-white truncate">${b(function(e){return r[e]||e}(t.service.name))}</span></div><span class="${x([{"bg-spider-green-500/20 text-spider-green-400":"online"===t.service.status,"bg-red-500/20 text-red-400":"errored"===t.service.status,"bg-gray-600/50 text-gray-400":"stopped"===t.service.status,"bg-yellow-500/20 text-yellow-400":"unknown"===t.service.status},"text-[10px] font-semibold px-1.5 py-0.5 rounded-md shrink-0 ml-1 uppercase tracking-wider"])}">${b(t.service.status)}</span></div>`),"online"===t.service.status&&t.service.memory>0?(o(`<div class="grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs text-gray-400 mb-2"><div>CPU ${b(t.service.cpu.toFixed(1))}%</div><div>${b(function(e){return e<1048576?`${(e/1024).toFixed(0)} KB`:`${(e/1048576).toFixed(1)} MB`}(t.service.memory))}</div><div>${b(function(e){const t=Math.floor(e/1e3);if(t<60)return`${t}s`;const r=Math.floor(t/60);if(r<60)return`${r}m`;const s=Math.floor(r/60);return s<24?`${s}h ${r%60}m`:`${Math.floor(s/24)}d ${s%24}h`}(t.service.uptime))}</div>`),t.service.restarts>0?o(`<div>${b(t.service.restarts)} restarts</div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),"cloud-bridge"===t.service.name&&"online"===t.service.status?o(`<div class="text-xs text-gray-500 mb-2">${b(t.service.restarts)} active connection${b(1!==t.service.restarts?"s":"")}</div>`):"automation"===t.service.name&&"online"===t.service.status?o(`<div class="text-xs text-gray-500 mb-2">${b(t.service.restarts)} active flow${b(1!==t.service.restarts?"s":"")}</div>`):"appdata-sync"===t.service.name?o(`<div class="text-xs text-gray-500 mb-2">${b(t.service.restarts)} synced file${b(1!==t.service.restarts?"s":"")}</div>`):o("\x3c!----\x3e"),function(e){return!s.has(e)}(t.service.name)?(o(`<div class="flex gap-1.5 mt-2"><button${m(t.restarting)?" disabled":""} class="flex-1 text-xs py-1.5 px-2 rounded-lg font-medium transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50">${b(t.restarting?"...":"Restart")}</button>`),"online"===t.service.status?o(`<button${m(t.stopping)?" disabled":""} class="flex-1 text-xs py-1.5 px-2 rounded-lg font-medium transition-all bg-red-500/20 text-red-400 hover:bg-red-500/30 disabled:opacity-50">${b(t.stopping?"...":"Stop")}</button>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o("</div>")}}}),Q=N.setup;N.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/system/ServiceCard.vue"),Q?Q(e,t):void 0};const U=Object.assign(N,{__name:"SystemServiceCard"}),W=r({__name:"ServerSection",__ssrInlineRender:!0,setup(r){const d=D(),{getAuthHeaders:c,authenticated:h}=M(),{requireAuth:w}=B(),k=s(()=>{var e,t;return null!=(t=null==(e=d.updateStatus)?void 0:e.autoUpdate)&&t}),S=a({enabled:!1,active:!1,serverIp:"",brokerPort:1884,entityCount:0,devices:[],hasData:!1}),T=o(""),P=o(!1),R=o(""),C=o(!1),j=o(null),I=o("");o(null);const N=a({}),Q=a({privateMode:!1,remoteEnabled:!1,remoteHost:"",remotePort:null}),W=s(()=>/^https?:\/\//i.test(Q.remoteHost)),F=s(()=>{var e;return(null==(e=d.config)?void 0:e.APP_PASSWORD)?"••••••••":"No password set"}),z=s(()=>{var e;const t=[],r=["API_PORT","WS_PORT","MQTT_PORT","MQTT_LAN_PORT","QUESTDB_PG_PORT","QUESTDB_HTTP_PORT","QUESTDB_ILP_PORT"];for(const s of r)N[s]&&N[s]!==(null==(e=d.config)?void 0:e[s])&&t.push(s.replace(/_/g," ").replace("QUESTDB ","DB "));return t}),G=s(()=>["QUESTDB_PG_PORT","QUESTDB_HTTP_PORT","QUESTDB_ILP_PORT"].filter(e=>{var t;return N[e]&&N[e]!==(null==(t=d.config)?void 0:t[e])})),Y=s(()=>{var e;return N.APP_PASSWORD&&N.APP_PASSWORD!==(null==(e=d.config)?void 0:e.APP_PASSWORD)});s(()=>{var e;const t=Object.keys(N).some(e=>{var t;return N[e]&&N[e]!==(null==(t=d.config)?void 0:t[e])}),r=d.proxyConfig&&(Q.privateMode!==d.proxyConfig.privateMode||Q.remoteEnabled!==(null!=(e=d.proxyConfig.remoteEnabled)&&e)||Q.remoteHost!==d.proxyConfig.remoteHost||Q.remotePort!==d.proxyConfig.remotePort);return t||r});const{cameras:q,go2rtcRunning:K}=E(),J=o(!1),V=o(null),X=o(!1),Z=o(!1),ee=o(null),te=a({name:"",protocol:"rtsp",host:"",port:554,path:"/stream1",username:"",password:""}),re=[{label:"IP Webcam (Android)",protocol:"rtsp",port:8080,path:"/h264_ulaw.sdp"},{label:"Generic RTSP (main)",protocol:"rtsp",port:554,path:"/stream1"},{label:"Hikvision",protocol:"rtsp",port:554,path:"/Streaming/Channels/101"},{label:"Dahua",protocol:"rtsp",port:554,path:"/cam/realmonitor?channel=1&subtype=0"},{label:"Reolink",protocol:"rtsp",port:554,path:"/h264Preview_01_main"},{label:"Tapo (TP-Link)",protocol:"rtsp",port:554,path:"/stream1"},{label:"ONVIF (auto)",protocol:"onvif",port:80,path:""},{label:"HTTP Camera (MJPEG)",protocol:"http-mjpeg",port:80,path:"/"}];async function ie(e,t){try{await w()}catch{return}I.value="",j.value={name:e,action:t}}async function ke(){var e;if(!j.value)return;const{name:t,action:r}=j.value;T.value=`${t}-${r}`,I.value="";try{await d.controlService(t,r),j.value=null}catch(t){I.value=(null==(e=t.data)?void 0:e.message)||`Failed to ${r} service`}finally{T.value=""}}async function Se(){var e,t;P.value=!0;try{const r={};for(const[t,s]of Object.entries(N))s&&s!==(null==(e=d.config)?void 0:e[t])&&(r[t]=s);if(Object.keys(r).length>0&&(await d.saveConfig(r),r.APP_PASSWORD)){const{setPassword:e}=M();e(r.APP_PASSWORD)}d.proxyConfig&&(Q.privateMode!==d.proxyConfig.privateMode||Q.remoteEnabled!==(null!=(t=d.proxyConfig.remoteEnabled)&&t)||Q.remoteHost!==d.proxyConfig.remoteHost||Q.remotePort!==d.proxyConfig.remotePort)&&await d.saveProxyConfig(Q),Object.keys(N).forEach(e=>delete N[e]),C.value=!1,setTimeout(()=>d.fetchServices(),2e3)}catch{}finally{P.value=!1}}const se=o([]),ae=a({mode:"allow-all",allowedUids:[]});return n(()=>d.proxyConfig,e=>{var t,r;e&&(Q.privateMode=e.privateMode,Q.remoteEnabled=null!=(t=e.remoteEnabled)&&t,Q.remoteHost=e.remoteHost,Q.remotePort=null!=(r=e.remotePort)?r:null)}),(r,s,a,o)=>{var n,c,w,D,M,B,E,oe,le,ne,de,ce,pe,ue,ge,be,xe,ve;const me=A,ye=L;s(`<div${p(e({class:"space-y-5"},o))}><div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-5"><div class="space-y-4"><div class="flex items-center justify-between mb-2"><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider">Services</h3><button class="text-xs text-gray-400 hover:text-spider-green-400 transition-colors flex items-center gap-1.5">`),s(u(t(_),{class:"w-3.5 h-3.5"},null,a)),s(" Refresh </button></div>"),0!==t(d).services.length||t(d).servicesLoading?(s('<div class="grid grid-cols-2 gap-2">\x3c!--[--\x3e'),g(t(d).services,e=>{s(u(U,{key:e.name,service:e,restarting:T.value===e.name+"-restart",stopping:T.value===e.name+"-stop",onRestart:t=>ie(e.name,"restart"),onStop:t=>ie(e.name,"stop")},null,a))}),s("\x3c!--]--\x3e</div>")):s('<div class="text-center py-6 text-gray-400 text-sm rounded-xl bg-gray-800/40 border border-gray-700/50"> No services detected. Run pm2-start.sh first. </div>'),s(`<div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Home Assistant</h3><div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50"><div class="flex items-center gap-4"><div class="flex-1"><span class="text-sm font-medium text-gray-200">MQTT Discovery Bridge</span><p class="text-xs text-gray-400 mt-0.5">${b(S.enabled?"Devices auto-discovered in Home Assistant via MQTT":"Disabled — HA cannot see your grow devices")}</p></div><button class="${x([S.enabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":S.enabled},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`),S.enabled?(s(`<div class="mt-2.5 pt-2.5 border-t border-gray-700/30 flex items-center gap-5"><div class="flex items-center gap-2"><span class="text-xs text-gray-500">Broker</span><span class="text-sm text-white font-mono">${b(S.serverIp||"...")}</span>`),S.serverIp?s('<button class="text-gray-500 hover:text-spider-green-400 transition-colors shrink-0" title="Copy"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></button>'):s("\x3c!----\x3e"),s(`</div><div class="flex items-center gap-2"><span class="text-xs text-gray-500">Port</span><span class="text-sm text-white font-mono">${b(S.brokerPort||"1884")}</span></div></div>`)):s("\x3c!----\x3e"),s("</div>"),S.enabled?(s(`\x3c!--[--\x3e<div class="mt-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-3"><span class="${x([S.active?"bg-green-400 shadow-lg shadow-green-400/50":"bg-yellow-400","w-2 h-2 rounded-full shrink-0"])}"></span><span class="text-xs text-gray-300">${b(S.active?`Bridge active — ${S.entityCount} entities published`:"Bridge starting...")}</span><button class="ml-auto text-gray-400 hover:text-spider-green-400 transition-colors">`),s(u(t(_),{class:"w-3.5 h-3.5"},null,a)),s("</button></div>"),(null==(n=S.devices)?void 0:n.length)?(s('<div class="mt-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1.5">Published Entities</label>\x3c!--[--\x3e'),g(S.devices,e=>{s(`<div class="mb-1.5 last:mb-0"><span class="text-xs text-gray-400 font-medium">${b(e.type)}</span><div class="flex flex-wrap gap-1 mt-0.5">\x3c!--[--\x3e`),g(e.entities,e=>{s(`<span class="text-xs px-1.5 py-0.5 rounded bg-gray-700/60 text-gray-300">${b(e)}</span>`)}),s("\x3c!--]--\x3e</div></div>")}),s("\x3c!--]--\x3e</div>")):s("\x3c!----\x3e"),s(`<div class="mt-2 p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"><p class="text-xs text-blue-400 font-semibold uppercase tracking-wider mb-1.5">Setup in Home Assistant</p><ol class="text-xs text-blue-300/80 space-y-1 list-decimal list-inside"><li>Go to <span class="text-blue-200">Settings → Devices &amp; Services → Add Integration</span></li><li>Search for <span class="text-blue-200">MQTT</span> and select it</li><li>Enter broker: <span class="text-blue-200 font-mono">${b(S.serverIp)}</span> port: <span class="text-blue-200 font-mono">${b(S.brokerPort)}</span></li><li>Leave username and password <span class="text-blue-200">empty</span></li><li>Your devices will appear automatically under <span class="text-blue-200">MQTT devices</span></li></ol></div><div class="mt-2 p-2.5 rounded-xl bg-amber-900/20 border border-amber-600/30"><p class="text-xs text-amber-300/80"> Control from HA is allowed in <span class="text-amber-200 font-semibold">Manual</span> and <span class="text-amber-200 font-semibold">Trigger</span> modes. Outlets (Time, Cycle, Temp, Humi, CO2, Drip), Blowers (Time, Cycle, Env), and Lights (Time Slot, PPFD Auto) automation modes are protected — HA commands will be rejected. </p><p class="text-xs text-amber-300/60 mt-1"> In Trigger mode, configured triggers will still fire independently of HA commands. </p></div>\x3c!--]--\x3e`)):s("\x3c!----\x3e"),s('</div></div><div class="space-y-4"><div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Network Ports</h3><div class="grid grid-cols-3 gap-2"><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Web App</label>'),t(h)?s(`<input${v("value",N.API_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(c=t(d).config)?void 0:c.API_PORT)||"3000")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Live Updates</label>'),t(h)?s(`<input${v("value",N.WS_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(w=t(d).config)?void 0:w.WS_PORT)||"3001")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Broker</label>'),t(h)?s(`<input${v("value",N.MQTT_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(D=t(d).config)?void 0:D.MQTT_PORT)||"1883")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Broker LAN</label>'),t(h)?s(`<input${v("value",N.MQTT_LAN_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(M=t(d).config)?void 0:M.MQTT_LAN_PORT)||"1884")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s(`</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">MQTT Proxy</label><div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-400">${b(t(h)?(null==(B=t(d).config)?void 0:B.PROXY_PORT)||"8883":"Hidden")}</div>`),t(h)?s('<p class="text-xs text-gray-500 mt-0.5">Fixed (binary)</p>'):s("\x3c!----\x3e"),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Database</label>'),t(h)?s(`<input${v("value",N.QUESTDB_PG_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(E=t(d).config)?void 0:E.QUESTDB_PG_PORT)||"8812")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">DB Console</label>'),t(h)?s(`<input${v("value",N.QUESTDB_HTTP_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(oe=t(d).config)?void 0:oe.QUESTDB_HTTP_PORT)||"9000")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">DB Writer</label>'),t(h)?s(`<input${v("value",N.QUESTDB_ILP_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(le=t(d).config)?void 0:le.QUESTDB_ILP_PORT)||"9009")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s('</div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Relay Node</label>'),t(h)?s(`<input${v("value",N.RELAY_PORT)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(ne=t(d).config)?void 0:ne.RELAY_PORT)||"9443")}>`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-gray-500">Hidden</div>'),s("</div></div></div>"),t(d).proxyConfig?(s(`<div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Privacy Mode</h3><div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"><div class="flex-1"><span class="text-sm font-medium text-gray-200">Stop sending data to the cloud</span><p class="text-xs text-gray-400 mt-0.5">${b(Q.privateMode?"Your data stays local — nothing leaves your network":"Devices are sharing data with Spider Farmer servers")}</p></div><button class="${x([Q.privateMode?"bg-gradient-to-r from-red-500 to-red-600 shadow-lg shadow-red-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":Q.privateMode},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`),Q.privateMode?s('<div class="mt-2 p-2.5 rounded-xl bg-amber-900/20 border border-amber-600/30"><p class="text-xs text-amber-300/90"> While active: you won&#39;t be able to control devices from the official Spider Farmer app, and no historical data will be stored in their cloud. Anything not sent while private cannot be recovered later. </p></div>'):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`<div><h3 class="text-base font-semibold text-white uppercase tracking-wider mb-2">Data Sources</h3><div class="space-y-2"><div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"><div class="flex-1"><span class="text-base font-medium text-gray-200">Source Filter</span><p class="text-base text-gray-400 mt-0.5">${b("whitelist"===ae.mode?"Only selected source is processed":"All sources accepted")}</p></div><button class="${x(["whitelist"===ae.mode?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":"whitelist"===ae.mode},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`),0===se.value.length?s('<div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><p class="text-base text-gray-500">No data sources detected yet. Waiting for MQTT messages...</p></div>'):s("\x3c!----\x3e"),s("\x3c!--[--\x3e"),g(se.value,e=>{s(`<div class="${x(["p-3 rounded-xl border transition-all",e.allowed?"bg-gray-800/40 border-gray-700/50":"bg-red-900/10 border-red-800/30"])}"><div class="flex items-center justify-between mb-2"><div class="flex items-center gap-2"><span class="${x(["w-2 h-2 rounded-full",e.allowed?"bg-spider-green-400 shadow-lg shadow-spider-green-400/50":"bg-red-500/70"])}"></span><span class="${x(["text-base px-1.5 py-0.5 rounded",e.allowed?"bg-spider-green-500/20 text-spider-green-400":"bg-red-500/20 text-red-400"])}">${b(e.allowed?"Active":"Blocked")}</span></div>`),"whitelist"===ae.mode?s(`<button class="${x(["px-2.5 py-1 text-base rounded-lg font-medium transition-all",e.allowed?"bg-spider-green-500/20 text-spider-green-400 border border-spider-green-500/30":"bg-gray-700 text-gray-400 hover:bg-gray-600 hover:text-gray-200"])}">${b(e.allowed?"Selected":"Select")}</button>`):s("\x3c!----\x3e"),s('</div><div class="space-y-1.5 mb-2">\x3c!--[--\x3e'),g(e.devices,e=>{s(`<div class="flex items-center gap-2 px-2 py-1.5 rounded-lg bg-gray-700/40"><span class="text-base font-medium text-gray-200">${b(e.typeName||e.type.toUpperCase())}</span>`),e.customName?s(`<span class="text-base text-spider-green-400">${b(e.customName)}</span>`):s("\x3c!----\x3e"),s(`<span class="text-base text-gray-500 font-mono ml-auto">${b(e.mac)}</span></div>`)}),s(`\x3c!--]--\x3e</div><div class="flex items-center gap-3 text-base text-gray-500"><span>UID ${b(e.uid)}</span><span>${b(e.totalMessages.toLocaleString())} msgs</span>`),e.blockedMessages>0?s(`<span class="text-red-400">${b(e.blockedMessages.toLocaleString())} blocked</span>`):s("\x3c!----\x3e"),s(`<span>${b(function(e){const t=Math.floor((Date.now()-e)/1e3);return t<5?"just now":t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}(e.lastSeen))}</span></div></div>`)}),s(`\x3c!--]--\x3e</div></div><div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Security &amp; Storage</h3><div class="grid grid-cols-2 gap-2"><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">App Password</label><input${v("value",N.APP_PASSWORD)} type="text" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",F.value)}><p class="text-xs text-gray-500 mt-1">Unlocks controls</p></div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Keep history</label><div class="flex items-center gap-1.5"><input${v("value",N.DATA_RETENTION_DAYS)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",(null==(de=t(d).config)?void 0:de.DATA_RETENTION_DAYS)||"90")}><span class="text-xs text-gray-400 shrink-0">days</span></div><p class="text-xs text-gray-500 mt-1">Older data is deleted</p></div></div></div><div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Software Updates</h3><div class="flex items-center justify-between p-3 rounded-xl bg-gray-800/40 border border-gray-700/50"><div><p class="text-sm font-medium text-gray-200">Auto-update</p><p class="text-xs text-gray-400">Automatically install updates when available</p></div><button class="${x(["relative inline-flex h-6 w-11 items-center rounded-full transition-all shrink-0 ml-3",k.value?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600"])}"><span class="${x(["inline-block h-4 w-4 rounded-full bg-white transition-transform shadow",k.value?"translate-x-[22px]":"translate-x-[3px]"])}"></span></button></div></div>`),t(d).proxyConfig?(s(`<div><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider mb-2">Send Data to Your Server</h3><div class="space-y-2"><div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"><div class="flex-1"><span class="text-sm font-medium text-gray-200">Clone device data to another server</span><p class="text-xs text-gray-400 mt-0.5">${b(Q.remoteEnabled?"A copy of all device data is being sent to your server":"Disabled — data only stays on this system")}</p></div><button class="${x([Q.remoteEnabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":Q.remoteEnabled},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`),Q.remoteEnabled?(s('<div class="space-y-2"><div class="flex flex-wrap gap-2"><div class="flex-1 min-w-[140px] p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Server address</label>'),t(h)?(s(`<div class="flex items-center gap-1"><input${v("value",Q.remoteHost)} type="text" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none" placeholder="192.168.1.100 or https://myserver.ddns.net">`),Q.remoteHost?s('<button class="text-gray-500 hover:text-red-400 transition-colors shrink-0 p-1" title="Clear"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'):s("\x3c!----\x3e"),s("</div>")):s(`<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-gray-500">${b(Q.remoteHost?"••••••••":"Not configured")}</div>`),s("</div>"),W.value?s("\x3c!----\x3e"):(s('<div class="w-[80px] p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">MQTT Port</label>'),t(h)?s(`<input${v("value",Q.remotePort)} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-white focus:border-spider-green-500/50 focus:outline-none" placeholder="1884">`):s('<div class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2.5 py-1.5 text-xs text-gray-500">••••</div>'),s("</div>")),s('<div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Certificates</label>'),s(u(me,null,{},a)),R.value?s(`<p class="${x([R.value.startsWith("Error")?"text-red-400":"text-spider-green-400","text-xs mt-1"])}">${b(R.value)}</p>`):s("\x3c!----\x3e"),s("</div></div>"),W.value?s('<div class="p-2 rounded-xl bg-purple-900/20 border border-purple-600/30"><p class="text-xs text-purple-300/80"> MQTT over WebSocket (WSS) — connects through your reverse proxy on port 443. The remote Mosquitto must have a WebSocket listener and Nginx must proxy <code class="text-purple-400">/mqtt</code> to it. </p></div>'):s('<div class="p-2 rounded-xl bg-blue-900/20 border border-blue-600/30"><p class="text-xs text-blue-300/80"> Direct MQTT connection to the remote Mosquitto broker on the specified port (default 1884). </p></div>'),s('<div class="p-2 rounded-xl bg-blue-900/20 border border-blue-600/30"><p class="text-xs text-blue-300/80">Data is duplicated — your local system and Spider Farmer keep receiving data normally.</p></div></div>')):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),s('<div><div class="flex items-center justify-between mb-2"><h3 class="text-xs sm:text-sm font-semibold text-white uppercase tracking-wider">IP Cameras</h3><button class="text-xs text-gray-400 hover:text-spider-green-400 transition-colors flex items-center gap-1.5"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> Add Camera </button></div>'),J.value?(s('<div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 mb-3 space-y-2.5"><div><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Preset</label><select class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"><option value="">Custom configuration</option>\x3c!--[--\x3e'),g(re,e=>{s(`<option${v("value",e.label)}>${b(e.label)}</option>`)}),s(`\x3c!--]--\x3e</select></div><div class="grid grid-cols-2 gap-2"><div><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Name</label><input${v("value",te.name)} type="text" placeholder="Grow Room 1" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div><div><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Protocol</label><select class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"><option value="rtsp"${m(Array.isArray(te.protocol)?y(te.protocol,"rtsp"):f(te.protocol,"rtsp"))?" selected":""}>RTSP</option><option value="rtsp-tcp"${m(Array.isArray(te.protocol)?y(te.protocol,"rtsp-tcp"):f(te.protocol,"rtsp-tcp"))?" selected":""}>RTSP over TCP</option><option value="onvif"${m(Array.isArray(te.protocol)?y(te.protocol,"onvif"):f(te.protocol,"onvif"))?" selected":""}>ONVIF</option><option value="http-mjpeg"${m(Array.isArray(te.protocol)?y(te.protocol,"http-mjpeg"):f(te.protocol,"http-mjpeg"))?" selected":""}>HTTP (MJPEG)</option></select></div></div><div class="grid grid-cols-6 gap-2"><div class="col-span-3"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Host / IP</label><input${v("value",te.host)} type="text" placeholder="192.168.1.50" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div><div class="col-span-1"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Port</label><input${v("value",te.port)} type="number" placeholder="554" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div><div class="col-span-2"><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Path</label><input${v("value",te.path)} type="text" placeholder="/stream1" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div></div><div class="grid grid-cols-2 gap-2"><div><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Username <span class="text-gray-600">(optional)</span></label><input${v("value",te.username)} type="text" placeholder="" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div><div><label class="block text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Password <span class="text-gray-600">(optional)</span></label><input${v("value",te.password)} type="password" placeholder="" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"></div></div><div class="flex items-center gap-2 pt-1"><button${m(!te.name||!te.host||!te.port||X.value)?" disabled":""} class="px-4 py-1.5 bg-gradient-to-r from-spider-green-500 to-spider-green-600 text-white text-base font-medium rounded-lg shadow-lg shadow-spider-green-500/20 hover:shadow-spider-green-500/40 transition-all disabled:opacity-40 disabled:cursor-not-allowed">${b(X.value?"Saving...":V.value?"Update":"Add Camera")}</button>`),!V.value&&te.host&&te.port?s(`<button${m(Z.value)?" disabled":""} class="px-4 py-1.5 bg-gray-700/60 text-gray-300 hover:bg-gray-600/60 text-base rounded-lg transition-colors disabled:opacity-40">${b(Z.value?"Testing...":"Test Connection")}</button>`):s("\x3c!----\x3e"),s('<button class="px-4 py-1.5 text-gray-400 hover:text-white text-base transition-colors"> Cancel </button>'),ee.value?s(`<span class="${x([ee.value.success?"text-green-400":"text-red-400","text-base ml-2"])}">${b(ee.value.message)}</span>`):s("\x3c!----\x3e"),s("</div></div>")):s("\x3c!----\x3e"),t(q).length>0?(s('<div class="max-h-[520px] overflow-y-auto space-y-2.5 pr-0.5">\x3c!--[--\x3e'),g(t(q),e=>{s('<div class="rounded-xl bg-gray-800/40 border border-gray-700/50 overflow-hidden">'),e.enabled?s(u(H,{"camera-id":e.id,"camera-name":e.name},null,a)):s(`<div class="aspect-video bg-gray-900/60 flex items-center justify-center"><span class="text-base text-gray-500">${b(e.name)} — disabled</span></div>`),s(`<div class="flex items-center gap-2 px-3 py-2 bg-gray-900/40"><span class="text-base text-gray-300 flex-1 truncate">${b(e.name)}</span><span class="text-xs text-gray-500 font-mono">${b(e.host)}:${b(e.port)}</span><button class="${x([e.enabled?"bg-spider-green-500":"bg-gray-600","relative w-9 h-5 rounded-full transition-all shrink-0"])}" title="Enable/Disable"><span class="${x([{"translate-x-4":e.enabled},"absolute top-0.5 left-0.5 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button><button class="text-gray-400 hover:text-spider-green-400 transition-colors" title="Edit"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button><button class="text-gray-400 hover:text-red-400 transition-colors" title="Delete"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button></div></div>`)}),s("\x3c!--]--\x3e</div>")):J.value?s("\x3c!----\x3e"):s('<div class="text-center py-6 text-gray-400 text-base rounded-xl bg-gray-800/40 border border-gray-700/50"> No cameras configured. Add an IP camera to see live video. </div>'),t(q).length>0?s(`<div class="mt-2 flex items-center gap-2"><span class="${x([t(K)?"bg-green-400 shadow-lg shadow-green-400/50":"bg-yellow-400","w-2 h-2 rounded-full shrink-0"])}"></span><span class="text-xs text-gray-400">${b(t(K)?"go2rtc streaming engine running":"go2rtc starting...")}</span></div>`):s("\x3c!----\x3e"),s("</div></div></div>"),s(u(me,null,{},a)),s(u(ye,{visible:!!j.value,title:"restart"===(null==(ce=j.value)?void 0:ce.action)?"Restart Service":"Stop Service",message:`Are you sure you want to ${null==(pe=j.value)?void 0:pe.action} '${null==(ue=j.value)?void 0:ue.name}'?`,warning:"stop"===(null==(ge=j.value)?void 0:ge.action)?"Stopping this service may interrupt data collection or app functionality until it is restarted.":void 0,info:"restart"===(null==(be=j.value)?void 0:be.action)?"The service will be briefly unavailable during restart.":void 0,"confirm-text":"restart"===(null==(xe=j.value)?void 0:xe.action)?"Restart":"Stop",variant:"stop"===(null==(ve=j.value)?void 0:ve.action)?"danger":"warning",loading:!!T.value,error:I.value,"cancel-text":"Cancel",onConfirm:ke,onCancel:e=>{j.value=null,I.value=""}},null,a)),s(u(ye,{visible:C.value,title:"Save Configuration",message:"You are about to modify the application configuration. Some changes may require service restarts.",warning:z.value.length>0?`Port changes detected (${z.value.join(", ")}). Affected services will be restarted automatically.${G.value.length>0?" QuestDB Docker container will be recreated (data is preserved).":""}`:void 0,info:Y.value?"The new password takes effect immediately — no restart needed.":void 0,"confirm-text":"Save Changes",variant:"warning",loading:P.value,"cancel-text":"Cancel",onConfirm:Se,onCancel:e=>C.value=!1},null,a)),s("</div>")}}}),F=W.setup;W.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/system/ServerSection.vue"),F?F(e,t):void 0};const z=Object.assign(W,{__name:"SystemServerSection"}),G=r({__name:"RelaySection",__ssrInlineRender:!0,setup(r){B();const{getAuthHeaders:n}=M(),d=a({enabled:!1,trackerEnabled:!1,port:9443,publicUrl:"",detectedUrl:"",publicKey:"",signPublicKey:"",peers:0,circuits:0,rooms:0,tunnelHosts:0,tunnelSessions:0,status:"stopped"}),c=o(9443),g=o(""),y=o(""),f=o(!1),h=o(!1),w=o(!1),k=s(()=>{const e=g.value||y.value;return!e||/^\d{1,3}(\.\d{1,3}){3}$/.test(e)}),S=s(()=>{const e=g.value||y.value||"your-ip";return k.value?`ws://${e}:${c.value}`:`wss://${e.replace(/\/relay\/?$/,"")}/relay`});const T=s(()=>{const e=function(e,t){return e?/^\d{1,3}(\.\d{1,3}){3}$/.test(e)?`ws://${e}:${t}`:`wss://${e.replace(/\/relay\/?$/,"")}/relay`:""}(g.value,c.value);return c.value!==d.port||e!==d.publicUrl});return(r,s,a,o)=>{s(`<div${p(e({class:"space-y-4"},o))}><div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"><div class="flex-1"><span class="text-base font-medium text-gray-200">Public Relay Node</span><p class="text-base text-gray-400 mt-0.5">${b(t(d).enabled?"This machine is part of the decentralized network — helping others connect securely":"Disabled — this machine does not relay traffic for the network")}</p></div><button${m(t(f))?" disabled":""} class="${x([t(d).enabled?"bg-gradient-to-r from-spider-green-500 to-spider-green-600 shadow-lg shadow-spider-green-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":t(d).enabled},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`),t(d).enabled?s(`<div class="p-3 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-4"><div class="flex-1"><span class="text-base font-medium text-gray-200">Room Tracker</span><p class="text-base text-gray-400 mt-0.5">${b(t(d).trackerEnabled?"This node indexes public rooms — users can discover games hosted on the network":"Disabled — this node only relays encrypted traffic, does not index rooms")}</p></div><button${m(t(h))?" disabled":""} class="${x([t(d).trackerEnabled?"bg-gradient-to-r from-purple-500 to-purple-600 shadow-lg shadow-purple-500/30":"bg-gray-600","relative w-11 h-6 rounded-full transition-all shrink-0"])}"><span class="${x([{"translate-x-5":t(d).trackerEnabled},"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform shadow"])}"></span></button></div>`):s("\x3c!----\x3e"),t(d).enabled?(s(`<div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 flex items-center gap-3"><span class="${x(["online"===t(d).status?"bg-green-400 shadow-lg shadow-green-400/50":"stopped"===t(d).status?"bg-yellow-400":"bg-red-400","w-2 h-2 rounded-full shrink-0"])}"></span><span class="text-base text-gray-300">${b("online"===t(d).status?"Relay running":"stopped"===t(d).status?"Relay stopped":"Relay status unknown")}</span><button class="ml-auto text-gray-400 hover:text-spider-green-400 transition-colors">`),s(u(t(_),{class:"w-4 h-4"},null,a)),s("</button></div>")):s("\x3c!----\x3e"),t(d).enabled&&"online"===t(d).status?(s(`<div class="grid grid-cols-3 gap-2"><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-xl font-bold text-spider-green-400">${b(t(d).peers)}</div><div class="text-base text-gray-500">Peers</div></div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-xl font-bold text-blue-400">${b(t(d).circuits)}</div><div class="text-base text-gray-500">Circuits</div></div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-xl font-bold text-purple-400">${b(t(d).rooms)}</div><div class="text-base text-gray-500">Rooms</div></div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-xl font-bold text-amber-400">${b(t(d).tunnelHosts)}</div><div class="text-base text-gray-500">Tunnel Hosts</div></div><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-xl font-bold text-teal-400">${b(t(d).tunnelSessions)}</div><div class="text-base text-gray-500">Sessions</div></div>`),t(d).publicKey?s(`<div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50 text-center"><div class="text-base font-mono text-gray-300 truncate"${v("title",t(d).publicKey)}>${b(t(d).publicKey.slice(0,8))}...</div><div class="text-base text-gray-500">Public Key</div></div>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),t(d).enabled?(s(`<div class="space-y-2"><div class="grid grid-cols-3 gap-2"><div class="p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-base text-gray-500 uppercase tracking-wider font-medium mb-1">Port</label><input${v("value",t(c))} type="number" class="w-full bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none" placeholder="9443"></div><div class="col-span-2 p-2.5 rounded-xl bg-gray-800/40 border border-gray-700/50"><label class="block text-base text-gray-500 uppercase tracking-wider font-medium mb-1">Public Host</label><div class="flex items-center gap-2"><span class="${x(["px-2 py-1 rounded-md text-base font-mono font-medium shrink-0",t(k)?"bg-yellow-500/20 text-yellow-400":"bg-green-500/20 text-green-400"])}">${b(t(k)?"ws://":"wss://")}</span><input${v("value",t(g))} type="text" class="flex-1 bg-gray-900/60 border border-gray-600/50 rounded-lg px-2 py-1.5 text-base text-white focus:border-spider-green-500/50 focus:outline-none"${v("placeholder",t(y)||"mydomain.com")}></div>`),t(y)&&!t(g)?s(`<p class="text-base text-gray-500 mt-1"> Auto-detected IP: ${b(t(y))}</p>`):s("\x3c!----\x3e"),s(`</div></div><div class="p-2 rounded-lg bg-gray-900/40 border border-gray-700/30 flex items-center gap-2"><span class="text-base text-gray-500">Public URL:</span><code class="${x([t(k)?"text-yellow-400":"text-green-400","text-base font-mono"])}">${b(t(S))}</code>`),t(k)?s('<span class="ml-auto px-2 py-0.5 rounded text-base bg-yellow-500/15 text-yellow-400">No SSL</span>'):s('<span class="ml-auto px-2 py-0.5 rounded text-base bg-green-500/15 text-green-400">SSL Ready</span>'),s("</div>"),t(T)?s(`<div class="flex items-center gap-3"><button${m(t(w))?" disabled":""} class="px-4 py-1.5 bg-gradient-to-r from-spider-green-500 to-spider-green-600 text-white text-base font-medium rounded-lg shadow-lg shadow-spider-green-500/20 hover:shadow-spider-green-500/40 transition-all disabled:opacity-40">${b(t(w)?"Saving...":"Save & Restart Relay")}</button><span class="text-base text-yellow-400">Unsaved changes</span></div>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`<div class="p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"><p class="text-base text-blue-300/80"> When enabled, this machine acts as a <span class="text-blue-200 font-semibold">public relay node</span> in the decentralized network. It helps route encrypted traffic between users without being able to read the contents. The more nodes in the network, the more secure and resilient it becomes. </p><p class="text-base text-blue-300/60 mt-1.5"> Port ${b(t(d).port||9443)} must be reachable from the internet for full relay functionality. The public URL is auto-detected from your IP if not set manually. </p></div></div>`)}}}),Y=G.setup;G.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/system/RelaySection.vue"),Y?Y(e,t):void 0};const q=Object.assign(G,{__name:"SystemRelaySection"}),K=r({__name:"BackupSection",__ssrInlineRender:!0,setup(r){const s=D(),{getAuthHeaders:a,authToken:n}=M();B();const d=o(!1),c=o(""),x=o(""),v=o(""),y=o(!1),f=o(""),h=o("");async function i(){var e;c.value="";try{await s.createBackup(),d.value=!1}catch(t){c.value=(null==(e=t.data)?void 0:e.message)||"Failed to create backup"}}async function l(){var e;y.value=!0,f.value="",h.value="";try{await s.restoreBackup(x.value),h.value="Backup restored successfully!",setTimeout(()=>{x.value=""},2e3)}catch(t){f.value=(null==(e=t.data)?void 0:e.message)||"Restore failed"}finally{y.value=!1}}async function O(){var e;y.value=!0,f.value="";try{await s.deleteBackup(v.value),v.value=""}catch(t){f.value=(null==(e=t.data)?void 0:e.message)||"Delete failed"}finally{y.value=!1}}return(r,a,o,n)=>{const w=L;a(`<div${p(e({class:"space-y-4"},n))}><div class="flex flex-wrap gap-2"><button${m(t(s).backupCreating)?" disabled":""} class="bg-gradient-to-r from-spider-green-500 to-spider-green-600 hover:from-spider-green-400 hover:to-spider-green-500 disabled:from-gray-600 disabled:to-gray-700 text-white text-xs font-semibold py-2 px-4 rounded-xl transition-all flex items-center gap-2 shadow-lg shadow-spider-green-500/20 disabled:shadow-none">`),t(s).backupCreating?a(u(t(_),{class:"w-3.5 h-3.5 animate-spin"},null,o)):a(u(t(R),{class:"w-3.5 h-3.5"},null,o)),a(` ${b(t(s).backupCreating?"Creating...":"Create Backup")}</button><label class="bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 text-xs font-semibold py-2 px-4 rounded-xl transition-all flex items-center gap-2 cursor-pointer">`),a(u(t(C),{class:"w-3.5 h-3.5"},null,o)),a(' Upload Backup <input type="file" accept=".json,.json.gz,.gz" class="hidden"></label></div><div class="p-3 rounded-xl bg-blue-900/20 border border-blue-600/30"><p class="text-xs text-blue-300 font-semibold mb-1">What gets saved?</p><p class="text-xs text-gray-400 leading-relaxed"> Everything: sensor readings, outlet history, light schedules, power events, device info, grow logs, and automation rules. Backups are compressed to save space. You can upload both compressed (.json.gz) and uncompressed (.json) files — they&#39;ll be compressed automatically. Restoring adds data without erasing what&#39;s already there. A safety copy is always made before restoring. </p></div>'),t(s).backupsLoading?a('<div class="text-center py-6 text-gray-400 text-xs rounded-xl bg-gray-800/40 border border-gray-700/50"> Loading backups... </div>'):0===t(s).backups.length?a('<div class="text-center py-8 text-gray-500 text-xs rounded-xl bg-gray-800/40 border border-gray-700/50"> No backups found. Create one to start protecting your data. </div>'):(a('<div class="space-y-2">\x3c!--[--\x3e'),g(t(s).backups,e=>{a(`<div class="flex items-center justify-between rounded-xl bg-gray-800/40 border border-gray-700/50 px-3 sm:px-4 py-2.5 sm:py-3"><div class="min-w-0 flex-1"><p class="text-xs text-white truncate font-medium">${b(e.filename)}</p><p class="text-xs text-gray-400 mt-0.5">${b(function(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`}(e.size))} `),e.compressed?a('<span class="text-spider-green-400/70">(compressed)</span>'):a("\x3c!----\x3e"),a(` · ${b(function(e){try{return new Date(e).toLocaleString()}catch{return e}}(e.created))}</p></div><div class="flex gap-1.5 ml-3 shrink-0"><button class="text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-gray-700/60 text-gray-300 hover:bg-gray-600/60"> Download </button><button${m(t(s).backupRestoring)?" disabled":""} class="text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 disabled:opacity-50"> Restore </button><button class="text-xs py-1.5 px-2.5 rounded-lg font-medium transition-all bg-red-500/20 text-red-400 hover:bg-red-500/30"> Delete </button></div></div>`)}),a("\x3c!--]--\x3e</div>")),a(u(w,{visible:d.value,title:"Create Backup",message:"This will export all database tables to a JSON backup file.",info:"The backup will include all sensor data, outlet states, light states, events, and configuration. This may take a moment for large databases.","confirm-text":"Create Backup",variant:"default",loading:t(s).backupCreating,error:c.value,onConfirm:i,onCancel:e=>{d.value=!1,c.value=""}},null,o)),a(u(w,{visible:!!x.value,title:"Restore Backup",message:`Restore data from: ${x.value}`,warning:"A safety backup will be created automatically before restoring. Existing data will NOT be deleted — the backup data will be merged with current records.","confirm-text":"Restore",variant:"warning",loading:y.value,error:f.value,success:h.value,onConfirm:l,onCancel:e=>{x.value="",f.value="",h.value=""}},null,o)),a(u(w,{visible:!!v.value,title:"Delete Backup",message:`Permanently delete: ${v.value}`,danger:"This backup file will be permanently deleted. This action cannot be undone.","confirm-text":"Delete",variant:"danger",loading:y.value,error:f.value,onConfirm:O,onCancel:e=>{v.value="",f.value=""}},null,o)),a("</div>")}}}),J=K.setup;K.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/system/BackupSection.vue"),J?J(e,t):void 0};const V=Object.assign(K,{__name:"SystemBackupSection"}),X=r({__name:"RawDataSection",__ssrInlineRender:!0,setup(t){const r=D(),{getAuthHeaders:s}=M();B();const a=o();o(!1);let c=null;function $(){c&&(c.close(),c=null),"phoneApp"===r.rawFilter&&r.rawLive&&(c=new EventSource("/api/system/phone-app-stream"),c.onmessage=e=>{try{const t=JSON.parse(e.data);r.addRawMessage(t)}catch{}},c.onerror=()=>{setTimeout(()=>{"phoneApp"===r.rawFilter&&r.rawLive&&$()},2e3)})}return n(()=>r.rawFilter,()=>{r.clearRawMessages(),$()}),n(()=>r.rawLive,()=>{$()}),n(()=>r.rawMessages.length,()=>{a.value&&d(()=>{a.value.scrollTop=a.value.scrollHeight})}),(t,r,s,a)=>{const o=A;r(`<div${p(e({class:"flex flex-col h-full space-y-3"},a))}>`),r(u(o,null,{},s)),r(u(o,null,{},s)),r("</div>")}}}),Z=X.setup;X.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("components/system/RawDataSection.vue"),Z?Z(e,t):void 0};const ee=Object.assign(X,{__name:"SystemRawDataSection"}),te={__name:"system",__ssrInlineRender:!0,setup:r=>(r,s,a,o)=>{s(`<div${p(e({class:"grid grid-cols-1 xl:grid-cols-3 gap-3 sm:gap-4 lg:gap-6 p-2 sm:p-4"},o))}><div class="xl:col-span-2 rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"><div class="absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-spider-green-500/30"></div><div class="flex items-center gap-3 mb-1 relative"><div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-spider-green-500/30 to-emerald-600/20 flex items-center justify-center">`),s(u(t(k),{class:"w-4 h-4 sm:w-5 sm:h-5 text-spider-green-400"},null,a)),s('</div><h2 class="text-sm sm:text-lg lg:text-xl font-semibold text-white">Server &amp; Services</h2></div><p class="text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative">Manage running services, network ports, privacy, and remote forwarding.</p>'),s(u(z,null,null,a)),s('</div><div class="flex flex-col gap-3 sm:gap-4 lg:gap-6"><div class="rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"><div class="absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-purple-500/30"></div><div class="flex items-center gap-3 mb-1 relative"><div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-purple-500/30 to-purple-600/20 flex items-center justify-center">'),s(u(t(S),{class:"w-4 h-4 sm:w-5 sm:h-5 text-purple-400"},null,a)),s('</div><h2 class="text-sm sm:text-lg lg:text-xl font-semibold text-white">Relay Node</h2></div><p class="text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative">Join the decentralized network as a public relay and tracker node.</p>'),s(u(q,null,null,a)),s('</div><div class="rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 relative overflow-hidden"><div class="absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-blue-500/30"></div><div class="flex items-center gap-3 mb-1 relative"><div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-blue-500/30 to-blue-600/20 flex items-center justify-center">'),s(u(t(T),{class:"w-4 h-4 sm:w-5 sm:h-5 text-blue-400"},null,a)),s('</div><h2 class="text-sm sm:text-lg lg:text-xl font-semibold text-white">Database Backups</h2></div><p class="text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative">Save, restore, and manage copies of all your grow data.</p>'),s(u(V,null,null,a)),s('</div><div class="rounded-2xl bg-gradient-to-br from-gray-800/60 to-gray-900/60 backdrop-blur-md border border-gray-700/50 p-4 sm:p-5 lg:p-6 flex-1 flex flex-col relative overflow-hidden"><div class="absolute -top-6 -left-6 w-24 h-24 rounded-full blur-2xl pointer-events-none bg-yellow-500/30"></div><div class="flex items-center gap-3 mb-1 relative"><div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-br from-yellow-500/30 to-amber-600/20 flex items-center justify-center">'),s(u(t(P),{class:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-400"},null,a)),s('</div><h2 class="text-sm sm:text-lg lg:text-xl font-semibold text-white">Live Messages</h2></div><p class="text-xs sm:text-sm text-gray-400 mb-4 ml-11 sm:ml-[52px] relative">See what your devices are reporting in real time, or request data on demand.</p>'),s(u(ee,{class:"flex-1"},null,a)),s("</div></div></div>")}},re=te.setup;te.setup=(e,t)=>{const r=c();return(r.modules||(r.modules=new Set)).add("pages/system.vue"),re?re(e,t):void 0};export{te as default};
