import{_ as a,c as n}from"./server.mjs";import{ref as o,computed as l,readonly as d,defineComponent as c,watch as u,mergeProps as v,unref as p,isRef as b,createVNode as m,resolveDynamicComponent as f,useSSRContext as y,reactive as w}from"vue";import{ssrRenderAttrs as g,ssrRenderComponent as k,ssrRenderStyle as _,ssrRenderClass as P,ssrInterpolate as I,ssrRenderAttr as A,ssrRenderList as C,ssrIncludeBooleanAttr as T,ssrRenderVNode as M,ssrRenderTeleport as S}from"vue/server-renderer";import{Bars3Icon as R,ChevronLeftIcon as D,ChevronRightIcon as E,KeyIcon as U,GlobeAltIcon as $,QuestionMarkCircleIcon as V,LockClosedIcon as O,LockOpenIcon as j,PencilSquareIcon as N,DocumentDuplicateIcon as L,CheckIcon as z,XMarkIcon as B,ShieldCheckIcon as K,EyeSlashIcon as F,ArrowPathIcon as W,AdjustmentsHorizontalIcon as H,ServerStackIcon as G,LinkIcon as J,MagnifyingGlassIcon as Y,UserGroupIcon as Q,StarIcon as Z}from"@heroicons/vue/24/solid";import{s as q}from"./_plugin-vue_export-helper-DlAUqK2U.mjs";import{StarIcon as X}from"@heroicons/vue/24/outline";import*as ee from"three";import{GLTFLoader as te}from"three/addons/loaders/GLTFLoader.js";import{computeBoundsTree as ae,disposeBoundsTree as se,acceleratedRaycast as oe}from"three-mesh-bvh";var re=Object.defineProperty,__publicField=(a,n,o)=>((a,n,o)=>n in a?re(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o)(a,"symbol"!=typeof n?n+"":n,o);const ot=()=>{},na=()=>{};ee.BufferGeometry.prototype.computeBoundsTree=ae,ee.BufferGeometry.prototype.disposeBoundsTree=se,ee.Mesh.prototype.raycast=oe;const ie=[];let le=null,de=null,ce=null,ue=null;function cs(){return le}function ia(){return de}function ds(){return ce}function us(){return ue}function fs(a){le=a}function vs(a){de=a}function bs(a){ce=a}function ms(a){ue=a}let ve=1.7,pe=0,he=200,be=.4,me=1;function ps(a){ve=a}function ys(a){pe=a}function hs(a){he=a}function xs(a){be=a}function ws(a){me=a}const fe=o(!1),xe=!1,ye=o(!1),we=[],ge=[],ke=[],_e=new Map,Ie=new ee.Raycaster,Ae=new ee.Raycaster,Ce=[];for(let a=0;a<8;a++){const n=a/8*Math.PI*2;Ce.push(new ee.Vector3(Math.cos(n),0,Math.sin(n)))}const Te=new ee.Color(26248),Me=.8,Se=new ee.Color(21862),Re=.4;function Ms(a){return Math.round(1e4*a)/1e4}function Ds(a){return a.split("/").pop()||""}function ba(a){return a.replace(/\.glb$/i,"").replace(/[-_]/g," ").replace(/\b\w/g,a=>a.toUpperCase())}const De=new ee.Vector3;function Us(){return ia().getWorldDirection(De),Math.atan2(De.x,De.z)}function ne(a){var n,o;a&&((null==(o=null==(n=a.source)?void 0:n.data)?void 0:o.close)&&a.source.data.close(),a.dispose())}function ma(a){a.traverse(a=>{if(a.geometry&&a.geometry.dispose(),a.material){const n=Array.isArray(a.material)?a.material:[a.material];for(const a of n)ne(a.map),ne(a.normalMap),ne(a.roughnessMap),ne(a.metalnessMap),ne(a.emissiveMap),ne(a.aoMap),ne(a.lightMap),ne(a.alphaMap),a.dispose()}})}function Os(a){a.traverse(a=>{a.geometry&&a.geometry.dispose()})}function Ns(a,n,o){const l=[];return a.traverse(a=>{var d;if(!a.isMesh||a.userData.isDisplayZone)return;const c=Array.isArray(a.material)?a.material:[a.material];for(const u of c)u.emissive&&(l.push({mesh:a,origEmissive:u.emissive.clone(),origEmissiveIntensity:null!=(d=u.emissiveIntensity)?d:1}),u.emissive.copy(n),u.emissiveIntensity=o)}),l}function Ls(a){for(const n of a){const a=Array.isArray(n.mesh.material)?n.mesh.material:[n.mesh.material];for(const o of a)o.emissive&&(o.emissive.copy(n.origEmissive),o.emissiveIntensity=n.origEmissiveIntensity)}}function Bs(a){kt(a),a.traverse(a=>{if(!a.isMesh)return;let n=we.indexOf(a);n>=0&&we.splice(n,1),n=ge.indexOf(a),n>=0&&ge.splice(n,1)})}function ya(a){var n,o,l;const d=a.geometry;if(!d||d.boundsTree)return;const c=d.index;(c?c.count/3:(null!=(l=null==(o=null==(n=d.attributes)?void 0:n.position)?void 0:o.count)?l:0)/3)>200&&d.computeBoundsTree({strategy:0,maxLeafSize:10})}function ha(a){a.traverse(a=>{a.isMesh&&ya(a)})}const Ee=[];let Ue=!1;function Vs(a){Ee.push(a),Ue||function(){if(0===Ee.length)return void(Ue=!1);Ue=!0}()}const $e=new ee.MeshBasicMaterial({visible:!1}),Ve=new Map,je=new ee.Vector3,Ne=new ee.Vector3;function ga(a){kt(a);const n=(new ee.Box3).setFromObject(a);if(n.isEmpty())return;n.getSize(je),n.getCenter(Ne);const o=new ee.BoxGeometry(je.x,je.y,je.z);o.computeBoundingSphere();const l=new ee.Mesh(o,$e);l.position.copy(Ne),l.visible=!1,l.matrixAutoUpdate=!1,l.updateMatrix(),l.matrixWorld.copy(l.matrix),l.userData.isCollisionProxy=!0,we.push(l),Ve.set(a,l)}function kt(a){const n=Ve.get(a);if(!n)return;const o=we.indexOf(n);o>=0&&we.splice(o,1),n.geometry.dispose(),Ve.delete(a)}function $s(a){var n;for(let o=0;o<ke.length;o++){const l=ke[o],d=Ve.get(l.group),c=null!=(n=null==a?void 0:a[o])?n:(new ee.Box3).setFromObject(l.group);c.isEmpty()||(c.getSize(je),c.getCenter(Ne),d?(d.geometry.dispose(),d.geometry=new ee.BoxGeometry(je.x,je.y,je.z),d.geometry.computeBoundingSphere(),d.position.copy(Ne),d.updateMatrix(),d.matrixWorld.copy(d.matrix)):ga(l.group))}}const Le=c({__name:"Room3dPrivacyInfo",__ssrInlineRender:!0,props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup:(a,{emit:n})=>(n,o,l,d)=>{S(o,n=>{a.modelValue?(n('<div class="fixed inset-0 z-[200] flex items-center justify-center p-4" data-v-2c69e695><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" data-v-2c69e695></div><div class="relative w-full max-w-3xl max-h-[85vh] overflow-y-auto rounded-2xl border border-white/10 bg-gray-950/95 shadow-2xl custom-scrollbar" data-v-2c69e695><button class="absolute top-4 right-4 z-10 p-1.5 rounded-lg text-white/40 hover:text-white/80 hover:bg-white/10 transition-all" data-v-2c69e695>'),n(k(p(B),{class:"w-5 h-5"},null,l)),n('</button><div class="p-6 pb-4 border-b border-white/[0.06]" data-v-2c69e695><div class="flex items-center gap-3" data-v-2c69e695><div class="w-10 h-10 rounded-xl bg-emerald-500/20 border border-emerald-500/30 flex items-center justify-center" data-v-2c69e695>'),n(k(p(K),{class:"w-5 h-5 text-emerald-400"},null,l)),n('</div><div data-v-2c69e695><h2 class="text-xl font-bold text-white" data-v-2c69e695>Anonymous &amp; Private Rooms</h2><p class="text-base text-white/40" data-v-2c69e695>How your privacy is protected</p></div></div></div><div class="p-6 space-y-6" data-v-2c69e695><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(F),{class:"w-5 h-5 text-emerald-400"},null,l)),n(' Zero Knowledge Architecture </h3><p class="text-base text-white/60 leading-relaxed" data-v-2c69e695> Your rooms use <strong class="text-white/80" data-v-2c69e695>onion-routed encryption</strong> — the same principle behind Tor. When you share a room, neither the relay servers nor anyone monitoring the network can see who is connecting to whom, or what data is being exchanged. </p></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2" data-v-2c69e695>'),n(k(p(W),{class:"w-5 h-5 text-sky-400"},null,l)),n(' How It Works </h3><div class="bg-black/40 rounded-xl border border-white/[0.06] p-4 font-mono text-base" data-v-2c69e695><div class="space-y-2 text-white/50" data-v-2c69e695><div class="flex items-center gap-2" data-v-2c69e695><span class="text-emerald-400 font-bold w-16 shrink-0 text-right" data-v-2c69e695>You</span><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-emerald-500/15 text-emerald-400 px-2 py-0.5 rounded border border-emerald-500/20" data-v-2c69e695>encrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-sky-400" data-v-2c69e695>Relay A</span></div><div class="flex items-center gap-2 pl-20" data-v-2c69e695><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-sky-500/15 text-sky-400 px-2 py-0.5 rounded border border-sky-500/20" data-v-2c69e695>re-encrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-purple-400" data-v-2c69e695>Relay B</span></div><div class="flex items-center gap-2 pl-40" data-v-2c69e695><span class="text-white/20" data-v-2c69e695>──</span><span class="bg-purple-500/15 text-purple-400 px-2 py-0.5 rounded border border-purple-500/20" data-v-2c69e695>decrypt</span><span class="text-white/20" data-v-2c69e695>──▶</span><span class="text-amber-400 font-bold" data-v-2c69e695>Guest</span></div><div class="pt-2 border-t border-white/[0.06] text-white/30 text-base" data-v-2c69e695> Each relay only sees the previous and next hop — never both endpoints. </div></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(O),{class:"w-5 h-5 text-amber-400"},null,l)),n(' Encryption </h3><div class="grid grid-cols-1 sm:grid-cols-2 gap-3" data-v-2c69e695><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Key Exchange</div><div class="text-base text-white/50" data-v-2c69e695>X25519 (Curve25519) — unique session keys per connection, forward secrecy</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Data Encryption</div><div class="text-base text-white/50" data-v-2c69e695>XChaCha20-Poly1305 AEAD — 256-bit authenticated encryption</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Packet Padding</div><div class="text-base text-white/50" data-v-2c69e695>All packets are fixed 512 bytes — traffic analysis impossible</div></div><div class="bg-black/30 rounded-lg border border-white/[0.06] p-3" data-v-2c69e695><div class="text-base font-bold text-amber-400 mb-1" data-v-2c69e695>Chaff Traffic</div><div class="text-base text-white/50" data-v-2c69e695>Constant noise between relays — hides when real data flows</div></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2" data-v-2c69e695>'),n(k(p(H),{class:"w-5 h-5 text-purple-400"},null,l)),n(' Room Modes </h3><div class="space-y-3" data-v-2c69e695><div class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><div class="flex items-center gap-2 mb-2" data-v-2c69e695>'),n(k(p(U),{class:"w-4 h-4 text-emerald-400"},null,l)),n('<span class="text-base font-bold text-emerald-400" data-v-2c69e695>Invite Only</span></div><p class="text-base text-white/50 leading-relaxed" data-v-2c69e695> Your room is invisible to everyone. Only people with your encrypted invite link can join. The link contains an encrypted token that reveals nothing about your server or IP address. Share it via any messaging app — even if intercepted, it cannot be used to locate your server. </p></div><div class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><div class="flex items-center gap-2 mb-2" data-v-2c69e695>'),n(k(p($),{class:"w-4 h-4 text-sky-400"},null,l)),n('<span class="text-base font-bold text-sky-400" data-v-2c69e695>Public</span></div><p class="text-base text-white/50 leading-relaxed" data-v-2c69e695> Your room appears in the Public Rooms browser so others can discover it. The listing is published through the onion network — the tracker that stores room listings is <strong class="text-white/70" data-v-2c69e695>blind</strong>: it only sees encrypted blobs and relay entry points, never your IP or room contents. Visitors connect through the same onion circuit, preserving both your anonymity and theirs. </p></div></div></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(G),{class:"w-5 h-5 text-rose-400"},null,l)),n(' The Blind Tracker </h3><p class="text-base text-white/60 leading-relaxed mb-3" data-v-2c69e695> The room directory (tracker) is designed to be completely blind: </p><ul class="space-y-2 text-base text-white/50" data-v-2c69e695><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695>Stores only <strong class="text-white/70" data-v-2c69e695>encrypted blobs</strong> — cannot read room names, descriptions, or any metadata</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>No IP addresses</strong> are stored — rooms are identified by relay entry points only</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>Ephemeral storage</strong> — room listings expire automatically (TTL) and are never persisted to disk</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695><strong class="text-white/70" data-v-2c69e695>No logs</strong> — relay servers keep zero logs of connections, traffic, or metadata</span></li><li class="flex items-start gap-2" data-v-2c69e695><span class="text-emerald-400 mt-0.5 shrink-0" data-v-2c69e695>✓</span><span data-v-2c69e695>Even if a relay is compromised, it only sees encrypted traffic — <strong class="text-white/70" data-v-2c69e695>no readable content</strong></span></li></ul></section><section data-v-2c69e695><h3 class="text-lg font-bold text-white mb-2 flex items-center gap-2" data-v-2c69e695>'),n(k(p(J),{class:"w-5 h-5 text-teal-400"},null,l)),n(' Invite Links </h3><p class="text-base text-white/60 leading-relaxed" data-v-2c69e695> Invite links contain an encrypted token that can only be decrypted by the app itself. The link URL points to a relay domain — <strong class="text-white/70" data-v-2c69e695>not your server</strong>. If someone inspects the link, they see only the relay&#39;s address and an opaque encrypted string. No IP addresses, room names, or identifying information is embedded in the link. </p></section><section class="bg-black/30 rounded-xl border border-white/[0.06] p-4" data-v-2c69e695><h3 class="text-base font-bold text-white/60 uppercase tracking-wider mb-3" data-v-2c69e695>Technical Summary</h3><div class="grid grid-cols-2 gap-x-6 gap-y-2 text-base" data-v-2c69e695><div class="text-white/40" data-v-2c69e695>Protocol</div><div class="text-white/70" data-v-2c69e695>Onion routing (multi-hop)</div><div class="text-white/40" data-v-2c69e695>Key Exchange</div><div class="text-white/70" data-v-2c69e695>X25519 (Curve25519)</div><div class="text-white/40" data-v-2c69e695>Symmetric Cipher</div><div class="text-white/70" data-v-2c69e695>XChaCha20-Poly1305</div><div class="text-white/40" data-v-2c69e695>Hash Function</div><div class="text-white/70" data-v-2c69e695>BLAKE2b</div><div class="text-white/40" data-v-2c69e695>Packet Size</div><div class="text-white/70" data-v-2c69e695>Fixed 512 bytes</div><div class="text-white/40" data-v-2c69e695>Key Rotation</div><div class="text-white/70" data-v-2c69e695>Every 60 minutes</div><div class="text-white/40" data-v-2c69e695>Logging</div><div class="text-white/70" data-v-2c69e695>Zero — no logs anywhere</div><div class="text-white/40" data-v-2c69e695>Tracker Storage</div><div class="text-white/70" data-v-2c69e695>In-memory only (Redis ephemeral)</div><div class="text-white/40" data-v-2c69e695>Library</div><div class="text-white/70" data-v-2c69e695>libsodium (NaCl/TweetNaCl)</div></div></section></div></div></div>')):n("\x3c!----\x3e")},"body",!1,l)}}),ze=Le.setup;Le.setup=(a,n)=>{const o=y();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dPrivacyInfo.vue"),ze?ze(a,n):void 0};const Be=Object.assign(q(Le,[["__scopeId","data-v-2c69e695"]]),{__name:"Room3dPrivacyInfo"}),Ke=24,Fe=16,We=32,He=16,Ge=32,Je=48,Ye=49,Qe=51,qe=64,Xe=65,et=66,tt=67,at=68,st=69;let nt=null,rt=null;async function Pe(){return nt||(rt||(rt=import("libsodium-wrappers").then(async a=>{const n=a.default||a;return await n.ready,nt=n,n})),rt)}function Ea(a,n,o){const l=nt,d=l.randombytes_buf(Ke),c=new Uint8Array(4);new DataView(c.buffer).setUint32(0,o);const u=l.crypto_aead_xchacha20poly1305_ietf_encrypt(a,c,null,d,n),v=new Uint8Array(d.length+u.length);return v.set(d),v.set(u,d.length),v}function Ia(a,n,o){const l=nt;if(a.length<40)return null;const d=a.subarray(0,Ke),c=a.subarray(Ke),u=new Uint8Array(4);new DataView(u.buffer).setUint32(0,o);try{return l.crypto_aead_xchacha20poly1305_ietf_decrypt(null,c,u,d,n)}catch{return null}}function lt(a,n,o){const l=n?(new TextEncoder).encode(n):new Uint8Array(0),d=new Uint8Array(2+l.length+2+o.length);return d[0]=a,d[1]=l.length,d.set(l,2),new DataView(d.buffer).setUint16(2+l.length,o.length),d.set(o,4+l.length),d}function Oe(a){return Array.from(a).map(a=>a.toString(16).padStart(2,"0")).join("")}function ct(a){const n=nt,o=nt.randombytes_buf(32),l=(new TextEncoder).encode(a),d=new Uint8Array(l.length+o.length);return d.set(l),d.set(o,l.length),n.crypto_generichash(32,d)}class Pa{constructor(){__publicField(this,"hops",[]),__publicField(this,"ws",null),__publicField(this,"circuitId",0),__publicField(this,"messageQueue",[]),__publicField(this,"dataCallback",null),__publicField(this,"_destroyed",!1)}async build(a){const n=(await Pe()).randombytes_buf(4);this.circuitId=new DataView(n.buffer).getUint32(0);const o=a[0];this.ws=new WebSocket(o.url),this.ws.binaryType="arraybuffer",await new Promise((a,n)=>{this.ws.onopen=()=>a(),this.ws.onerror=()=>n(new Error(`Failed to connect to relay ${o.url}`))}),this.ws.onclose=()=>{this._destroyed};const l=await this._handshakeWithRelay();this.hops.push({url:o.url,sessionRx:l.rx,sessionTx:l.tx,publicKey:l.serverPk}),this.ws.onmessage=a=>{const n=new Uint8Array(a.data);this._handleIncoming(n)};for(let n=1;n<a.length;n++){const o=a[n],l=await this._extendCircuit(o);this.hops.push({url:o.url,sessionRx:l.rx,sessionTx:l.tx,publicKey:l.serverPk})}}send(a,n,o=null){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)return;let l=lt(n,o,a);for(let a=this.hops.length-1;a>=0;a--){const n=this.hops[a];a===this.hops.length-1||(l=lt(He,this.hops[a+1].url,l));const o=Ea(l,n.sessionTx,this.circuitId),d=o.subarray(0,Ke),c=o.subarray(Ke);l=new Uint8Array(28+c.length),l.set(d,0),new DataView(l.buffer).setUint32(Ke,this.circuitId),l.set(c,28)}this.ws.send(l)}onData(a){this.dataCallback=a}destroy(){this._destroyed=!0,this.ws&&(this.ws.onclose=null,this.ws.onmessage=null,this.ws.close(),this.ws=null);for(const a of this.hops)a.sessionRx.fill(0),a.sessionTx.fill(0);this.hops=[],this.messageQueue=[]}_handleIncoming(a){let n=a;for(const a of this.hops){const o=Ia(n,a.sessionRx,this.circuitId);if(!o)return;n=o}const o=function(a){if(a.length<4)return null;const n=a[0],o=a[1],l=o>0?(new TextDecoder).decode(a.subarray(2,2+o)):null,d=new DataView(a.buffer,a.byteOffset).getUint16(2+o);return{type:n,nextHop:l,payload:a.subarray(4+o,4+o+d)}}(n);if(o){if(this.messageQueue.length>0)return void this.messageQueue.shift().resolve({type:o.type,payload:o.payload});this.dataCallback&&this.dataCallback(o.type,o.payload)}}_waitForMessage(a=1e4){return new Promise((n,o)=>{const l=setTimeout(()=>{const a=this.messageQueue.findIndex(a=>a.resolve===n);a>=0&&this.messageQueue.splice(a,1),o(new Error("Timeout waiting for relay response"))},a);this.messageQueue.push({resolve:a=>{clearTimeout(l),n(a)}})})}async _handshakeWithRelay(){var a;const n=nt,o=n.crypto_kx_keypair(),l=new Uint8Array(60),d=n.randombytes_buf(Ke);l.set(d,0),new DataView(l.buffer).setUint32(Ke,this.circuitId),l.set(o.publicKey,28),this.ws.send(function(a,n){if(a.length>=n)return a.subarray(0,n);const o=new Uint8Array(n);o.set(a);const l=nt.randombytes_buf(n-a.length);return o.set(l,a.length),o}(l,512));const c=await new Promise((a,n)=>{const o=setTimeout(()=>{this.ws.onmessage=null,n(new Error("Handshake timeout"))},1e4);this.ws.onmessage=n=>{clearTimeout(o),a(new Uint8Array(n.data))}}),u=new Uint8Array([83,70,80,75]);let v,p,b;if(c.length>=4&&c[0]===u[0]&&c[1]===u[1]&&c[2]===u[2]&&c[3]===u[3])v=c.subarray(4,36),p=c.subarray(36,60),b=c.subarray(64);else{const o=0===this.hops.length?null==(a=this.ws)?void 0:a.url:"";if(!o)throw new Error("Cannot determine relay URL for PK fetch");const l=o.replace(/^wss:/,"https:").replace(/^ws:/,"http:")+"/pk",d=await fetch(l);if(!d.ok)throw new Error(`Failed to fetch relay PK from ${l}`);const u=await d.json();v=n.from_hex(u.publicKey),p=c.subarray(0,Ke),b=c.subarray(28)}const m=n.crypto_kx_client_session_keys(o.publicKey,o.privateKey,v),f=b.subarray(0,49),y=new Uint8Array(4);new DataView(y.buffer).setUint32(0,this.circuitId);try{n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,f,y,p,m.sharedRx)}catch{throw new Error("Handshake verification failed — relay rejected or key mismatch")}return{rx:m.sharedRx,tx:m.sharedTx,serverPk:new Uint8Array(v)}}async _extendCircuit(a){const n=nt,o=n.crypto_kx_keypair(),l=new Uint8Array(60),d=n.randombytes_buf(Ke);l.set(d,0),new DataView(l.buffer).setUint32(Ke,this.circuitId),l.set(o.publicKey,28),this.send(l,He,a.url);const c=(await this._waitForMessage()).payload,u=new Uint8Array([83,70,80,75]),v=c.length>=4&&c[0]===u[0]&&c[1]===u[1]&&c[2]===u[2]&&c[3]===u[3]?4:0;if(c.length<v+We+Ke+4+Fe+1)throw new Error("Extend handshake reply too short");const p=c.subarray(v,v+We),b=n.crypto_kx_client_session_keys(o.publicKey,o.privateKey,p);return{rx:b.sharedRx,tx:b.sharedTx,serverPk:new Uint8Array(p)}}}class dt{constructor(){__publicField(this,"rx",new Uint8Array(0)),__publicField(this,"tx",new Uint8Array(0)),__publicField(this,"nonceCounter",0)}async initAsClient(a){const n=(await Pe()).crypto_kx_keypair();return this._keypair=n,n.publicKey}async completeAsClient(a){const n=nt,o=this._keypair,l=n.crypto_kx_client_session_keys(o.publicKey,o.privateKey,a);this.rx=l.sharedRx,this.tx=l.sharedTx}async initAsServer(a){const n=await Pe(),o=n.crypto_kx_keypair(),l=n.crypto_kx_server_session_keys(o.publicKey,o.privateKey,a);return this.rx=l.sharedRx,this.tx=l.sharedTx,o.publicKey}encrypt(a){const n=nt,o=n.randombytes_buf(Ke),l=n.crypto_aead_xchacha20poly1305_ietf_encrypt(a,null,null,o,this.tx),d=new Uint8Array(o.length+l.length);return d.set(o),d.set(l,o.length),d}decrypt(a){const n=nt;if(a.length<40)return null;const o=a.subarray(0,Ke),l=a.subarray(Ke);try{return n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,l,null,o,this.rx)}catch{return null}}destroy(){this.rx.fill(0),this.tx.fill(0)}}let it=!1,ut=[],vt="",pt=null;const ht=[];let bt=null,mt=null,ft=null;function Da(){const a=o(!1),l=o(!1),c=o([]),u=o(!1),v=o(null);async function i(){if(it)a.value=!0;else try{await Pe();const o=n(),l=o.public.onionRelayA||"wss://schedule4real.com/rooms",d=o.public.onionRelayB||"wss://r2.imaset.com";vt=o.public.onionTracker||l,ut=[{url:l,publicKey:new Uint8Array(We)},{url:d,publicKey:new Uint8Array(We)}];const c=nt,u=(new TextEncoder).encode("spiderfarmer-room-metadata-v1");pt=c.crypto_generichash(32,u),it=!0,a.value=!0}catch(a){v.value=a.message}}async function r(a){const n=new Pa,o=a||[...ut];return await n.build(o),ht.push(n),n}function h(a){if(!pt||a.length<40)return null;const n=nt,o=a.subarray(0,Ke),l=a.subarray(Ke);try{const a=n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,l,null,o,pt),d=(new TextDecoder).decode(a);return JSON.parse(d)}catch{return null}}return{isReady:d(a),isPublishing:d(l),isDiscovering:d(u),publicRooms:d(c),connectionError:d(v),init:i,publishRoom:async function(a){it||await i(),l.value=!0,v.value=null;try{const n=ct(a.envId),o=function(a){if(!pt)throw new Error("Not initialized");const n=nt,o=JSON.stringify(a),l=(new TextEncoder).encode(o),d=n.randombytes_buf(Ke),c=n.crypto_aead_xchacha20poly1305_ietf_encrypt(l,null,null,d,pt),u=new Uint8Array(d.length+c.length);return u.set(d),u.set(c,d.length),u}({envId:a.envId,name:a.name,description:a.description,capacity:a.capacity||8,tags:a.tags||[]}),d=await r([...ut].reverse()),c=ut[ut.length-1].url,u=(new TextEncoder).encode(c),v=a.private?1:0,p=new Uint8Array(36+u.length+o.length);p[0]=qe,p[1]=v,p.set(n,2),new DataView(p.buffer).setUint16(34,u.length),p.set(u,36),p.set(o,36+u.length),d.send(p,qe);const b=Oe(n);ft=void 0,bt=d,d.onData((n,o)=>{n===st&&async function(a,n){const o=nt;if(a.length<23)return;const l=a.subarray(0,20),d=new DataView(a.buffer,a.byteOffset+20).getUint16(0),c=(new TextDecoder).decode(a.subarray(22,22+d)),u=ut.find(a=>a.url===c);if(!u)return;const v=[...ut.filter(a=>a.url!==c),u],p=await r(v),b=o.crypto_kx_keypair(),m=new Uint8Array(52);m.set(l),m.set(b.publicKey,20),p.send(m,Qe);const f=await Promise.race([new Promise(a=>{p.onData((n,o)=>{n===Ge&&o.length>=We&&a(o.subarray(0,We))})}),new Promise((a,n)=>setTimeout(()=>n(new Error("Visitor PK timeout")),15e3))]),y=o.crypto_kx_server_session_keys(b.publicKey,b.privateKey,f),w=new dt;w.rx=y.sharedRx,w.tx=y.sharedTx;const g=(new TextEncoder).encode(JSON.stringify({envId:n})),k=w.encrypt(g);p.send(k,Ge),setTimeout(()=>{w.destroy(),p.destroy();const a=ht.indexOf(p);a>=0&&ht.splice(a,1)},3e3)}(o,a.envId).catch(a=>{})});const m={roomId:b,keepAlive:()=>{var a;if((null==(a=d.ws)?void 0:a.readyState)===WebSocket.OPEN){const a=new Uint8Array(33);a[0]=tt,a.set(n,1),d.send(a,tt)}},unpublish:()=>{ft&&clearInterval(ft),ft=null,d.destroy(),bt=null,mt=null,l.value=!1}};return mt=m,l.value=!1,m}catch(a){return v.value=a.message,l.value=!1,null}},discoverRooms:async function(){it||await i(),u.value=!0,v.value=null;let a=[],n=null;try{const n=await r([...ut].reverse()),o=new Uint8Array(7);o[0]=Xe,new DataView(o.buffer).setUint32(1,0),new DataView(o.buffer).setUint16(5,50);const l=new Promise(a=>{n.onData((n,o)=>{n===et&&a(o)})});n.send(o,Xe);const d=await Promise.race([l,new Promise((a,n)=>setTimeout(()=>n(new Error("Tracker query timeout")),8e3))]);if(d.length>=6){const n=new DataView(d.buffer,d.byteOffset).getUint16(4);let o=6;for(let l=0;l<n&&o<d.length&&!(o+36>d.length);l++){const n=d.subarray(o,o+32),l=new DataView(d.buffer,d.byteOffset+o+32).getUint16(0),c=(new TextDecoder).decode(d.subarray(o+34,o+34+l)),u=new DataView(d.buffer,d.byteOffset+o+34+l).getUint16(0),v=d.subarray(o+36+l,o+36+l+u),p=Oe(n),b=h(v);b&&a.push({roomId:p,envId:b.envId,name:b.name,description:b.description,capacity:b.capacity,tags:b.tags,entryRelay:c}),o+=36+l+u}}n.destroy();const c=ht.indexOf(n);c>=0&&ht.splice(c,1)}catch(a){n=a.message}if(0===a.length)try{a=await async function(){const a=nt,n=ut.map(a=>a.url.replace("wss://","https://").replace("ws://","http://")),o=new Map,l=await Promise.allSettled(n.map(async a=>{const n=await fetch(`${a}/rooms`,{signal:AbortSignal.timeout(8e3)});if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()}));for(const n of l)if("fulfilled"===n.status)for(const l of n.value.rooms)if(!o.has(l.id))try{const n=h(a.from_base64(l.metadata,a.base64_variants.ORIGINAL));n&&o.set(l.id,{roomId:l.id,envId:n.envId,name:n.name,description:n.description,capacity:n.capacity,tags:n.tags,entryRelay:l.relay})}catch{}return[...o.values()]}(),a.length}catch{}return 0===a.length&&n&&(v.value=n),c.value=a,u.value=!1,a},connectToRoom:async function(a){it||await i(),v.value=null;try{const n=nt,o=[...ut],l=await r(o),d=o[o.length-1].url,c=n.randombytes_buf(20);if(l.send(new Uint8Array(c),Je),!await Promise.race([new Promise(a=>{l.onData((n,o)=>{n===Ye&&a(1===o[0])})}),new Promise((a,n)=>setTimeout(()=>n(new Error("Rendezvous establish timeout")),1e4))]))throw l.destroy(),new Error("Failed to establish rendezvous");const u=await r([...ut].reverse()),v=(new TextEncoder).encode(d),p=function(a){const n=new Uint8Array(a.length/2);for(let o=0;o<n.length;o++)n[o]=parseInt(a.slice(2*o,2*o+2),16);return n}(a),b=new Uint8Array(55+v.length);b[0]=at,b.set(p,1),b.set(c,33),new DataView(b.buffer).setUint16(53,v.length),b.set(v,55),u.send(b,at);const m=new dt,f=await m.initAsClient(l),y=await Promise.race([new Promise(a=>{l.onData((n,o)=>{n===Qe&&a(o.subarray(1))})}),new Promise((a,n)=>setTimeout(()=>n(new Error("Host join timeout (30s)")),3e4))]);l.send(f,Ge),await m.completeAsClient(y),u.destroy();const w=ht.indexOf(u);w>=0&&ht.splice(w,1);const g=await Promise.race([new Promise(a=>{l.onData((n,o)=>{if(n===Ge){const n=m.decrypt(o);if(n)try{const o=JSON.parse((new TextDecoder).decode(n));o.envId&&a(o.envId)}catch{}}})}),new Promise((a,n)=>setTimeout(()=>n(new Error("Room info timeout")),1e4))]),k={onData:null,onClose:null,send:a=>{const n=m.encrypt(a);l.send(n,Ge)},close:()=>{var a;m.destroy(),l.destroy();const n=ht.indexOf(l);n>=0&&ht.splice(n,1),null==(a=k.onClose)||a.call(k)}};return l.onData((a,n)=>{var o;if(a===Ge){const a=m.decrypt(n);a&&(null==(o=k.onData)||o.call(k,a))}}),{connection:k,envId:g}}catch(a){return v.value=a.message,null}},destroyAll:function(){ft&&clearInterval(ft),ft=null;for(const a of ht)a.destroy();ht.length=0,bt=null,mt=null,l.value=!1,u.value=!1},deriveRoomId:function(a){if(!nt)throw new Error("Not initialized");return Oe(ct(a))},generateInviteToken:function(a,n){if(!nt||!pt)throw new Error("Not initialized");const o=nt,l=(new TextEncoder).encode(a),d=o.randombytes_buf(Ke),c=o.crypto_aead_xchacha20poly1305_ietf_encrypt(l,null,null,d,pt),u=new Uint8Array(d.length+c.length);return u.set(d),u.set(c,d.length),`${n}.${o.to_base64(u,o.base64_variants.URLSAFE_NO_PADDING)}`},parseInviteToken:function(a){if(!nt||!pt)return null;const n=nt;let o="",l="";if(a.startsWith("sfr:"))l=a.slice(4);else{const n=a.indexOf(".");if(n<1)return null;o=a.substring(0,n),l=a.substring(n+1)}try{const a=n.from_base64(l,n.base64_variants.URLSAFE_NO_PADDING);if(a.length<40)return null;const d=a.subarray(0,Ke),c=a.subarray(Ke),u=n.crypto_aead_xchacha20poly1305_ietf_decrypt(null,c,null,d,pt);if(!u||0===u.length)return null;return{roomKey:o,envId:(new TextDecoder).decode(u)}}catch{return null}},fetchTunnelInfo:async function(){try{return await $fetch("/api/room3d/tunnel-info")}catch{return null}}}}const xt=o([]),yt=o({});function Ua(){function e(a){xt.value.some(n=>n.roomId===a.roomId)||xt.value.push({roomId:a.roomId,name:a.name,addedAt:Date.now()})}function t(a){xt.value=xt.value.filter(n=>n.roomId!==a)}function s(a){return xt.value.some(n=>n.roomId===a)}return{favorites:d(xt),customNames:d(yt),addFavorite:e,removeFavorite:t,isFavorite:s,toggleFavorite:function(a){s(a.roomId)?t(a.roomId):e(a)},setCustomName:function(a,n){n.trim()?yt.value[a]=n.trim():delete yt.value[a]},getDisplayName:function(a){return yt.value[a.roomId]||a.name}}}const wt=c({__name:"Room3dPublicBrowser",__ssrInlineRender:!0,props:{authenticated:{type:Boolean}},emits:["join-public-room"],setup(a,{emit:n}){Da();const d=Ua(),c=o(""),u=o([]),b=o(!1),m=o(null),f=o(null),y=o("");o(null);const{getDisplayName:w,isFavorite:_}=d;const M=l(()=>{if(!c.value.trim())return u.value;const a=c.value.toLowerCase();return u.value.filter(n=>{var o,l;return n.name.toLowerCase().includes(a)||(null==(o=n.description)?void 0:o.toLowerCase().includes(a))||(null==(l=n.tags)?void 0:l.some(n=>n.toLowerCase().includes(a)))})});return(a,n,o,l)=>{n(`<div${g(v({class:"w-full max-w-4xl mx-auto"},l))} data-v-d44a5b4d><div class="flex items-center gap-2 mb-3" data-v-d44a5b4d><div class="relative flex-1" data-v-d44a5b4d>`),n(k(p(Y),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/25"},null,o)),n(`<input${A("value",p(c))} type="text" placeholder="Search rooms..." class="w-full bg-black/60 border border-white/20 rounded-xl pl-9 pr-3 py-2 text-white text-base placeholder-white/30 focus:border-emerald-500/40 focus:outline-none transition-colors" data-v-d44a5b4d></div><button${T(p(b))?" disabled":""} class="p-2 rounded-xl bg-black/60 border border-white/20 hover:bg-emerald-500/10 hover:border-emerald-500/30 transition-all disabled:opacity-30" title="Refresh" data-v-d44a5b4d>`),n(k(p(W),{class:["w-5 h-5 text-white/50",{"animate-spin":p(b)}]},null,o)),n('</button></div><div class="max-h-[30vh] sm:max-h-[35vh] overflow-y-auto pr-0.5 pub-scroll" data-v-d44a5b4d>'),p(b)&&!p(u).length?n('<div class="flex flex-col items-center py-8" data-v-d44a5b4d><div class="w-8 h-8 border-2 border-white/5 border-t-emerald-400 rounded-full animate-spin mb-3" data-v-d44a5b4d></div><p class="text-white/40 text-base" data-v-d44a5b4d>Discovering rooms...</p></div>'):p(m)?n(`<div class="text-center py-6" data-v-d44a5b4d><p class="text-red-400/70 text-base mb-2" data-v-d44a5b4d>${I(p(m))}</p><button class="text-base text-emerald-400/60 hover:text-emerald-400 transition-colors" data-v-d44a5b4d>Try again</button></div>`):p(M).length||p(b)?(n('<div class="space-y-2" data-v-d44a5b4d>\x3c!--[--\x3e'),C(p(M),a=>{var l;n(`<div class="space-y-0" data-v-d44a5b4d><button class="${P([[p(f)===a.roomId?"rounded-t-xl border-b-0 border-amber-500/30 bg-amber-500/[0.04]":"rounded-xl hover:border-emerald-500/30 hover:bg-emerald-500/[0.06]"],"group w-full text-left flex items-center gap-3 bg-black/50 border border-white/[0.12] px-4 py-3 transition-all"])}" data-v-d44a5b4d><div class="flex-1 min-w-0" data-v-d44a5b4d><div class="flex items-center gap-2" data-v-d44a5b4d><h4 class="text-base font-bold text-white/80 group-hover:text-emerald-300 transition-colors truncate" data-v-d44a5b4d>${I(p(w)(a))}</h4>`),a.passwordProtected?n(k(p(O),{class:"w-4 h-4 text-amber-400/60 flex-shrink-0"},null,o)):n("\x3c!----\x3e"),n("\x3c!--[--\x3e"),C(null==(l=a.tags)?void 0:l.slice(0,2),a=>{n(`<span class="hidden sm:inline px-1.5 py-0.5 rounded bg-white/[0.06] text-white/35 text-base leading-tight flex-shrink-0" data-v-d44a5b4d>${I(a)}</span>`)}),n("\x3c!--]--\x3e</div>"),a.description?n(`<p class="text-base text-white/35 truncate mt-0.5" data-v-d44a5b4d>${I(a.description)}</p>`):n("\x3c!----\x3e"),n('</div><div class="flex items-center gap-1 text-white/30 text-base flex-shrink-0" data-v-d44a5b4d>'),n(k(p(Q),{class:"w-4 h-4"},null,o)),n(`<span data-v-d44a5b4d>${I(a.capacity)}</span></div><div class="p-1 cursor-pointer flex-shrink-0" data-v-d44a5b4d>`),function(a){return _(a)}(a.roomId)?n(k(p(Z),{class:"w-4 h-4 text-amber-400"},null,o)):n(k(p(X),{class:"w-4 h-4 text-white/15 group-hover:text-white/30 transition-colors"},null,o)),n("</div></button>"),p(f)===a.roomId?(n('<div class="bg-black/50 border border-white/[0.12] border-t-0 border-amber-500/30 rounded-b-xl px-4 py-3 flex items-center gap-2" data-v-d44a5b4d>'),n(k(p(O),{class:"w-4 h-4 text-amber-400/50 flex-shrink-0"},null,o)),n(`<input${A("value",p(y))} type="password" placeholder="Enter room password" maxlength="32" class="flex-1 bg-black/60 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-amber-500/50 focus:outline-none transition-colors" data-v-d44a5b4d><button class="px-3 py-1.5 rounded-lg bg-amber-500/20 text-amber-300 text-base font-medium hover:bg-amber-500/30 transition-colors" data-v-d44a5b4d> Join </button></div>`)):n("\x3c!----\x3e"),n("</div>")}),n("\x3c!--]--\x3e</div>")):(n('<div class="text-center py-8" data-v-d44a5b4d>'),n(k(p($),{class:"w-10 h-10 text-white/[0.08] mx-auto mb-2"},null,o)),n(`<p class="text-white/40 text-base" data-v-d44a5b4d>${I(p(c)?"No rooms match your search":"No public rooms yet")}</p></div>`)),n("</div></div>")}}}),gt=wt.setup;wt.setup=(a,n)=>{const o=y();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dPublicBrowser.vue"),gt?gt(a,n):void 0};const _t=Object.assign(q(wt,[["__scopeId","data-v-d44a5b4d"]]),{__name:"Room3dPublicBrowser"}),Mt=o();let Rt=null,Dt=null,Et=null,Ut=0,$t=0;const Vt=new ee.Vector3,Ot=o(!1);let jt=0;const Nt=o([]),Lt=o(""),zt="sf_room3d_user_name",Bt=o("");function Na(){const a=Bt.value.trim();a?localStorage.setItem(zt,a):localStorage.removeItem(zt)}function La(){Bt.value=localStorage.getItem(zt)||""}const Kt=o(),Ft=o(0);function Va(a){const n=a.target;if(!n)return;const o=n.scrollWidth/ie.length;Ft.value=Math.round(n.scrollLeft/o)}const Wt=o({}),Ht=o(""),Gt=l(()=>"");let Jt=null,Yt=[],Qt=0,Zt=0;const qt=o(0);let Xt=null;const ea=new Set;async function Ha(){if(!Mt.value||Et)return;const a="ontouchstart"in void 0||(void 0).maxTouchPoints>0;Rt=new ee.Scene,Dt=new ee.PerspectiveCamera(34,Mt.value.clientWidth/Mt.value.clientHeight,.1,50),Dt.position.set(0,1.25,4.8),Dt.lookAt(0,.6,0),Et=new ee.WebGLRenderer({antialias:!a,alpha:!0}),Et.setPixelRatio(Math.min((void 0).devicePixelRatio,a?1.5:2)),Et.setSize(Mt.value.clientWidth,Mt.value.clientHeight),Et.setClearColor(0,0),Et.toneMapping=a?ee.AgXToneMapping:ee.ACESFilmicToneMapping,Et.toneMappingExposure=1.6,a||(Et.shadowMap.enabled=!0,Et.shadowMap.type=ee.PCFSoftShadowMap),Mt.value.appendChild(Et.domElement),Rt.fog=new ee.FogExp2(394767,.06);const n=new ee.DirectionalLight(16772829,3.5);n.position.set(2,5,5),a||(n.castShadow=!0,n.shadow.mapSize.set(1024,1024),n.shadow.camera.near=.5,n.shadow.camera.far=15,n.shadow.bias=-.002),Rt.add(n);const o=new ee.DirectionalLight(6724044,.8);o.position.set(-4,2,3),Rt.add(o);const l=new ee.DirectionalLight(1096065,2);if(l.position.set(0,3,-5),Rt.add(l),!a){const a=new ee.SpotLight(16777215,4,12,Math.PI/8,.6,1);a.position.set(0,5,3),a.target.position.set(0,0,2.8),Rt.add(a),Rt.add(a.target)}Rt.add(new ee.AmbientLight(3359829,a?1.2:.6)),Jt=new ee.Group,Rt.add(Jt),(void 0).addEventListener("resize",It);try{await Et.compileAsync(Rt,Dt)}catch{}$t=performance.now(),Ct()}function It(){if(!Mt.value||!Et||!Dt)return;const a=Mt.value.clientWidth,n=Mt.value.clientHeight;Dt.aspect=a/n,Dt.updateProjectionMatrix(),Et.setSize(a,n)}async function za(){var a;if(!Rt||!Jt||0===Nt.value.length)return;Ot.value=!0;const n=++jt,o=Nt.value,l=o.length,d=2*Math.PI/l;if(!Xt)try{const n=new te,o=await new Promise((a,o)=>n.load("/models/characters/animations/Idle.glb",a,void 0,o));(null==(a=o.animations)?void 0:a.length)&&(Xt=o.animations.find(a=>!a.name.includes("T-Pose"))||o.animations[o.animations.length-1])}catch{}if(n!==jt)return;Yt=[],ea.clear();for(let a=0;a<l;a++){const n=a*d,l=new ee.Group;l.position.set(2.8*Math.sin(n),0,2.8*Math.cos(n)),Jt.add(l),Yt.push({wrapper:l,model:null,mixer:null,file:o[a],loaded:!1})}const c=o.indexOf(Lt.value);c>=0&&(qt.value=c,Qt=Zt=-c*d);const u=[qt.value];l>1&&u.push(((qt.value+1)%l+l)%l),l>2&&u.push(((qt.value-1)%l+l)%l),await Promise.all(u.map(a=>Tt(a,n))),At(),Ot.value=!1}async function Tt(a,n){const o=null!=n?n:jt;if(a<0||a>=Yt.length)return;const l=Yt[a];if(l&&!l.loaded&&!ea.has(a)){ea.add(a);try{const a=new te,n=await new Promise((n,o)=>{a.load(`/models/characters/${encodeURIComponent(l.file)}`,n,void 0,o)});if(o!==jt)return void n.scene.traverse(a=>{a.geometry&&a.geometry.dispose()});const d=n.scene,c=(new ee.Box3).setFromObject(d),u=c.max.y-c.min.y;u>0&&d.scale.setScalar(1.4/u);const v=(new ee.Box3).setFromObject(d);d.position.y=-v.min.y,d.position.x=-(v.min.x+v.max.x)/2,d.position.z=-(v.min.z+v.max.z)/2,l.wrapper.add(d),l.model=d;const p=n.animations||[];let b=p.find(a=>/idle/i.test(a.name)&&!a.name.includes("T-Pose"));if(!b&&p.length>0&&(b=p.find(a=>!a.name.includes("T-Pose"))||p[0]),!b&&Xt&&(b=Xt),b&&(l.mixer=new ee.AnimationMixer(d),l.mixer.clipAction(b).play()),l.loaded=!0,Et&&Rt&&Dt)try{await Et.compileAsync(Rt,Dt)}catch{}}catch{}finally{ea.delete(a)}}}function Ga(a,n){a.model&&a.model.traverse(a=>{if(a.isMesh&&a.material){const o=Array.isArray(a.material)?a.material:[a.material];for(const a of o)a.transparent=!0,a.opacity=n}})}function At(){if(!Yt.length)return;const a=Yt.length;for(let n=0;n<a;n++){const o=((n-qt.value)%a+a)%a,l=o>a/2?a-o:o,d=0===l?1.05:1;Yt[n].wrapper.scale.setScalar(d),Yt[n].wrapper.visible=l<=2,Ga(Yt[n],l<=1?1:.25)}}function Ct(){if(!Et||!Rt||!Dt)return;Ut=requestAnimationFrame(Ct);const a=performance.now(),n=Math.min((a-$t)/1e3,.1);$t=a;for(const a of Yt)a.mixer&&a.mixer.update(n);if(Jt){const a=Zt-Qt;Math.abs(a)>.001?Qt+=a*Math.min(1,4*n):Qt=Zt,Jt.rotation.y=Qt;const o=Dt.position;for(const a of Yt){a.wrapper.getWorldPosition(Vt);const n=o.x-Vt.x,l=o.z-Vt.z,d=Math.atan2(n,l);a.wrapper.rotation.y=d-Jt.rotation.y}}Et.render(Rt,Dt)}function Ze(a){const n=Nt.value.length;if(n<2)return;const o=qt.value,l=2*Math.PI/n;for(qt.value=(a%n+n)%n,Zt=-qt.value*l;Zt-Qt>Math.PI;)Zt-=2*Math.PI;for(;Zt-Qt<-Math.PI;)Zt+=2*Math.PI;Lt.value=Nt.value[qt.value],At();const d=qt.value>o||o===n-1&&0===qt.value?1:-1;Tt(((qt.value+d)%n+n)%n)}function St(){Ze(qt.value-1)}function Pt(){Ze(qt.value+1)}let ta=0;function Fa(a){if(a.preventDefault(),Nt.value.length<2)return;const n=Date.now();n-ta<200||(ta=n,a.deltaY>0?Pt():a.deltaY<0&&St())}function _a(){(void 0).removeEventListener("resize",It),cancelAnimationFrame(Ut),Ut=0,jt++,ea.clear();for(const a of Yt)a.mixer&&a.mixer.stopAllAction(),ma(a.wrapper);Yt=[],Rt&&(Rt.traverse(a=>{if(a.geometry&&a.geometry.dispose(),a.material){const n=Array.isArray(a.material)?a.material:[a.material];for(const a of n)a.dispose()}}),Rt=null),Jt=null,Et&&(Et.domElement.remove(),Et.dispose(),Et=null),Dt=null}async function Ya(){try{const a=await $fetch("/api/room3d/characters");if(null==a?void 0:a.length){const n=[...a];for(let a=n.length-1;a>0;a--){const o=Math.floor(Math.random()*(a+1));[n[a],n[o]]=[n[o],n[a]]}Nt.value=n}!Nt.value.includes(Lt.value)&&Nt.value.length>0&&(Lt.value=Nt.value[0])}catch{}}function Wa(){return{lobbyCanvas:Mt,lobbyCharLoading:Ot,availableCharacters:Nt,selectedCharacter:Lt,displayName:Bt,saveDisplayName:Na,loadDisplayName:La,roomScrollContainer:Kt,activeRoomIdx:Ft,onRoomScroll:Va,editingCode:Wt,copiedCode:Ht,currentDomain:Gt,carouselSelectedIdx:qt,initLobbyScene:Ha,disposeLobbyScene:_a,initCarouselPositions:za,lobbyRotateToIndex:Ze,lobbyPrevChar:St,lobbyNextChar:Pt,onLobbyWheel:Fa,loadAvailableCharacters:Ya,charDisplayName:ba}}const aa=c({__name:"Room3dLobby",__ssrInlineRender:!0,props:{environments:{},availableCharacters:{},selectedCharacter:{},carouselSelectedIdx:{},lobbyCharLoading:{type:Boolean},displayName:{},isDev:{type:Boolean},editMode:{type:Boolean},authenticated:{type:Boolean},roomSettings:{},inviteTokens:{},copiedToken:{},activeRoomIdx:{},guestMode:{type:Boolean},guestReady:{type:Boolean},guestOnlineCount:{},guestConnected:{type:Boolean},hideTokenPaste:{type:Boolean}},emits:["select-environment","prev-char","next-char","lobby-wheel","update-room-settings","copy-link","update:displayName","update:editMode","save-display-name","room-scroll","enter-room","join-public-room","join-by-token"],setup(n,{emit:d}){const c={isPublic:!0,inviteOnly:!1,publicName:"",publicDescription:"",password:""},y={isPublic:!1,inviteOnly:!0,publicName:"",publicDescription:"",password:""},w=n,S=d,B=o(!1),K=o(""),F=o(null),W=o(null);function x(a,n){const o=w.roomSettings[a];return o&&n in o?o[n]:("big_room"===a?c:y)[n]}const H=l(()=>w.authenticated?w.environments:w.environments.filter(a=>!a.hidden)),G=l({get:()=>w.displayName,set:a=>S("update:displayName",a)});l({get:()=>w.editMode,set:a=>S("update:editMode",a)});const J=o("rooms"),Y=o(),Q=o();o();const Z=o(0),q=o(3),X=l(()=>Math.max(1,Math.ceil(H.value.length/q.value))),ee=l(()=>{const a=H.value.length,n=q.value;if(Z.value>=X.value-1&&a>n)return H.value.slice(a-n);const o=Z.value*n;return H.value.slice(o,o+n)}),te=Wa();return u(Y,a=>{a&&(te.lobbyCanvas.value=a)}),u(Q,a=>{a&&(te.roomScrollContainer.value=a)}),(o,l,d,c)=>{var u;const y=a,w=Be,S=_t;l(`<div${g(v({class:"absolute inset-0 z-30 lobby-bg overflow-hidden"},c))} data-v-f35415a5>`),n.guestMode?l("\x3c!----\x3e"):(l('<button class="absolute top-3 left-3 z-30 p-2 text-white/40 hover:text-white/70 transition-colors" data-v-f35415a5>'),l(k(p(R),{class:"w-6 h-6"},null,d)),l("</button>")),l(`<div class="lobby-particle lobby-p1" data-v-f35415a5></div><div class="lobby-particle lobby-p2" data-v-f35415a5></div><div class="lobby-particle lobby-p3" data-v-f35415a5></div><div class="lobby-particle lobby-p4" data-v-f35415a5></div><div class="lobby-particle lobby-p5" data-v-f35415a5></div><div class="lobby-particle lobby-p6" data-v-f35415a5></div><div class="lobby-particle lobby-p7" data-v-f35415a5></div><div class="lobby-particle lobby-p8" data-v-f35415a5></div><canvas class="absolute inset-0 w-full h-full object-cover pointer-events-none" style="${_({filter:"blur(4px)",opacity:"0.35"})}" data-v-f35415a5></canvas><div class="absolute inset-0 z-[1]" data-v-f35415a5></div><div class="absolute inset-0 pointer-events-none lobby-vignette z-[2]" data-v-f35415a5></div>`),n.guestMode?l(`<div class="absolute top-4 right-4 z-30" data-v-f35415a5><div class="px-3 py-1.5 rounded-full bg-black/70 backdrop-blur-sm border border-white/15 text-base text-gray-300 flex items-center gap-2" data-v-f35415a5><div class="${P([n.guestConnected?"bg-emerald-400 animate-pulse":"bg-gray-600","w-2 h-2 rounded-full"])}" data-v-f35415a5></div><span data-v-f35415a5>${I(null!=(u=n.guestOnlineCount)?u:0)} online</span></div></div>`):l("\x3c!----\x3e"),n.lobbyCharLoading?l('<div class="absolute inset-0 z-10 flex items-center justify-center pointer-events-none" data-v-f35415a5><div class="w-14 h-14 border-2 border-white/5 border-t-emerald-400 rounded-full animate-spin" data-v-f35415a5></div></div>'):l("\x3c!----\x3e"),l(`<div class="absolute top-0 left-0 right-0 z-20 text-center pt-5 pointer-events-none" data-v-f35415a5><div class="inline-block" data-v-f35415a5><img${A("src","/images/SCHEDULE-4-REAL.svg")} alt="Schedule 4 Real" class="mx-auto h-16 sm:h-24 select-none lobby-title-glow" draggable="false" data-v-f35415a5>`),n.authenticated||n.guestMode?l("\x3c!----\x3e"):l('<div class="mt-2 inline-block bg-yellow-500/10 border border-yellow-500/30 rounded-full px-3 py-0.5" data-v-f35415a5><span class="text-yellow-400/70 text-base font-medium" data-v-f35415a5>Guest Mode</span></div>'),l('<div class="mx-auto mt-2 h-px w-56 bg-gradient-to-r from-transparent via-emerald-500/40 to-transparent" data-v-f35415a5></div></div>'),l(k(y,null,{},d)),l("</div>"),n.availableCharacters.length>1?(l('<button class="absolute left-2 sm:left-6 top-[45%] -translate-y-1/2 z-20 lobby-nav-btn group" data-v-f35415a5>'),l(k(p(D),{class:"w-5 h-5 text-white/40 group-hover:text-emerald-300 transition-colors duration-200"},null,d)),l("</button>")):l("\x3c!----\x3e"),n.availableCharacters.length>1?(l('<button class="absolute right-2 sm:right-6 top-[45%] -translate-y-1/2 z-20 lobby-nav-btn group" data-v-f35415a5>'),l(k(p(E),{class:"w-5 h-5 text-white/40 group-hover:text-emerald-300 transition-colors duration-200"},null,d)),l("</button>")):l("\x3c!----\x3e"),l('<div class="absolute bottom-0 left-0 right-0 z-20 lobby-bottom-fade pointer-events-none" data-v-f35415a5>'),n.guestMode?(l('<div class="pointer-events-auto max-w-xs mx-auto px-4 pb-6 text-center" data-v-f35415a5>'),n.availableCharacters.length>1?(l('<div class="flex items-center justify-center gap-1.5 mb-4" data-v-f35415a5>\x3c!--[--\x3e'),C(n.availableCharacters,(a,o)=>{l(`<div class="${P([o===n.carouselSelectedIdx?"bg-emerald-400 w-4":"bg-white/15 w-1.5","h-1.5 rounded-full transition-all duration-300"])}" data-v-f35415a5></div>`)}),l("\x3c!--]--\x3e</div>")):l("\x3c!----\x3e"),l(`<input${A("value",p(G))} type="text" placeholder="Enter your name" maxlength="20" class="w-full bg-black/60 border border-white/20 rounded-xl px-4 py-2.5 text-white text-center text-base placeholder-white/30 focus:border-emerald-500/50 focus:outline-none transition-colors mb-3" data-v-f35415a5><button${T(!n.guestReady||n.lobbyCharLoading)?" disabled":""} class="w-full py-3 rounded-xl font-bold text-base text-white transition-all bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 disabled:opacity-30 disabled:cursor-not-allowed shadow-lg shadow-emerald-500/25" data-v-f35415a5> Enter Room </button>`),n.hideTokenPaste?l("\x3c!----\x3e"):(l('<div class="mt-3 flex items-center gap-2" data-v-f35415a5><div class="relative flex-1" data-v-f35415a5>'),l(k(p(U),{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/25"},null,d)),l(`<input${A("value",p(K))} type="text" placeholder="Paste invite token" class="w-full bg-black/60 border border-white/20 rounded-xl pl-9 pr-3 py-2 text-white text-base placeholder-white/30 focus:border-emerald-500/40 focus:outline-none transition-colors font-mono" data-v-f35415a5></div><button${T(!p(K).startsWith("sfr:"))?" disabled":""} class="px-3 py-2 rounded-xl bg-emerald-500/25 border border-emerald-500/30 text-emerald-400 text-base font-bold hover:bg-emerald-500/35 transition-all disabled:opacity-20 disabled:cursor-not-allowed flex-shrink-0" data-v-f35415a5> Join </button></div>`)),l("</div>")):(l('<div class="max-w-6xl mx-auto px-0 pb-3 sm:px-6 sm:pb-6" data-v-f35415a5><div class="text-center mb-3 sm:mb-4" data-v-f35415a5>'),n.availableCharacters.length>1?(l('<div class="hidden sm:flex items-center justify-center gap-1.5 mb-2" data-v-f35415a5>\x3c!--[--\x3e'),C(n.availableCharacters,(a,o)=>{l(`<div class="${P([o===n.carouselSelectedIdx?"bg-emerald-400 w-4 rounded-full":"bg-white/15","w-1.5 h-1.5 rounded-full transition-all duration-300"])}" data-v-f35415a5></div>`)}),l("\x3c!--]--\x3e</div>")):l("\x3c!----\x3e"),l(`<div class="flex justify-center" data-v-f35415a5><input${A("value",p(G))} type="text" placeholder="Your name" maxlength="20" class="pointer-events-auto w-48 sm:w-56 bg-black/60 border border-white/20 rounded-xl px-4 py-2 sm:py-2.5 text-white text-center text-base placeholder-white/30 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-f35415a5></div></div><div class="flex items-center justify-center gap-3 sm:gap-4 mb-2 sm:mb-3 pointer-events-auto" data-v-f35415a5><div class="hidden sm:block h-px w-12 bg-gradient-to-r from-transparent to-white/10" data-v-f35415a5></div><div class="flex items-center bg-black/60 rounded-xl p-0.5 border border-white/15" data-v-f35415a5><button class="${P(["rooms"===p(J)?"bg-white/[0.12] text-white/70":"text-white/30 hover:text-white/50","px-3 sm:px-4 py-1 sm:py-1.5 rounded-lg text-base font-bold tracking-wider uppercase transition-all"])}" data-v-f35415a5> My Rooms </button><button class="${P(["public"===p(J)?"bg-white/[0.12] text-white/70":"text-white/30 hover:text-white/50","px-3 sm:px-4 py-1 sm:py-1.5 rounded-lg text-base font-bold tracking-wider uppercase transition-all flex items-center gap-1.5"])}" data-v-f35415a5>`),l(k(p($),{class:"w-3.5 h-3.5"},null,d)),l(' Public </button></div><div class="hidden sm:block h-px w-12 bg-gradient-to-l from-transparent to-white/10" data-v-f35415a5></div></div>'),"rooms"===p(J)?(l('<div class="flex items-center justify-center mb-3 pointer-events-auto" data-v-f35415a5><button class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-black/40 border border-white/10 text-white/40 hover:text-emerald-400 hover:border-emerald-500/30 hover:bg-emerald-500/10 transition-all text-base" title="How privacy works" data-v-f35415a5>'),l(k(p(V),{class:"w-4 h-4"},null,d)),l("<span data-v-f35415a5>Privacy info</span></button></div>")):l("\x3c!----\x3e"),l(k(w,{modelValue:p(B),"onUpdate:modelValue":a=>b(B)?B.value=a:null},null,d)),"rooms"===p(J)?(l('<div class="pointer-events-auto relative" data-v-f35415a5>'),p(Z)>0?(l('<button class="hidden sm:flex absolute -left-4 top-1/2 -translate-y-1/2 z-10 w-9 h-9 items-center justify-center rounded-full bg-black/70 backdrop-blur-sm border border-white/15 hover:bg-emerald-500/15 hover:border-emerald-500/30 transition-all" data-v-f35415a5>'),l(k(p(D),{class:"w-4 h-4 text-white/60"},null,d)),l("</button>")):l("\x3c!----\x3e"),l(`<div class="flex gap-3 sm:gap-5 overflow-x-auto snap-x snap-mandatory scrollbar-hide sm:overflow-visible sm:justify-center px-2 sm:px-0 items-start" data-v-f35415a5><div${g({name:"room-card",class:"contents"})} data-v-f35415a5>`),C(p(ee),a=>{l('<div class="flex flex-col items-stretch w-[45vw] sm:w-96 snap-center flex-shrink-0" data-v-f35415a5><div class="lobby-room-card group relative overflow-hidden rounded-2xl transition-all duration-300 hover:scale-[1.03]" data-v-f35415a5><button class="w-full text-left" data-v-f35415a5><div class="relative h-28 sm:h-56 overflow-hidden" data-v-f35415a5>'),a.image?l(`<img${A("src",a.image)}${A("alt",a.name)} class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" data-v-f35415a5>`):(l('<div class="w-full h-full bg-gradient-to-br from-gray-800/80 to-gray-900/80 flex items-center justify-center" data-v-f35415a5>'),M(l,m(f(a.icon),{class:"w-12 h-12 text-white/15"},null),d),l("</div>")),l('<div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-black/30" data-v-f35415a5></div>'),a.hidden&&n.authenticated?l('<div class="absolute top-2 right-2 bg-amber-500/20 border border-amber-500/30 rounded-full px-2 py-0.5" data-v-f35415a5><span class="text-amber-400 text-base font-medium" data-v-f35415a5>Hidden</span></div>'):l("\x3c!----\x3e"),l(`<div class="absolute bottom-3 left-3 right-3" data-v-f35415a5><h3 class="text-white font-bold text-lg sm:text-xl drop-shadow-lg group-hover:text-emerald-300 transition-colors leading-tight" data-v-f35415a5>${I(x(a.id,"publicName")||a.name)}</h3>`),x(a.id,"publicDescription")?l(`<p class="text-white/50 text-base drop-shadow-lg truncate mt-0.5" data-v-f35415a5>${I(x(a.id,"publicDescription"))}</p>`):l("\x3c!----\x3e"),l('</div><div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300" data-v-f35415a5><div class="w-14 h-14 rounded-full bg-emerald-500/20 backdrop-blur-sm flex items-center justify-center border border-emerald-400/30" data-v-f35415a5><svg class="w-6 h-6 text-emerald-300 ml-0.5" fill="currentColor" viewBox="0 0 24 24" data-v-f35415a5><path d="M8 5v14l11-7z" data-v-f35415a5></path></svg></div></div></div></button>'),n.authenticated?(l(`<div class="bg-black/80 border-t border-white/[0.08] px-3 py-1.5 space-y-1.5" data-v-f35415a5><div class="flex items-center justify-between" data-v-f35415a5><label class="flex items-center gap-1.5 cursor-pointer" data-v-f35415a5><div class="relative inline-flex items-center" data-v-f35415a5><input type="checkbox"${T(x(a.id,"isPublic"))?" checked":""} class="sr-only peer" data-v-f35415a5><div class="w-7 h-4 bg-gray-700 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-3 after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all" data-v-f35415a5></div></div><span class="${P([x(a.id,"isPublic")?"text-emerald-400/80":"text-white/35","text-base"])}" data-v-f35415a5>${I(x(a.id,"isPublic")?"Public visible":"Not public")}</span></label><label class="flex items-center gap-1.5 cursor-pointer" data-v-f35415a5><div class="relative inline-flex items-center" data-v-f35415a5><input type="checkbox"${T(!x(a.id,"inviteOnly"))?" checked":""} class="sr-only peer" data-v-f35415a5><div class="w-7 h-4 bg-gray-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-3 after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all" data-v-f35415a5></div></div><span class="${P([x(a.id,"inviteOnly")?"text-white/35":"text-sky-400/80","text-base"])}" data-v-f35415a5>${I(x(a.id,"inviteOnly")?"Hidden on lobby":"Visible on lobby")}</span></label></div><div class="flex items-center gap-2" data-v-f35415a5><button class="${P([[x(a.id,"password")?"text-amber-400 bg-amber-500/10":"text-white/30 hover:text-white/50",p(W)===a.id?"ring-1 ring-amber-500/40":""],"flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-f35415a5>`),x(a.id,"password")?l(k(p(O),{class:"w-3.5 h-3.5"},null,d)):l(k(p(j),{class:"w-3.5 h-3.5"},null,d)),l(`<span data-v-f35415a5>${I(x(a.id,"password")?"Password set":"No password")}</span></button><button class="${P([p(F)===a.id?"text-emerald-400 bg-emerald-500/10 ring-1 ring-emerald-500/40":"text-white/30 hover:text-white/50","flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-f35415a5>`),l(k(p(N),{class:"w-3.5 h-3.5"},null,d)),l('<span data-v-f35415a5>Edit info</span></button><div class="flex-1" data-v-f35415a5></div>'),n.inviteTokens[a.id]?(l(`<button class="${P([n.copiedToken===a.id?"text-emerald-400 bg-emerald-500/10":"text-white/30 hover:text-white/50","flex items-center gap-1 px-2 py-0.5 rounded-lg text-base transition-all"])}" data-v-f35415a5>`),n.copiedToken!==a.id?l(k(p(L),{class:"w-3.5 h-3.5"},null,d)):l(k(p(z),{class:"w-3.5 h-3.5"},null,d)),l(`<span data-v-f35415a5>${I(n.copiedToken===a.id?"Copied!":"Copy link")}</span></button>`)):l("\x3c!----\x3e"),l("</div></div>")):l("\x3c!----\x3e"),l("</div>"),p(F)===a.id?l(`<div class="mt-1.5 bg-black/70 backdrop-blur-sm border border-white/[0.12] rounded-xl px-3 py-2 space-y-1.5" data-v-f35415a5><input type="text"${A("value",x(a.id,"publicName"))} maxlength="60"${A("placeholder",a.name)} class="w-full bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-f35415a5><input type="text"${A("value",x(a.id,"publicDescription"))} maxlength="200" placeholder="Short description..." class="w-full bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-emerald-500/50 focus:outline-none transition-colors" data-v-f35415a5></div>`):l("\x3c!----\x3e"),p(W)===a.id?(l('<div class="mt-1.5 bg-black/70 backdrop-blur-sm border border-amber-500/20 rounded-xl px-3 py-2" data-v-f35415a5><div class="flex items-center gap-2" data-v-f35415a5>'),l(k(p(O),{class:"w-4 h-4 text-amber-400/50 flex-shrink-0"},null,d)),l(`<input type="text"${A("value",x(a.id,"password"))} maxlength="32" placeholder="Room password (leave empty to remove)" class="flex-1 bg-black/50 border border-white/15 rounded-lg px-2.5 py-1.5 text-white text-base placeholder-white/25 focus:border-amber-500/50 focus:outline-none transition-colors" data-v-f35415a5></div></div>`)):l("\x3c!----\x3e"),l("</div>")}),l("</div></div>"),p(Z)<p(X)-1?(l('<button class="hidden sm:flex absolute -right-4 top-1/2 -translate-y-1/2 z-10 w-9 h-9 items-center justify-center rounded-full bg-black/70 backdrop-blur-sm border border-white/15 hover:bg-emerald-500/15 hover:border-emerald-500/30 transition-all" data-v-f35415a5>'),l(k(p(E),{class:"w-4 h-4 text-white/60"},null,d)),l("</button>")):l("\x3c!----\x3e"),l("</div>")):l("\x3c!----\x3e"),"rooms"===p(J)&&p(X)>1?(l('<div class="flex items-center justify-center gap-1.5 mt-3 pointer-events-auto" data-v-f35415a5>\x3c!--[--\x3e'),C(p(X),a=>{l(`<button class="${P([a-1===p(Z)?"bg-emerald-400 w-5":"bg-white/15 w-1.5 hover:bg-white/30","h-1.5 rounded-full transition-all duration-300 cursor-pointer"])}" data-v-f35415a5></button>`)}),l("\x3c!--]--\x3e</div>")):l("\x3c!----\x3e"),"public"===p(J)?(l('<div class="pointer-events-auto" data-v-f35415a5>'),l(k(S,{authenticated:n.authenticated,onJoinPublicRoom:a=>o.$emit("join-public-room",a)},null,d)),l("</div>")):l("\x3c!----\x3e"),l("</div>")),l("</div></div>")}}}),sa=aa.setup;aa.setup=(a,n)=>{const o=y();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dLobby.vue"),sa?sa(a,n):void 0};const oa=Object.assign(q(aa,[["__scopeId","data-v-f35415a5"]]),{__name:"Room3dLobby"}),ra=o(!1);o(!1),o("");const la=o(new Map);function js(){return{connected:o(!1),wsConnected:o(!1),localPeerId:o(""),playerCount:l(()=>0),remotePlayers:o(new Map),connect:()=>{},joinRoom:()=>{},leaveRoom:()=>{},sendLocalState:()=>{},sendRoomStateChanged:()=>{},onPlayerMoved:a=>{},onRoomStateChanged:a=>{},onPlayersInit:a=>{},sendObjectDelta:a=>{},onObjectDelta:a=>{},sendVoiceSignal:(a,n,o)=>{},sendVoiceState:a=>{},sendVoiceRelay:(a,n)=>{},onVoiceSignal:a=>{},onVoiceState:a=>{},getRoomId:()=>null,onPlayerLeft:a=>{},sendTVChanged:(a,n)=>{},onTVChanged:a=>{},onServerError:a=>{},dispose:()=>{}}}l(()=>la.value.size+(ra.value?1:0));const da={mode:"vad",muted:!1,volume:80,spatialAudio:!0,autoJoin:!0};const ca=function(){try{const a=localStorage.getItem("room3d-voice-settings");if(a)return{...da,...JSON.parse(a)}}catch{}return{...da}}();function Hs(){return{voiceEnabled:o(!1),voiceMode:o("ptt"),localMuted:o(!1),localSpeaking:o(!1),pttActive:o(!1),masterVolume:o(80),spatialEnabled:o(!0),autoJoinVoice:o(!0),showVoiceSettings:o(!1),peerVoiceStates:new Map,requestMicrophone:async()=>!1,setMultiplayerRef:()=>{},initVoice:async()=>{},disposeVoice:()=>{},connectToPeer:async()=>{},disconnectPeer:()=>{},updateSpatialPositions:()=>{},setVoiceMode:a=>{},setPTT:a=>{},toggleMute:()=>{},setMasterVolume:a=>{},setSpatialAudio:a=>{},setAutoJoin:a=>{},openVoiceSettings:()=>{},closeVoiceSettings:()=>{},onPeerSpeakingChanged:a=>{},getConnectedPeerIds:()=>[],getVoiceDebugInfo:()=>({}),forceEnableTransmit:()=>{}}}o(!1),o(ca.mode),o(ca.muted),o(!1),o(!1),o(ca.volume),o(ca.spatialAudio),o(ca.autoJoin),o(!1),w(new Map);export{$s as $,ia as A,Bs as B,Us as C,Ds as D,_e as E,ve as F,pe as G,Hs as H,Ce as I,Ie as J,oa as K,Ls as L,Ms as M,Ns as N,Os as O,Re as P,be as Q,xe as R,Se as S,Ae as T,Ua as U,Vs as V,Wa as W,he as X,Me as Y,Te as Z,fs as _,ke as a,vs as a0,bs as a1,Da as b,ga as c,we as d,ys as e,me as f,fe as g,hs as h,kt as i,js as j,ye as k,ba as l,ma as m,ge as n,ot as o,ps as p,cs as q,ie as r,na as s,ds as t,us as u,ha as v,ws as w,xs as x,ya as y,ms as z};
