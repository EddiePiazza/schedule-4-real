import{defineComponent as e,ref as t,computed as o,shallowRef as n,watch as s,nextTick as c,markRaw as u,mergeProps as p,unref as v,isRef as f,createVNode as g,resolveDynamicComponent as b,h,withCtx as x,withDirectives as S,vModelText as $,openBlock as M,createBlock as T,createCommentVNode as V,reactive as O,toRaw as I,useSSRContext as j}from"vue";import{ssrRenderAttrs as F,ssrRenderComponent as _,ssrRenderTeleport as E,ssrRenderClass as U,ssrRenderList as N,ssrRenderAttr as J,ssrInterpolate as Z,ssrIncludeBooleanAttr as X,ssrLooseContain as ee,ssrRenderStyle as oe,ssrRenderVNode as ne,ssrLooseEqual as le}from"vue/server-renderer";import{UserIcon as se,GlobeAltIcon as re,XMarkIcon as de,AdjustmentsHorizontalIcon as ce,TrashIcon as ue,ArrowsPointingOutIcon as pe,ArrowPathIcon as ve,DocumentDuplicateIcon as fe,LockOpenIcon as ge,LockClosedIcon as be,PhotoIcon as he,DocumentTextIcon as xe,KeyIcon as ye,CubeTransparentIcon as we,HomeModernIcon as ke,LinkIcon as Se,BeakerIcon as Ce,SunIcon as $e,Cog6ToothIcon as Me,QuestionMarkCircleIcon as Te,WrenchScrewdriverIcon as Ve,MapPinIcon as Pe,PlusCircleIcon as ze,ArrowUturnLeftIcon as De,SwatchIcon as Oe,ArrowDownTrayIcon as Re,PlusIcon as Ie,BoltIcon as je,CursorArrowRaysIcon as Fe,ArrowUturnRightIcon as _e}from"@heroicons/vue/24/solid";import{s as Le}from"./_plugin-vue_export-helper-DlAUqK2U.mjs";import*as Ue from"three";import{U as We,d as Ne,l as He,n as Ge,Q as qe,P as Ye,s as Je,o as Ze,p as Qe,r as Xe,h as et,v as tt,a as nt,T as lt,M as it,z as rt,b as ut,H as pt,u as vt,Z as ft,K as bt,$ as mt,e as ht,t as yt,E as wt,y as kt,L as St,W as Ct,x as $t,V as Mt,J as Tt,B as Vt,g as At,C as Pt,S as zt,f as Dt,m as Ot,c as Rt,D as It,i as Ft,O as _t,j as Lt,R as Bt,k as Et,q as Ut,w as Wt,X as Nt,A as Ht}from"./useImmersiveMode-CbESTZqa.mjs";import{u as Gt}from"./useAuthGate-BgxmmIEE.mjs";import{Z as qt,B as Kt,g as Yt,Q as Jt,O as Zt,w as Qt,v as Xt}from"./useMultiplayer-S6HKuOfe.mjs";import*as ea from"three/examples/jsm/utils/SkeletonUtils.js";import{GLTFLoader as ta}from"three/addons/loaders/GLTFLoader.js";import{mergeVertices as aa}from"three/addons/utils/BufferGeometryUtils.js";import{MeshoptSimplifier as oa}from"meshoptimizer";import{OrbitControls as na}from"three/addons/controls/OrbitControls.js";import{w as la}from"./useSocketNames-CMd40qB4.mjs";import{d as ia,r as sa,X as ra,o as da}from"./lights-BCfJksXN.mjs";import{e as ca}from"./server.mjs";import{PointerLockControls as ua}from"three/addons/controls/PointerLockControls.js";import pa from"hls.js";import{GLTFLoader as va}from"three/examples/jsm/loaders/GLTFLoader.js";import{Chart as fa,LineController as ga,LinearScale as ma,TimeScale as ha,PointElement as xa,LineElement as ya,Filler as wa,CategoryScale as ka}from"chart.js";import{p as Sa}from"./useRealtimeUpdates-DRiOwH2-.mjs";import{HorizontalBlurShader as Ca}from"three/examples/jsm/shaders/HorizontalBlurShader.js";import{VerticalBlurShader as $a}from"three/examples/jsm/shaders/VerticalBlurShader.js";import{EffectComposer as Ma}from"three/examples/jsm/postprocessing/EffectComposer.js";import{RenderPass as Ta}from"three/examples/jsm/postprocessing/RenderPass.js";import{UnrealBloomPass as Va}from"three/examples/jsm/postprocessing/UnrealBloomPass.js";import{OutputPass as Aa}from"three/examples/jsm/postprocessing/OutputPass.js";import{Lensflare as Pa,LensflareElement as za}from"three/examples/jsm/objects/Lensflare.js";import{d as Da}from"./triggers-BGw-F1Fy.mjs";import{d as Oa}from"./useRoom3dPrivacy-CeZkyKa2.mjs";import"three-mesh-bvh";import"@heroicons/vue/24/outline";import"pinia";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"vue-router";var Ra=Object.defineProperty,__publicField=(e,t,o)=>((e,t,o)=>t in e?Ra(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o)(e,"symbol"!=typeof t?t+"":t,o);const Ia=e({__name:"Room3dHttpWarning",__ssrInlineRender:!0,props:{inviteCode:{}},emits:["dismiss"],setup(e,{emit:o}){const n=t(!1),s=t(!1),c=t(!1);return(e,t,o,u)=>{E(t,e=>{v(n)?(e(`<div class="fixed inset-0 z-[60] overflow-y-auto overflow-x-hidden bg-black/80 backdrop-blur-sm" style="${oe({height:"100dvh","max-height":"100dvh"})}"><div class="flex items-center justify-center p-4" style="${oe({"min-height":"100dvh"})}">`),v(n)?(e(`<div class="${U([v(c)?"border-amber-500/30 to-amber-950/30 shadow-amber-500/10":"border-green-500/30 to-green-950/30 shadow-green-500/10","relative w-full max-w-2xl max-h-[90dvh] overflow-y-auto rounded-2xl border bg-gradient-to-br from-gray-900 via-gray-900 shadow-2xl"])}"><div class="absolute -top-16 -right-16 w-32 h-32 rounded-full blur-3xl pointer-events-none bg-amber-500/15"></div><div class="absolute -bottom-16 -left-16 w-32 h-32 rounded-full blur-3xl pointer-events-none bg-green-500/10"></div><div class="p-5 sm:p-6 pb-0"><div class="flex items-center gap-3 mb-4"><div class="${U([v(c)?"bg-gradient-to-br from-amber-500/30 to-orange-600/20 shadow-amber-500/20":"bg-gradient-to-br from-green-500/30 to-emerald-600/20 shadow-green-500/20","w-12 h-12 rounded-xl shadow-lg flex items-center justify-center text-2xl shrink-0"])}">${Z(v(c)?"ðŸ”“":"ðŸŒ¿")}</div><div class="min-w-0"><h2 class="${U([v(c)?"text-amber-400":"text-green-400","text-xl font-bold"])}">${Z(v(c)?"Whoa there, grower!":"Welcome, grower!")}</h2><p class="${U([v(c)?"text-amber-500/70":"text-green-500/70","text-base font-mono"])}">${Z(v(c)?"HTTP detected â€” no SSL, no party":"Your 3D grow room awaits")}</p></div></div></div><div class="px-5 sm:px-6 pb-2 space-y-4"><p class="text-base text-gray-300 leading-relaxed"> Welcome to what will be the <strong class="text-amber-400">weirdest and most fun grow room control experience ever built</strong>. Here â€” once the developer <span class="text-green-400 font-mono">Ptakx</span> has enough time and resources to finish it â€” you&#39;ll be able to: </p><div class="grid grid-cols-1 sm:grid-cols-2 gap-2"><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸŒ±</span><span class="text-base text-gray-300">Control your entire grow from inside a 3D room</span></div><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸ““</span><span class="text-base text-gray-300">Manage your grow journal and track phenotypes</span></div><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸ§¬</span><span class="text-base text-gray-300">Run your breeding laboratory like a mad scientist</span></div><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸ“º</span><span class="text-base text-gray-300">Watch TV, add your own IPTV channels... yes, even the <em class="text-amber-400/70">spicy</em> ones</span></div><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸŽ®</span><span class="text-base text-gray-300">Play mini-games while your plants do their thing</span></div><div class="flex items-start gap-2 bg-gray-800/40 rounded-lg p-3 border border-gray-700/30"><span class="text-lg shrink-0">ðŸ‘¥</span><span class="text-base text-gray-300">Multiplayer! Invite friends to your room with voice chat</span></div></div><div class="bg-gradient-to-r from-green-900/20 to-transparent border border-green-700/30 rounded-xl p-4"><p class="text-base text-gray-300 leading-relaxed"><span class="text-green-400 font-bold">Your room, your rules.</span> Make it private, set an invite code, and only people with your link can join. We&#39;re not going to give you ideas, but... the room is <strong class="text-green-400">100% private and self-hosted</strong> on your server. No logs, no snooping, no third parties. <span class="text-green-400/70">What happens in your room, stays in your room.</span></p></div><p class="text-base text-gray-300 leading-relaxed"> You&#39;ll also be able to show your guests your <strong class="text-amber-400">catalog of goodies</strong> â€” complete with photos and full harvest progress data. Enough to make anyone&#39;s mouth water. </p>`),v(c)?e('<div class="bg-gradient-to-r from-red-900/20 to-transparent border border-red-700/30 rounded-xl p-4"><h3 class="text-base font-bold text-red-400 mb-2"> But here&#39;s the thing... </h3><p class="text-base text-gray-300 leading-relaxed"> You&#39;re accessing this over plain <strong class="text-red-400">HTTP</strong>. That means: </p><ul class="text-base text-gray-300 mt-2 space-y-1.5"><li class="flex items-start gap-2"><span class="text-red-400 shrink-0">âœ—</span><span><strong class="text-red-400">No voice chat</strong> â€” WebRTC requires a secure context (HTTPS)</span></li><li class="flex items-start gap-2"><span class="text-red-400 shrink-0">âœ—</span><span><strong class="text-red-400">No asset caching</strong> â€” 3D models will re-download every time (hundreds of MB!)</span></li></ul><p class="text-base text-gray-400 mt-3"> To unlock everything, set up a <strong class="text-amber-400">domain with SSL certificates</strong>. Don&#39;t know how? There&#39;s a step-by-step guide in the <strong class="text-amber-400">How to Install</strong> section â†’ <strong class="text-amber-400">Domain &amp; SSL</strong> tab. It&#39;s free and takes about 10 minutes. </p></div>'):e("\x3c!----\x3e"),e(`<label class="flex items-center gap-3 cursor-pointer select-none py-1"><input type="checkbox"${X(Array.isArray(v(s))?ee(v(s),null):v(s))?" checked":""} class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-amber-500 focus:ring-amber-500/50 focus:ring-offset-0 cursor-pointer shrink-0"><span class="text-base text-gray-400">Don&#39;t show this again</span></label></div><div class="p-5 sm:p-6 pt-4 flex justify-end"><button class="${U([v(c)?"bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-500 hover:to-amber-600 shadow-amber-500/20 hover:shadow-amber-500/30":"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 shadow-green-500/20 hover:shadow-green-500/30","px-6 py-3 text-base font-semibold text-white rounded-xl transition-all shadow-lg"])}">${Z(v(c)?"Got it, let me in anyway":"Let's go!")}</button></div></div>`)):e("\x3c!----\x3e"),e("</div></div>")):e("\x3c!----\x3e")},"body",!1,o)}}}),ja=Ia.setup;Ia.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dHttpWarning.vue"),ja?ja(e,t):void 0};const Fa=Object.assign(Ia,{__name:"Room3dHttpWarning"}),_a=e({__name:"Room3dWsWarning",__ssrInlineRender:!0,props:{wsConnected:{type:Boolean}},emits:["dismiss"],setup(e,{emit:o}){const n=e,c=t(!1),u=t(!1);return s(()=>n.wsConnected,e=>{}),(e,t,o,n)=>{E(t,e=>{v(c)?(e('<div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">'),v(c)?e(`<div class="relative w-full max-w-lg rounded-2xl border border-red-500/30 bg-gradient-to-br from-gray-900 via-gray-900 to-red-950/20 shadow-2xl shadow-red-500/10 overflow-hidden"><div class="absolute -top-12 -right-12 w-24 h-24 rounded-full blur-3xl pointer-events-none bg-red-500/15"></div><div class="p-6 pb-3"><div class="flex items-center gap-3"><div class="w-11 h-11 rounded-xl bg-gradient-to-br from-red-500/30 to-red-700/20 shadow-lg shadow-red-500/20 flex items-center justify-center text-xl"> ðŸ”Œ </div><div><h2 class="text-lg font-bold text-red-400">WebSocket Connection Failed</h2><p class="text-base text-red-500/60 font-mono">/_room3d-ws unreachable</p></div></div></div><div class="px-6 pb-2 space-y-4"><p class="text-base text-gray-300 leading-relaxed"> The multiplayer WebSocket could not connect. This usually means your <strong class="text-red-400">reverse proxy</strong> is not forwarding WebSocket connections. </p><div class="bg-red-900/15 border border-red-700/30 rounded-xl p-4"><p class="text-base font-semibold text-red-400 mb-2">Without WebSocket you won&#39;t have:</p><ul class="text-base text-gray-300 space-y-1.5"><li class="flex items-start gap-2"><span class="text-red-400 shrink-0">âœ—</span><span><strong class="text-red-400">Multiplayer</strong> â€” no one can join your room</span></li><li class="flex items-start gap-2"><span class="text-red-400 shrink-0">âœ—</span><span><strong class="text-red-400">Voice chat</strong> â€” signaling requires WebSocket</span></li><li class="flex items-start gap-2"><span class="text-red-400 shrink-0">âœ—</span><span><strong class="text-red-400">Shared objects</strong> â€” furniture placed by others won&#39;t appear</span></li></ul></div><div class="bg-gray-800/40 border border-gray-700/30 rounded-xl p-4"><p class="text-base font-semibold text-gray-300 mb-2">How to fix it:</p><p class="text-base text-gray-400"> Add WebSocket proxy rules for <code class="text-amber-400 bg-gray-800 px-1.5 py-0.5 rounded">/_room3d-ws</code> in your reverse proxy configuration. Check the <strong class="text-amber-400">How to Install</strong> section â†’ <strong class="text-amber-400">Your Domain</strong> tab for the correct config for your proxy software (Nginx, Apache, LiteSpeed, etc.). </p></div><p class="text-base text-gray-500"> You can still explore the room solo â€” the 3D environment works fine without multiplayer. </p><label class="flex items-center gap-3 cursor-pointer select-none py-1"><input type="checkbox"${X(Array.isArray(v(u))?ee(v(u),null):v(u))?" checked":""} class="w-5 h-5 rounded border-gray-600 bg-gray-800 text-red-500 focus:ring-red-500/50 focus:ring-offset-0 cursor-pointer"><span class="text-base text-gray-400">Don&#39;t show this again</span></label></div><div class="p-6 pt-3 flex justify-end"><button class="px-6 py-3 text-base font-semibold bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-500 hover:to-gray-600 text-white rounded-xl transition-all shadow-lg"> Continue solo </button></div></div>`):e("\x3c!----\x3e"),e("</div>")):e("\x3c!----\x3e")},"body",!1,o)}}}),La=_a.setup;_a.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dWsWarning.vue"),La?La(e,t):void 0};const Ba=Object.assign(_a,{__name:"Room3dWsWarning"}),Ea=e({__name:"Room3dAddChannel",__ssrInlineRender:!0,props:{showAddChannelModal:{type:Boolean},addChannelUrl:{},addChannelName:{},addChannelCategory:{},addChannelTesting:{type:Boolean},addChannelTestResult:{},categories:{}},emits:["cancel","save","test","update:addChannelUrl","update:addChannelName","update:addChannelCategory"],setup:e=>(t,o,n,s)=>{e.showAddChannelModal?(o(`<div${F(p({class:"absolute inset-0 z-50 flex items-center justify-center bg-black/70"},s))} data-v-c5b140be><div class="add-channel-panel" data-v-c5b140be><div class="px-6 py-4 flex items-center justify-between" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.08)"})}" data-v-c5b140be><div data-v-c5b140be><h2 class="text-white font-black text-xl tracking-wide" data-v-c5b140be>ADD CHANNEL</h2><p class="text-gray-400 text-base mt-0.5" data-v-c5b140be>Paste an IPTV stream URL (.m3u8 HLS format)</p></div><button class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-500 hover:text-white hover:bg-white/10 transition-all border border-transparent hover:border-white/15" data-v-c5b140be>`),o(_(v(de),{class:"w-5 h-5"},null,n)),o(`</button></div><div class="px-6 py-5 space-y-4" data-v-c5b140be><div data-v-c5b140be><label class="text-gray-300 text-base font-semibold mb-1.5 block" data-v-c5b140be>Stream URL</label><input${J("value",e.addChannelUrl)} type="text" placeholder="https://example.com/live/stream.m3u8" class="add-channel-input" data-v-c5b140be><p class="text-gray-500 text-base opacity-60 mt-1.5" data-v-c5b140be>Must be a direct .m3u8 HLS stream link. NOT a web page URL.</p></div><div data-v-c5b140be><label class="text-gray-300 text-base font-semibold mb-1.5 block" data-v-c5b140be>Channel Name</label><input${J("value",e.addChannelName)} type="text" placeholder="My Channel" class="add-channel-input" data-v-c5b140be></div><div data-v-c5b140be><label class="text-gray-300 text-base font-semibold mb-1.5 block" data-v-c5b140be>Category</label><select${J("value",e.addChannelCategory)} class="add-channel-input" data-v-c5b140be>\x3c!--[--\x3e`),N(e.categories,e=>{o(`<option${J("value",e)} data-v-c5b140be>${Z(e)}</option>`)}),o("\x3c!--]--\x3e</select></div>"),"success"===e.addChannelTestResult?o('<div class="flex items-center gap-2.5 bg-green-500/10 border border-green-500/30 rounded-xl px-4 py-2.5" data-v-c5b140be><span class="text-green-400 text-lg" data-v-c5b140be>âœ“</span><span class="text-green-400 text-base font-medium" data-v-c5b140be>Channel works!</span></div>'):o("\x3c!----\x3e"),"fail"===e.addChannelTestResult?o('<div class="flex items-center gap-2.5 bg-red-500/10 border border-red-500/30 rounded-xl px-4 py-2.5" data-v-c5b140be><span class="text-red-400 text-lg" data-v-c5b140be>âœ—</span><span class="text-red-400 text-base font-medium" data-v-c5b140be>Channel failed â€” check URL format and CORS support</span></div>'):o("\x3c!----\x3e"),o(`<div class="flex gap-2.5 pt-1" data-v-c5b140be><button${X(e.addChannelTesting||!e.addChannelUrl.trim())?" disabled":""} class="${U([e.addChannelTesting?"add-channel-btn--disabled":"add-channel-btn--test","add-channel-btn"])}" data-v-c5b140be>${Z(e.addChannelTesting?"Testing...":"Test Channel")}</button><div class="flex-1" data-v-c5b140be></div><button class="add-channel-btn add-channel-btn--cancel" data-v-c5b140be>Cancel</button><button${X(!e.addChannelUrl.trim()||!e.addChannelName.trim())?" disabled":""} class="add-channel-btn add-channel-btn--save" data-v-c5b140be>Save</button></div></div></div></div>`)):o("\x3c!----\x3e")}}),Ua=Ea.setup;Ea.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dAddChannel.vue"),Ua?Ua(e,t):void 0};const Wa=Object.assign(Le(Ea,[["__scopeId","data-v-c5b140be"]]),{__name:"Room3dAddChannel"}),Na={brightness:1,contrast:1,highlights:0,shadows:0,whites:0,blacks:0,saturation:1,vibrance:0,warmth:0,tint:0};let Ha=null,Ga=null;const qa=new Map;let Ka=null,Ya=!1,Za=0,Qa=!1,Xa=null,eo=null,to=!1,ao=-1,oo=null;const no=new Ue.Color,lo=new Ue.Color,io=new Map,so=new Map,ro=new Set,co={...Na},uo={...Na};let po="",vo=0;const fo=t(!1),go=t([]),bo=t(null),mo=t(null),ho=t("single"),xo=t(""),yo=t([]),wo=t(60),ko=t(!1),So=t(!1),Co=t(!1),$o=t("sky");function Px(){return Ha}function Dx(){return!!Ya||!!("cycle"===(null==Ha?void 0:Ha.mode)&&Ha.cyclePresetIds.length>=2&&St())&&(Ur(),Ya)}function Rx(e){Ka=e}function Ox(){return Ka}function eb(e,t,o,n){const s=Math.max(5*n,50);return{id:"default",name:"Default",lights:[{id:"ambient",type:"ambient",name:"Ambient",enabled:!0,color:"#ffffff",intensity:.4},{id:"hemi",type:"hemisphere",name:"Hemisphere",enabled:!0,color:"#ffeedd",intensity:.5,groundColor:"#8899aa"},{id:"key",type:"directional",name:"Key Light",enabled:!0,color:"#fff8f0",intensity:1.2,position:{x:10,y:20,z:10}},{id:"fill_dir",type:"directional",name:"Fill Light",enabled:!0,color:"#e8f0ff",intensity:.6,position:{x:-8,y:15,z:-5}},{id:"fill1",type:"point",name:"Fill 1",enabled:!0,color:"#fff5e8",intensity:s,distance:2*n,decay:1,position:{x:e.x,y:o+.8*t.y,z:e.z}},{id:"fill2",type:"point",name:"Fill 2",enabled:!0,color:"#fff5e8",intensity:s,distance:2*n,decay:1,position:{x:e.x+.25*t.x,y:o+.7*t.y,z:e.z+.25*t.z}},{id:"fill3",type:"point",name:"Fill 3",enabled:!0,color:"#fff5e8",intensity:s,distance:2*n,decay:1,position:{x:e.x-.25*t.x,y:o+.7*t.y,z:e.z-.25*t.z}}],skyRotation:0,exposure:1,filters:{...Na},sceneFilters:{...Na},cycleWeight:1}}function tb(e){var t;const o=new Ue.Color(e.color);switch(e.type){case"ambient":return new Ue.AmbientLight(o,e.intensity);case"hemisphere":return new Ue.HemisphereLight(o,new Ue.Color(e.groundColor||"#888888"),e.intensity);case"directional":{const t=new Ue.DirectionalLight(o,e.intensity);return e.position&&t.position.set(e.position.x,e.position.y,e.position.z),t}case"point":{const n=new Ue.PointLight(o,e.intensity,e.distance||0,null!=(t=e.decay)?t:2);return e.position&&n.position.set(e.position.x,e.position.y,e.position.z),n}}return null}function Fx(e){const t=St();Xa&&t&&(t.remove(Xa),Xa.geometry.dispose(),Xa.material.dispose());const o={envMap:{value:e},uBrightness:{value:1},uContrast:{value:1},uHighlights:{value:0},uShadows:{value:0},uWhites:{value:0},uBlacks:{value:0},uSaturation:{value:1},uVibrance:{value:0},uWarmth:{value:0},uTint:{value:0},uRotationY:{value:0},uExposure:{value:1}};eo=o;const n=new Ue.ShaderMaterial({glslVersion:Ue.GLSL3,uniforms:o,vertexShader:"\nout vec3 vWorldDirection;\nvoid main() {\n  vWorldDirection = position;\n  vec4 mvp = projectionMatrix * mat4(mat3(viewMatrix)) * vec4(position, 1.0);\n  gl_Position = mvp.xyww;\n}\n",fragmentShader:"\nprecision highp float;\nuniform sampler2D envMap;\nuniform float uBrightness;\nuniform float uContrast;\nuniform float uHighlights;\nuniform float uShadows;\nuniform float uWhites;\nuniform float uBlacks;\nuniform float uSaturation;\nuniform float uVibrance;\nuniform float uWarmth;\nuniform float uTint;\nuniform float uRotationY;\nuniform float uExposure;\nin vec3 vWorldDirection;\nout vec4 fragColor;\nconst float PI = 3.14159265359;\nconst vec3 LUMA = vec3(0.2126, 0.7152, 0.0722);\nvec3 ACESFilmic(vec3 x) {\n  const float a = 2.51, b = 0.03, c = 2.43, d = 0.59, e = 0.14;\n  return clamp((x*(a*x+b))/(x*(c*x+d)+e), 0.0, 1.0);\n}\nvoid main() {\n  vec3 dir = normalize(vWorldDirection);\n  float cosR = cos(uRotationY), sinR = sin(uRotationY);\n  dir = vec3(cosR*dir.x + sinR*dir.z, dir.y, -sinR*dir.x + cosR*dir.z);\n  float u = atan(dir.z, dir.x) / (2.0*PI) + 0.5;\n  float v = asin(clamp(dir.y, -1.0, 1.0)) / PI + 0.5;\n\n  // Fix equirectangular seam at u=0/1 (atan wrap boundary).\n  // At the seam, u jumps ~1.0 between adjacent fragments, producing huge\n  // implicit derivatives that confuse GPU texture filtering. We correct\n  // the derivatives and use textureGrad for artifact-free sampling.\n  vec2 uv = vec2(u, v);\n  vec2 uvDx = dFdx(uv);\n  vec2 uvDy = dFdy(uv);\n  if (abs(uvDx.x) > 0.5) uvDx.x += (uvDx.x > 0.0 ? -1.0 : 1.0);\n  if (abs(uvDy.x) > 0.5) uvDy.x += (uvDy.x > 0.0 ? -1.0 : 1.0);\n  vec3 color = textureGrad(envMap, uv, uvDx, uvDy).rgb;\n\n  // Brightness (exposure-style multiply)\n  color *= uBrightness;\n\n  // Contrast (power curve, HDR-safe)\n  color = pow(max(color, vec3(0.0001)), vec3(uContrast));\n\n  // Luminance for masks\n  float lum = dot(color, LUMA);\n\n  // Highlights â€” affect bright areas (luminance > 0.5)\n  float hiMask = smoothstep(0.3, 1.0, lum);\n  color += color * uHighlights * hiMask;\n\n  // Shadows â€” affect dark areas (luminance < 0.5)\n  float shMask = 1.0 - smoothstep(0.0, 0.7, lum);\n  color += color * uShadows * shMask;\n\n  // Whites â€” push the white point (affects very bright areas)\n  float whMask = smoothstep(0.6, 1.0, lum);\n  color += vec3(uWhites) * whMask * whMask;\n\n  // Blacks â€” lift/crush the black point (affects very dark areas)\n  float blMask = 1.0 - smoothstep(0.0, 0.4, lum);\n  color += vec3(uBlacks) * blMask * blMask;\n\n  // Saturation\n  lum = dot(max(color, vec3(0.0)), LUMA);\n  color = mix(vec3(lum), color, max(uSaturation, 0.0));\n\n  // Vibrance â€” smart saturation (affects less saturated colors more)\n  float maxC = max(color.r, max(color.g, color.b));\n  float minC = min(color.r, min(color.g, color.b));\n  float curSat = (maxC - minC) / (maxC + 0.001);\n  float vibW = 1.0 - curSat;\n  color = mix(vec3(dot(color, LUMA)), color, 1.0 + uVibrance * vibW);\n\n  // Warmth â€” color temperature (blue<>orange axis)\n  color *= vec3(1.0 + uWarmth*0.3, 1.0 + uWarmth*0.05, 1.0 - uWarmth*0.3);\n\n  // Tint â€” green<>magenta axis\n  color *= vec3(1.0 + uTint*0.15, 1.0 - uTint*0.2, 1.0 + uTint*0.15);\n\n  // Tone mapping with exposure\n  color = ACESFilmic(max(color, vec3(0.0)) * uExposure);\n  color = pow(color, vec3(1.0 / 2.2));\n  fragColor = vec4(color, 1.0);\n}\n",side:Ue.BackSide,depthWrite:!1,toneMapped:!1}),s=new Ue.SphereGeometry(10,64,32);Xa=new Ue.Mesh(s,n),Xa.renderOrder=-1e3,Xa.frustumCulled=!1,t&&t.add(Xa)}function ab(e,t,o){eo&&(eo.uBrightness.value=e.brightness,eo.uContrast.value=e.contrast,eo.uHighlights.value=(e.highlights||0)/100,eo.uShadows.value=(e.shadows||0)/100,eo.uWhites.value=(e.whites||0)/100,eo.uBlacks.value=(e.blacks||0)/100,eo.uSaturation.value=e.saturation,eo.uVibrance.value=(e.vibrance||0)/100,eo.uWarmth.value=(e.warmth||0)/100,eo.uTint.value=(e.tint||0)/100,eo.uRotationY.value=t*Math.PI/180,eo.uExposure.value=o)}function ob(e,t){const o=Ct();if(!o)return;if(to)return void(o.domElement.style.filter="");if(!t){const e=performance.now();if(e-vo<2e3)return;vo=e}const n=[];let s=e.brightness;e.highlights&&(s+=e.highlights/100*.15),e.whites&&(s+=e.whites/100*.1),e.shadows&&(s+=e.shadows/100*.08),1!==s&&n.push(`brightness(${s})`);let c=e.contrast;e.blacks&&(c+=e.blacks/100*.2),1!==c&&n.push(`contrast(${c})`);let u=e.saturation;e.vibrance&&(u+=e.vibrance/100*.4),1!==u&&n.push(`saturate(${u})`);const p=e.warmth||0;p>0?(n.push(`sepia(${.4*Math.min(p/100,1)})`),n.push(`saturate(${1+p/200})`)):p<0&&(n.push(`hue-rotate(${.4*p}deg)`),n.push(`saturate(${1+Math.abs(p)/300})`));const v=e.tint||0;0!==v&&n.push(`hue-rotate(${.6*v}deg)`);const f=n.length?n.join(" "):"";f!==po&&(po=f,o.domElement.style.filter=f)}function Qn(e){const t=St(),o=Ct();if(t&&o){for(const[,e]of qa)t.remove(e);qa.clear();for(const o of e.lights){if(!o.enabled)continue;const e=tb(o);e&&(e.userData.managedLight=!0,qa.set(o.id,e),t.add(e))}o.toneMappingExposure=e.exposure,ab(e.filters||Na,e.skyRotation,e.exposure),ob(e.sceneFilters||Na,!0)}}function Zd(){if(!Ha||Ya)return;const e=Ha.presets.find(e=>e.id===Ha.activePresetId);e&&Qn(e)}function Ur(){"cycle"===(null==Ha?void 0:Ha.mode)&&Ha.cyclePresetIds.length>=2?(Ya=!0,Za=0,Qa=!0,ao=-1):(Ya=!1,Qa=!1)}async function nb(e){var t,o;Ga=e;let n=null;try{n=await $fetch("/api/room3d/room-lighting",{query:{roomId:e,...Je.value&&{system:!0}}})}catch{}if(null==n?void 0:n.presets){const e=n;for(const t of e.presets)t.filters||(t.filters={...Na}),t.sceneFilters||(t.sceneFilters={...Na}),t.cycleWeight||(t.cycleWeight=1);Ha=e}else if(null==n?void 0:n.lights)Ha={presets:[{id:"default",name:"Default",lights:n.lights,skyRotation:null!=(t=n.skyRotation)?t:0,exposure:null!=(o=n.exposure)?o:1,filters:{...Na},sceneFilters:{...Na},cycleWeight:1}],mode:"single",activePresetId:"default",cyclePresetIds:["default"],cycleDurationMinutes:60};else{if(!Ka)return;{const e=Ka;Ha={presets:[eb(e.center,e.size,e.floorY,e.maxDim)],mode:"single",activePresetId:"default",cyclePresetIds:["default"],cycleDurationMinutes:60}}}if("cycle"===Ha.mode&&Ha.cyclePresetIds.length>=2){const e=Ha.cyclePresetIds[0],t=Ha.presets.find(t=>t.id===e);t?Qn(t):Zd()}else Zd();Ur()}async function lb(e){const t=e||Ga;if(Ha&&t)try{const e=t,o=Ha;if(Je.value){const{getAuthHeaders:t}=Gt(),n=t();await $fetch("/api/room3d/room-lighting",{method:"POST",body:{roomId:e,config:o,system:!0},headers:n})}else{const{getAuthHeaders:t}=Gt();await $fetch("/api/room3d/room-lighting",{method:"POST",body:{roomId:e,config:o},headers:t()})}ko.value="ok",setTimeout(()=>{ko.value=!1},2e3)}catch{ko.value="err",setTimeout(()=>{ko.value=!1},3e3)}}function Ex(e){var t,o,n,s,c,u,p,v;if(!Ha||"cycle"!==Ha.mode||fo.value)return;const f=St(),g=Ct(),b=Ha,h=b.cyclePresetIds.map(e=>b.presets.find(t=>t.id===e)).filter(Boolean);if(h.length<2)return void(1===h.length&&Qn(h[0]));if(Qa)return Qa=!1,ao=0,void Qn(h[0]);const x=6e4*b.cycleDurationMinutes;Za=(Za+1e3*e)%x;const S=h.reduce((e,t)=>e+(t.cycleWeight||1),0);let $=0,M=0,T=0,V=0;for(let e=0;e<h.length;e++){if(V=(h[e].cycleWeight||1)/S*x,Za<$+V){M=e,T=$;break}$+=V}const O=V>0?(Za-T)/V:0;if(oo&&ao>=0&&ao!==M){const e=h[ao],t=h[M];e&&oo(e.id,"end"),t&&oo(t.id,"start")}ao=M;const I=h[M],j=h[(M+1)%h.length];io.clear(),so.clear(),ro.clear();for(const e of I.lights)e.enabled&&io.set(e.id,e);for(const e of j.lights)e.enabled&&so.set(e.id,e);for(const e of io.keys())ro.add(e);for(const e of so.keys())ro.add(e);const F=io,_=so,E=ro,U=I.exposure,N=j.exposure,J=U+(N-U)*O,Z=J>0?U/J:1,X=J>0?N/J:1;for(const e of E){const g=F.get(e),b=_.get(e),h=g||b;if(!h)continue;let x=qa.get(e);if(x||(x=null!=(t=tb(h))?t:void 0,x&&(x.intensity=0,x.userData.managedLight=!0,qa.set(e,x),f.add(x))),x)if(g&&b){if(no.set(g.color),lo.set(b.color),null==(o=x.color)||o.copy(no.lerp(lo,O)),x.intensity=g.intensity+(b.intensity-g.intensity)*O,"position"in x&&g.position&&b.position&&x.position.set(g.position.x+(b.position.x-g.position.x)*O,g.position.y+(b.position.y-g.position.y)*O,g.position.z+(b.position.z-g.position.z)*O),"distance"in x){const e=null!=(n=g.distance)?n:0,t=null!=(s=b.distance)?s:0;x.distance=e+(t-e)*O}if("decay"in x){const e=null!=(c=g.decay)?c:2,t=null!=(u=b.decay)?u:2;x.decay=e+(t-e)*O}"groundColor"in x&&g.groundColor&&b.groundColor&&(no.set(g.groundColor),lo.set(b.groundColor),x.groundColor.copy(no.lerp(lo,O)))}else g&&!b?(null==(p=x.color)||p.set(g.color),x.intensity=g.intensity*Z,"position"in x&&g.position&&x.position.set(g.position.x,g.position.y,g.position.z),"distance"in x&&null!=g.distance&&(x.distance=g.distance),"decay"in x&&null!=g.decay&&(x.decay=g.decay),"groundColor"in x&&g.groundColor&&x.groundColor.set(g.groundColor)):b&&!g&&(null==(v=x.color)||v.set(b.color),x.intensity=b.intensity*X,"position"in x&&b.position&&x.position.set(b.position.x,b.position.y,b.position.z),"distance"in x&&null!=b.distance&&(x.distance=b.distance),"decay"in x&&null!=b.decay&&(x.decay=b.decay),"groundColor"in x&&b.groundColor&&x.groundColor.set(b.groundColor))}for(const[e]of qa)E.has(e)||(f.remove(qa.get(e)),qa.delete(e));const ee=I.skyRotation,oe=j.skyRotation,ne=J;function ie(e,t,o){e.brightness=t.brightness+(o.brightness-t.brightness)*O,e.contrast=t.contrast+(o.contrast-t.contrast)*O,e.highlights=(t.highlights||0)+((o.highlights||0)-(t.highlights||0))*O,e.shadows=(t.shadows||0)+((o.shadows||0)-(t.shadows||0))*O,e.whites=(t.whites||0)+((o.whites||0)-(t.whites||0))*O,e.blacks=(t.blacks||0)+((o.blacks||0)-(t.blacks||0))*O,e.saturation=t.saturation+(o.saturation-t.saturation)*O,e.vibrance=(t.vibrance||0)+((o.vibrance||0)-(t.vibrance||0))*O,e.warmth=(t.warmth||0)+((o.warmth||0)-(t.warmth||0))*O,e.tint=(t.tint||0)+((o.tint||0)-(t.tint||0))*O}g&&(g.toneMappingExposure=ne),ie(co,I.filters||Na,j.filters||Na),ab(co,ee+(oe-ee)*O,ne),ie(uo,I.sceneFilters||Na,j.sceneFilters||Na),ob(uo)}const Mo=o(()=>go.value.find(e=>e.id===bo.value)||null),To=o(()=>{const e=Mo.value;return e&&e.lights.find(e=>e.id===mo.value)||null}),Vo=o(()=>{const e=Mo.value;return e&&("sky"===$o.value?e.filters:e.sceneFilters)||Na});function Bx(e,t){const o=Mo.value;if(!o)return;const n="sky"===$o.value?"filters":"sceneFilters";o[n]||(o[n]={...Na}),o[n][e]=t,Jo()}const Ao=200;function ib(e,t){if(!Ka)return{x:100,y:100};const o=Ka;return{x:16+168*((e-(o.center.x-o.size.x/2))/o.size.x),y:16+168*((t-(o.center.z-o.size.z/2))/o.size.z)}}function sb(e,t){if(!Ka)return{x:0,z:0};const o=Ka,n=(e-16)/168,s=(t-16)/168;return{x:o.center.x-o.size.x/2+n*o.size.x,z:o.center.z-o.size.z/2+s*o.size.z}}const zo=o(()=>{var e;const t=null==(e=To.value)?void 0:e.position;return t?ib(t.x,t.z):{x:100,y:100}}),Do=o(()=>{if(!Ka)return{min:0,max:50};const e=Ka;return{min:Math.floor(e.floorY),max:Math.ceil(e.floorY+1.5*e.size.y)}}),Oo=o(()=>{if(!Ha||"cycle"!==Ha.mode)return 0;const e=6e4*Ha.cycleDurationMinutes;return e<=0?0:Za/e*100});function Wx(e){Co.value=!0,e.currentTarget.setPointerCapture(e.pointerId),rb(e)}function Hx(e){Co.value&&rb(e)}function Gx(){Co.value=!1}function rb(e){const t=To.value;if(!t)return;const o=(e.currentTarget.closest("svg")||e.currentTarget).getBoundingClientRect(),n=sb((e.clientX-o.left)/o.width*Ao,(e.clientY-o.top)/o.height*Ao);t.position||(t.position={x:0,y:5,z:0}),t.position.x=Math.round(10*n.x)/10,t.position.z=Math.round(10*n.z)/10,Jo()}function Kx(e){const t=To.value;t&&(t.position||(t.position={x:0,y:0,z:0}),t.position.y=e,Jo())}function qx(){var e,t,o;if(!Ha)return;Ya=!1,go.value=JSON.parse(JSON.stringify(Ha.presets)),ho.value=Ha.mode,xo.value=Ha.activePresetId,yo.value=[...Ha.cyclePresetIds],wo.value=Ha.cycleDurationMinutes,bo.value=(null==(e=go.value[0])?void 0:e.id)||null;const n=go.value[0];mo.value=(null==(t=null==n?void 0:n.lights[0])?void 0:t.id)||null,So.value=!1,fo.value=!0,n&&Qn(n),null==(o=qe())||o.unlock()}function db(e){!e&&Ha&&(Zd(),Ur()),fo.value=!1,So.value=!1,c(()=>{var e;return null==(e=qe())?void 0:e.lock()})}function Jo(){const e=Mo.value;e&&Qn(e)}async function Yx(e){Ha={presets:JSON.parse(JSON.stringify(go.value)),mode:ho.value,activePresetId:xo.value,cyclePresetIds:[...yo.value],cycleDurationMinutes:wo.value},await lb(e),Ur(),db(!0)}async function Zx(e){var t,o,n;if(e){try{const{getAuthHeaders:t}=Gt();await $fetch("/api/room3d/room-lighting-reset",{method:"POST",body:{roomId:e},headers:t()})}catch{}await nb(e),Ha&&(go.value=JSON.parse(JSON.stringify(Ha.presets)),ho.value=Ha.mode,xo.value=Ha.activePresetId,yo.value=[...Ha.cyclePresetIds],wo.value=Ha.cycleDurationMinutes,bo.value=(null==(t=go.value[0])?void 0:t.id)||null,mo.value=(null==(n=null==(o=go.value[0])?void 0:o.lights[0])?void 0:n.id)||null,Jo())}}const Ro=t(!1);async function Xx(e){var t,o,n;try{let s=await $fetch("/api/room3d/room-lighting",{query:{roomId:e}});if((null==s?void 0:s.presets)||(s=await $fetch("/api/room3d/room-lighting",{query:{roomId:e,system:!0}})),!(null==s?void 0:s.presets))return!1;const c=s;for(const e of c.presets)e.filters||(e.filters={...Na}),e.sceneFilters||(e.sceneFilters={...Na}),e.cycleWeight||(e.cycleWeight=1);return go.value=JSON.parse(JSON.stringify(c.presets)),ho.value=c.mode,xo.value=c.activePresetId,yo.value=[...c.cyclePresetIds],wo.value=c.cycleDurationMinutes,bo.value=(null==(t=go.value[0])?void 0:t.id)||null,mo.value=(null==(n=null==(o=go.value[0])?void 0:o.lights[0])?void 0:n.id)||null,Jo(),Ro.value=!1,!0}catch{return!1}}function Jx(e){const t=`preset_${Date.now()}`;let o;if(e){const n=go.value.find(t=>t.id===e);if(!n)return;o=JSON.parse(JSON.stringify(n)),o.id=t,o.name=n.name+" Copy"}else o={id:t,name:"New Preset",lights:[],skyRotation:0,exposure:1,filters:{...Na},sceneFilters:{...Na},cycleWeight:1};go.value.push(o),yo.value.push(t),v0(t)}function Qx(e){go.value.length<=1||(go.value=go.value.filter(t=>t.id!==e),yo.value=yo.value.filter(t=>t!==e),xo.value===e&&(xo.value=go.value[0].id),bo.value===e&&v0(go.value[0].id))}function v0(e){var t;bo.value=e;const o=go.value.find(t=>t.id===e);mo.value=(null==(t=null==o?void 0:o.lights[0])?void 0:t.id)||null,o&&Qn(o)}let Io=null;function _x(e,t){Io=t,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t))}function e1(e,t){if(e.preventDefault(),!Io||Io===t)return;const a=(e,t,o)=>{const n=e.findIndex(e=>("string"==typeof e?e:e.id)===t),s=e.findIndex(e=>("string"==typeof e?e:e.id)===o);if(n<0||s<0)return;const[c]=e.splice(n,1);e.splice(s,0,c)};a(go.value,Io,t),a(yo.value,Io,t)}function t1(){Io=null}function a1(e){const t=Mo.value;if(!t)return;const o=`light_${Date.now()}`,n={id:o,type:e,name:{ambient:"Ambient",hemisphere:"Hemisphere",directional:"Directional",point:"Point Light"}[e],enabled:!0,color:"#ffffff",intensity:1};"hemisphere"===e&&(n.groundColor="#444444"),"directional"===e&&(n.position={x:5,y:10,z:5}),"point"===e&&(n.position={x:0,y:5,z:0},n.distance=50,n.decay=1),t.lights.push(n),mo.value=o,So.value=!1,Jo()}function o1(e){var t;const o=Mo.value;o&&(o.lights=o.lights.filter(t=>t.id!==e),mo.value===e&&(mo.value=(null==(t=o.lights[0])?void 0:t.id)||null),Jo())}function n1(e){const t=Mo.value;if(!t)return;const o=t.lights.find(t=>t.id===e);if(!o)return;const n=JSON.parse(JSON.stringify(o));n.id=`light_${Date.now()}`,n.name=o.name+" Copy",t.lights.push(n),mo.value=n.id,Jo()}const jo=t(null);let Fo=null,Lo=null,Bo=5;function l1(e){var t,o;const n=Mo.value;if(!n)return;const s=n.lights.find(t=>t.id===e);if(!s)return;jo.value=e,fo.value=!1;const c=St();if(!c)return;const u=.08*Ye,p=new Ue.SphereGeometry(u,12,8),v=new Ue.MeshBasicMaterial({color:65416,transparent:!0,opacity:.85,depthTest:!1});Fo=new Ue.Mesh(p,v),Fo.renderOrder=999,c.add(Fo);const f=new Ue.Color(s.color);Lo=new Ue.PointLight(f,Math.min(.3*s.intensity,300),s.distance||50,null!=(t=s.decay)?t:2),c.add(Lo),Bo=5,null==(o=qe())||o.lock()}function i1(){if(!jo.value||!Fo)return;const e=Vt();if(!e)return;const t=new Ue.Vector3;e.getWorldDirection(t);const o=e.position.clone().add(t.multiplyScalar(Bo));Fo.position.copy(o),Lo&&Lo.position.copy(o)}function s1(){var e;if(!jo.value||!Fo)return;const t=Mo.value;if(!t)return void of();const o=t.lights.find(e=>e.id===jo.value);if(!o)return void of();const n=Fo.position;o.position={x:Math.round(10*n.x)/10,y:Math.round(10*n.y)/10,z:Math.round(10*n.z)/10},g0(),jo.value=null,null==(e=qe())||e.unlock(),fo.value=!0,mo.value=o.id,Jo()}function of(){var e;g0(),jo.value=null,null==(e=qe())||e.unlock(),fo.value=!0}function r1(e){if(!jo.value)return;const t=e>0?-.5:.5;Bo=Math.max(1,Math.min(50,Bo+t))}function g0(){const e=St();Fo&&e&&(e.remove(Fo),Fo.geometry.dispose(),Fo.material.dispose(),Fo=null),Lo&&e&&(e.remove(Lo),Lo.dispose(),Lo=null)}function d1(e){oo=e}function c1(){g0(),jo.value=null;const e=Ct();e&&(e.domElement.style.filter=""),po="",vo=0;const t=St();for(const[,e]of qa)t&&t.remove(e);qa.clear(),Xa&&t&&(t.remove(Xa),Xa.geometry.dispose(),Xa.material.dispose()),Xa=null,eo=null,Ha=null,Ga=null,Ya=!1,Za=0,Qa=!1,ao=-1,oo=null,Ka=null}function ub(){return{DEFAULT_FILTERS:Na,getLightingConfig:Px,isLightingCycleActive:Dx,setRoomGeometryCache:Rx,getRoomGeometryCache:Ox,generateDefaultLighting:eb,createBackgroundSphere:Fx,applyPresetLighting:Qn,applyActivePreset:Zd,startCycleIfNeeded:Ur,loadRoomLighting:nb,saveLightingConfig:lb,updateLightingCycle:Ex,cleanupLighting:c1,setOnPresetTransitionCallback:d1,editMode:Je,showEnvironmentEditor:fo,envEditorPresets:go,envEditorSelectedPresetId:bo,envEditorSelectedId:mo,envEditorMode:ho,envEditorActivePresetId:xo,envEditorCyclePresetIds:yo,envEditorCycleDuration:wo,envEditorSaved:ko,envEditorAddMenuOpen:So,posEditorDragging:Co,envGradingTarget:$o,envEditorSelectedPreset:Mo,envEditorSelectedLight:To,activeGradingFilters:Vo,posLightSvg:zo,posYRange:Do,cyclePlayheadPct:Oo,setGradingFilter:Bx,POS_EDITOR_SIZE:Ao,worldToSvg:ib,svgToWorld:sb,onPosEditorDown:Wx,onPosEditorMove:Hx,onPosEditorUp:Gx,updateLightY:Kx,openEnvironmentEditor:qx,closeEnvironmentEditor:db,applyEditorLighting:Jo,saveEnvironmentEditor:Yx,resetEnvironmentDefaults:Zx,addPreset:Jx,deletePreset:Qx,selectEditorPreset:v0,importLightingFromRoom:Xx,importRoomPickerOpen:Ro,onPresetDragStart:_x,onPresetDragOver:e1,onPresetDragEnd:t1,addEditorLight:a1,deleteEditorLight:o1,cloneEditorLight:n1,placingLightId:jo,startLightPlacement:l1,updateLightPlacement:i1,confirmLightPlacement:s1,cancelLightPlacement:of,scrollLightDistance:r1,setMobile:e=>{to=e},getSceneLightRefs:()=>qa}}const Eo=e({__name:"Room3dEnvEditor",__ssrInlineRender:!0,props:{currentRoomId:{}},emits:["save","reset"],setup(e){const t=e,{editMode:n,showEnvironmentEditor:s,envEditorPresets:c,envEditorSelectedPresetId:u,envEditorSelectedPreset:f,envEditorSelectedId:g,envEditorSelectedLight:b,envEditorMode:h,envEditorActivePresetId:x,envEditorCycleDuration:S,envEditorSaved:$,envEditorAddMenuOpen:M,envGradingTarget:T,activeGradingFilters:V,posLightSvg:O,posYRange:I,POS_EDITOR_SIZE:j,selectEditorPreset:E,addPreset:ee,deletePreset:ne,importLightingFromRoom:le,importRoomPickerOpen:se,addEditorLight:re,deleteEditorLight:pe,cloneEditorLight:ge,applyEditorLighting:be,setGradingFilter:he,onPresetDragStart:xe,onPresetDragOver:ye,onPresetDragEnd:we,closeEnvironmentEditor:ke,onPosEditorDown:Se,onPosEditorMove:Ce,onPosEditorUp:Me,updateLightY:Te,startLightPlacement:Ve}=ub(),Pe=o(()=>We.filter(e=>e.id!==t.currentRoomId&&!e.hidden).map(e=>({id:e.id,name:e.name}))),ze=[{key:"brightness",label:"Brightness",min:.2,max:3,step:.01,fmt:2},{key:"contrast",label:"Contrast",min:.2,max:3,step:.01,fmt:2},{key:"highlights",label:"Highlights",min:-100,max:100,step:1,fmt:0},{key:"shadows",label:"Shadows",min:-100,max:100,step:1,fmt:0},{key:"whites",label:"Whites",min:-100,max:100,step:1,fmt:0},{key:"blacks",label:"Blacks",min:-100,max:100,step:1,fmt:0}],De=[{key:"saturation",label:"Saturation",min:0,max:3,step:.01,fmt:2},{key:"vibrance",label:"Vibrance",min:-100,max:100,step:1,fmt:0},{key:"warmth",label:"Temperature",min:-100,max:100,step:1,fmt:0},{key:"tint",label:"Tint",min:-100,max:100,step:1,fmt:0}];return(e,t,o,E)=>{var ee,ne,le,re,pe,ge;v(s)?(t(`<div${F(p({class:"absolute top-0 right-0 bottom-0 w-[340px] z-50 flex flex-col shadow-2xl",style:{background:"linear-gradient(180deg, rgba(15,10,30,0.92) 0%, rgba(10,8,25,0.95) 100%)","backdrop-filter":"blur(24px)","border-left":"1px solid rgba(251,191,36,0.15)"}},E))} data-v-08b0e30f><div class="px-5 py-3 flex items-center justify-between shrink-0" style="${oe({"border-bottom":"1px solid rgba(251,191,36,0.1)"})}" data-v-08b0e30f><div class="flex items-center gap-3" data-v-08b0e30f><div class="w-8 h-8 rounded-xl flex items-center justify-center" style="${oe({background:"linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.1))",border:"1px solid rgba(251,191,36,0.3)"})}" data-v-08b0e30f>`),t(_(v($e),{class:"w-4 h-4 text-amber-400"},null,o)),t(`</div><div data-v-08b0e30f><h2 class="text-white font-bold text-base tracking-wide" data-v-08b0e30f>Environment</h2><p class="text-amber-500/50 text-base font-medium" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>Lighting &amp; Atmosphere</p></div></div><div class="flex items-center gap-2" data-v-08b0e30f>`),"ok"===v($)?t(`<span class="text-green-400 text-base font-bold px-2 py-0.5 rounded-full" style="${oe({background:"rgba(74,222,128,0.15)"})}" data-v-08b0e30f>Saved</span>`):"err"===v($)?t(`<span class="text-red-400 text-base font-bold px-2 py-0.5 rounded-full" style="${oe({background:"rgba(248,113,113,0.15)"})}" data-v-08b0e30f>Error</span>`):t("\x3c!----\x3e"),v(n)?t(`<div class="px-2 py-0.5 rounded-full text-base font-black text-amber-300 tracking-widest" style="${oe({"font-size":"11px",background:"linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.1))",border:"1px solid rgba(251,191,36,0.3)"})}" data-v-08b0e30f>SYS</div>`):t("\x3c!----\x3e"),t('<button class="w-8 h-8 rounded-lg flex items-center justify-center text-gray-500 hover:text-white hover:bg-white/10 transition-all" data-v-08b0e30f>'),t(_(v(de),{class:"w-4 h-4"},null,o)),t(`</button></div></div><div class="flex-1 overflow-y-auto" style="${oe({"scrollbar-width":"thin","scrollbar-color":"rgba(251,191,36,0.2) transparent"})}" data-v-08b0e30f><div class="px-5 py-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-08b0e30f><button class="${U(["single"===v(h)?"text-amber-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-lg transition-all flex items-center justify-center gap-1.5"])}" style="${oe(["single"===v(h)?"background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(245,158,11,0.1)); border: 1px solid rgba(251,191,36,0.3);":"border: 1px solid transparent;",{"font-size":"13px"}])}" data-v-08b0e30f>`),t(_(v($e),{class:"w-3.5 h-3.5"},null,o)),t(` Single </button><button class="${U(["cycle"===v(h)?"text-amber-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-lg transition-all flex items-center justify-center gap-1.5"])}" style="${oe(["cycle"===v(h)?"background: linear-gradient(135deg, rgba(251,191,36,0.25), rgba(245,158,11,0.1)); border: 1px solid rgba(251,191,36,0.3);":"border: 1px solid transparent;",{"font-size":"13px"}])}" data-v-08b0e30f>`),t(_(v(ve),{class:"w-3.5 h-3.5"},null,o)),t(" Cycle </button></div>"),"cycle"===v(h)?(t('<div class="flex items-center gap-2 mt-3" data-v-08b0e30f>'),t(_(v(ve),{class:"w-3.5 h-3.5 text-amber-500/50"},null,o)),t(`<span class="text-gray-400 text-base font-medium" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>Total cycle</span><input type="number"${J("value",v(S))} min="1" max="1440" class="w-16 rounded-lg px-2 py-1.5 text-white text-base font-mono text-center focus:outline-none focus:ring-1 focus:ring-amber-500/50" style="${oe({"font-size":"14px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-08b0e30f><span class="text-gray-500 text-base" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>min</span></div>`)):t("\x3c!----\x3e"),t(`</div><div class="px-5 py-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><div class="flex items-center justify-between mb-2" data-v-08b0e30f><span class="env-section-label" data-v-08b0e30f>`),t(_(v(Oe),{class:"w-3.5 h-3.5 text-amber-500/60"},null,o)),t(` Presets </span><div class="flex gap-1.5 relative" data-v-08b0e30f><button class="env-sm-btn" style="${oe({background:"rgba(96,165,250,0.12)",border:"1px solid rgba(96,165,250,0.25)"})}" title="Import from room" data-v-08b0e30f>`),t(_(v(Re),{class:"w-3.5 h-3.5 text-blue-400"},null,o)),t(`</button><button class="env-sm-btn" style="${oe({background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"})}" title="Clone" data-v-08b0e30f>`),t(_(v(fe),{class:"w-3.5 h-3.5 text-gray-400"},null,o)),t(`</button><button class="env-sm-btn" style="${oe({background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.3)"})}" title="New preset" data-v-08b0e30f>`),t(_(v(Ie),{class:"w-3.5 h-3.5 text-amber-400"},null,o)),t("</button>"),v(se)?t('<div class="fixed inset-0 z-10" data-v-08b0e30f></div>'):t("\x3c!----\x3e"),v(se)?(t(`<div class="absolute right-0 top-full mt-1 rounded-xl shadow-2xl z-20 overflow-hidden w-52" style="${oe({background:"rgba(20,15,40,0.98)",border:"1px solid rgba(96,165,250,0.25)","backdrop-filter":"blur(12px)"})}" data-v-08b0e30f><div class="px-3 py-2" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><span class="text-blue-400 text-base font-bold" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>Import lighting from:</span></div><div class="max-h-48 overflow-y-auto" style="${oe({"scrollbar-width":"thin"})}" data-v-08b0e30f>\x3c!--[--\x3e`),N(v(Pe),e=>{t(`<button class="w-full text-left px-4 py-2.5 text-base text-gray-300 hover:text-blue-300 hover:bg-blue-500/10 transition-colors flex items-center gap-2" style="${oe({"font-size":"14px","border-bottom":"1px solid rgba(255,255,255,0.03)"})}" data-v-08b0e30f><span class="truncate" data-v-08b0e30f>${Z(e.name)}</span></button>`)}),t("\x3c!--]--\x3e</div>"),0===v(Pe).length?t(`<div class="px-4 py-3" data-v-08b0e30f><span class="text-gray-500 text-base" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>No other rooms found</span></div>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t('</div></div><div class="space-y-1 max-h-44 overflow-y-auto" data-v-08b0e30f>\x3c!--[--\x3e'),N(v(c),e=>{t(`<div class="flex items-center gap-1.5 group cursor-grab active:cursor-grabbing" draggable="true" data-v-08b0e30f><button class="flex-1 flex items-center gap-2 px-3 py-2 rounded-xl text-left transition-all" style="${oe([{"font-size":"14px"},v(u)===e.id?"background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.05)); border: 1px solid rgba(251,191,36,0.3); box-shadow: 0 0 12px rgba(251,191,36,0.1);":"background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);"])}" data-v-08b0e30f><span class="text-gray-600 select-none" style="${oe({"font-size":"11px"})}" data-v-08b0e30f>::</span><span class="${U([v(u)===e.id?"text-white font-semibold":"text-gray-400","flex-1 truncate"])}" data-v-08b0e30f>${Z(e.name)}</span>`),"cycle"===v(h)?t(`<span class="font-mono px-1.5 py-0.5 rounded-md" style="${oe({"font-size":"11px",background:"rgba(251,191,36,0.1)",color:"rgba(251,191,36,0.6)"})}" data-v-08b0e30f>${Z(e.cycleWeight||1)}x</span>`):t("\x3c!----\x3e"),"single"===v(h)&&v(x)===e.id?t(`<span class="font-black text-amber-400 tracking-wider px-1.5 py-0.5 rounded-md" style="${oe({"font-size":"11px",background:"rgba(251,191,36,0.15)"})}" data-v-08b0e30f>ON</span>`):t("\x3c!----\x3e"),t("</button>"),"single"===v(h)&&v(x)!==e.id?(t(`<button class="env-sm-btn opacity-0 group-hover:opacity-100" style="${oe({background:"rgba(251,191,36,0.1)"})}" title="Set active" data-v-08b0e30f>`),t(_(v(je),{class:"w-3.5 h-3.5 text-amber-500/60"},null,o)),t("</button>")):t("\x3c!----\x3e"),v(c).length>1?(t(`<button class="env-sm-btn opacity-0 group-hover:opacity-100" style="${oe({background:"rgba(239,68,68,0.1)"})}" title="Delete" data-v-08b0e30f>`),t(_(v(ue),{class:"w-3.5 h-3.5 text-red-400/60"},null,o)),t("</button>")):t("\x3c!----\x3e"),t("</div>")}),t("\x3c!--]--\x3e</div>"),v(f)?(t(`<div class="mt-2 flex gap-2" data-v-08b0e30f><input${J("value",v(f).name)} type="text" placeholder="Preset name" class="flex-1 rounded-lg px-3 py-1.5 text-white font-medium focus:outline-none focus:ring-1 focus:ring-amber-500/50" style="${oe({"font-size":"14px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-08b0e30f>`),"cycle"===v(h)?t(`<div class="flex items-center gap-1" data-v-08b0e30f><input type="number"${J("value",v(f).cycleWeight)} min="1" max="20" class="w-12 rounded-lg px-2 py-1.5 text-amber-400 font-mono text-center focus:outline-none focus:ring-1 focus:ring-amber-500/50" style="${oe({"font-size":"13px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(251,191,36,0.2)"})}" data-v-08b0e30f><span class="text-gray-600" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>wt</span></div>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t("</div>"),v(f)?(t(`<div class="px-5 py-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><div class="flex items-center justify-between mb-2 relative" data-v-08b0e30f><span class="env-section-label" data-v-08b0e30f>`),t(_(v(je),{class:"w-3.5 h-3.5 text-amber-500/60"},null,o)),t(` Lights </span><button class="env-sm-btn" style="${oe({background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.3)"})}" data-v-08b0e30f>`),t(_(v(Ie),{class:"w-3.5 h-3.5 text-amber-400"},null,o)),t("</button>"),v(M)?(t(`<div class="absolute right-0 top-full mt-1 rounded-xl shadow-2xl z-10 overflow-hidden w-36" style="${oe({background:"rgba(20,15,40,0.98)",border:"1px solid rgba(251,191,36,0.2)","backdrop-filter":"blur(12px)"})}" data-v-08b0e30f>\x3c!--[--\x3e`),N(["ambient","hemisphere","directional","point"],e=>{t(`<button class="w-full text-left px-4 py-2.5 text-base text-gray-300 hover:text-amber-300 transition-colors capitalize flex items-center gap-2" style="${oe({"font-size":"14px","border-bottom":"1px solid rgba(255,255,255,0.03)"})}" data-v-08b0e30f><div class="w-2.5 h-2.5 rounded-full" style="${oe({background:"ambient"===e?"#fbbf24":"hemisphere"===e?"#60a5fa":"directional"===e?"#f59e0b":"#a78bfa"})}" data-v-08b0e30f></div> ${Z(e)}</button>`)}),t("\x3c!--]--\x3e</div>")):t("\x3c!----\x3e"),t('</div><div class="space-y-1 max-h-40 overflow-y-auto" data-v-08b0e30f>\x3c!--[--\x3e'),N(v(f).lights,e=>{t(`<button class="w-full flex items-center gap-2 px-3 py-2 rounded-xl text-left transition-all" style="${oe([{"font-size":"13px"},v(g)===e.id?"background: linear-gradient(135deg, rgba(251,191,36,0.12), rgba(245,158,11,0.05)); border: 1px solid rgba(251,191,36,0.25); box-shadow: 0 0 8px rgba(251,191,36,0.08);":"background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.04);"])}" data-v-08b0e30f><div class="w-3.5 h-3.5 rounded-full shrink-0 shadow-sm" style="${oe({backgroundColor:e.color,boxShadow:`0 0 6px ${e.color}40`})}" data-v-08b0e30f></div><span class="${U([e.enabled?v(g)===e.id?"text-white":"text-gray-300":"text-gray-600 line-through","flex-1 truncate font-medium"])}" data-v-08b0e30f>${Z(e.name)}</span><span class="text-gray-600 uppercase font-mono shrink-0" style="${oe({"font-size":"11px"})}" data-v-08b0e30f>${Z("directional"===e.type?"dir":"hemisphere"===e.type?"hemi":"ambient"===e.type?"amb":"pt")}</span><label class="relative shrink-0" data-v-08b0e30f><input type="checkbox"${X(e.enabled)?" checked":""} class="sr-only peer" data-v-08b0e30f><div style="${oe(e.enabled?"background: rgba(251,191,36,0.5);":"background: rgba(255,255,255,0.1);")}" class="${U([e.enabled?"after:translate-x-4 after:bg-amber-200":"after:bg-gray-500","w-8 h-4 rounded-full peer transition-all after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:rounded-full after:h-3 after:w-3 after:transition-all"])}" data-v-08b0e30f></div></label></button>`)}),t("\x3c!--]--\x3e</div>"),v(g)?(t(`<div class="mt-2 flex gap-2" data-v-08b0e30f><button class="flex-1 px-3 py-1.5 rounded-xl text-base font-medium flex items-center justify-center gap-1.5 transition-all hover:scale-[1.02]" style="${oe({"font-size":"13px",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.15)",color:"rgba(251,191,36,0.8)"})}" data-v-08b0e30f>`),t(_(v(fe),{class:"w-3.5 h-3.5"},null,o)),t(` Clone </button><button class="flex-1 px-3 py-1.5 rounded-xl text-base font-medium flex items-center justify-center gap-1.5 transition-all hover:scale-[1.02]" style="${oe({"font-size":"13px",background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.15)",color:"rgba(248,113,113,0.8)"})}" data-v-08b0e30f>`),t(_(v(ue),{class:"w-3.5 h-3.5"},null,o)),t(" Delete </button></div>")):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),v(b)?(t(`<div class="px-5 py-3 space-y-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><div class="flex items-center gap-2" data-v-08b0e30f><div class="w-4 h-4 rounded-full shadow-sm" style="${oe({backgroundColor:v(b).color,boxShadow:`0 0 8px ${v(b).color}60`})}" data-v-08b0e30f></div><span class="text-white font-bold flex-1 truncate" style="${oe({"font-size":"14px"})}" data-v-08b0e30f>${Z(v(b).name)}</span><span class="font-mono px-2 py-0.5 rounded-md" style="${oe({"font-size":"12px",background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.3)"})}" data-v-08b0e30f>${Z(v(b).type)}</span></div><div data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Name</label><input${J("value",v(b).name)} type="text" class="w-full rounded-lg px-3 py-2 text-white mt-1 focus:outline-none focus:ring-1 focus:ring-amber-500/50" style="${oe({"font-size":"14px",background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-08b0e30f></div><div data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Color</label><div class="flex items-center gap-3 mt-1" data-v-08b0e30f><input type="color"${J("value",v(b).color)} class="w-10 h-8 rounded-lg cursor-pointer" style="${oe({border:"2px solid rgba(255,255,255,0.15)"})}" data-v-08b0e30f><span class="text-gray-500 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(b).color)}</span></div></div>`),"hemisphere"===v(b).type?t(`<div data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Ground Color</label><div class="flex items-center gap-3 mt-1" data-v-08b0e30f><input type="color"${J("value",v(b).groundColor||"#888888")} class="w-10 h-8 rounded-lg cursor-pointer" style="${oe({border:"2px solid rgba(255,255,255,0.15)"})}" data-v-08b0e30f><span class="text-gray-500 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(b).groundColor||"#888888")}</span></div></div>`):t("\x3c!----\x3e"),t(`<div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Intensity</label><span class="text-amber-400 font-mono font-bold" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(b).intensity.toFixed(2))}</span></div><input type="range" min="0"${J("max","point"===v(b).type?5e3:5)} step="0.01"${J("value",v(b).intensity)} class="w-full mt-1 accent-amber-500 h-1.5" data-v-08b0e30f></div>`),"point"===v(b).type?t(`<div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Decay</label><span class="text-amber-400 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z((null!=(ee=v(b).decay)?ee:2).toFixed(1))}</span></div><input type="range" min="0" max="3" step="0.1"${J("value",null!=(ne=v(b).decay)?ne:2)} class="w-full mt-1 accent-amber-500 h-1.5" data-v-08b0e30f></div>`):t("\x3c!----\x3e"),"point"===v(b).type?t(`<div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Distance <span class="text-gray-600 normal-case font-normal" data-v-08b0e30f>(0 = infinite)</span></label><span class="text-amber-400 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(b).distance||0)}</span></div><input type="range" min="0" max="3000" step="5"${J("value",v(b).distance||0)} class="w-full mt-1 accent-amber-500 h-1.5" data-v-08b0e30f></div>`):t("\x3c!----\x3e"),"directional"===v(b).type||"point"===v(b).type?(t(`<div data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Position</label><div class="flex gap-2 mt-2" data-v-08b0e30f><svg${J("viewBox",`0 0 ${v(j)} ${v(j)}`)} class="flex-1 aspect-square rounded-xl cursor-crosshair select-none" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.08)","max-width":"220px"})}" data-v-08b0e30f>\x3c!--[--\x3e`),N(5,e=>{t(`<line${J("x1",16+42*(e-1))}${J("y1",16)}${J("x2",16+42*(e-1))}${J("y2",184)} stroke="rgba(255,255,255,0.04)" stroke-width="0.5" data-v-08b0e30f></line>`)}),t("\x3c!--]--\x3e\x3c!--[--\x3e"),N(5,e=>{t(`<line${J("x1",16)}${J("y1",16+42*(e-1))}${J("x2",184)}${J("y2",16+42*(e-1))} stroke="rgba(255,255,255,0.04)" stroke-width="0.5" data-v-08b0e30f></line>`)}),t(`\x3c!--]--\x3e<rect x="16" y="16"${J("width",v(j)-32)}${J("height",v(j)-32)} fill="none" stroke="rgba(251,191,36,0.15)" stroke-width="1" stroke-dasharray="6,3" data-v-08b0e30f></rect><line${J("x1",v(j)/2-8)}${J("y1",v(j)/2)}${J("x2",v(j)/2+8)}${J("y2",v(j)/2)} stroke="rgba(255,255,255,0.1)" stroke-width="0.5" data-v-08b0e30f></line><line${J("x1",v(j)/2)}${J("y1",v(j)/2-8)}${J("x2",v(j)/2)}${J("y2",v(j)/2+8)} stroke="rgba(255,255,255,0.1)" stroke-width="0.5" data-v-08b0e30f></line><circle${J("cx",v(O).x)}${J("cy",v(O).y)} r="14"${J("fill",`${v(b).color}20`)} data-v-08b0e30f></circle><circle${J("cx",v(O).x)}${J("cy",v(O).y)} r="7"${J("fill",v(b).color)} stroke="white" stroke-width="2" data-v-08b0e30f></circle><text x="6"${J("y",v(j)/2+3)} fill="rgba(255,255,255,0.2)" font-size="10" font-family="monospace" data-v-08b0e30f>X</text><text${J("x",v(j)/2-3)} y="12" fill="rgba(255,255,255,0.2)" font-size="10" font-family="monospace" data-v-08b0e30f>Z</text></svg><div class="flex flex-col items-center gap-1 w-8" data-v-08b0e30f><span class="text-amber-500/50 font-bold" style="${oe({"font-size":"11px"})}" data-v-08b0e30f>Y</span><input type="range"${J("min",v(I).min)}${J("max",v(I).max)} step="0.5"${J("value",null!=(re=null==(le=v(b).position)?void 0:le.y)?re:0)} class="flex-1 accent-amber-500" style="${oe({"writing-mode":"vertical-lr",direction:"rtl","min-height":"140px"})}" data-v-08b0e30f><span class="text-amber-400 font-mono font-bold" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>${Z((null!=(ge=null==(pe=v(b).position)?void 0:pe.y)?ge:0).toFixed(0))}</span></div></div><div class="flex items-center gap-4 mt-2" data-v-08b0e30f>\x3c!--[--\x3e`),N(["x","y","z"],e=>{var o,n;t(`<span class="font-mono" style="${oe({"font-size":"12px"})}" data-v-08b0e30f><span class="text-gray-600 uppercase font-bold" data-v-08b0e30f>${Z(e)}</span><span class="text-gray-400 ml-1" data-v-08b0e30f>${Z((null!=(n=null==(o=v(b).position)?void 0:o[e])?n:0).toFixed(1))}</span></span>`)}),t(`\x3c!--]--\x3e<div class="flex-1" data-v-08b0e30f></div><button class="px-3 py-1.5 rounded-lg text-base font-bold flex items-center gap-1.5 transition-all hover:scale-105" style="${oe({"font-size":"13px",background:"linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,200,100,0.08))",border:"1px solid rgba(0,255,136,0.3)",color:"#00ff88"})}" data-v-08b0e30f>`),t(_(v(Fe),{class:"w-3.5 h-3.5"},null,o)),t(" Place </button></div></div>")):t("\x3c!----\x3e"),t("</div>")):v(f)&&0===v(f).lights.length?(t('<div class="px-5 py-8 text-center" data-v-08b0e30f>'),t(_(v(je),{class:"w-8 h-8 text-gray-700 mx-auto mb-2"},null,o)),t('<p class="text-gray-600 text-base" data-v-08b0e30f>No lights yet</p><p class="text-gray-700 text-base mt-1" data-v-08b0e30f>Click + to add one</p></div>')):t("\x3c!----\x3e"),v(f)?(t(`<div class="px-5 py-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-08b0e30f><div class="flex items-center justify-between mb-3" data-v-08b0e30f><span class="env-section-label" data-v-08b0e30f>`),t(_(v(ce),{class:"w-3.5 h-3.5 text-amber-500/60"},null,o)),t(` Color Grading </span><div class="flex rounded-md overflow-hidden" style="${oe({border:"1px solid rgba(255,255,255,0.1)"})}" data-v-08b0e30f><button class="px-2.5 py-1 font-bold uppercase tracking-wider transition-all" style="${oe([{"font-size":"12px"},"sky"===v(T)?"background: rgba(56,189,248,0.25); color: rgb(125,211,252);":"background: transparent; color: rgba(255,255,255,0.35);"])}" data-v-08b0e30f> Sky</button><button class="px-2.5 py-1 font-bold uppercase tracking-wider transition-all" style="${oe([{"font-size":"12px"},"scene"===v(T)?"background: rgba(251,191,36,0.25); color: rgb(252,211,77);":"background: transparent; color: rgba(255,255,255,0.35);"])}" data-v-08b0e30f> Ambient</button></div></div><div class="space-y-1.5 mb-3" data-v-08b0e30f>\x3c!--[--\x3e`),N(ze,e=>{var o,n;t(`<div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="text-gray-500 font-medium" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>${Z(e.label)}</label><span class="text-amber-400/70 font-mono" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>${Z((null!=(o=v(V)[e.key])?o:e.min>0?1:0).toFixed(e.fmt))}</span></div><input type="range"${J("min",e.min)}${J("max",e.max)}${J("step",e.step)}${J("value",null!=(n=v(V)[e.key])?n:e.min>0?1:0)} class="${U(["sky"===v(T)?"accent-sky-500":"accent-amber-500","w-full h-1.5"])}" data-v-08b0e30f></div>`)}),t(`\x3c!--]--\x3e</div><div class="mb-1.5 pt-2" style="${oe({"border-top":"1px solid rgba(255,255,255,0.04)"})}" data-v-08b0e30f><span class="text-gray-600 font-bold uppercase tracking-widest" style="${oe({"font-size":"11px"})}" data-v-08b0e30f>Color</span></div><div class="space-y-1.5" data-v-08b0e30f>\x3c!--[--\x3e`),N(De,e=>{var o,n;t(`<div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="text-gray-500 font-medium" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>${Z(e.label)}</label><span class="text-amber-400/70 font-mono" style="${oe({"font-size":"12px"})}" data-v-08b0e30f>${Z((null!=(o=v(V)[e.key])?o:e.min>0?1:0).toFixed(e.fmt))}</span></div><input type="range"${J("min",e.min)}${J("max",e.max)}${J("step",e.step)}${J("value",null!=(n=v(V)[e.key])?n:e.min>0?1:0)} class="${U(["sky"===v(T)?"accent-sky-500":"accent-amber-500","w-full h-1.5"])}" data-v-08b0e30f></div>`)}),t("\x3c!--]--\x3e</div></div>")):t("\x3c!----\x3e"),v(f)?t(`<div class="px-5 py-3 space-y-2" data-v-08b0e30f><div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Sky Rotation</label><span class="text-amber-400 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(f).skyRotation)}Â°</span></div><input type="range" min="0" max="360" step="1"${J("value",v(f).skyRotation)} class="w-full accent-amber-500 h-1.5 mt-1" data-v-08b0e30f></div><div data-v-08b0e30f><div class="flex items-center justify-between" data-v-08b0e30f><label class="env-prop-label" data-v-08b0e30f>Exposure</label><span class="text-amber-400 font-mono" style="${oe({"font-size":"13px"})}" data-v-08b0e30f>${Z(v(f).exposure.toFixed(2))}</span></div><input type="range" min="0.1" max="3" step="0.01"${J("value",v(f).exposure)} class="w-full accent-amber-500 h-1.5 mt-1" data-v-08b0e30f></div></div>`):t("\x3c!----\x3e"),t(`</div><div class="px-5 py-3 flex items-center gap-2 shrink-0" style="${oe({"border-top":"1px solid rgba(251,191,36,0.1)",background:"rgba(0,0,0,0.2)"})}" data-v-08b0e30f>`),v(n)?t("\x3c!----\x3e"):(t(`<button class="px-3 py-2 rounded-xl text-base font-bold transition-all hover:scale-105" style="${oe({"font-size":"13px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.4)"})}" data-v-08b0e30f>`),t(_(v(ve),{class:"w-3.5 h-3.5 inline -mt-0.5 mr-1"},null,o)),t("Reset </button>")),t(`<div class="flex-1" data-v-08b0e30f></div><button class="px-4 py-2 rounded-xl text-base font-bold transition-all hover:scale-105" style="${oe({"font-size":"13px",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.5)"})}" data-v-08b0e30f> Cancel </button><button class="px-5 py-2 rounded-xl font-black transition-all hover:scale-105 hover:shadow-lg" style="${oe({"font-size":"14px",background:"linear-gradient(135deg, rgba(251,191,36,0.3), rgba(245,158,11,0.15))",border:"1px solid rgba(251,191,36,0.4)",color:"#fbbf24","box-shadow":"0 0 16px rgba(251,191,36,0.15)"})}" data-v-08b0e30f> Save </button></div></div>`)):t("\x3c!----\x3e")}}}),Uo=Eo.setup;Eo.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dEnvEditor.vue"),Uo?Uo(e,t):void 0};const Wo=Object.assign(Le(Eo,[["__scopeId","data-v-08b0e30f"]]),{__name:"Room3dEnvEditor"}),No=e({__name:"Room3dHud",__ssrInlineRender:!0,props:{selectedEnv:{},loading:{type:Boolean},locked:{type:Boolean},editMode:{type:Boolean},placingAsset:{},rotatingObject:{},ghostValid:{type:Boolean},placedCount:{},canUndo:{type:Boolean},canRedo:{type:Boolean},showRadial:{type:Boolean},showInventory:{type:Boolean},showHelp:{type:Boolean},showEnvironmentEditor:{type:Boolean},playerCount:{},calibratingCharacter:{type:Boolean},calibratingCharacterFile:{},characterCalibration:{},calAppliedAll:{type:Boolean},showScaleSaved:{type:Boolean},showRotationSaved:{type:Boolean},showSpawnSaved:{type:Boolean},settingSpawn:{type:Boolean},showEditSaved:{type:[Boolean,String]},voiceEnabled:{type:Boolean},voiceMode:{},localMuted:{type:Boolean},localSpeaking:{type:Boolean},pttActive:{type:Boolean},placingLightId:{},isTouchDevice:{type:Boolean},aimingAtClickable:{type:Boolean},aimingAtKeypad:{type:Boolean},keypadButtons:{},polygonToolActive:{type:Boolean},calibratingRoom:{type:Boolean},calibrationStep:{},calibSnapped:{type:Boolean},calibFloorDisplay:{},calibScaleDisplay:{},editingRoomMeshes:{type:Boolean},activeTool:{},activeToolData:{}},emits:["undo","redo","apply-calibration-all","close-calibration","toggle-mute","toggle-voice-mode","mobile-rotate","mobile-tilt","mobile-scale","mobile-calib","mobile-calib-confirm","mobile-calib-cancel","mobile-light-dist","mobile-light-confirm","mobile-light-cancel","mobile-mesh-simplify","mobile-mesh-finish","mobile-mesh-cancel","mobile-polygon-undo","mobile-polygon-cancel","mobile-keypad-press"],setup:e=>(t,o,n,s)=>{var c,u,p,f,g,b,h,x,S,$,M;o("\x3c!--[--\x3e"),e.selectedEnv&&!e.loading&&e.locked&&!e.isTouchDevice?(o('<div class="absolute top-4 right-4 z-10 flex items-center gap-2" data-v-3d1a46c8>'),e.voiceEnabled?(o(`\x3c!--[--\x3e<button class="hud-icon-btn group"${J("title",e.localMuted?"Unmute (M)":"Mute (M)")} data-v-3d1a46c8>`),e.localMuted?o('<svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-3d1a46c8><path stroke-linecap="round" stroke-linejoin="round" d="M19 19L5 5m14 0l-3.5 3.5M12 18.75a6 6 0 01-5.82-4.55M12 18.75V21m0-2.25a6 6 0 005.82-4.55M12 2.25a3 3 0 00-3 3v4.5m0 0L5.25 5.25" data-v-3d1a46c8></path></svg>'):o(`<svg class="${U([e.localSpeaking||e.pttActive?"text-teal-400":"text-gray-400 group-hover:text-white","w-5 h-5 transition-colors"])}" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-3d1a46c8><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5V22.5m-3.75-.75h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" data-v-3d1a46c8></path></svg>`),o("</button>"),"ptt"===e.voiceMode?o('<button class="hud-icon-btn group" title="Push-to-Talk (hold V) â€” click for Voice Activated" data-v-3d1a46c8><span class="text-base font-black leading-none tracking-wide text-teal-400" data-v-3d1a46c8>PTT</span></button>'):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")):o("\x3c!----\x3e"),e.editMode&&e.placedCount>0&&!e.showRadial?(o('<div class="hud-pill" data-v-3d1a46c8>'),o(_(v(we),{class:"w-4 h-4 text-emerald-400"},null,n)),o(`<span class="text-emerald-400 font-bold text-base" data-v-3d1a46c8>${Z(e.placedCount)} sys</span></div>`)):o("\x3c!----\x3e"),e.canUndo?(o('<button class="hud-icon-btn group" title="Undo (Ctrl+Z)" data-v-3d1a46c8>'),o(_(v(De),{class:"w-5 h-5 text-gray-400 group-hover:text-white transition-colors"},null,n)),o("</button>")):o("\x3c!----\x3e"),e.canRedo?(o('<button class="hud-icon-btn group" title="Redo (Ctrl+Shift+Z)" data-v-3d1a46c8>'),o(_(v(_e),{class:"w-5 h-5 text-gray-400 group-hover:text-white transition-colors"},null,n)),o("</button>")):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),e.selectedEnv&&!e.loading&&e.locked&&!e.isTouchDevice&&e.playerCount>1?o(`<div class="absolute top-4 left-4 z-10 pointer-events-none" data-v-3d1a46c8><p class="text-teal-400/70 text-base font-semibold drop-shadow-lg" data-v-3d1a46c8>${Z(e.playerCount)} in room</p></div>`):o("\x3c!----\x3e"),e.locked?(o('<div class="absolute inset-0 z-10 pointer-events-none flex items-center justify-center" data-v-3d1a46c8>'),e.placingLightId?(o('\x3c!--[--\x3e<div class="w-10 h-10 border-2 border-green-400 rounded-full shadow-[0_0_16px_rgba(0,255,136,0.6)]" data-v-3d1a46c8></div><div class="w-2 h-2 rounded-full absolute bg-green-400" data-v-3d1a46c8></div>'),e.isTouchDevice?o("\x3c!----\x3e"):o('<div class="absolute top-[calc(50%+32px)] text-center" data-v-3d1a46c8><p class="text-base font-bold text-green-400 drop-shadow-[0_2px_8px_rgba(0,255,136,0.4)]" data-v-3d1a46c8>Place Light</p></div>'),o("\x3c!--]--\x3e")):e.placingAsset?(o(`\x3c!--[--\x3e<div class="${U([e.ghostValid?"border-green-400 shadow-[0_0_16px_rgba(74,222,128,0.6)]":"border-red-400 shadow-[0_0_16px_rgba(248,113,113,0.6)]","w-10 h-10 border-2 rounded-full transition-colors duration-150"])}" data-v-3d1a46c8></div><div class="${U([e.ghostValid?"bg-green-400":"bg-red-400","w-2 h-2 rounded-full absolute transition-colors duration-150"])}" data-v-3d1a46c8></div>`),e.isTouchDevice?o("\x3c!----\x3e"):o(`<div class="absolute top-[calc(50%+32px)] text-center" data-v-3d1a46c8><p class="text-base font-bold text-yellow-400 drop-shadow-[0_2px_8px_rgba(250,204,21,0.4)]" data-v-3d1a46c8>${Z(e.placingAsset.name)}</p></div>`),o("\x3c!--]--\x3e")):e.rotatingObject?(o('\x3c!--[--\x3e<div class="w-9 h-9 border-2 border-purple-400 rounded-full shadow-[0_0_16px_rgba(168,85,247,0.6)]" data-v-3d1a46c8></div>'),o(_(v(ve),{class:"w-4 h-4 text-purple-400 absolute"},null,n)),o("\x3c!--]--\x3e")):(o("\x3c!--[--\x3e"),e.isTouchDevice?(o("\x3c!--[--\x3e"),e.aimingAtClickable?o('<div class="flex flex-col items-center gap-1" data-v-3d1a46c8><div class="w-4 h-4 rounded-full bg-teal-400/60 border-2 border-teal-400/80 shadow-[0_0_12px_rgba(45,212,191,0.5)] animate-pulse" data-v-3d1a46c8></div><span class="text-teal-400 text-base font-black drop-shadow-lg whitespace-nowrap mt-1 tracking-wide" data-v-3d1a46c8>TAP</span></div>'):o("\x3c!----\x3e"),e.aimingAtClickable?o("\x3c!----\x3e"):o('<div class="w-2.5 h-2.5 rounded-full bg-white/40 border border-white/50 shadow-[0_0_6px_rgba(255,255,255,0.2)]" data-v-3d1a46c8></div>'),o("\x3c!--]--\x3e")):o(`<div class="${U(e.aimingAtKeypad?"crosshair crosshair--green":"crosshair")}" data-v-3d1a46c8><div class="crosshair-h" data-v-3d1a46c8></div><div class="crosshair-v" data-v-3d1a46c8></div><div class="crosshair-dot" data-v-3d1a46c8></div></div>`),o("\x3c!--]--\x3e")),o("</div>")):o("\x3c!----\x3e"),e.placingAsset&&e.locked&&!e.showRadial&&!e.isTouchDevice?(o('<div class="absolute bottom-5 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8><div class="hud-bar hud-bar--yellow" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Click</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Place</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Scroll</kbd><span class="hud-action" data-v-3d1a46c8>Rotate</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--combo" data-v-3d1a46c8>Shift+Scroll</kbd><span class="hud-action" data-v-3d1a46c8>Tilt</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--combo" data-v-3d1a46c8>Ctrl+Scroll</kbd><span class="hud-action" data-v-3d1a46c8>Scale</span></div>'),e.editMode?o('\x3c!--[--\x3e<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--amber" data-v-3d1a46c8>+/-</kbd><span class="hud-action text-amber-400" data-v-3d1a46c8>Sys Size</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--amber" data-v-3d1a46c8>Numpad</kbd><span class="hud-action text-amber-400" data-v-3d1a46c8>Sys Rot</span></div>\x3c!--]--\x3e'):o("\x3c!----\x3e"),o('<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>RClick</kbd><span class="hud-action text-red-400" data-v-3d1a46c8>Cancel</span></div></div></div>')):o("\x3c!----\x3e"),e.rotatingObject&&e.locked&&!e.showRadial&&!e.isTouchDevice?o('<div class="absolute bottom-5 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8><div class="hud-bar hud-bar--purple" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--purple" data-v-3d1a46c8>Scroll</kbd><span class="hud-action text-purple-400" data-v-3d1a46c8>Rotate</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--purple" data-v-3d1a46c8>Shift+Scroll</kbd><span class="hud-action text-purple-400" data-v-3d1a46c8>Tilt</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--purple" data-v-3d1a46c8>Ctrl+Scroll</kbd><span class="hud-action text-purple-400" data-v-3d1a46c8>Scale</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Click</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Confirm</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>RClick</kbd><span class="hud-action text-red-400" data-v-3d1a46c8>Cancel</span></div></div></div>'):o("\x3c!----\x3e"),e.placingLightId&&e.locked&&!e.isTouchDevice?o('<div class="absolute bottom-5 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8><div class="hud-bar hud-bar--green" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--green" data-v-3d1a46c8>Scroll</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Distance</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Click</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Place Light</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Q</kbd><span class="hud-action text-red-400" data-v-3d1a46c8>Cancel</span></div></div></div>'):o("\x3c!----\x3e"),e.calibratingRoom&&e.locked&&!e.isTouchDevice?(o(`<div class="absolute bottom-5 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8><div class="${U(["floor"===e.calibrationStep?"hud-bar--green":"hud-bar--yellow","hud-bar"])}" data-v-3d1a46c8>`),"floor"===e.calibrationStep?o(`\x3c!--[--\x3e<div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-green-400 font-bold" data-v-3d1a46c8>Step 1: Set Floor</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--green" data-v-3d1a46c8>Scroll</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Move Floor</span></div><div class="hud-cmd" data-v-3d1a46c8><span class="${U([e.calibSnapped?"text-green-400 font-bold":"text-yellow-400","hud-action"])}" data-v-3d1a46c8>${Z(e.calibSnapped?"SNAPPED":"Free")}</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-white/60" data-v-3d1a46c8>Floor: ${Z(e.calibFloorDisplay.toFixed(2))}</span></div>\x3c!--]--\x3e`):o(`\x3c!--[--\x3e<div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-yellow-400 font-bold" data-v-3d1a46c8>Step 2: Set Scale</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--amber" data-v-3d1a46c8>Scroll</kbd><span class="hud-action text-yellow-400" data-v-3d1a46c8>Resize Cylinder</span></div><div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-white/60" data-v-3d1a46c8>Red = 1.7m person</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-white/60" data-v-3d1a46c8>Scale: ${Z(e.calibScaleDisplay.toFixed(3))} u/m</span></div>\x3c!--]--\x3e`),o('<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Enter</kbd><span class="hud-action text-green-400" data-v-3d1a46c8>Confirm</span></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap" data-v-3d1a46c8>Q</kbd><span class="hud-action text-red-400" data-v-3d1a46c8>Cancel</span></div></div></div>')):o("\x3c!----\x3e"),!e.selectedEnv||e.loading||!e.locked||e.placingAsset||e.rotatingObject||e.placingLightId||e.calibratingRoom||e.polygonToolActive||e.showInventory||e.showRadial||e.showEnvironmentEditor||e.isTouchDevice?o("\x3c!----\x3e"):(o('<div class="absolute bottom-5 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8>'),"watering"===e.activeTool?o(`<div class="hud-bar hud-bar--blue" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-blue" data-v-3d1a46c8>Click</kbd><span class="hud-action text-blue-300" data-v-3d1a46c8>Pour</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>E</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Refill</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-purple" data-v-3d1a46c8>Q</kbd><span class="hud-action text-purple-300" data-v-3d1a46c8>Stow</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd hud-water-bar" data-v-3d1a46c8><span class="hud-action text-blue-300" data-v-3d1a46c8>Water</span><div class="hud-water-track" data-v-3d1a46c8><div class="${U([(null!=(u=null==(c=e.activeToolData)?void 0:c.waterLevel)?u:1)<.2?"bg-red-500 animate-pulse":"bg-blue-500","hud-water-fill"])}" style="${oe({width:100*(null!=(f=null==(p=e.activeToolData)?void 0:p.waterLevel)?f:1)+"%"})}" data-v-3d1a46c8></div></div><span class="hud-action text-white/50" data-v-3d1a46c8>${Z(Math.round(100*(null!=(b=null==(g=e.activeToolData)?void 0:g.waterLevel)?b:1)))}%</span></div></div>`):"ducting"===e.activeTool?(o('<div class="hud-bar hud-bar--teal" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>Click</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Add point</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>E</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Finish at vent</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-purple" data-v-3d1a46c8>Q</kbd><span class="hud-action text-purple-300" data-v-3d1a46c8>Cancel</span></div>'),(null!=(x=null==(h=e.activeToolData)?void 0:h.anchorCount)?x:0)>0?o(`\x3c!--[--\x3e<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><span class="hud-action text-amber-400 font-bold" data-v-3d1a46c8>${Z(null==(S=e.activeToolData)?void 0:S.anchorCount)} point${Z((null!=(M=null==($=e.activeToolData)?void 0:$.anchorCount)?M:0)>1?"s":"")}</span></div>\x3c!--]--\x3e`):o("\x3c!----\x3e"),o("</div>")):(o('<div class="hud-bar hud-bar--default" data-v-3d1a46c8><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-purple" data-v-3d1a46c8>Q</kbd><span class="hud-action text-purple-300" data-v-3d1a46c8>Actions</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>E</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Toggle</span></div><div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>Tab</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Inventory</span></div>'),e.voiceEnabled&&"ptt"===e.voiceMode?o('\x3c!--[--\x3e<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>V</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Talk</span></div>\x3c!--]--\x3e'):o("\x3c!----\x3e"),o('<div class="hud-sep" data-v-3d1a46c8></div><div class="hud-cmd" data-v-3d1a46c8><kbd class="keycap keycap--glow-teal" data-v-3d1a46c8>O</kbd><span class="hud-action text-teal-300" data-v-3d1a46c8>Options</span></div></div>')),o("</div>")),e.rotatingObject&&e.locked&&!e.showRadial&&e.isTouchDevice?o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto" data-v-3d1a46c8><div class="mobile-tool-bar" data-v-3d1a46c8><button class="mobile-tool-btn" data-v-3d1a46c8>â†º</button><button class="mobile-tool-btn" data-v-3d1a46c8>â†»</button><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn" data-v-3d1a46c8>Tiltâ†‘</button><button class="mobile-tool-btn" data-v-3d1a46c8>Tiltâ†“</button><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn" data-v-3d1a46c8>Scale+</button><button class="mobile-tool-btn" data-v-3d1a46c8>Scale-</button></div></div>'):o("\x3c!----\x3e"),e.calibratingRoom&&e.locked&&e.isTouchDevice?o(`<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto" data-v-3d1a46c8><div class="mobile-tool-bar" data-v-3d1a46c8><span class="${U(["floor"===e.calibrationStep?"text-green-400":"text-yellow-400","mobile-tool-label"])}" data-v-3d1a46c8>${Z("floor"===e.calibrationStep?"Step 1: Floor":"Step 2: Scale")}</span><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn" data-v-3d1a46c8>âˆ’</button><span class="text-white/60 text-base font-mono min-w-[60px] text-center" data-v-3d1a46c8>${Z("floor"===e.calibrationStep?e.calibFloorDisplay.toFixed(2):e.calibScaleDisplay.toFixed(3))}</span><button class="mobile-tool-btn" data-v-3d1a46c8>+</button><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn mobile-tool-btn--green" data-v-3d1a46c8>âœ“</button><button class="mobile-tool-btn mobile-tool-btn--red" data-v-3d1a46c8>âœ—</button></div></div>`):o("\x3c!----\x3e"),e.placingLightId&&e.locked&&e.isTouchDevice?o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto" data-v-3d1a46c8><div class="mobile-tool-bar" data-v-3d1a46c8><button class="mobile-tool-btn" data-v-3d1a46c8>Near</button><button class="mobile-tool-btn" data-v-3d1a46c8>Far</button><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn mobile-tool-btn--green" data-v-3d1a46c8>Place</button><button class="mobile-tool-btn mobile-tool-btn--red" data-v-3d1a46c8>Cancel</button></div></div>'):o("\x3c!----\x3e"),e.editingRoomMeshes&&e.locked&&e.isTouchDevice?o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto" data-v-3d1a46c8><div class="mobile-tool-bar" data-v-3d1a46c8><span class="mobile-tool-label text-amber-400" data-v-3d1a46c8>Mesh Editor</span><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn" data-v-3d1a46c8>âˆ’</button><button class="mobile-tool-btn" data-v-3d1a46c8>+</button><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn mobile-tool-btn--green" data-v-3d1a46c8>Done</button><button class="mobile-tool-btn mobile-tool-btn--red" data-v-3d1a46c8>Cancel</button></div></div>'):o("\x3c!----\x3e"),e.polygonToolActive&&e.locked&&e.isTouchDevice?o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto" data-v-3d1a46c8><div class="mobile-tool-bar" data-v-3d1a46c8><span class="mobile-tool-label text-cyan-400" data-v-3d1a46c8>Tracing...</span><div class="mobile-tool-sep" data-v-3d1a46c8></div><button class="mobile-tool-btn" data-v-3d1a46c8>Undo</button><button class="mobile-tool-btn mobile-tool-btn--red" data-v-3d1a46c8>Cancel</button></div></div>'):o("\x3c!----\x3e"),e.aimingAtKeypad&&e.keypadButtons.length>0&&e.locked&&e.isTouchDevice&&!e.showRadial?(o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 z-10 pointer-events-auto max-w-[95vw]" data-v-3d1a46c8><div class="mobile-tool-bar flex-wrap gap-1.5" data-v-3d1a46c8>\x3c!--[--\x3e'),N(e.keypadButtons,(e,t)=>{o(`<button class="${U(["confirm"===e.type?"mobile-tool-btn--green":"delete"===e.type||"clear"===e.type?"mobile-tool-btn--red":"","mobile-tool-btn"])}" data-v-3d1a46c8>${Z(e.label)}</button>`)}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),e.pttActive&&e.locked?o('<div class="absolute bottom-20 left-1/2 -translate-x-1/2 z-10" data-v-3d1a46c8><div class="hud-pill hud-pill--glow-teal" data-v-3d1a46c8><div class="w-2.5 h-2.5 rounded-full bg-teal-400 animate-pulse shadow-[0_0_8px_rgba(45,212,191,0.6)]" data-v-3d1a46c8></div><span class="text-teal-300 text-base font-black tracking-widest" data-v-3d1a46c8>TRANSMITTING</span></div></div>'):o("\x3c!----\x3e"),e.showHelp&&e.locked?(o('<div class="absolute inset-0 z-20 flex items-center justify-center pointer-events-none" data-v-3d1a46c8><div class="help-panel" data-v-3d1a46c8><h3 class="text-white font-black text-lg mb-4 text-center tracking-wide" data-v-3d1a46c8>CONTROLS</h3><div class="grid grid-cols-2 gap-x-8 gap-y-2" data-v-3d1a46c8><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>W A S D</kbd><span class="help-label" data-v-3d1a46c8>Move</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Mouse</kbd><span class="help-label" data-v-3d1a46c8>Look around</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Shift</kbd><span class="help-label" data-v-3d1a46c8>Sprint</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Ctrl</kbd><span class="help-label" data-v-3d1a46c8>Crouch</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Space</kbd><span class="help-label" data-v-3d1a46c8>Jump</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--glow-purple" data-v-3d1a46c8>Q / MMB</kbd><span class="help-label" data-v-3d1a46c8>Action wheel</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--glow-teal" data-v-3d1a46c8>E</kbd><span class="help-label" data-v-3d1a46c8>Toggle device</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--glow-teal" data-v-3d1a46c8>Tab</kbd><span class="help-label" data-v-3d1a46c8>Open inventory</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Click</kbd><span class="help-label" data-v-3d1a46c8>Place / Confirm</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Right Click</kbd><span class="help-label" data-v-3d1a46c8>Cancel</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>R / Scroll</kbd><span class="help-label" data-v-3d1a46c8>Rotate (placing)</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Ctrl+Scroll</kbd><span class="help-label" data-v-3d1a46c8>Scale object</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Ctrl+Z</kbd><span class="help-label" data-v-3d1a46c8>Undo</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--combo" data-v-3d1a46c8>Ctrl+Shift+Z</kbd><span class="help-label" data-v-3d1a46c8>Redo</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>Esc</kbd><span class="help-label" data-v-3d1a46c8>Release cursor</span></div>'),"ptt"===e.voiceMode?o('<div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--glow-teal" data-v-3d1a46c8>V</kbd><span class="help-label" data-v-3d1a46c8>Push to talk</span></div>'):o("\x3c!----\x3e"),o('<div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--glow-teal" data-v-3d1a46c8>O</kbd><span class="help-label" data-v-3d1a46c8>Options / Settings</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help" data-v-3d1a46c8>H</kbd><span class="help-label" data-v-3d1a46c8>Toggle this help</span></div></div>'),e.editMode?o(`<div class="mt-4 pt-3" style="${oe({"border-top":"1px solid rgba(251,191,36,0.2)"})}" data-v-3d1a46c8><h4 class="text-amber-400 font-black text-base mb-2.5 text-center tracking-wider" data-v-3d1a46c8>ADMIN CONTROLS</h4><div class="grid grid-cols-2 gap-x-8 gap-y-2" data-v-3d1a46c8><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>+ / -</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Sys default size</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>Numpad 4/6</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Sys Y rotation</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>Numpad 8/2</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Sys X rotation</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>Numpad 7/9</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Sys Z rotation</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>PgUp/Dn</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Adjust height</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>*</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Save spawn point</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>F3</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Perf monitor</span></div><div class="help-row" data-v-3d1a46c8><kbd class="keycap keycap--help keycap--amber" data-v-3d1a46c8>F4</kbd><span class="help-label text-amber-300/80" data-v-3d1a46c8>Wireframe</span></div></div></div>`):o("\x3c!----\x3e"),o('<p class="text-gray-500 text-base mt-4 text-center" data-v-3d1a46c8>Press <kbd class="keycap keycap--inline" data-v-3d1a46c8>H</kbd> to close</p></div></div>')):o("\x3c!----\x3e"),e.calibratingCharacter?o(`<div class="absolute bottom-24 left-1/2 -translate-x-1/2 z-40" data-v-3d1a46c8><div class="bg-black/85 backdrop-blur-md border border-teal-500/40 rounded-2xl px-6 py-4 text-center min-w-[400px] shadow-[0_0_30px_rgba(45,212,191,0.15)]" data-v-3d1a46c8><p class="text-teal-400 font-black text-base mb-3 tracking-wider" data-v-3d1a46c8>CHARACTER CALIBRATION â€” ${Z(v(kt)(e.calibratingCharacterFile))}</p><div class="grid grid-cols-3 gap-4" data-v-3d1a46c8><div data-v-3d1a46c8><p class="text-gray-400 text-base mb-0.5" data-v-3d1a46c8>Ctrl + Wheel</p><p class="text-white font-mono text-lg font-bold" data-v-3d1a46c8>${Z(e.characterCalibration.scaleMultiplier.toFixed(2))}x</p><p class="text-gray-500 text-base" data-v-3d1a46c8>Scale</p></div><div data-v-3d1a46c8><p class="text-gray-400 text-base mb-0.5" data-v-3d1a46c8>Shift + Wheel</p><p class="text-white font-mono text-lg font-bold" data-v-3d1a46c8>${Z(e.characterCalibration.yOffset>=0?"+":"")}${Z(e.characterCalibration.yOffset.toFixed(2))}m</p><p class="text-gray-500 text-base" data-v-3d1a46c8>Y Position</p></div><div data-v-3d1a46c8><p class="text-gray-400 text-base mb-0.5" data-v-3d1a46c8>Alt + Wheel</p><p class="text-white font-mono text-lg font-bold" data-v-3d1a46c8>${Z(e.characterCalibration.labelOffset>=0?"+":"")}${Z(e.characterCalibration.labelOffset.toFixed(2))}m</p><p class="text-gray-500 text-base" data-v-3d1a46c8>Label Height</p></div></div><div class="mt-3 flex items-center justify-center gap-3" data-v-3d1a46c8><button class="${U([e.calAppliedAll?"bg-green-500/20 border-green-500/50 text-green-400":"bg-teal-500/10 border-teal-500/30 text-teal-400 hover:bg-teal-500/20","px-4 py-2 rounded-xl text-base font-bold border transition-all hover:scale-[1.03]"])}" data-v-3d1a46c8>${Z(e.calAppliedAll?"Applied!":"Apply to all characters")}</button><button class="px-4 py-2 rounded-xl text-base font-bold border border-gray-500/30 text-gray-300 bg-gray-500/10 hover:bg-gray-500/20 transition-all hover:scale-[1.03]" data-v-3d1a46c8> Done </button></div><p class="text-gray-500 text-base mt-2" data-v-3d1a46c8>Auto-saves Â· Press Done to close</p></div></div>`):o("\x3c!----\x3e"),e.showScaleSaved?o('<div class="absolute top-16 left-1/2 -translate-x-1/2 z-20" data-v-3d1a46c8><div class="hud-toast hud-toast--emerald" data-v-3d1a46c8><p class="text-emerald-400 text-base font-bold" data-v-3d1a46c8>Scale saved</p></div></div>'):o("\x3c!----\x3e"),e.showRotationSaved?o('<div class="absolute top-16 left-1/2 -translate-x-1/2 z-20" data-v-3d1a46c8><div class="hud-toast hud-toast--amber" data-v-3d1a46c8><p class="text-amber-400 text-base font-bold" data-v-3d1a46c8>Default rotation saved</p></div></div>'):o("\x3c!----\x3e"),e.settingSpawn?o(`<div class="absolute top-16 left-1/2 -translate-x-1/2 z-20" data-v-3d1a46c8><div class="hud-toast hud-toast--amber" data-v-3d1a46c8><p class="text-amber-400 text-base font-bold" data-v-3d1a46c8>Walk to spawn position, ${Z(e.isTouchDevice?"tap Interact":"press E")} to confirm</p></div></div>`):o("\x3c!----\x3e"),e.showSpawnSaved?o('<div class="absolute top-16 left-1/2 -translate-x-1/2 z-20" data-v-3d1a46c8><div class="hud-toast hud-toast--cyan" data-v-3d1a46c8><p class="text-cyan-400 text-base font-bold" data-v-3d1a46c8>Spawn position saved</p></div></div>'):o("\x3c!----\x3e"),e.showEditSaved?o(`<div class="absolute top-24 left-1/2 -translate-x-1/2 z-20" data-v-3d1a46c8><div class="${U(["ok"===e.showEditSaved?"hud-toast--amber":"hud-toast--red","hud-toast"])}" data-v-3d1a46c8><p class="${U(["ok"===e.showEditSaved?"text-amber-400":"text-red-400","text-base font-bold"])}" data-v-3d1a46c8>${Z("ok"===e.showEditSaved?"System objects saved":"SAVE FAILED - check console")}</p></div></div>`):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")}}),Ho=No.setup;No.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dHud.vue"),Ho?Ho(e,t):void 0};const Go=Object.assign(Le(No,[["__scopeId","data-v-3d1a46c8"]]),{__name:"Room3dHud"}),Ko=e({__name:"Room3dRadialMenu",__ssrInlineRender:!0,props:{showRadial:{type:Boolean},radialHover:{},radialTargetName:{},radialOptions:{},isTouchDevice:{type:Boolean}},emits:["execute","cancel","update:radialHover"],setup(e,{emit:n}){const s=e,c=n,u=o({get:()=>s.radialHover,set:e=>c("update:radialHover",e)}),f=t(600),h=o(()=>s.isTouchDevice&&f.value<420);function d(e){const t=s.radialOptions.length,o=e/t*Math.PI*2-Math.PI/2;let n;if(h.value){const e=.26*f.value;n=Math.min(t<=4?100:110,e)}else if(s.isTouchDevice)n=t<=2?90:t<=4?100:t<=6?110:120;else{const e=Math.ceil(100*t/(2*Math.PI));n=Math.max(t<=2?140:t<=4?170:190,e)}return{x:Math.cos(o)*n,y:Math.sin(o)*n}}const x=o(()=>{if(h.value)return Math.min(280,.8*f.value);if(s.isTouchDevice)return 300;const e=s.radialOptions.length,t=Math.max(190,Math.ceil(100*e/(2*Math.PI)));return Math.max(460,2*t+140)}),S=o(()=>h.value?"w-[40px] h-[40px]":s.isTouchDevice?"w-[48px] h-[48px]":s.radialOptions.length>8?"w-[60px] h-[60px]":"w-[72px] h-[72px]"),$=o(()=>h.value?"w-4 h-4":s.isTouchDevice||s.radialOptions.length>8?"w-6 h-6":"w-8 h-8");return(t,o,n,s)=>{var c,f,M;e.showRadial?(o(`<div${F(p({class:"absolute inset-0 z-30 flex items-center justify-center"},s))}><div class="absolute inset-0"></div>`),v(h)?o("\x3c!----\x3e"):o(`<div class="absolute rounded-full pointer-events-none" style="${oe({width:`${v(x)+60}px`,height:`${v(x)+60}px`,background:"radial-gradient(circle, transparent 45%, rgba(20,184,166,0.06) 60%, transparent 75%)"})}"></div>`),o(`<div class="absolute rounded-full pointer-events-none" style="${oe({width:`${v(x)}px`,height:`${v(x)}px`,background:"radial-gradient(circle, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 55%, rgba(0,0,0,0.2) 70%, transparent 80%)",border:"1px solid rgba(255,255,255,0.06)"})}"></div>`),e.radialTargetName?o(`<div class="absolute flex flex-col items-center gap-1.5 pointer-events-none"><div class="w-3.5 h-3.5 rounded-full bg-cyan-400/70 shadow-lg shadow-cyan-400/30"></div><p class="text-base text-cyan-300 font-bold whitespace-nowrap drop-shadow-lg tracking-wide">${Z(e.radialTargetName)}</p></div>`):o(`<div class="w-5 h-5 rounded-full pointer-events-none" style="${oe({background:"radial-gradient(circle, rgba(255,255,255,0.25), rgba(255,255,255,0.05))",border:"2px solid rgba(255,255,255,0.2)","box-shadow":"0 0 12px rgba(255,255,255,0.1)"})}"></div>`),o("\x3c!--[--\x3e"),N(e.radialOptions,(t,s)=>{o(`<button class="absolute transition-all duration-150 ease-out cursor-pointer focus:outline-none" style="${oe({transform:`translate(${d(s).x}px, ${d(s).y}px) scale(${v(u)===s?1.12:1})`,zIndex:v(u)===s?10:1})}"><div class="flex flex-col items-center gap-1.5"><div class="${U([[v(S),v(u)===s?`${t.bg} shadow-xl shadow-current/40`:"bg-black/70 border-gray-600/40 hover:border-gray-500/60"],"rounded-2xl flex items-center justify-center border-2 transition-all duration-150"])}" style="${oe(v(u)===s?"backdrop-filter: blur(8px);":"backdrop-filter: blur(4px);")}">`),ne(o,g(b(t.icon),{class:[[v($),v(u)===s?t.color:"text-gray-200"],"transition-all duration-150"]},null),n),o("</div>"),e.isTouchDevice?o("\x3c!----\x3e"):o(`<span class="${U([v(u)===s?`${t.color} drop-shadow-lg`:"text-gray-200","font-bold whitespace-nowrap transition-all duration-150 tracking-wide text-base"])}" style="${oe(v(u)===s?"text-shadow: 0 0 12px currentColor;":"")}">${Z(t.label)}</span>`),o("</div></button>")}),o("\x3c!--]--\x3e"),e.isTouchDevice&&v(u)>=0&&v(u)<e.radialOptions.length?o(`<div class="absolute pointer-events-none" style="${oe({bottom:"-50px"})}"><div class="bg-black/80 backdrop-blur-sm rounded-lg px-3 py-1 border border-white/10"><span class="${U([null!=(f=null==(c=e.radialOptions[v(u)])?void 0:c.color)?f:"text-white","text-base font-bold whitespace-nowrap"])}">${Z(null==(M=e.radialOptions[v(u)])?void 0:M.label)}</span></div></div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e")}}}),Yo=Ko.setup;Ko.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dRadialMenu.vue"),Yo?Yo(e,t):void 0};const Zo=Object.assign(Ko,{__name:"Room3dRadialMenu"}),Qo=e({__name:"Room3dTouchOverlay",__ssrInlineRender:!0,props:{leftStick:{},rightStick:{},locked:{type:Boolean},isLandscape:{type:Boolean},placingAsset:{type:Boolean},leftHanded:{type:Boolean},voiceEnabled:{type:Boolean},voiceMode:{},pttActive:{type:Boolean},editMode:{type:Boolean},perfActive:{type:Boolean},rotatingObject:{type:Boolean}},emits:["open-radial","place","rotate-cw","cancel-place","ptt-start","ptt-end","toggle-perf","toggle-wireframe","rotation-confirm","rotation-cancel","sys-size-up","sys-size-down"],setup(e){const t=e,n=o(()=>t.leftHanded?t.rightStick:t.leftStick),s=o(()=>t.leftHanded?t.leftStick:t.rightStick);return(t,o,c,u)=>{o("\x3c!--[--\x3e"),e.isLandscape?o("\x3c!----\x3e"):o('<div class="absolute inset-0 z-50 bg-black/95 flex flex-col items-center justify-center gap-6" data-v-a55fa7d5><svg class="w-20 h-20 text-teal-400 animate-pulse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-a55fa7d5><rect x="6" y="3" width="12" height="18" rx="2" class="origin-center -rotate-90" data-v-a55fa7d5></rect><path d="M16.5 15.5l2-2m0 0l2 2m-2-2v5" stroke-linecap="round" stroke-linejoin="round" data-v-a55fa7d5></path></svg><p class="text-white text-xl font-bold" data-v-a55fa7d5>Rotate Your Device</p><p class="text-gray-400 text-base" data-v-a55fa7d5>Landscape mode required to play</p></div>'),e.locked&&e.isLandscape?(o('<div class="absolute inset-0 z-10 pointer-events-none touch-safe-area" data-v-a55fa7d5>'),v(n).active?o(`\x3c!--[--\x3e<div class="joystick-ring" style="${oe({transform:`translate3d(${v(n).cx-84}px, ${v(n).cy-84}px, 0)`})}" data-v-a55fa7d5><div class="w-[168px] h-[168px] rounded-full joystick-outer joystick-outer--move" data-v-a55fa7d5></div></div><div class="joystick-knob" style="${oe({transform:`translate3d(${v(n).cx+v(n).dx-28}px, ${v(n).cy+v(n).dy-28}px, 0)`})}" data-v-a55fa7d5><div class="w-[56px] h-[56px] rounded-full joystick-inner joystick-inner--move" data-v-a55fa7d5></div></div>\x3c!--]--\x3e`):o("\x3c!----\x3e"),v(s).active?o(`\x3c!--[--\x3e<div class="joystick-ring" style="${oe({transform:`translate3d(${v(s).cx-84}px, ${v(s).cy-84}px, 0)`})}" data-v-a55fa7d5><div class="w-[168px] h-[168px] rounded-full joystick-outer joystick-outer--cam" data-v-a55fa7d5></div></div><div class="joystick-knob" style="${oe({transform:`translate3d(${v(s).cx+v(s).dx-28}px, ${v(s).cy+v(s).dy-28}px, 0)`})}" data-v-a55fa7d5><div class="w-[56px] h-[56px] rounded-full joystick-inner joystick-inner--cam" data-v-a55fa7d5></div></div>\x3c!--]--\x3e`):o("\x3c!----\x3e"),o(`<div class="absolute bottom-6 pointer-events-auto" style="${oe(e.leftHanded?{right:"24px",paddingRight:"env(safe-area-inset-right, 0px)"}:{left:"24px",paddingLeft:"env(safe-area-inset-left, 0px)"})}" data-v-a55fa7d5><button class="touch-action-btn touch-action-btn--purple" data-v-a55fa7d5><svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-a55fa7d5><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" data-v-a55fa7d5></path></svg></button></div>`),e.voiceEnabled&&"ptt"===e.voiceMode?o(`<div class="absolute bottom-6 pointer-events-auto" style="${oe(e.leftHanded?{left:"24px",paddingLeft:"env(safe-area-inset-left, 0px)"}:{right:"24px",paddingRight:"env(safe-area-inset-right, 0px)"})}" data-v-a55fa7d5><button class="${U([e.pttActive?"touch-action-btn--teal-active":"touch-action-btn--teal","touch-action-btn"])}" data-v-a55fa7d5><svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-a55fa7d5><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5V22.5m-3.75-.75h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" data-v-a55fa7d5></path></svg></button></div>`):o("\x3c!----\x3e"),e.editMode?(o(`<div class="absolute top-16 left-3 pointer-events-auto flex flex-col gap-2" style="${oe({"padding-left":"env(safe-area-inset-left, 0px)"})}" data-v-a55fa7d5><button class="${U([e.perfActive?"touch-action-btn--amber-active":"touch-action-btn--amber","touch-action-btn"])}" data-v-a55fa7d5><span class="text-base font-bold leading-none" data-v-a55fa7d5>F3</span></button>`),e.perfActive?o('<button class="touch-action-btn touch-action-btn--amber" data-v-a55fa7d5><span class="text-base font-bold leading-none" data-v-a55fa7d5>F4</span></button>'):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),e.rotatingObject?o(`<div class="absolute pointer-events-auto flex flex-col gap-2.5" style="${oe([e.leftHanded?{left:"24px",paddingLeft:"env(safe-area-inset-left, 0px)"}:{right:"24px",paddingRight:"env(safe-area-inset-right, 0px)"},{bottom:"140px"}])}" data-v-a55fa7d5><button class="touch-action-btn touch-action-btn--green" data-v-a55fa7d5><svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-a55fa7d5><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" data-v-a55fa7d5></path></svg></button><button class="touch-action-btn touch-action-btn--red" data-v-a55fa7d5><svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-a55fa7d5><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-a55fa7d5></path></svg></button></div>`):o("\x3c!----\x3e"),e.placingAsset?(o('<div class="absolute bottom-6 left-1/2 -translate-x-1/2 pointer-events-auto" data-v-a55fa7d5><div class="flex items-center gap-2.5 bg-black/70 backdrop-blur-md rounded-2xl px-3 py-2 border border-gray-700/40 shadow-[0_4px_20px_rgba(0,0,0,0.5)]" data-v-a55fa7d5><button class="touch-place-btn touch-place-btn--confirm" data-v-a55fa7d5> Place </button><button class="touch-place-btn touch-place-btn--neutral" data-v-a55fa7d5> Rotate </button><button class="touch-place-btn touch-place-btn--cancel" data-v-a55fa7d5> Cancel </button>'),e.editMode?o('\x3c!--[--\x3e<div class="w-px h-6 bg-white/10 mx-1" data-v-a55fa7d5></div><button class="touch-place-btn touch-place-btn--amber" data-v-a55fa7d5>Size+</button><button class="touch-place-btn touch-place-btn--amber" data-v-a55fa7d5>Size-</button>\x3c!--]--\x3e'):o("\x3c!----\x3e"),o('<span class="text-gray-400 text-base ml-1 italic" data-v-a55fa7d5>Pinch to scale</span></div></div>')):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")}}}),Xo=Qo.setup;Qo.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dTouchOverlay.vue"),Xo?Xo(e,t):void 0};const en=Object.assign(Le(Qo,[["__scopeId","data-v-a55fa7d5"]]),{__name:"Room3dTouchOverlay"}),an={mouseSensitivity:1,touchSensitivity:1.4,invertY:!1,leftHanded:!1,fov:75,shadowQuality:"low",debugOverlay:"simple",contactShadows:"low",bloom:!1,bloomIntensity:.3,bloomThreshold:.95,lensflare:!0,dustParticles:!0,dustParticleCount:1e3,sfxVolume:.7,ambientVolume:.5,musicVolume:.3,gridSnap:!1,gridSize:.5},on=O({...an});function vb(){try{localStorage.setItem("room3d_settings",JSON.stringify(on))}catch{}}function tn(e,t,o){return Math.max(t,Math.min(o,e))}let nn=null;function jt(){nn&&clearTimeout(nn),nn=setTimeout(vb,300)}function h0(){return{settings:on,setMouseSensitivity(e){on.mouseSensitivity=tn(e,.3,3),jt()},setTouchSensitivity(e){on.touchSensitivity=tn(e,.3,3),jt()},setInvertY(e){on.invertY=e,jt()},setLeftHanded(e){on.leftHanded=e,jt()},setFov(e){on.fov=tn(e,60,120),jt()},setShadowQuality(e){on.shadowQuality=e,jt()},setDebugOverlay(e){on.debugOverlay=e,jt()},setContactShadows(e){on.contactShadows=e,jt()},setBloom(e){on.bloom=e,jt()},setBloomIntensity(e){on.bloomIntensity=tn(e,0,1),jt()},setBloomThreshold(e){on.bloomThreshold=tn(e,.7,1),jt()},setLensflare(e){on.lensflare=e,jt()},setDustParticles(e){on.dustParticles=e,jt()},setDustParticleCount(e){on.dustParticleCount=tn(e,500,2e3),jt()},setSfxVolume(e){on.sfxVolume=tn(e,0,1),jt()},setAmbientVolume(e){on.ambientVolume=tn(e,0,1),jt()},setMusicVolume(e){on.musicVolume=tn(e,0,1),jt()},setGridSnap(e){on.gridSnap=e,jt()},setGridSize(e){(.25===e||.5===e||1===e)&&(on.gridSize=e,jt())},resetDefaults(){Object.assign(on,an),vb()}}}const ln=e({__name:"Room3dSettings",__ssrInlineRender:!0,props:{show:{type:Boolean},voiceEnabled:{type:Boolean},voiceMode:{},localMuted:{type:Boolean},localSpeaking:{type:Boolean},masterVolume:{},spatialEnabled:{type:Boolean},autoJoin:{type:Boolean},voiceDebug:{type:Boolean}},emits:["close","connect-voice","toggle-mute","set-mode","set-volume","set-spatial","set-auto-join","debug-overlay-change","toggle-voice-debug"],setup(e){const o=h0().settings,n=t("controls");function l(e,t,o){return(e-t)/(o-t)*100+"%"}return(t,s,c,u)=>{e.show?(s(`<div${F(p({class:"absolute inset-0 z-40 flex items-center justify-center"},u))} data-v-8b3f3308><div class="absolute inset-0 bg-black/40" data-v-8b3f3308></div><div class="relative bg-gray-900/95 backdrop-blur-xl rounded-2xl border border-gray-700/50 shadow-2xl w-full max-w-[440px] mx-4 max-h-[85vh] overflow-hidden flex flex-col" data-v-8b3f3308><div class="flex items-center justify-between px-5 py-3.5 border-b border-gray-800/50 shrink-0" data-v-8b3f3308><div class="flex items-center gap-2.5" data-v-8b3f3308><div class="w-8 h-8 rounded-lg bg-gray-700/40 flex items-center justify-center" data-v-8b3f3308><svg class="w-4.5 h-4.5 text-gray-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" data-v-8b3f3308></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" data-v-8b3f3308></path></svg></div><h3 class="text-white font-bold text-base" data-v-8b3f3308>Settings</h3></div><button class="w-7 h-7 rounded-lg bg-gray-800/50 hover:bg-gray-700/50 flex items-center justify-center transition-colors" data-v-8b3f3308>`),s(_(v(de),{class:"w-4 h-4 text-gray-400"},null,c)),s(`</button></div><div class="flex shrink-0 border-b border-gray-800/50" data-v-8b3f3308><button class="${U(["controls"===v(n)?"text-teal-400 border-teal-400":"text-gray-500 border-transparent hover:text-gray-300","flex-1 flex items-center justify-center gap-1.5 py-2.5 text-base font-medium transition-all border-b-2"])}" data-v-8b3f3308><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" data-v-8b3f3308></path></svg> Controls </button><button class="${U(["graphics"===v(n)?"text-teal-400 border-teal-400":"text-gray-500 border-transparent hover:text-gray-300","flex-1 flex items-center justify-center gap-1.5 py-2.5 text-base font-medium transition-all border-b-2"])}" data-v-8b3f3308><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42" data-v-8b3f3308></path></svg> Graphics </button><button class="${U(["audio"===v(n)?"text-teal-400 border-teal-400":"text-gray-500 border-transparent hover:text-gray-300","flex-1 flex items-center justify-center gap-1.5 py-2.5 text-base font-medium transition-all border-b-2"])}" data-v-8b3f3308><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" data-v-8b3f3308></path></svg> Audio </button><button class="${U(["voice"===v(n)?"text-teal-400 border-teal-400":"text-gray-500 border-transparent hover:text-gray-300","flex-1 flex items-center justify-center gap-1.5 py-2.5 text-base font-medium transition-all border-b-2"])}" data-v-8b3f3308><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5V22.5m-3.75-.75h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" data-v-8b3f3308></path></svg> Voice </button></div><div class="overflow-y-auto flex-1 min-h-0" data-v-8b3f3308><div class="px-5 py-4 space-y-5" style="${oe("controls"===v(n)?null:{display:"none"})}" data-v-8b3f3308><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Mouse Sensitivity</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(Math.round(100*v(o).mouseSensitivity))}%</span></div><input type="range" min="30" max="300" step="5"${J("value",Math.round(100*v(o).mouseSensitivity))} class="settings-slider" style="${oe({"--pct":l(100*v(o).mouseSensitivity,30,300)})}" data-v-8b3f3308></div><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Touch Sensitivity</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(Math.round(100*v(o).touchSensitivity))}%</span></div><input type="range" min="30" max="300" step="5"${J("value",Math.round(100*v(o).touchSensitivity))} class="settings-slider" style="${oe({"--pct":l(100*v(o).touchSensitivity,30,300)})}" data-v-8b3f3308></div><div class="flex items-center justify-between" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>Invert Y-Axis</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Vertical look direction (touch)</p></div><button class="${U([v(o).invertY?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([v(o).invertY?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div><div class="flex items-center justify-between" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>Left-Handed Mode</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Swap joystick sides</p></div><button class="${U([v(o).leftHanded?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([v(o).leftHanded?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div><div class="pt-2 border-t border-gray-800/30" data-v-8b3f3308><button class="text-gray-500 text-base hover:text-gray-300 transition-colors font-medium" data-v-8b3f3308> Reset to defaults </button></div></div><div class="px-5 py-4 space-y-5" style="${oe("graphics"===v(n)?null:{display:"none"})}" data-v-8b3f3308><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Field of View</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(v(o).fov)}Â°</span></div><input type="range" min="60" max="120" step="5"${J("value",v(o).fov)} class="settings-slider" style="${oe({"--pct":l(v(o).fov,60,120)})}" data-v-8b3f3308></div><div data-v-8b3f3308><label class="text-gray-400 text-base font-medium mb-2 block" data-v-8b3f3308>Shadow Quality</label><div class="grid grid-cols-3 gap-2" data-v-8b3f3308>\x3c!--[--\x3e`),N(["off","low","high"],e=>{s(`<button class="${U([v(o).shadowQuality===e?"bg-teal-500/20 border-teal-500/50 text-teal-400":"bg-gray-800/50 border-gray-700/30 text-gray-400 hover:border-gray-600/50","px-3 py-2 rounded-xl border text-base font-medium transition-all capitalize"])}" data-v-8b3f3308>${Z(e)}</button>`)}),s('\x3c!--]--\x3e</div></div><div data-v-8b3f3308><label class="text-gray-400 text-base font-medium mb-2 block" data-v-8b3f3308>Debug Overlay</label><div class="grid grid-cols-3 gap-2" data-v-8b3f3308>\x3c!--[--\x3e'),N(["off","simple","full"],e=>{s(`<button class="${U([v(o).debugOverlay===e?"bg-teal-500/20 border-teal-500/50 text-teal-400":"bg-gray-800/50 border-gray-700/30 text-gray-400 hover:border-gray-600/50","px-3 py-2 rounded-xl border text-base font-medium transition-all capitalize"])}" data-v-8b3f3308>${Z("simple"===e?"FPS":e)}</button>`)}),s(`\x3c!--]--\x3e</div></div><div class="flex items-center justify-between" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>Grid Snap</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Align objects to grid when placing</p></div><button class="${U([v(o).gridSnap?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([v(o).gridSnap?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div>`),v(o).gridSnap?(s('<div data-v-8b3f3308><label class="text-gray-400 text-base font-medium mb-2 block" data-v-8b3f3308>Grid Size</label><div class="grid grid-cols-3 gap-2" data-v-8b3f3308>\x3c!--[--\x3e'),N([.25,.5,1],e=>{s(`<button class="${U([v(o).gridSize===e?"bg-teal-500/20 border-teal-500/50 text-teal-400":"bg-gray-800/50 border-gray-700/30 text-gray-400 hover:border-gray-600/50","px-3 py-2 rounded-xl border text-base font-medium transition-all"])}" data-v-8b3f3308>${Z(e)}m </button>`)}),s("\x3c!--]--\x3e</div></div>")):s("\x3c!----\x3e"),s(`</div><div class="px-5 py-4 space-y-5" style="${oe("audio"===v(n)?null:{display:"none"})}" data-v-8b3f3308><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Sound Effects</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(Math.round(100*v(o).sfxVolume))}%</span></div><input type="range" min="0" max="100" step="5"${J("value",Math.round(100*v(o).sfxVolume))} class="settings-slider" style="${oe({"--pct":l(100*v(o).sfxVolume,0,100)})}" data-v-8b3f3308></div><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Ambient</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(Math.round(100*v(o).ambientVolume))}%</span></div><input type="range" min="0" max="100" step="5"${J("value",Math.round(100*v(o).ambientVolume))} class="settings-slider" style="${oe({"--pct":l(100*v(o).ambientVolume,0,100)})}" data-v-8b3f3308></div><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Music</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(Math.round(100*v(o).musicVolume))}%</span></div><input type="range" min="0" max="100" step="5"${J("value",Math.round(100*v(o).musicVolume))} class="settings-slider" style="${oe({"--pct":l(100*v(o).musicVolume,0,100)})}" data-v-8b3f3308></div><div class="flex items-center justify-between pt-2 border-t border-gray-800/30" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>Voice Debug</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Show voice diagnostics overlay</p></div><button class="${U([e.voiceDebug?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([e.voiceDebug?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div></div><div class="px-5 py-4 space-y-5" style="${oe("voice"===v(n)?null:{display:"none"})}" data-v-8b3f3308><div class="flex items-center justify-between" data-v-8b3f3308><div class="flex items-center gap-2" data-v-8b3f3308><div class="${U([e.voiceEnabled?"bg-teal-400":"bg-gray-600","w-2 h-2 rounded-full"])}" data-v-8b3f3308></div><span class="${U([e.voiceEnabled?"text-teal-400":"text-gray-500","text-base"])}" data-v-8b3f3308>${Z(e.voiceEnabled?"Connected":"Disconnected")}</span></div>`),e.voiceEnabled?s("\x3c!----\x3e"):s('<button class="px-3 py-1.5 rounded-lg bg-teal-500/20 border border-teal-500/50 text-teal-400 text-base font-medium hover:bg-teal-500/30 transition-colors" data-v-8b3f3308> Connect </button>'),s(`</div><div data-v-8b3f3308><label class="text-gray-400 text-base font-medium mb-2 block" data-v-8b3f3308>Microphone</label><button class="${U([e.localMuted?"bg-red-500/10 border-red-500/30 hover:bg-red-500/20":"bg-teal-500/10 border-teal-500/30 hover:bg-teal-500/20","w-full flex items-center justify-between px-4 py-2.5 rounded-xl border transition-all"])}" data-v-8b3f3308><div class="flex items-center gap-2.5" data-v-8b3f3308>`),e.localMuted?s('<svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M19 19L5 5m14 0l-3.5 3.5M12 18.75a6 6 0 01-5.82-4.55M12 18.75V21m0-2.25a6 6 0 005.82-4.55M12 2.25a3 3 0 00-3 3v4.5m0 0L5.25 5.25" data-v-8b3f3308></path></svg>'):s('<svg class="w-5 h-5 text-teal-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-8b3f3308><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5V22.5m-3.75-.75h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" data-v-8b3f3308></path></svg>'),s(`<span class="${U([e.localMuted?"text-red-400":"text-teal-400","text-base font-medium"])}" data-v-8b3f3308>${Z(e.localMuted?"Muted":"Active")}</span></div><span class="text-base text-gray-500" data-v-8b3f3308>${Z(e.localMuted?"Click to unmute":"Click to mute")}</span></button></div><div data-v-8b3f3308><label class="text-gray-400 text-base font-medium mb-2 block" data-v-8b3f3308>Voice Mode</label><div class="grid grid-cols-2 gap-2" data-v-8b3f3308><button class="${U(["ptt"===e.voiceMode?"bg-teal-500/20 border-teal-500/50 text-teal-400":"bg-gray-800/50 border-gray-700/30 text-gray-400 hover:border-gray-600/50","px-4 py-2.5 rounded-xl border text-base font-medium transition-all"])}" data-v-8b3f3308> Push to Talk <p class="text-gray-500 text-base opacity-60 mt-0.5" data-v-8b3f3308>Hold V to speak</p></button><button class="${U(["vad"===e.voiceMode?"bg-green-500/20 border-green-500/50 text-green-400":"bg-gray-800/50 border-gray-700/30 text-gray-400 hover:border-gray-600/50","px-4 py-2.5 rounded-xl border text-base font-medium transition-all"])}" data-v-8b3f3308> Voice Activated <p class="text-gray-500 text-base opacity-60 mt-0.5" data-v-8b3f3308>Auto-detect speech</p></button></div></div><div data-v-8b3f3308><div class="flex items-center justify-between mb-2" data-v-8b3f3308><label class="text-gray-400 text-base font-medium" data-v-8b3f3308>Voice Volume</label><span class="text-teal-400 text-base font-mono" data-v-8b3f3308>${Z(e.masterVolume)}%</span></div><input type="range" min="0" max="100"${J("value",e.masterVolume)} class="settings-slider" style="${oe({"--pct":e.masterVolume+"%"})}" data-v-8b3f3308></div><div class="flex items-center justify-between" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>3D Spatial Audio</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Volume based on distance</p></div><button class="${U([e.spatialEnabled?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([e.spatialEnabled?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div><div class="flex items-center justify-between" data-v-8b3f3308><div data-v-8b3f3308><p class="text-gray-300 text-base font-medium" data-v-8b3f3308>Auto-Join Voice</p><p class="text-gray-500 text-base opacity-60" data-v-8b3f3308>Connect when entering room</p></div><button class="${U([e.autoJoin?"bg-teal-500":"bg-gray-600","w-11 h-6 rounded-full transition-all relative shrink-0"])}" data-v-8b3f3308><div class="${U([e.autoJoin?"left-[22px]":"left-0.5","w-4.5 h-4.5 bg-white rounded-full absolute top-0.5 transition-all shadow-sm"])}" data-v-8b3f3308></div></button></div></div></div><div class="px-5 py-2.5 border-t border-gray-800/30 shrink-0" data-v-8b3f3308><p class="text-gray-600 text-base text-center" data-v-8b3f3308>Esc or tap outside to close</p></div></div></div>`)):s("\x3c!----\x3e")}}}),sn=ln.setup;ln.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dSettings.vue"),sn?sn(e,t):void 0};const rn=Object.assign(Le(ln,[["__scopeId","data-v-8b3f3308"]]),{__name:"Room3dSettings"}),dn=new Map,cn=[],un=new Map;let pn=null;function m1(e){pn=e}let vn=null;function y1(e){vn=e}function h1(e,t){const o=e.split("/").pop()||e;un.set(o,t)}function Dc(e){var t;const o=e.split("/").pop()||e;return null==(t=un.get(o))||t}function x1(e){un.clear();for(const[t,o]of Object.entries(e))un.set(t,o.onIsEnd)}const fn=new Ue.Raycaster,gn=new Ue.Vector2(0,0);function gb(e){if("procedural://grow-tent"===e)return"toggle";if(pn){const t=e.split("/").pop()||e,o=pn(t);if("static"===o.animType)return null;if("toggle"===o.animType)return"toggle";if("loop"===o.animType)return"loop"}return e.includes("/animated/")?e.includes("/animated/switches/")?"toggle":"loop":null}function pb(e){if(pn){const t=e.split("/").pop()||e,o=pn(t);if("pingpong"===o.loopMode)return"pingpong";if("continuous"===o.loopMode)return"continuous"}return"continuous"}function bb(e){if(pn){const t=e.split("/").pop()||e,o=pn(t);if(null!=o.defaultToggleState)return o.defaultToggleState}return!1}function Yi(e,t,o){let n=null==o?void 0:o.animRange,s=null==o?void 0:o.animRangeStart,c=null==o?void 0:o.animRangeEnd;if(!n&&pn){const t=e.split("/").pop()||e,o=pn(t);n=o.animRange,s=o.animRangeStart,c=o.animRangeEnd}if(!n||"full"===n)return[0,t];if("half"===n)return[0,.5*t];const u=(null!=s?s:0)*t,p=(null!=c?c:1)*t;return[Math.min(u,p),Math.max(u,p)]}function k1(e,t){t.length>0&&dn.set(e,t)}function C1(e){return function(e){let t=!1;return e.traverse(e=>{e.isSkinnedMesh&&(t=!0)}),t}(e)?ea.clone(e):e.clone(!0)}function T1(e,t,o,n){const s=gb(t);if(!s)return;const c=dn.get(t);if(!c||0===c.length)return;const u=new Ue.AnimationMixer(e),p=c[0],v=u.clipAction(p),[f,g]=Yi(t,p.duration,n);if("toggle"===s){v.setLoop(Ue.LoopOnce,1),v.clampWhenFinished=!0;const e=null!=o?o:bb(t);(Dc(t)?e:!e)?(v.reset(),v.timeScale=1,v.time=g,v.play(),v.paused=!0):(v.reset(),v.timeScale=1,v.time=f,v.play(),v.paused=!0)}else{const e=pb(t);v.setLoop("pingpong"===e?Ue.LoopPingPong:Ue.LoopRepeat,1/0),v.reset(),v.time=f,v.play()}u.update(0),cn.push({group:e,mixer:u,action:v,type:s,toggleState:null!=o&&o,assetFile:t,rangeOverride:n})}function M1(e){const t=cn.findIndex(t=>t.group===e);if(t<0)return;const o=cn[t];o.action.stop(),o.mixer.stopAllAction(),o.mixer.uncacheRoot(e),cn.splice(t,1)}const mn=new Ue.Frustum,hn=new Ue.Matrix4,xn=new Ue.Vector3;let yn=0;function P1(e){yn++;const t=Vt();let o=!1;t&&(hn.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),mn.setFromProjectionMatrix(hn),o=!0);const n=Ye||1,s=(8*n)**2,c=(20*n)**2,u=(40*n)**2;for(const n of cn)if("toggle"!==n.type||!n.action.paused){if(("toggle"!==n.type||n.action.paused)&&t&&o){n.group.getWorldPosition(xn);const e=t.position.distanceToSquared(xn);if(mn.containsPoint(xn)){if(e>u)continue;if(e>c){if(yn%4!=0)continue}else if(e>s&&yn%2!=0)continue}else if(yn%8!=0)continue}if(n.mixer.update(e),"toggle"===n.type&&!n.action.paused){const e=n.action.getClip(),[t,o]=Yi(n.assetFile,e.duration,n.rangeOverride);(o<e.duration||t>0)&&(n.action.timeScale>0&&n.action.time>=o?(n.action.time=o,n.action.paused=!0,null==vn||vn(n.group,n.toggleState)):n.action.timeScale<0&&n.action.time<=t&&(n.action.time=t,n.action.paused=!0,null==vn||vn(n.group,n.toggleState)))}if("loop"===n.type&&!n.action.paused){const e=n.action.getClip(),[t,o]=Yi(n.assetFile,e.duration,n.rangeOverride);(o<e.duration||t>0)&&(n.action.time>=o||n.action.time<t)&&(n.action.time=t)}}}function Rg(e){let t=e;for(;t;){if(t.userData.placed)return t;t=t.parent}return null}function D1(e){const t=Vt();if(!t)return null;fn.setFromCamera(gn,t),fn.far=e;const o=it.filter(e=>null!==Rg(e));if(0===o.length)return null;const n=fn.intersectObjects(o,!1);if(0===n.length)return null;const s=n[0];if(!s)return null;const c=Rg(s.object);if(!c)return null;const u=cn.find(e=>e.group===c);if(!u)return null;if("toggle"===u.type)mb(u);else{if("loop"!==u.type)return null;u.action.paused=!u.action.paused}return c}function mb(e){const{action:t}=e,o=t.getClip(),[n,s]=Yi(e.assetFile,o.duration,e.rangeOverride);e.toggleState=!e.toggleState,(Dc(e.assetFile)?e.toggleState:!e.toggleState)?(t.reset(),t.clampWhenFinished=!0,t.setLoop(Ue.LoopOnce,1),t.timeScale=1,t.time=n,t.play()):(t.reset(),t.clampWhenFinished=!0,t.setLoop(Ue.LoopOnce,1),t.time=s,t.timeScale=-1,t.play())}function R1(e){const t=cn.find(t=>t.group===e);if(t){if("toggle"===t.type)return t.toggleState;if("loop"===t.type)return!t.action.paused}}function O1(e,t){const o=cn.find(t=>t.group===e);!o||"toggle"!==o.type||(o.toggleState=t)}function z1(e,t){const o=cn.find(t=>t.group===e);if(o)if("toggle"===o.type){if(o.toggleState===t)return;mb(o)}else if("loop"===o.type){if(!o.action.paused===t)return;o.action.paused=!t}}function I1(e,t){const o=cn.find(t=>t.group===e);if(o&&(o.rangeOverride=t,"toggle"===o.type)){const e=o.action.getClip(),[n,s]=Yi(o.assetFile,e.duration,t),c=Dc(o.assetFile)?o.toggleState:!o.toggleState;o.action.time=c?s:n,o.action.paused=!0}}function F1(e){var t;return null==(t=cn.find(t=>t.group===e))?void 0:t.rangeOverride}function E1(e){var t;return null!=(t=dn.get(e))?t:null}function L1(){for(const e of cn)e.action.stop(),e.mixer.stopAllAction(),e.mixer.uncacheRoot(e.group);cn.length=0,dn.clear()}function is(){return{isAnimatedAsset:gb,getLoopMode:pb,getDefaultToggleState:bb,setGetAssetMetaCallback:m1,cacheAnimationClips:k1,getCachedClips:E1,setAnimOnIsEnd:h1,getAnimOnIsEnd:Dc,loadAnimMetaBulk:x1,getAnimRange:Yi,updateInstanceRange:I1,getInstanceRange:F1,cloneTemplate:C1,attachAnimation:T1,detachAnimation:M1,updateAnimations:P1,tryToggleAt:D1,getToggleState:R1,setToggleStateSilent:O1,remoteToggle:z1,setOnToggleCompleteCallback:y1,disposeAll:L1}}const wn="room3d-meshopt",kn="simplified";let Sn=!1,Cn=!1,$n=0,Mn=0,Tn=null;async function yb(){if(!Sn){try{await oa.ready,Sn=!0}catch{}!function(){if(!(Tn||typeof indexedDB>"u"))try{const e=indexedDB.open(wn,1);e.onupgradeneeded=()=>{const t=e.result;t.objectStoreNames.contains(kn)||t.createObjectStore(kn,{keyPath:"key"})},e.onsuccess=()=>{Tn=e.result},e.onerror=()=>{}}catch{}}()}}function q1(e){Cn=e}function Rc(e){return e.index?e.index.count/3:e.attributes.position?e.attributes.position.count/3:0}function hb(e,t,o=.02){if(!Sn||!e.attributes.position)return e;const n=function(e){if(e.index)return e;try{const t=aa(e,1e-4);if(t.index)return t}catch{}return e}(e);if(!n.index)return e;const s=n.attributes.position.array,c=new Uint32Array(n.index.array),u=Math.max(Math.floor(c.length*t),12);try{const[t]=oa.simplify(c,s,3,u,o);if(t.length>=.95*c.length)return e;const p=n!==e?n:e.clone();return p.setIndex(new Ue.BufferAttribute(t,1)),p}catch{return e}}async function e5(e,t){const o=await async function(e){return Tn?new Promise(t=>{try{const o=Tn.transaction(kn,"readonly").objectStore(kn).get(e);o.onsuccess=()=>{const e=o.result;e&&Date.now()-e.ts<2592e6?t(e):t(null)},o.onerror=()=>t(null)}catch{t(null)}}):null}(t);if(!o||0===o.meshes.length)return!1;const n=new Map;for(const e of o.meshes)n.set(e.idx,e);let s=0,c=0;for(const t of e){const e=n.get(t.idx);if(!e)continue;if(e.origVerts!==t.verts||e.origTris!==t.tris)return!1;const o=new Uint32Array(e.indices),u=t.mesh.geometry,p=u.clone();p.setIndex(new Ue.BufferAttribute(o,1)),t.mesh.geometry=p,t.mesh.userData._preOptGeo=u;const v=Rc(p);c+=t.tris-v,s++}return s>0&&($n+=s,Mn+=c),!0}async function xb(e,t,o){if(Sn||await yb(),!Sn)return;const n=o?Cn?15e3:5e4:Cn?8e3:25e3,s=o?Cn?1e5:3e5:Cn?2e4:6e4,c=function(e){const t=[];let o=0;return e.traverse(e=>{if(e.isMesh&&e.geometry&&e.geometry.attributes.position){const n=e.geometry;t.push({mesh:e,idx:o++,tris:Rc(n),verts:n.attributes.position.count})}}),t}(e);if(0===c.length)return;const u=c.reduce((e,t)=>e+t.tris,0);t.split("/").pop();for(const e of c)e.tris;const p=c.some(e=>e.tris>n),v=u>s;if(!p&&!v)return;const f=function(e){return`${Cn?"m":"d"}:${e}`}(t);if(await e5(c,f))return;const g=v?s/u:1;let b=0,h=0;const x=[];for(const e of c){let t=e.tris>n?n/e.tris:1;if(t=Math.min(t,g),t>=.9)continue;const o=e.mesh.geometry;if(e.mesh.geometry=hb(o,t),e.mesh.geometry!==o){const t=Rc(e.mesh.geometry);h+=e.tris-t,b++,e.mesh.userData._preOptGeo=o,e.mesh.geometry.index&&x.push({idx:e.idx,origTris:e.tris,origVerts:e.verts,indices:e.mesh.geometry.index.array.buffer.slice(0)})}}x.length>0&&function(e,t){if(Tn&&0!==t.length)try{Tn.transaction(kn,"readwrite").objectStore(kn).put({key:e,meshes:t,ts:Date.now()})}catch{}}(f,x),b>0&&($n+=b,Mn+=h)}async function t5(e,t){await xb(e,t||"asset",!1)}async function a5(e,t){await xb(e,t||"room",!0)}function o5(){return{ready:Sn,isMobile:Cn,totalSimplified:$n,totalTrisRemoved:Mn}}function n5(e){return e.userData._preOptGeo||e.geometry}function Oc(){return{init:yb,setMobile:q1,processAssetTemplate:t5,processRoomEnvironment:a5,simplifyGeometry:hb,getTriCount:Rc,getOriginalGeometry:n5,getStats:o5}}const Vn=is(),An=Oc();let Pn=null;function l5(e){Pn=e}let zn=null;function i5(e){zn=e}let Dn=null;function s5(e){Dn=e}let On=null;function r5(e){On=e}let Rn=null;function d5(e){Rn=e}let In=null;function c5(e){In=e}let jn=null;function u5(e){jn=e}let Fn=null;function f5(e){Fn=e}let Ln=null;function v5(e){Ln=e}const Bn=t([]),En=new Set;let Un=!1;function g5(){Un=!1}const Wn=t({}),Nn=t(!1),Hn=t({}),Gn=t({}),qn=t(!1),Kn=t({}),Yn=t(!1),Jn=t({}),Xn=t(!1),tl=t({}),al=t(!1),ol=t({}),nl=t(!1),ll=t({}),il=t({}),dl=t({}),cl=t(!1),ul=t([]),pl=t(0);let vl=null,fl=null,bl=null;function kb(e){if(e.behavior)return e;if(e.deviceBinding){const t=e.deviceBinding;if(e.behavior={type:"switch",config:{mode:"toggle",interactRange:3,interactPrompt:"",deviceType:t.deviceType,deviceId:t.deviceId,invertAnimation:t.invertAnimation,isDecorative:t.isDecorative,configLocked:t.configLocked,sceneObjectId:t.sceneObjectId,envLightIds:t.envLightIds,doorIds:t.doorIds,presetTriggers:t.presetTriggers}},t.ambientLightStates){const o=Object.keys(t.ambientLightStates.onState||{}).filter(e=>t.ambientLightStates.onState[e]);o.length>0&&(e.components=e.components||[],e.components.push({type:"light",id:"legacy-light",config:{envLightIds:o,defaultState:"off"}}))}}else e.doorTarget?e.behavior={type:"door",config:{doorType:"both",targetRoomId:e.doorTarget.envId,targetSpawnKey:e.doorTarget.spawnKey||"",autoClose:!1,autoCloseDelay:3e3,disableCollisionWhenOpen:!0,travelAfterAnimation:!0,travelDelay:500,requiresUnlock:!!e.keypadLock,lockKeypadId:e.keypadLock,lockMode:e.keypadLockMode||"everyone"}}:e.keypadData&&(e.behavior={type:"keypad",config:{keypadData:e.keypadData}});return e}function Sb(e){var t;if(e.behavior)return e;const o=e.assetFile.split("/").pop()||e.assetFile,n=dl.value[o];return n&&(n.behaviorDefaults&&(e.behavior={type:n.behaviorDefaults.type,config:{...n.behaviorDefaults.config}}),(null==(t=n.componentDefaults)?void 0:t.length)&&(e.components=e.components||[],e.components.push(...n.componentDefaults.map(e=>({...e,config:{...e.config}}))))),e}function b5(e){var t,o,n,s,c;const u=null!=(t=null==Dn?void 0:Dn.value)&&t;if(!Je.value&&u||!e||!Un)return;const p=e,{getAuthHeaders:v}=Gt();if(Je.value){const e=Ne.map(e=>{var t,o,n,s,c;const u=Vn.getToggleState(e.group);return{id:e.systemId||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),assetFile:e.assetFile,position:{x:He(e.group.position.x),y:He(e.group.position.y),z:He(e.group.position.z)},quaternion:{x:He(e.group.quaternion.x),y:He(e.group.quaternion.y),z:He(e.group.quaternion.z),w:He(e.group.quaternion.w)},scale:He(e.group.scale.x),name:e.name,locked:null!=(t=e.locked)&&t,...e.tvConfig&&{tvConfig:e.tvConfig},...null!=u&&{toggleState:u},...e.deviceBinding&&{deviceBinding:e.deviceBinding},...e.doorTarget&&{doorTarget:e.doorTarget},...e.animRange&&"full"!==e.animRange&&{animRange:e.animRange},...null!=e.animRangeStart&&{animRangeStart:e.animRangeStart},...null!=e.animRangeEnd&&{animRangeEnd:e.animRangeEnd},...e.keypadData&&{keypadData:e.keypadData},...(null==(o=e.textPanels)?void 0:o.length)&&{textPanels:e.textPanels},...e.keypadLock&&{keypadLock:e.keypadLock},...e.keypadLockMode&&{keypadLockMode:e.keypadLockMode},...e.behavior&&{behavior:e.behavior},...(null==(n=e.components)?void 0:n.length)&&{components:e.components},...(null==(s=e.bindings)?void 0:s.length)&&{bindings:e.bindings},...e.properties&&Object.keys(e.properties).length>0&&{properties:e.properties},...(null==(c=e.tags)?void 0:c.length)&&{tags:e.tags},...!1===e.collisionEnabled&&{collisionEnabled:!1}}});for(let t=0;t<Ne.length;t++)Ne[t].systemId||(Ne[t].systemId=e[t].id);Bn.value=e,$fetch("/api/room3d/room-objects",{method:"POST",body:{roomId:p,objects:e},headers:v()}).then(()=>{cl.value="ok",setTimeout(()=>{cl.value=!1},2e3)}).catch(e=>{cl.value="err",setTimeout(()=>{cl.value=!1},5e3)})}else{const e=[],t={};for(const u of Ne)if(u.systemId){const e=Bn.value.find(e=>e.id===u.systemId);if(!e)continue;const o={};let n=!1;e.locked||((He(u.group.position.x)!==e.position.x||He(u.group.position.y)!==e.position.y||He(u.group.position.z)!==e.position.z)&&(o.position={x:He(u.group.position.x),y:He(u.group.position.y),z:He(u.group.position.z)},n=!0),(He(u.group.quaternion.x)!==e.quaternion.x||He(u.group.quaternion.y)!==e.quaternion.y||He(u.group.quaternion.z)!==e.quaternion.z||He(u.group.quaternion.w)!==e.quaternion.w)&&(o.quaternion={x:He(u.group.quaternion.x),y:He(u.group.quaternion.y),z:He(u.group.quaternion.z),w:He(u.group.quaternion.w)},n=!0),He(u.group.scale.x)!==e.scale&&(o.scale=He(u.group.scale.x),n=!0)),u.tvConfig&&JSON.stringify(u.tvConfig)!==JSON.stringify(e.tvConfig)&&(o.tvConfig=u.tvConfig,n=!0),n&&(t[u.systemId]=o)}else{const t=Vn.getToggleState(u.group);e.push({assetFile:u.assetFile,position:{x:He(u.group.position.x),y:He(u.group.position.y),z:He(u.group.position.z)},quaternion:{x:He(u.group.quaternion.x),y:He(u.group.quaternion.y),z:He(u.group.quaternion.z),w:He(u.group.quaternion.w)},scale:He(u.group.scale.x),name:u.name,...u.tvConfig&&{tvConfig:u.tvConfig},...null!=t&&{toggleState:t},...u.deviceBinding&&{deviceBinding:u.deviceBinding},...u.doorTarget&&{doorTarget:u.doorTarget},...u.animRange&&"full"!==u.animRange&&{animRange:u.animRange},...null!=u.animRangeStart&&{animRangeStart:u.animRangeStart},...null!=u.animRangeEnd&&{animRangeEnd:u.animRangeEnd},...u.keypadData&&{keypadData:u.keypadData},...(null==(o=u.textPanels)?void 0:o.length)&&{textPanels:u.textPanels},...u.keypadLock&&{keypadLock:u.keypadLock},...u.keypadLockMode&&{keypadLockMode:u.keypadLockMode},...u.behavior&&{behavior:u.behavior},...(null==(n=u.components)?void 0:n.length)&&{components:u.components},...(null==(s=u.bindings)?void 0:s.length)&&{bindings:u.bindings},...u.properties&&Object.keys(u.properties).length>0&&{properties:u.properties},...(null==(c=u.tags)?void 0:c.length)&&{tags:u.tags},...!1===u.collisionEnabled&&{collisionEnabled:!1}})}for(const e of En)t[e]={deleted:!0};const u={roomId:p,objects:e};Object.keys(t).length>0&&(u.overrides=t),$fetch("/api/room3d/savegame",{method:"POST",body:u,headers:v()}).catch(e=>{})}}async function Dd(e,t,o){var n,s,c,u,p;const v=Sb(kb({...e})),f=St();let g=Xe.get(v.assetFile);if(!g&&v.assetFile.startsWith("procedural://")&&Ln){const e=Ln(v);e&&(g=e.group,Xe.set(v.assetFile,g),(null==(n=e.clips)?void 0:n.length)&&Vn.cacheAnimationClips(v.assetFile,e.clips))}if(!g){if(v.assetFile.startsWith("procedural://"))return;const e=new ta;try{const t=await new Promise((t,o)=>e.load(v.assetFile,t,void 0,o));g=t.scene,await An.processAssetTemplate(g,Qe(v.assetFile)),Xe.set(v.assetFile,g),Vn.cacheAnimationClips(v.assetFile,t.animations||[])}catch{return}}const b=Vn.cloneTemplate(g);b.position.set(v.position.x,v.position.y,v.position.z),b.quaternion.set(v.quaternion.x,v.quaternion.y,v.quaternion.z,v.quaternion.w),b.scale.setScalar(v.scale),b.userData.placed=!0,b.userData.assetFile=v.assetFile,t&&(b.userData.systemId=t),f.add(b),b.updateMatrixWorld(!0),lt(b),b.traverse(e=>{e.isMesh&&it.push(e)}),!1!==v.collisionEnabled&&rt(b),On&&On();const h=v.tvConfig||void 0,x=v.animRange?{animRange:v.animRange,animRangeStart:v.animRangeStart,animRangeEnd:v.animRangeEnd}:void 0;Ne.push({group:b,assetFile:v.assetFile,scale:v.scale,name:v.name,...h&&{tvConfig:h},...v.deviceBinding&&{deviceBinding:v.deviceBinding},...v.doorTarget&&{doorTarget:v.doorTarget},...t&&{systemId:t},...null!=o&&{locked:o},...v.animRange&&{animRange:v.animRange},...null!=v.animRangeStart&&{animRangeStart:v.animRangeStart},...null!=v.animRangeEnd&&{animRangeEnd:v.animRangeEnd},...v.keypadData&&{keypadData:v.keypadData},...(null==(s=v.textPanels)?void 0:s.length)&&{textPanels:v.textPanels},...v.keypadLock&&{keypadLock:v.keypadLock},...v.keypadLockMode&&{keypadLockMode:v.keypadLockMode},...v.behavior&&{behavior:v.behavior},...(null==(c=v.components)?void 0:c.length)&&{components:v.components},...(null==(u=v.bindings)?void 0:u.length)&&{bindings:v.bindings},...v.properties&&{properties:v.properties},...(null==(p=v.tags)?void 0:p.length)&&{tags:v.tags},...void 0!==v.collisionEnabled&&{collisionEnabled:v.collisionEnabled}}),Pn&&Pn(b,v.assetFile,h),Vn.attachAnimation(b,v.assetFile,v.toggleState,x);const S=v.keypadData||function(e){var t;const o=e.split("/").pop()||e;return(null==(t=dl.value[o])?void 0:t.keypadDefaults)||null}(v.assetFile);S&&Rn&&Rn(b,S,!1);const $=v.textPanels||function(e){var t;const o=e.split("/").pop()||e;return(null==(t=dl.value[o])?void 0:t.textPanelDefaults)||null}(v.assetFile);(null==$?void 0:$.length)&&jn&&jn(b,$)}function Cb(){const e=St();for(const t of Ne)Vn.detachAnimation(t.group),zn&&zn(t.group),In&&In(t.group),Fn&&Fn(t.group),tt(t.group),e.remove(t.group),nt(t.group);Ne.length=0,pl.value=0,En.clear()}async function h5(e){Cb(),await Tb(e)}function x5(e){En.add(e)}function M0(e){const t=e.group.position;return`${e.assetFile}|${He(t.x)},${He(t.y)},${He(t.z)}`}function w5(e){const t=St(),o=Ne.findIndex(t=>M0(t)===e);if(o<0)return;const n=Ne[o];Vn.detachAnimation(n.group),zn&&zn(n.group),tt(n.group),t.remove(n.group),nt(n.group),Ne.splice(o,1),pl.value=Ne.length,On&&On()}function k5(e,t,o,n){const s=Ne.find(t=>M0(t)===e);s&&(s.group.position.set(t.x,t.y,t.z),s.group.quaternion.set(o.x,o.y,o.z,o.w),null!=n&&s.group.scale.setScalar(n),s.group.updateMatrixWorld(!0),On&&On())}async function Tb(e,t){var o,n,s,c,u;if(Un=!1,null!=(o=null==Dn?void 0:Dn.value)&&o)return Bn.value=[],void(Un=!0);let p=[];try{const t=await $fetch("/api/room3d/room-objects",{query:{roomId:e}});p=Array.isArray(t)?t:[]}catch{}Bn.value=p;const l=()=>new Promise(e=>setTimeout(e,0));if(Je.value){const e=p.length;for(let o=0;o<p.length;o++){const n=Qe(p[o].assetFile);null==t||t(o,e,Xe.has(p[o].assetFile)?`Placing ${n}`:`Loading ${n}`),await Dd(p[o],p[o].id,p[o].locked),o%4==3&&await l()}}else{let o={objects:[],overrides:{}};try{const t=await $fetch("/api/room3d/savegame",{query:{roomId:e}});Array.isArray(t)?o={objects:t,overrides:{}}:t&&Array.isArray(t.objects)&&(o={objects:t.objects,overrides:t.overrides||{}})}catch{}En.clear();for(const[e,t]of Object.entries(o.overrides))(null==t?void 0:t.deleted)&&En.add(e);const v=p.filter(e=>{var t;return!(null==(t=o.overrides[e.id])?void 0:t.deleted)}),f=v.length+o.objects.length;let g=0;for(const e of v){const p=o.overrides[e.id],v=p?{...e,position:null!=(n=p.position)?n:e.position,quaternion:null!=(s=p.quaternion)?s:e.quaternion,scale:null!=(c=p.scale)?c:e.scale,tvConfig:null!=(u=p.tvConfig)?u:e.tvConfig,...p.behavior&&{behavior:p.behavior},...p.components&&{components:p.components},...p.bindings&&{bindings:p.bindings},...p.properties&&{properties:p.properties},...p.tags&&{tags:p.tags},...void 0!==p.collisionEnabled&&{collisionEnabled:p.collisionEnabled}}:e,b=Qe(v.assetFile);null==t||t(g,f,Xe.has(v.assetFile)?`Placing ${b}`:`Loading ${b}`),await Dd(v,e.id,e.locked),g++,g%4==0&&await l()}for(let e=0;e<o.objects.length;e++){const n=Qe(o.objects[e].assetFile);null==t||t(g,f,Xe.has(o.objects[e].assetFile)?`Placing ${n}`:`Loading ${n}`),await Dd(o.objects[e]),g++,g%4==0&&await l()}}pl.value=Ne.length,Un=!0}async function S5(){try{const e=await $fetch("/api/room3d/room-spawns");Wn.value=e||{}}catch{}}async function C5(e,t){var o;const n=null!=(o=null==Dn?void 0:Dn.value)&&o;if(Je.value||!n){Wn.value[e]=t,Nn.value=!0,setTimeout(()=>{Nn.value=!1},1500);try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/room-spawns",{method:"POST",body:{roomId:e,...t,system:Je.value},headers:o()})}catch{}}}async function T5(){try{const e=await $fetch("/api/room3d/room-calibrations");Hn.value=e||{}}catch{}}async function M5(e,t,o){if(!(o<=0)&&isFinite(o)&&isFinite(t)){Hn.value[e]={floorY:t,unitPerMeter:o};try{const{getAuthHeaders:n}=Gt();await $fetch("/api/room3d/room-calibrations",{method:"POST",body:{roomId:e,floorY:t,unitPerMeter:o,system:Je.value},headers:n()})}catch{}}}async function $5(){try{const e=await $fetch("/api/room3d/room-hidden-meshes");ll.value=e||{}}catch{}}async function A5(e,t){0===t.length?delete ll.value[e]:ll.value[e]=t;try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/room-hidden-meshes",{method:"POST",body:{roomId:e,indices:t,system:Je.value},headers:o()})}catch{}}async function V5(){try{const e=await $fetch("/api/room3d/room-mesh-simplifications");il.value=e||{}}catch{}}async function P5(e,t){0===Object.keys(t).length?delete il.value[e]:il.value[e]=t;try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/room-mesh-simplifications",{method:"POST",body:{roomId:e,ratios:t,system:Je.value},headers:o()})}catch{}}async function D5(){try{const e=await $fetch("/api/room3d/asset-scales");Gn.value=e||{}}catch{}}async function R5(e,t){var o;const n=null!=(o=null==Dn?void 0:Dn.value)&&o;if(Je.value||!n){Gn.value[e]=t;try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-scales",{method:"POST",body:{filename:e,scale:t,system:Je.value},headers:o()})}catch{}}}async function O5(){try{const e=await $fetch("/api/room3d/asset-rotations");Kn.value=e||{}}catch{}}async function z5(e,t){if(Kn.value[e]=t,Yn.value=!0,setTimeout(()=>{Yn.value=!1},1500),e.endsWith(".glb"))try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-rotations",{method:"POST",body:{filename:e,rotation:t,system:Je.value},headers:o()})}catch{}}async function I5(){try{const e=await $fetch("/api/room3d/asset-anim-meta");Jn.value=e||{}}catch{}}async function F5(e,t){Jn.value[e]={onIsEnd:t},Xn.value=!0,setTimeout(()=>{Xn.value=!1},1500);try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-anim-meta",{method:"POST",body:{filename:e,onIsEnd:t,system:Je.value},headers:o()})}catch{}}function E5(e){var t,o,n;return null!=(null==(t=dl.value[e])?void 0:t.onIsEnd)?dl.value[e].onIsEnd:null==(n=null==(o=Jn.value[e])?void 0:o.onIsEnd)||n}async function L5(){try{const e=await $fetch("/api/room3d/asset-meta");dl.value=e||{}}catch{}}async function B5(e,t){dl.value[e]={...dl.value[e]||{},...t};try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-meta",{method:"POST",body:{filename:e,meta:t,system:Je.value},headers:o()})}catch{}}function j5(e){return dl.value[e]||{}}function U5(e){const t=e.split("/").pop()||e,o=dl.value[t];return!0===(null==o?void 0:o.isDoor)||!1!==(null==o?void 0:o.isDoor)&&!(!e.includes("/doors/")&&!t.toLowerCase().includes("door"))}async function N5(){try{const e=await $fetch("/api/room3d/asset-thumb-offsets");tl.value=e||{}}catch{}}async function W5(e,t){tl.value[e]=t,al.value=!0,setTimeout(()=>{al.value=!1},1500);try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-thumb-offsets",{method:"POST",body:{filename:e,offset:t,system:Je.value},headers:o()})}catch{}}function Mb(e){var t;return null!=(t=tl.value[e])?t:{x:0,y:0,z:0,zoom:1}}async function H5(){try{const e=await $fetch("/api/room3d/asset-binding-defaults");ol.value=e||{}}catch{}}async function G5(e,t){t?ol.value[e]=t:delete ol.value[e],nl.value=!0,setTimeout(()=>{nl.value=!1},1500);try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/asset-binding-defaults",{method:"POST",body:{filename:e,binding:t,system:Je.value},headers:o()})}catch{}}function K5(e){var t;return null!=(t=ol.value[e])?t:null}async function $b(e){if(Xe.has(e))return!0;const t=new ta;try{const o=await new Promise((o,n)=>t.load(e,o,void 0,n)),n=o.scene;return await An.processAssetTemplate(n,Qe(e)),Xe.set(e,n),Vn.cacheAnimationClips(e,o.animations||[]),!0}catch{return!1}}async function Lc(e){var t,o;if(function(){if(vl)return;vl=new Ue.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0}),vl.setSize(160,160),vl.setClearColor(1710638,1),vl.toneMapping=Ue.ACESFilmicToneMapping,vl.toneMappingExposure=1.2,fl=new Ue.Scene;const e=new Ue.AmbientLight(16777215,.7);e.userData={baseIntensity:.7},fl.add(e);const t=new Ue.DirectionalLight(16777215,1);t.position.set(2,3,4),t.userData={baseIntensity:1},fl.add(t);const o=new Ue.DirectionalLight(8947967,.3);o.position.set(-2,1,-1),o.userData={baseIntensity:.3},fl.add(o),bl=new Ue.PerspectiveCamera(40,1,.01,1e4)}(),!vl||!fl||!bl)return"";const n=Xe.get(e);if(!n)return"";const s=Vn.cloneTemplate(n);s.updateMatrixWorld(!0);const c=Vn.getCachedClips(e);let u=null,p=null;c&&c.length>0&&(u=new Ue.AnimationMixer(s),p=u.clipAction(c[0]),p.setLoop(Ue.LoopOnce,1),p.clampWhenFinished=!0,p.play(),u.update(1/60),s.updateMatrixWorld(!0));const v=function(e){e.updateMatrixWorld(!0);const t=new Ue.Box3;return e.traverse(e=>{if(!e.isMesh||!e.geometry)return;const o=e.geometry;if(o.boundingBox||o.computeBoundingBox(),!o.boundingBox||o.boundingBox.isEmpty())return;const n=o.boundingBox.clone();n.applyMatrix4(e.matrixWorld),t.union(n)}),t}(s);let f=0;if(s.traverse(e=>{e.isMesh&&f++}),v.isEmpty()||0===f)return p&&p.stop(),u&&(u.stopAllAction(),u.uncacheRoot(s)),"";const g=v.getCenter(new Ue.Vector3),b=v.getSize(new Ue.Vector3);let h=Math.max(b.x,b.y,b.z);(!isFinite(h)||h<1e-4)&&(h=1);const x=Mb(e.split("/").pop()||e);s.position.sub(g);const S=1.8*h/Math.max(.1,x.zoom),$=null!=x.camX&&null!=x.camZ,M=$?x.camX:.7,T=$&&null!=(t=x.camY)?t:.5,V=$?x.camZ:.7,O=Math.sqrt(M*M+T*T+V*V)||1;bl.position.set(x.x+M/O*S,x.y+T/O*S,x.z+V/O*S),bl.lookAt(x.x,x.y,x.z),bl.updateProjectionMatrix();for(let e=fl.children.length-1;e>=0;e--){const t=fl.children[e];t.isLight||fl.remove(t)}const I=null!=(o=x.light)?o:3;fl.traverse(e=>{var t;e.isLight&&null!=(null==(t=e.userData)?void 0:t.baseIntensity)&&(e.intensity=e.userData.baseIntensity*I)}),fl.add(s),s.updateMatrixWorld(!0),vl.render(fl,bl),fl.remove(s),p&&p.stop(),u&&(u.stopAllAction(),u.uncacheRoot(s));const j=vl.domElement.toDataURL("image/jpeg",.85),F=e.split("/").pop()||"";if(j){const t=ul.value.find(t=>t.file===e);t&&(t.thumbnail=j)}if(j&&F){const t=`/data/cache/models/${F}.jpg`,{getAuthHeaders:o}=Gt();$fetch("/api/room3d/thumbnail-save",{method:"POST",body:{filename:F,dataUrl:j},headers:o()}).then(()=>{const o=ul.value.find(t=>t.file===e);o&&(o.thumbnail=`${t}?v=${Date.now()}`)}).catch(()=>{})}return j}async function Z5(){let e=[];try{const t=await $fetch("/api/room3d/assets");Array.isArray(t)&&(e=t.map(e=>"string"==typeof e?{path:e,source:"system"}:{path:e.path,source:e.source||"system"}))}catch{e=[]}e=e.filter(e=>!e.path.endsWith("asset-scales.json")),ul.value=e.map(e=>{const t=e.path.split("/"),o=t[t.length-1]||e.path,n=t.length>1?t.slice(0,-1).join(" / "):"General",s="user"===e.source?"/data/room3d/models/assets":"/data/appdata/models/assets";return{id:o,name:o.replace(/\.glb$/i,"").replace(/_/g," ").replace(/-/g," "),category:n,file:`${s}/${e.path}`,source:e.source,thumbnail:""}});try{const e=await $fetch("/api/room3d/thumbnails");if(e&&"object"==typeof e){let t=0;for(const o of ul.value){const n=o.file.split("/").pop()||"";n&&e[n]&&(o.thumbnail=e[n],t++)}}}catch{}}async function X5(){for(const e of ul.value)if(!e.thumbnail&&Xe.has(e.file)){await new Promise(e=>requestAnimationFrame(()=>e()));try{const t=await Lc(e.file);t&&(e.thumbnail=t)}catch{}}}async function J5(e){const t=ul.value.find(t=>t.file===e);if(t&&!t.thumbnail)try{const o=await Lc(e);o&&(t.thumbnail=o)}catch{}}let ml=!1;async function Q5(){if(ml)return;const e=ul.value.filter(e=>!e.thumbnail);if(0===e.length)return;ml=!0;for(const t of e)if(!t.thumbnail&&(await new Promise(e=>{}),Xe.has(t.file)||await $b(t.file)))try{const e=await Lc(t.file);e&&(t.thumbnail=e)}catch{}ml=!1}async function _5(e,t,o){const n=new FormData;n.append("file",e),n.append("category",t),n.append("isAdmin",String(o));try{const{getAuthHeaders:e}=Gt(),o=await $fetch("/api/room3d/asset-upload",{method:"POST",body:n,headers:e()});if(!o.ok)return null;const s="user"===o.source?"/data/room3d/models/assets":"/data/appdata/models/assets",c={id:o.filename,name:o.filename.replace(/\.glb$/i,"").replace(/_/g," ").replace(/-/g," "),category:t||"General",file:`${s}/${o.path}`,source:o.source};return ul.value=[...ul.value,c],c}catch{return null}}async function e2(e,t){const o="user"===e.source?"/data/room3d/models/assets/":"/data/appdata/models/assets/",n=e.file.startsWith(o)?e.file.slice(o.length):e.file;try{const{getAuthHeaders:o}=Gt();return await $fetch("/api/room3d/asset-delete",{method:"POST",body:{path:n,source:e.source||"system",isAdmin:t},headers:o()}),ul.value=ul.value.filter(t=>t.file!==e.file),!0}catch{return!1}}function $0(e){const t=(new Ue.Box3).setFromObject(e).getSize(new Ue.Vector3),o=Math.max(t.x,t.y,t.z);return o>.01?1.5/o:1}function t2(e,t){var o;return $0(e)*(null!=(o=Gn.value[t])?o:1)*Ye}function a2(e,t){const o=$0(e)*Ye;return o>0?t/o:1}async function o2(e){try{const t=await $fetch("/api/room3d/room-ducts",{query:{roomId:e}});return Array.isArray(t)?t:[]}catch{return[]}}async function n2(e,t){try{const{getAuthHeaders:o}=Gt();await $fetch("/api/room3d/room-ducts",{method:"POST",body:{roomId:e,ducts:t},headers:o()})}catch{}}function l2(){vl&&(vl.dispose(),vl=null),fl=null,bl=null}function Bc(){return{setAttachTVScreenCallback:l5,setDetachTVScreenCallback:i5,setIsGuestRef:s5,setMarkOctreeDirtyCallback:r5,setAttachKeypadCallback:d5,setDetachKeypadCallback:c5,setAttachTextPanelsCallback:u5,setDetachTextPanelsCallback:f5,setBuildProceduralCallback:v5,systemObjectsCache:Bn,roomSpawns:Wn,showSpawnSaved:Nn,assetScales:Gn,showScaleSaved:qn,assetRotations:Kn,showRotationSaved:Yn,assetAnimMeta:Jn,showAnimMetaSaved:Xn,assetThumbOffsets:tl,showThumbOffsetSaved:al,showEditSaved:cl,assets:ul,placedCount:pl,saveRoomState:b5,spawnSavedObject:Dd,loadRoomState:Tb,clearPlacedObjects:Cb,reloadRoomObjects:h5,markSystemObjectDeleted:x5,migrateToSandbox:kb,applyAssetMetaDefaults:Sb,getObjectIdentifier:M0,removeObjectByIdentifier:w5,moveObjectByIdentifier:k5,loadRoomSpawns:S5,saveRoomSpawn:C5,roomCalibrations:Hn,loadRoomCalibrations:T5,saveRoomCalibration:M5,roomHiddenMeshes:ll,loadRoomHiddenMeshes:$5,saveRoomHiddenMeshes:A5,roomMeshSimplifications:il,loadRoomMeshSimplifications:V5,saveRoomMeshSimplifications:P5,loadAssetScales:D5,saveAssetScale:R5,getModelBaseScale:$0,computeAssetScale:t2,extractUserMultiplier:a2,loadAssetRotations:O5,saveAssetRotation:z5,loadAssetAnimMeta:I5,saveAssetAnimMeta:F5,getAnimOnIsEnd:E5,assetMeta:dl,loadAssetMeta:L5,saveAssetMeta:B5,getAssetMeta:j5,isDoorCandidate:U5,loadAssetThumbOffsets:N5,saveAssetThumbOffset:W5,getThumbOffset:Mb,assetBindingDefaults:ol,showBindingDefaultSaved:nl,loadAssetBindingDefaults:H5,saveAssetBindingDefault:G5,getAssetBindingDefault:K5,loadAssetCatalog:Z5,ensureAssetLoaded:$b,generateThumbnail:Lc,generateCachedThumbnails:X5,generateAndCacheThumbnail:J5,generateMissingThumbnailsBackground:Q5,cleanupThumbnails:l2,uploadAsset:_5,deleteAsset:e2,resetRoomLoadFlag:g5,loadDuctConnections:o2,saveDuctConnections:n2}}const hl="All",xl=e({__name:"Room3dInventory",__ssrInlineRender:!0,props:{showInventory:{type:Boolean},assets:{},assetScales:{},editMode:{type:Boolean},assetThumbOffsets:{}},emits:["close","select","update-thumb-offset","regenerate-thumbnail","delete-asset","edit-position"],setup(e,{emit:n}){const c=e,u=Bc(),f=t(!1),g=t(hl);function r(e){return u.getAssetMeta(Ke(e)).category||e.category}const b=o(()=>{const e=new Set;for(const t of c.assets)e.add(r(t));const t=[...e].sort((e,t)=>e.localeCompare(t));return t.length>1?[hl,...t]:t});const h=o(()=>g.value===hl?c.assets:c.assets.filter(e=>r(e)===g.value));s(()=>c.showInventory,e=>{e&&(g.value=hl,pe.value=null,ue.value=!1)}),t(null);const x=t(!1);const S=t(""),$=t(""),M=t("static"),T=t("continuous"),V=t(!1),O=t(!0),I=t(!1),j=t("full"),E=t(0),ne=t(100),se=t(!1),re=t(""),ce=o(()=>{const e=new Set;for(const t of c.assets)t.category&&e.add(t.category);return[...e].sort((e,t)=>e.localeCompare(t))});s([j,E,ne],()=>{});const ue=t(!1),pe=t(null),ve=t(!1);t(null);const fe=t(!1),ge=t(3);new Ue.Clock;const be=t(!1),he=t(!1);function Ke(e){return e.file.split("/").pop()||e.file}return s(()=>c.showInventory,e=>{e||(fe.value=!1,he.value=!1,be.value=!1)}),(t,o,n,s)=>{e.showInventory?(o(`<div${F(p({class:"absolute inset-0 z-20 flex items-center justify-center"},s))} data-v-9a28c7f7><div class="inventory-panel" data-v-9a28c7f7><div class="px-6 py-4 flex items-center justify-between shrink-0" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.08)"})}" data-v-9a28c7f7><div data-v-9a28c7f7><h2 class="text-white font-black text-xl tracking-wide" data-v-9a28c7f7>INVENTORY</h2><p class="text-gray-400 text-base mt-0.5" data-v-9a28c7f7>${Z(v(pe)?"Drag to orbit Â· Scroll to zoom Â· Right-drag to pan":v(ue)?"Click an asset to edit its thumbnail":"Select an object to place")}</p></div><div class="flex items-center gap-2" data-v-9a28c7f7>`),v(pe)?o("\x3c!----\x3e"):(o(`<button${X(v(f))?" disabled":""} class="${U([v(f)?"text-gray-500 cursor-wait":"text-emerald-400 hover:text-emerald-300","px-3 py-1.5 rounded-xl text-base font-bold transition-all flex items-center gap-1.5"])}" style="${oe(v(f)?"background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);":"background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3);")}" data-v-9a28c7f7>`),v(f)?o('<div class="w-4 h-4 border-2 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin" data-v-9a28c7f7></div>'):o('<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" data-v-9a28c7f7></path></svg>'),o(` ${Z(v(f)?"Uploading...":"Upload .glb")}</button>`)),o('<input type="file" accept=".glb" class="hidden" data-v-9a28c7f7>'),v(pe)?o("\x3c!----\x3e"):o(`<button class="${U([v(ue)?"text-sky-300 border-sky-500/40":"text-gray-400 hover:text-white border-transparent hover:border-white/15","px-3 py-1.5 rounded-xl text-base font-bold transition-all flex items-center gap-1.5"])}" style="${oe(v(ue)?"background: rgba(14,165,233,0.15); border: 1px solid rgba(14,165,233,0.4);":"background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.08);")}" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931z" data-v-9a28c7f7></path><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" data-v-9a28c7f7></path></svg> Edit Model </button>`),o('<button class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-500 hover:text-white hover:bg-white/10 transition-all border border-transparent hover:border-white/15" data-v-9a28c7f7>'),o(_(v(de),{class:"w-5 h-5"},null,n)),o('</button></div></div><div class="flex flex-1 min-h-0 overflow-hidden" data-v-9a28c7f7><div class="flex-1 flex flex-col min-w-0 overflow-hidden" data-v-9a28c7f7>'),v(b).length>1&&!v(pe)?(o(`<div class="px-4 pt-3 pb-1 shrink-0" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7><div class="flex flex-wrap gap-2" data-v-9a28c7f7>\x3c!--[--\x3e`),N(v(b),e=>{o(`<button class="${U([v(g)===e?"inv-tab--active":"inv-tab--idle","inv-tab"])}" data-v-9a28c7f7>${Z(e)} <span class="ml-1 opacity-50" data-v-9a28c7f7>${Z(function(e){return e===hl?c.assets.length:c.assets.filter(t=>r(t)===e).length}(e))}</span></button>`)}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),o('<div class="p-4 overflow-y-auto" data-v-9a28c7f7><div class="grid grid-cols-3 sm:grid-cols-4 gap-3" data-v-9a28c7f7>\x3c!--[--\x3e'),N(v(h),t=>{var n;o(`<button class="${U([(null==(n=v(pe))?void 0:n.file)===t.file?"inv-card--editing":"","inv-card group"])}" data-v-9a28c7f7><div class="aspect-square w-full rounded-xl overflow-hidden flex items-center justify-center relative" style="${oe({background:"linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))"})}" data-v-9a28c7f7>`),t.thumbnail?o(`<img${J("src",t.thumbnail)} class="w-full h-full object-contain" draggable="false" data-v-9a28c7f7>`):o('<div class="w-8 h-8 border-2 border-teal-500/30 border-t-teal-500 rounded-full animate-spin" data-v-9a28c7f7></div>'),e.assetScales[t.id]?o(`<div class="absolute top-1.5 right-1.5 bg-black/70 rounded-lg px-1.5 py-0.5 border border-emerald-500/30" data-v-9a28c7f7><span class="text-emerald-400 font-mono font-bold" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>${Z(e.assetScales[t.id].toFixed(2))}x</span></div>`):o("\x3c!----\x3e"),v(pe)?o("\x3c!----\x3e"):o('<button class="absolute bottom-1.5 right-1.5 w-7 h-7 rounded-lg flex items-center justify-center bg-black/70 border border-sky-500/40 text-sky-400 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-sky-500/20" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" data-v-9a28c7f7></path><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0z" data-v-9a28c7f7></path></svg></button>'),o(`<div class="absolute inset-0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200" style="${oe({background:"radial-gradient(circle at 50% 80%, rgba(20,184,166,0.12) 0%, transparent 70%)"})}" data-v-9a28c7f7></div></div><p class="text-base text-gray-400 group-hover:text-white mt-1.5 text-center leading-tight line-clamp-2 transition-colors font-medium" data-v-9a28c7f7>${Z(function(e){return u.getAssetMeta(Ke(e)).displayName||e.name}(t))}</p></button>`)}),o("\x3c!--]--\x3e</div>"),0===v(h).length?o('<p class="text-gray-500 text-center py-12 text-base" data-v-9a28c7f7> No assets in this category.<br data-v-9a28c7f7><span class="text-gray-600 opacity-60" data-v-9a28c7f7>Add .glb files to data/appdata/models/assets/</span></p>'):o("\x3c!----\x3e"),o("</div></div>"),v(pe)?(o(`<div class="w-[340px] shrink-0 flex flex-col" style="${oe({"border-left":"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7><div class="flex-1 overflow-y-auto px-4 pt-4 pb-2 min-h-0" data-v-9a28c7f7><div class="mb-3" data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Name</label><input${J("value",v(S))} type="text"${J("placeholder",v(pe).name)} class="w-full rounded-lg px-3 py-2 text-white text-base font-medium focus:outline-none focus:ring-1 focus:ring-sky-500/50" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9a28c7f7></div><div class="mb-3" data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Category</label>`),v(se)?o(`<div class="flex gap-2" data-v-9a28c7f7><input${J("value",v(re))} type="text" placeholder="New category..." class="flex-1 rounded-lg px-3 py-2 text-white text-base font-medium focus:outline-none focus:ring-1 focus:ring-sky-500/50" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(14,165,233,0.3)"})}" data-v-9a28c7f7><button class="px-2 py-2 rounded-lg text-emerald-400" style="${oe({background:"rgba(16,185,129,0.1)",border:"1px solid rgba(16,185,129,0.3)"})}" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" data-v-9a28c7f7></path></svg></button><button class="px-2 py-2 rounded-lg text-gray-500" style="${oe({background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-9a28c7f7></path></svg></button></div>`):(o(`<div class="flex gap-2" data-v-9a28c7f7><select class="flex-1 rounded-lg px-3 py-2 text-white text-base font-medium focus:outline-none focus:ring-1 focus:ring-sky-500/50 appearance-none cursor-pointer" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9a28c7f7>\x3c!--[--\x3e`),N(v(ce),e=>{o(`<option${J("value",e)} class="bg-gray-900" data-v-9a28c7f7${X(Array.isArray(v($))?ee(v($),e):le(v($),e))?" selected":""}>${Z(e)}</option>`)}),o(`\x3c!--]--\x3e</select><button class="px-2 py-2 rounded-lg text-sky-400 hover:text-sky-300 transition-all" style="${oe({background:"rgba(14,165,233,0.1)",border:"1px solid rgba(14,165,233,0.3)"})}" title="New category" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" data-v-9a28c7f7></path></svg></button></div>`)),o(`</div><div class="mb-3" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7></div><div class="mb-3" data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1.5 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Animation Type</label><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-9a28c7f7>\x3c!--[--\x3e`),N(["static","toggle","loop"],e=>{o(`<button class="${U([v(M)===e?"text-sky-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-lg transition-all capitalize"])}" style="${oe(v(M)===e?"background: rgba(14,165,233,0.2); border: 1px solid rgba(14,165,233,0.3);":"border: 1px solid transparent;")}" data-v-9a28c7f7>${Z(e)}</button>`)}),o("\x3c!--]--\x3e</div></div>"),"toggle"===v(M)?o(`<div class="mb-3 space-y-2" data-v-9a28c7f7><div data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1.5 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Default State</label><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-9a28c7f7><button class="${U([v(V)?"text-gray-600 hover:text-gray-400":"text-gray-300 shadow-lg","flex-1 text-base font-bold py-1.5 rounded-lg transition-all"])}" style="${oe(v(V)?"border: 1px solid transparent;":"background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);")}" data-v-9a28c7f7>OFF</button><button class="${U([v(V)?"text-emerald-300 shadow-lg":"text-gray-600 hover:text-gray-400","flex-1 text-base font-bold py-1.5 rounded-lg transition-all"])}" style="${oe(v(V)?"background: rgba(16,185,129,0.2); border: 1px solid rgba(16,185,129,0.3);":"border: 1px solid transparent;")}" data-v-9a28c7f7>ON</button></div></div><label class="flex items-center gap-3 cursor-pointer group" data-v-9a28c7f7><div class="${U([v(O)?"bg-teal-500/40":"bg-white/10","relative w-10 h-5 rounded-full transition-all"])}" data-v-9a28c7f7><div class="${U([v(O)?"bg-teal-400 left-5":"bg-gray-500 left-0.5","absolute top-0.5 w-4 h-4 rounded-full transition-all"])}" data-v-9a28c7f7></div></div><div data-v-9a28c7f7><span class="text-white text-base font-medium" data-v-9a28c7f7>ON = animation end</span><p class="text-gray-500 text-base leading-tight" data-v-9a28c7f7>${Z(v(O)?"ON state shows end of clip":"ON state shows start of clip")}</p></div></label></div>`):o("\x3c!----\x3e"),"loop"===v(M)?o(`<div class="mb-3" data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1.5 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Loop Mode</label><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-9a28c7f7><button class="${U(["continuous"===v(T)?"text-sky-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-lg transition-all"])}" style="${oe("continuous"===v(T)?"background: rgba(14,165,233,0.2); border: 1px solid rgba(14,165,233,0.3);":"border: 1px solid transparent;")}" data-v-9a28c7f7>Continuous</button><button class="${U(["pingpong"===v(T)?"text-sky-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-lg transition-all"])}" style="${oe("pingpong"===v(T)?"background: rgba(14,165,233,0.2); border: 1px solid rgba(14,165,233,0.3);":"border: 1px solid transparent;")}" data-v-9a28c7f7>Ping-pong</button></div></div>`):o("\x3c!----\x3e"),o(`<label class="flex items-center gap-3 cursor-pointer group mb-3" data-v-9a28c7f7><div class="${U([v(I)?"bg-teal-500/40":"bg-white/10","relative w-10 h-5 rounded-full transition-all"])}" data-v-9a28c7f7><div class="${U([v(I)?"bg-teal-400 left-5":"bg-gray-500 left-0.5","absolute top-0.5 w-4 h-4 rounded-full transition-all"])}" data-v-9a28c7f7></div></div><div data-v-9a28c7f7><span class="text-white text-base font-medium" data-v-9a28c7f7>Door / Portal</span><p class="text-gray-500 text-base leading-tight" data-v-9a28c7f7>${Z(v(I)?"Can link to a room as portal":"Normal object")}</p></div></label>`),"static"!==v(M)?(o(`<div class="mb-3" data-v-9a28c7f7><label class="text-gray-500 text-base font-bold uppercase tracking-wider mb-1.5 block" style="${oe({"font-size":"11px"})}" data-v-9a28c7f7>Animation Range</label><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-9a28c7f7>\x3c!--[--\x3e`),N(["full","half","custom"],e=>{o(`<button class="${U([v(j)===e?"text-amber-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-lg transition-all capitalize"])}" style="${oe(v(j)===e?"background: rgba(245,158,11,0.2); border: 1px solid rgba(245,158,11,0.3);":"border: 1px solid transparent;")}" data-v-9a28c7f7>${Z(e)}</button>`)}),o("\x3c!--]--\x3e</div>"),"custom"===v(j)?o(`<div class="mt-2 space-y-2 p-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.2)"})}" data-v-9a28c7f7><div class="flex items-center gap-2" data-v-9a28c7f7><span class="text-gray-400 text-base w-12" data-v-9a28c7f7>Start</span><input type="range" min="0" max="100" step="1"${J("value",v(E))} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(245,158,11)",background:"rgba(255,255,255,0.1)"})}" data-v-9a28c7f7><span class="text-amber-400 font-mono font-bold text-base w-10 text-right" data-v-9a28c7f7>${Z(v(E))}%</span></div><div class="flex items-center gap-2" data-v-9a28c7f7><span class="text-gray-400 text-base w-12" data-v-9a28c7f7>End</span><input type="range" min="0" max="100" step="1"${J("value",v(ne))} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(245,158,11)",background:"rgba(255,255,255,0.1)"})}" data-v-9a28c7f7><span class="text-amber-400 font-mono font-bold text-base w-10 text-right" data-v-9a28c7f7>${Z(v(ne))}%</span></div></div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o(`<div class="mb-3" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7></div><div class="w-full rounded-xl overflow-hidden mb-3 relative" style="${oe({"aspect-ratio":"1",background:"linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))"})}" data-v-9a28c7f7><canvas class="editor-canvas w-full h-full block" data-v-9a28c7f7></canvas>`),v(fe)?o("\x3c!----\x3e"):o('<div class="absolute inset-0 flex items-center justify-center pointer-events-none" data-v-9a28c7f7><div class="w-6 h-6 border-2 border-sky-500/30 border-t-sky-500 rounded-full animate-spin" data-v-9a28c7f7></div></div>'),v(ve)?o('<div class="absolute inset-0 flex items-center justify-center bg-black/40 pointer-events-none" data-v-9a28c7f7><div class="w-6 h-6 border-2 border-sky-500/30 border-t-sky-500 rounded-full animate-spin" data-v-9a28c7f7></div></div>'):o("\x3c!----\x3e"),o('</div><div class="mb-3 flex items-center justify-center gap-3 text-gray-500" data-v-9a28c7f7><div class="flex items-center gap-1" data-v-9a28c7f7><svg class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-9a28c7f7><rect x="6" y="2" width="12" height="20" rx="6" data-v-9a28c7f7></rect><line x1="12" y1="2" x2="12" y2="10" data-v-9a28c7f7></line><rect x="6" y="2" width="6" height="8" rx="3" fill="currentColor" opacity="0.3" data-v-9a28c7f7></rect></svg><span class="text-base" data-v-9a28c7f7>Orbit</span></div><div class="flex items-center gap-1" data-v-9a28c7f7><svg class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-9a28c7f7><rect x="6" y="2" width="12" height="20" rx="6" data-v-9a28c7f7></rect><line x1="12" y1="2" x2="12" y2="10" data-v-9a28c7f7></line><rect x="12" y="2" width="6" height="8" rx="3" fill="currentColor" opacity="0.3" data-v-9a28c7f7></rect></svg><span class="text-base" data-v-9a28c7f7>Pan</span></div><div class="flex items-center gap-1" data-v-9a28c7f7><svg class="w-4 h-4 opacity-60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-9a28c7f7><rect x="6" y="2" width="12" height="20" rx="6" data-v-9a28c7f7></rect><line x1="12" y1="2" x2="12" y2="10" data-v-9a28c7f7></line><circle cx="12" cy="6" r="2" fill="currentColor" opacity="0.5" data-v-9a28c7f7></circle></svg><span class="text-base" data-v-9a28c7f7>Zoom</span></div></div>'),v(he)?(o(`<div class="mb-3" data-v-9a28c7f7><button class="${U([v(be)?"text-emerald-400":"text-amber-400","w-full px-3 py-1.5 rounded-xl text-base font-bold transition-all flex items-center justify-center gap-2"])}" style="${oe(v(be)?"background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.3);":"background: rgba(245,158,11,0.12); border: 1px solid rgba(245,158,11,0.3);")}" data-v-9a28c7f7>`),v(be)?o('<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" data-v-9a28c7f7><path d="M8 5v14l11-7z" data-v-9a28c7f7></path></svg>'):o('<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" data-v-9a28c7f7><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" data-v-9a28c7f7></path></svg>'),o(` ${Z(v(be)?"Play Animation":"Pause Animation")}</button></div>`)):o("\x3c!----\x3e"),o(`<div class="mb-3" data-v-9a28c7f7><div class="flex items-center justify-between mb-1" data-v-9a28c7f7><p class="text-gray-500 text-base font-medium" data-v-9a28c7f7>Lighting</p><span class="text-amber-400 font-mono text-base font-bold" data-v-9a28c7f7>${Z(v(ge).toFixed(2))}</span></div><div class="flex items-center gap-2" data-v-9a28c7f7><button class="thumb-ctrl-btn" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><circle cx="12" cy="12" r="4" data-v-9a28c7f7></circle></svg></button><div class="flex-1 h-1.5 rounded-full bg-white/10 relative overflow-hidden" data-v-9a28c7f7><div class="h-full rounded-full bg-amber-500/60" style="${oe({width:Math.min(100,v(ge)/10*100)+"%"})}" data-v-9a28c7f7></div></div><button class="thumb-ctrl-btn" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><circle cx="12" cy="12" r="4" data-v-9a28c7f7></circle><path stroke-linecap="round" d="M12 2v2m0 16v2m10-10h-2M4 12H2m15.07-7.07l-1.41 1.41M8.34 15.66l-1.41 1.41m12.14 0l-1.41-1.41M8.34 8.34L6.93 6.93" data-v-9a28c7f7></path></svg></button></div></div></div><div class="shrink-0 px-4 pb-4 pt-2 space-y-2" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7><button class="w-full px-3 py-2 rounded-xl text-base font-bold transition-all flex items-center justify-center gap-2 text-violet-400 hover:text-violet-300" style="${oe({background:"rgba(139,92,246,0.1)",border:"1px solid rgba(139,92,246,0.3)"})}" data-v-9a28c7f7><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-9a28c7f7><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" data-v-9a28c7f7></path></svg> Edit Position in Scene </button><div class="flex gap-2" data-v-9a28c7f7><button${X(v(ve))?" disabled":""} style="${oe({background:"rgba(14,165,233,0.2)",color:"#7dd3fc",border:"1px solid rgba(14,165,233,0.4)"})}" class="${U([v(ve)?"opacity-50":"hover:bg-sky-500/30","flex-1 px-3 py-2 rounded-xl text-base font-bold transition-all"])}" data-v-9a28c7f7> Save </button><button class="px-3 py-2 rounded-xl text-base font-medium transition-all" style="${oe({background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.5)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9a28c7f7> Reset </button></div><button class="w-full px-3 py-2 rounded-xl text-base font-medium transition-all text-center" style="${oe({background:"rgba(255,255,255,0.03)",color:"rgba(255,255,255,0.4)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-9a28c7f7> Back to inventory </button>`),function(e){return!(!e||!c.editMode&&"user"!==e.source)}(v(pe))?(o("<div data-v-9a28c7f7>"),v(x)?o(`<div class="flex gap-2" data-v-9a28c7f7><button class="flex-1 px-3 py-2 rounded-xl text-base font-bold transition-all text-center text-red-300 hover:text-white" style="${oe({background:"rgba(239,68,68,0.25)",border:"1px solid rgba(239,68,68,0.5)"})}" data-v-9a28c7f7> Yes, delete </button><button class="flex-1 px-3 py-2 rounded-xl text-base font-medium transition-all text-center" style="${oe({background:"rgba(255,255,255,0.05)",color:"rgba(255,255,255,0.5)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9a28c7f7> Cancel </button></div>`):o(`<div class="w-full" data-v-9a28c7f7><button class="w-full px-3 py-2 rounded-xl text-base font-medium transition-all text-center text-red-400 hover:text-red-300" style="${oe({background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.2)"})}" data-v-9a28c7f7> Delete Model </button></div>`),o("</div>")):o("\x3c!----\x3e"),o("</div></div>")):o("\x3c!----\x3e"),o("</div></div></div>")):o("\x3c!----\x3e")}}}),yl=xl.setup;xl.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dInventory.vue"),yl?yl(e,t):void 0};const wl=Object.assign(Le(xl,[["__scopeId","data-v-9a28c7f7"]]),{__name:"Room3dInventory"}),kl=e({__name:"Room3dActionChainBuilder",__ssrInlineRender:!0,props:{modelValue:{},label:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=o(()=>Ne.map(e=>{var t;return{id:e.systemId||`${e.assetFile}|${e.group.position.x.toFixed(4)},${e.group.position.y.toFixed(4)},${e.group.position.z.toFixed(4)}`,name:e.name||(null==(t=e.assetFile.split("/").pop())?void 0:t.replace(".glb",""))||"Object"}})),s=o(()=>We.map(e=>({id:e.id,name:e.name})));return(t,o,c,u)=>{var f;o(`<div${F(p({class:"space-y-2"},u))}>`),e.label?o(`<div class="text-base font-medium text-gray-300 uppercase tracking-wide">${Z(e.label)}</div>`):o("\x3c!----\x3e"),o("\x3c!--[--\x3e"),N(e.modelValue,(e,t)=>{var c,u,p,f,g;o(`<div class="flex items-start gap-2 bg-gray-800/50 rounded-lg p-3 border border-gray-700/50"><div class="flex-shrink-0 w-6 h-6 rounded-full bg-teal-500/20 text-teal-400 flex items-center justify-center text-base font-bold mt-1">${Z(t+1)}</div><div class="flex-1 space-y-2"><select${J("value",e.type)} class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-1.5 text-base text-white focus:border-teal-500 outline-none"><option value="play-animation">Play Animation</option><option value="stop-animation">Stop Animation</option><option value="delay">Delay</option><option value="travel-to-room">Travel to Room</option><option value="toggle-collision">Toggle Collision</option><option value="toggle-visibility">Toggle Visibility</option><option value="toggle-light">Toggle Light</option><option value="set-property">Set Property</option><option value="toggle-property">Toggle Property</option><option value="play-sound">Play Sound</option><option value="send-message">Send Message</option></select>`),["delay","travel-to-room","toggle-light"].includes(e.type)?o("\x3c!----\x3e"):(o(`<div class="flex gap-2"><select${J("value",e.target.mode)} class="bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="self">Self</option><option value="specific">Object...</option><option value="tagged">Tag...</option></select>`),"specific"===e.target.mode?(o(`<select${J("value",e.target.objectId||"")} class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="">Select object...</option>\x3c!--[--\x3e`),N(v(n),e=>{o(`<option${J("value",e.id)}>${Z(e.name)}</option>`)}),o("\x3c!--]--\x3e</select>")):o("\x3c!----\x3e"),"tagged"===e.target.mode?o(`<input${J("value",e.target.tag||"")} placeholder="Tag name..." class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none">`):o("\x3c!----\x3e"),o("</div>")),"play-animation"===e.type?(o(`<div class="space-y-2"><div class="flex items-center gap-2"><span class="text-base text-gray-400">Direction:</span><select${J("value",e.params.direction||"toggle")} class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="toggle">Toggle (alternate)</option><option value="forward">Forward (to end)</option><option value="reverse">Reverse (to start)</option></select></div><div class="flex items-center gap-2"><span class="text-base text-gray-400">Range:</span><div class="flex gap-1">\x3c!--[--\x3e`),N(["full","half","custom"],t=>{o(`<button class="${U([(e.params.range||"full")===t?"bg-teal-500/30 text-teal-400 border-teal-500/50":"bg-gray-800 text-gray-400 border-gray-600","px-3 py-1 rounded border text-base capitalize transition-colors"])}">${Z(t)}</button>`)}),o("\x3c!--]--\x3e</div></div>"),"custom"===e.params.range?o(`<div class="space-y-1.5"><div class="flex items-center gap-2"><span class="text-base text-gray-500 w-12">Start:</span><input type="range"${J("value",null!=(c=e.params.rangeStart)?c:0)} min="0" max="100" step="1" class="flex-1 accent-teal-500"><span class="text-base text-amber-400 w-10 text-right">${Z(null!=(u=e.params.rangeStart)?u:0)}%</span></div><div class="flex items-center gap-2"><span class="text-base text-gray-500 w-12">End:</span><input type="range"${J("value",null!=(p=e.params.rangeEnd)?p:100)} min="0" max="100" step="1" class="flex-1 accent-teal-500"><span class="text-base text-amber-400 w-10 text-right">${Z(null!=(f=e.params.rangeEnd)?f:100)}%</span></div></div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),"delay"===e.type?o(`<div class="flex items-center gap-2"><span class="text-base text-gray-400">Duration:</span><input type="number"${J("value",e.params.duration||0)} min="0" step="100" class="w-24 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><span class="text-base text-gray-500">ms</span></div>`):o("\x3c!----\x3e"),"travel-to-room"===e.type?(o(`<div class="space-y-2"><div class="flex items-center gap-2"><span class="text-base text-gray-400">Room:</span><select${J("value",e.params.roomId||"")} class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="">Select room...</option>\x3c!--[--\x3e`),N(v(s),e=>{o(`<option${J("value",e.id)}>${Z(e.name)}</option>`)}),o(`\x3c!--]--\x3e</select></div><div class="flex items-center gap-2"><span class="text-base text-gray-400">Spawn:</span><input${J("value",e.params.spawnKey||"")} placeholder="(default)" class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"></div></div>`)):o("\x3c!----\x3e"),"toggle-collision"===e.type?o(`<div class="flex items-center gap-2"><span class="text-base text-gray-400">Collision:</span><select${J("value",e.params.enabled?"true":"false")} class="bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="true">Enabled</option><option value="false">Disabled</option></select></div>`):o("\x3c!----\x3e"),"toggle-visibility"===e.type?o(`<div class="flex items-center gap-2"><span class="text-base text-gray-400">Visible:</span><select${J("value",e.params.visible?"true":"false")} class="bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="true">Visible</option><option value="false">Hidden</option></select></div>`):o("\x3c!----\x3e"),"toggle-light"===e.type?o(`<div class="space-y-1"><div class="flex items-center gap-2"><span class="text-base text-gray-400">Light IDs:</span><input${J("value",(e.params.lightIds||[]).join(", "))} placeholder="light-1, light-2..." class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"></div><div class="flex items-center gap-2"><span class="text-base text-gray-400">State:</span><select${J("value",e.params.enabled?"true":"false")} class="bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><option value="true">ON</option><option value="false">OFF</option></select></div></div>`):o("\x3c!----\x3e"),"set-property"===e.type?o(`<div class="flex items-center gap-2"><input${J("value",e.params.property||"")} placeholder="Property name" class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"><span class="text-gray-500">=</span><input${J("value",null!=(g=e.params.value)?g:"")} placeholder="Value" class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"></div>`):o("\x3c!----\x3e"),"send-message"===e.type?o(`<div class="flex items-center gap-2"><input${J("value",e.params.messageName||"")} placeholder="Message name..." class="flex-1 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-white focus:border-teal-500 outline-none"></div>`):o("\x3c!----\x3e"),"delay"!==e.type?o(`<div class="flex items-center gap-2"><span class="text-base text-gray-500">Wait before:</span><input type="number"${J("value",e.delay||0)} min="0" step="100" class="w-20 bg-gray-900 border border-gray-600 rounded px-2 py-1 text-base text-gray-400 focus:border-teal-500 outline-none"><span class="text-base text-gray-500">ms</span></div>`):o("\x3c!----\x3e"),o('</div><button class="flex-shrink-0 p-1 text-gray-500 hover:text-red-400 transition-colors mt-1" title="Remove step"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>')}),o("\x3c!--]--\x3e"),(null==(f=e.modelValue)?void 0:f.length)?o("\x3c!----\x3e"):o('<div class="text-base text-gray-500 italic py-2">No actions defined</div>'),o('<button class="w-full py-2 px-4 border border-dashed border-gray-600 rounded-lg text-base text-gray-400 hover:text-teal-400 hover:border-teal-500/50 transition-colors"> + Add Action Step </button></div>')}}}),Sl=kl.setup;kl.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dActionChainBuilder.vue"),Sl?Sl(e,t):void 0};const Cl=Object.assign(kl,{__name:"Room3dActionChainBuilder"}),$l=e({__name:"Room3dConfigTabBinding",__ssrInlineRender:!0,props:{channels:{},sceneObjects:{},envLights:{},doors:{},selectedDeviceId:{},selectedSceneObjectId:{},selectedEnvLightIds:{},selectedDoorIds:{},editMode:{type:Boolean},isDecorative:{type:Boolean},configLocked:{type:Boolean},applyScope:{},editName:{}},emits:["selectDevice","selectSceneObject","selectEnvLight","selectDoor","update:decorative","update:configLocked","update:applyScope","update:editName"],setup(e){const n=e,s=t("all"),c={all:{label:"All",color:"#5eead4",activeStyle:"background: linear-gradient(135deg, rgba(20,184,166,0.2), rgba(20,184,166,0.08)); color: #5eead4; border-color: rgba(20,184,166,0.35); box-shadow: 0 0 10px rgba(20,184,166,0.1);"},socket:{label:"Sockets",color:"#fbbf24",activeStyle:"background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.08)); color: #fbbf24; border-color: rgba(245,158,11,0.35); box-shadow: 0 0 10px rgba(245,158,11,0.1);"},light:{label:"Lights",color:"#fde047",activeStyle:"background: linear-gradient(135deg, rgba(250,204,21,0.2), rgba(250,204,21,0.08)); color: #fde047; border-color: rgba(250,204,21,0.35); box-shadow: 0 0 10px rgba(250,204,21,0.1);"},blower:{label:"Fan",color:"#22d3ee",activeStyle:"background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(6,182,212,0.08)); color: #22d3ee; border-color: rgba(6,182,212,0.35); box-shadow: 0 0 10px rgba(6,182,212,0.1);"},scene_object:{label:"Scene",color:"#c084fc",activeStyle:"background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(168,85,247,0.08)); color: #c084fc; border-color: rgba(168,85,247,0.35); box-shadow: 0 0 10px rgba(168,85,247,0.1);"},env_light:{label:"Env Lights",color:"#fbbf24",activeStyle:"background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(251,191,36,0.08)); color: #fbbf24; border-color: rgba(251,191,36,0.35); box-shadow: 0 0 10px rgba(251,191,36,0.1);"},door:{label:"Doors",color:"#f472b6",activeStyle:"background: linear-gradient(135deg, rgba(244,114,182,0.2), rgba(244,114,182,0.08)); color: #f472b6; border-color: rgba(244,114,182,0.35); box-shadow: 0 0 10px rgba(244,114,182,0.1);"}},u=o(()=>{var e,t;return null!=(t=null==(e=n.sceneObjects)?void 0:e.length)?t:0}),f=o(()=>{var e,t;return null!=(t=null==(e=n.envLights)?void 0:e.length)?t:0}),g=o(()=>{var e,t;return null!=(t=null==(e=n.doors)?void 0:e.length)?t:0}),b=o(()=>{const e={all:n.channels.length+u.value+f.value+g.value,socket:0,light:0,blower:0};for(const t of n.channels)"socket"===t.type?e.socket++:"light"===t.type?e.light++:"blower"===t.type&&e.blower++;const t=[{id:"all",count:e.all,...c.all}];return e.socket>0&&t.push({id:"socket",count:e.socket,...c.socket}),e.light>0&&t.push({id:"light",count:e.light,...c.light}),e.blower>0&&t.push({id:"blower",count:e.blower,...c.blower}),u.value>0&&t.push({id:"scene_object",count:u.value,...c.scene_object}),f.value>0&&t.push({id:"env_light",count:f.value,...c.env_light}),g.value>0&&t.push({id:"door",count:g.value,...c.door}),t}),h=o(()=>"all"===s.value?n.channels:n.channels.filter(e=>e.type===s.value)),x=o(()=>{const e=[],t=["socket","light","blower"];for(const o of t){const t=n.channels.filter(e=>e.type===o);if(t.length>0){const n=c[o];e.push({type:o,label:n.label,color:n.color,channels:t})}}return e}),S=o(()=>{var e;return n.selectedDeviceId&&null!=(e=n.channels.find(e=>e.id===n.selectedDeviceId))?e:null});return(t,o,n,c)=>{var u,f,g,$;o(`<div${F(p({class:"flex flex-col min-h-0 h-full"},c))} data-v-ad238349><div class="pb-1 shrink-0" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.06)"})}" data-v-ad238349><div class="flex flex-wrap gap-2" data-v-ad238349>\x3c!--[--\x3e`),N(v(b),e=>{o(`<button class="${U([v(s)===e.id?"bind-tab--active":"bind-tab--idle","bind-tab"])}" style="${oe(v(s)===e.id?e.activeStyle:void 0)}" data-v-ad238349>${Z(e.label)} <span class="ml-1 opacity-50" data-v-ad238349>${Z(e.count)}</span></button>`)}),o(`\x3c!--]--\x3e</div></div><div class="${U([{"opacity-30 pointer-events-none":e.isDecorative},"flex-1 overflow-y-auto py-3"])}" data-v-ad238349><button class="${U([null!==e.selectedDeviceId||e.selectedSceneObjectId||0!==e.selectedEnvLightIds.size?"bind-row--idle":"bind-row--selected","w-full flex items-center gap-3 px-4 py-2.5 mb-3 rounded-xl transition-all text-left"])}" data-v-ad238349><div class="w-3 h-3 rounded-full bg-gray-600 shrink-0" data-v-ad238349></div><span class="text-gray-300 text-base font-medium" data-v-ad238349>None (decorative only)</span></button>`),"all"===v(s)?(o("\x3c!--[--\x3e\x3c!--[--\x3e"),N(v(x),t=>{o(`<div class="mb-3" data-v-ad238349><p class="text-base font-bold mb-2 px-1" style="${oe({color:t.color})}" data-v-ad238349>${Z(t.label)}</p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e`),N(t.channels,t=>{o(`<button class="${U([e.selectedDeviceId===t.id?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="${U([t.isOn?"bg-emerald-400":"bg-gray-600","w-2.5 h-2.5 rounded-full shrink-0"])}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.displayName)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.modeName)}</span>`),t.canDirectControl?t.isOn?o('<span class="text-emerald-400 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'):o('<span class="bind-badge-auto shrink-0" data-v-ad238349>auto</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")}),o("\x3c!--]--\x3e"),e.sceneObjects&&e.sceneObjects.length>0?(o(`<div class="mb-3" data-v-ad238349><p class="text-base font-bold mb-2 px-1" style="${oe({color:"#c084fc"})}" data-v-ad238349>Scene Objects</p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e`),N(e.sceneObjects,t=>{o(`<button class="${U([e.selectedSceneObjectId===t.id?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="${U([t.isOn?"bg-purple-400":"bg-gray-600","w-2.5 h-2.5 rounded-full shrink-0"])}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>animated</span>`),t.isOn?o('<span class="text-purple-400 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),e.envLights&&e.envLights.length>0?(o(`<div class="mb-3" data-v-ad238349><p class="text-base font-bold mb-2 px-1" style="${oe({color:"#fbbf24"})}" data-v-ad238349>Env Lights <span class="text-gray-600 font-normal" data-v-ad238349>(multi-select)</span></p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e`),N(e.envLights,t=>{o(`<button class="${U([e.selectedEnvLightIds.has(t.id)?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="w-2.5 h-2.5 rounded-full shrink-0" style="${oe({backgroundColor:t.color})}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.type)}</span>`),e.selectedEnvLightIds.has(t.id)?o('<span class="text-amber-400 text-base font-bold" data-v-ad238349>SEL</span>'):t.enabled?o('<span class="text-amber-400/50 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),e.doors&&e.doors.length>0?(o(`<div class="mb-3" data-v-ad238349><p class="text-base font-bold mb-2 px-1" style="${oe({color:"#f472b6"})}" data-v-ad238349>Doors <span class="text-gray-600 font-normal" data-v-ad238349>(multi-select)</span></p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e`),N(e.doors,t=>{o(`<button class="${U([e.selectedDoorIds.has(t.id)?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="w-2.5 h-2.5 rounded-full shrink-0 bg-pink-400" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.envId)}</span>`),e.selectedDoorIds.has(t.id)?o('<span class="text-pink-400 text-base font-bold" data-v-ad238349>SEL</span>'):o("\x3c!----\x3e"),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")):"scene_object"===v(s)?(o('\x3c!--[--\x3e<div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e'),N(e.sceneObjects||[],t=>{o(`<button class="${U([e.selectedSceneObjectId===t.id?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="${U([t.isOn?"bg-purple-400":"bg-gray-600","w-2.5 h-2.5 rounded-full shrink-0"])}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>animated</span>`),t.isOn?o('<span class="text-purple-400 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div>"),(null==(u=e.sceneObjects)?void 0:u.length)?o("\x3c!----\x3e"):o('<p class="text-gray-500 text-center py-6 text-base" data-v-ad238349> No animated objects placed in the scene. </p>'),o("\x3c!--]--\x3e")):"env_light"===v(s)?(o('\x3c!--[--\x3e<p class="text-gray-500 text-base mb-2" data-v-ad238349>Select one or more lights to toggle with this switch.</p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e'),N(e.envLights||[],t=>{o(`<button class="${U([e.selectedEnvLightIds.has(t.id)?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="w-2.5 h-2.5 rounded-full shrink-0" style="${oe({backgroundColor:t.color})}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.type)}</span>`),e.selectedEnvLightIds.has(t.id)?o('<span class="text-amber-400 text-base font-bold" data-v-ad238349>SEL</span>'):t.enabled?o('<span class="text-amber-400/50 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div>"),(null==(f=e.envLights)?void 0:f.length)?o("\x3c!----\x3e"):o('<p class="text-gray-500 text-center py-6 text-base" data-v-ad238349> No environment lights in current preset. </p>'),o("\x3c!--]--\x3e")):"door"===v(s)?(o('\x3c!--[--\x3e<p class="text-gray-500 text-base mb-2" data-v-ad238349>Select one or more doors to toggle with this switch.</p><div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e'),N(e.doors||[],t=>{o(`<button class="${U([e.selectedDoorIds.has(t.id)?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="w-2.5 h-2.5 rounded-full shrink-0 bg-pink-400" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.envId)}</span>`),e.selectedDoorIds.has(t.id)?o('<span class="text-pink-400 text-base font-bold" data-v-ad238349>SEL</span>'):o("\x3c!----\x3e"),o("</div></button>")}),o("\x3c!--]--\x3e</div>"),(null==(g=e.doors)?void 0:g.length)?o("\x3c!----\x3e"):o('<p class="text-gray-500 text-center py-6 text-base" data-v-ad238349> No doors placed in the scene. </p>'),o("\x3c!--]--\x3e")):(o('\x3c!--[--\x3e<div class="grid grid-cols-2 gap-2" data-v-ad238349>\x3c!--[--\x3e'),N(v(h),t=>{o(`<button class="${U([e.selectedDeviceId===t.id?"bind-card--selected":"bind-card--idle","bind-card"])}" data-v-ad238349><div class="flex items-center gap-2 mb-1" data-v-ad238349><div class="${U([t.isOn?"bg-emerald-400":"bg-gray-600","w-2.5 h-2.5 rounded-full shrink-0"])}" data-v-ad238349></div><span class="text-white text-base font-medium truncate" data-v-ad238349>${Z(t.displayName)}</span></div><div class="flex items-center justify-between" data-v-ad238349><span class="text-gray-500 text-base truncate" data-v-ad238349>${Z(t.modeName)}</span>`),t.canDirectControl?t.isOn?o('<span class="text-emerald-400 text-base font-bold" data-v-ad238349>ON</span>'):o('<span class="text-gray-500 text-base font-bold" data-v-ad238349>OFF</span>'):o('<span class="bind-badge-auto shrink-0" data-v-ad238349>auto</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div>"),0===v(h).length?o('<p class="text-gray-500 text-center py-6 text-base" data-v-ad238349> No devices in this category. </p>'):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")),o("</div>"),e.selectedDeviceId&&v(S)&&!v(S).canDirectControl&&!e.isDecorative?o(`<div class="pt-3 shrink-0" data-v-ad238349><div class="flex items-start gap-2 px-3 py-2.5 rounded-xl" style="${oe({background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)"})}" data-v-ad238349><span class="text-amber-400 text-base shrink-0 mt-0.5" data-v-ad238349>!</span><p class="text-amber-300/80 text-base leading-tight" data-v-ad238349> View only â€” switch to <strong class="text-amber-300" data-v-ad238349>Manual</strong> or <strong class="text-amber-300" data-v-ad238349>Trigger</strong> mode to interact. </p></div></div>`):o("\x3c!----\x3e"),e.selectedEnvLightIds.size>0||e.selectedDoorIds.size>0?(o(`<div class="pt-3 shrink-0" data-v-ad238349><div class="px-3 py-2.5 rounded-xl space-y-1" style="${oe({background:"rgba(20,184,166,0.06)",border:"1px solid rgba(20,184,166,0.15)"})}" data-v-ad238349>`),e.selectedEnvLightIds.size>0?o(`<p class="text-amber-300/80 text-base leading-tight" data-v-ad238349><span class="font-bold text-amber-400" data-v-ad238349>${Z(e.selectedEnvLightIds.size)}</span> env light${Z(e.selectedEnvLightIds.size>1?"s":"")} selected </p>`):o("\x3c!----\x3e"),e.selectedDoorIds.size>0?o(`<p class="text-pink-300/80 text-base leading-tight" data-v-ad238349><span class="font-bold text-pink-400" data-v-ad238349>${Z(e.selectedDoorIds.size)}</span> door${Z(e.selectedDoorIds.size>1?"s":"")} selected </p>`):o("\x3c!----\x3e"),o("</div></div>")):o("\x3c!----\x3e"),e.selectedDeviceId&&"socket"===(null==($=v(S))?void 0:$.type)&&!e.isDecorative?o(`<div class="py-3 shrink-0" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-ad238349><label class="text-gray-400 text-base block mb-1" data-v-ad238349>Device Name</label><input${J("value",e.editName)} type="text"${J("placeholder",v(S).label)} class="w-full bg-gray-800/60 rounded-xl px-3 py-2.5 text-base text-white placeholder-gray-500 focus:outline-none transition-all" style="${oe({border:"1px solid rgba(255,255,255,0.1)"})}" data-v-ad238349></div>`):o("\x3c!----\x3e"),e.editMode?(o(`<div class="py-3 shrink-0 space-y-2.5" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-ad238349><label class="flex items-center gap-3 cursor-pointer group" data-v-ad238349><div class="${U([e.isDecorative?"bg-amber-500/40":"bg-white/10","relative w-10 h-5 rounded-full transition-all"])}" data-v-ad238349><div class="${U([e.isDecorative?"bg-amber-400 left-5":"bg-gray-500 left-0.5","absolute top-0.5 w-4 h-4 rounded-full transition-all"])}" data-v-ad238349></div></div><div data-v-ad238349><span class="text-white text-base font-medium" data-v-ad238349>Decorative switch</span><p class="text-gray-500 text-base leading-tight" data-v-ad238349>Toggles animation only, no real device</p></div></label><label class="flex items-center gap-3 cursor-pointer group" data-v-ad238349><div class="${U([e.configLocked?"bg-red-500/40":"bg-white/10","relative w-10 h-5 rounded-full transition-all"])}" data-v-ad238349><div class="${U([e.configLocked?"bg-red-400 left-5":"bg-gray-500 left-0.5","absolute top-0.5 w-4 h-4 rounded-full transition-all"])}" data-v-ad238349></div></div><div data-v-ad238349><span class="text-white text-base font-medium" data-v-ad238349>Lock configuration</span><p class="text-gray-500 text-base leading-tight" data-v-ad238349>Users cannot change this binding</p></div></label><div class="w-full flex rounded-xl overflow-hidden mt-1" style="${oe({border:"1px solid rgba(255,255,255,0.1)"})}" data-v-ad238349><button class="${U(["instance"===e.applyScope?"seg-active":"seg-idle","flex-1 py-2 text-base font-bold text-center transition-all"])}" data-v-ad238349> This instance </button><button class="${U(["default"===e.applyScope?"seg-active":"seg-idle","flex-1 py-2 text-base font-bold text-center transition-all"])}" data-v-ad238349> Default for all </button></div>`),"default"===e.applyScope?o('<p class="text-amber-400/60 text-base leading-tight" data-v-ad238349> New placements of this model will use this binding automatically. </p>'):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o("</div>")}}}),Ml=$l.setup;$l.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dConfigTabBinding.vue"),Ml?Ml(e,t):void 0};const Tl=Object.assign(Le($l,[["__scopeId","data-v-ad238349"]]),{__name:"Room3dConfigTabBinding"}),Vl=e({__name:"Room3dConfigTabAmbient",__ssrInlineRender:!0,props:{presetGroups:{},onStates:{},offStates:{}},emits:["update:onStates","update:offStates","preview"],setup:(e,{emit:t})=>(t,o,n,s)=>{o(`<div${F(p({class:"space-y-5"},s))} data-v-e7da1b3b><p class="text-gray-400 text-base" data-v-e7da1b3b>Control which environment lights turn on or off when this switch changes state.</p>`),e.presetGroups&&0!==e.presetGroups.length?(o(`\x3c!--[--\x3e<div class="rounded-xl overflow-hidden" style="${oe({border:"1px solid rgba(16,185,129,0.2)"})}" data-v-e7da1b3b><div class="flex items-center justify-between px-4 py-2.5" style="${oe({background:"rgba(16,185,129,0.08)"})}" data-v-e7da1b3b><div class="flex items-center gap-2" data-v-e7da1b3b><div class="w-2.5 h-2.5 rounded-full bg-emerald-400" data-v-e7da1b3b></div><span class="text-emerald-300 text-base font-bold" data-v-e7da1b3b>WHEN SWITCH ON</span></div><button class="px-3 py-1 rounded-lg text-base font-medium text-emerald-400/70 hover:text-emerald-300 transition-all" style="${oe({background:"rgba(16,185,129,0.1)",border:"1px solid rgba(16,185,129,0.2)"})}" title="Preview ON state for 3 seconds" data-v-e7da1b3b> Preview </button></div><div class="px-3 py-2 space-y-3" data-v-e7da1b3b>\x3c!--[--\x3e`),N(e.presetGroups,t=>{o(`<div data-v-e7da1b3b><div class="flex items-center gap-2 mb-2 px-1" data-v-e7da1b3b><div class="w-1.5 h-1.5 rounded-full bg-teal-500/60" data-v-e7da1b3b></div><span class="text-teal-300/80 text-base font-bold" data-v-e7da1b3b>${Z(t.presetName)}</span><div class="flex-1 h-px" style="${oe({background:"rgba(255,255,255,0.04)"})}" data-v-e7da1b3b></div></div><div class="grid grid-cols-2 gap-2" data-v-e7da1b3b>\x3c!--[--\x3e`),N(t.lights,t=>{o(`<button class="${U([e.onStates[t.id]?"ambient-card--on":"ambient-card--off","ambient-card"])}" data-v-e7da1b3b><div class="flex items-center gap-2 mb-1.5" data-v-e7da1b3b><div class="w-3 h-3 rounded-full shrink-0" style="${oe({backgroundColor:t.color})}" data-v-e7da1b3b></div><span class="text-white text-base font-medium truncate" data-v-e7da1b3b>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-e7da1b3b><span class="text-gray-500 text-base truncate" data-v-e7da1b3b>${Z(t.type)}</span>`),e.onStates[t.id]?o('<span class="text-emerald-400 text-base font-bold" data-v-e7da1b3b>ON</span>'):o('<span class="text-gray-600 text-base font-bold" data-v-e7da1b3b>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")}),o(`\x3c!--]--\x3e</div></div><div class="rounded-xl overflow-hidden" style="${oe({border:"1px solid rgba(239,68,68,0.2)"})}" data-v-e7da1b3b><div class="flex items-center justify-between px-4 py-2.5" style="${oe({background:"rgba(239,68,68,0.06)"})}" data-v-e7da1b3b><div class="flex items-center gap-2" data-v-e7da1b3b><div class="w-2.5 h-2.5 rounded-full bg-gray-600" data-v-e7da1b3b></div><span class="text-red-300 text-base font-bold" data-v-e7da1b3b>WHEN SWITCH OFF</span></div><button class="px-3 py-1 rounded-lg text-base font-medium text-red-400/70 hover:text-red-300 transition-all" style="${oe({background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.2)"})}" title="Preview OFF state for 3 seconds" data-v-e7da1b3b> Preview </button></div><div class="px-3 py-2 space-y-3" data-v-e7da1b3b>\x3c!--[--\x3e`),N(e.presetGroups,t=>{o(`<div data-v-e7da1b3b><div class="flex items-center gap-2 mb-2 px-1" data-v-e7da1b3b><div class="w-1.5 h-1.5 rounded-full bg-teal-500/60" data-v-e7da1b3b></div><span class="text-teal-300/80 text-base font-bold" data-v-e7da1b3b>${Z(t.presetName)}</span><div class="flex-1 h-px" style="${oe({background:"rgba(255,255,255,0.04)"})}" data-v-e7da1b3b></div></div><div class="grid grid-cols-2 gap-2" data-v-e7da1b3b>\x3c!--[--\x3e`),N(t.lights,t=>{o(`<button class="${U([e.offStates[t.id]?"ambient-card--on":"ambient-card--off","ambient-card"])}" data-v-e7da1b3b><div class="flex items-center gap-2 mb-1.5" data-v-e7da1b3b><div class="w-3 h-3 rounded-full shrink-0" style="${oe({backgroundColor:t.color})}" data-v-e7da1b3b></div><span class="text-white text-base font-medium truncate" data-v-e7da1b3b>${Z(t.name)}</span></div><div class="flex items-center justify-between" data-v-e7da1b3b><span class="text-gray-500 text-base truncate" data-v-e7da1b3b>${Z(t.type)}</span>`),e.offStates[t.id]?o('<span class="text-emerald-400 text-base font-bold" data-v-e7da1b3b>ON</span>'):o('<span class="text-gray-600 text-base font-bold" data-v-e7da1b3b>OFF</span>'),o("</div></button>")}),o("\x3c!--]--\x3e</div></div>")}),o(`\x3c!--]--\x3e</div></div><div class="p-3 rounded-xl" style="${oe({background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-e7da1b3b><p class="text-gray-500 text-base leading-relaxed" data-v-e7da1b3b> Click each light to set whether it should be <span class="text-emerald-400 font-medium" data-v-e7da1b3b>ON</span> or <span class="text-gray-400 font-medium" data-v-e7da1b3b>OFF</span> for each switch state. Use <span class="text-white font-medium" data-v-e7da1b3b>Preview</span> to temporarily see the result in the scene. </p></div>\x3c!--]--\x3e`)):o('<div class="text-center py-8" data-v-e7da1b3b><p class="text-gray-500 text-base" data-v-e7da1b3b>No environment lights configured.</p><p class="text-gray-600 text-base mt-1" data-v-e7da1b3b>Add lights in the Environment Editor first.</p></div>'),o("</div>")}}),Pl=Vl.setup;Vl.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dConfigTabAmbient.vue"),Pl?Pl(e,t):void 0};const zl=Object.assign(Le(Vl,[["__scopeId","data-v-e7da1b3b"]]),{__name:"Room3dConfigTabAmbient"}),Dl=e({__name:"Room3dConfigTabAnimation",__ssrInlineRender:!0,props:{animRange:{},animStart:{},animEnd:{}},emits:["update:animRange","update:animStart","update:animEnd"],setup:e=>(t,o,n,s)=>{o(`<div${F(p({class:"space-y-4"},s))}><p class="text-gray-400 text-base">Control how much of the animation plays when toggled.</p><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}">\x3c!--[--\x3e`),N(["full","half","custom"],t=>{o(`<button class="${U([e.animRange===t?"text-amber-300 shadow-lg":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2.5 rounded-lg transition-all capitalize"])}" style="${oe(e.animRange===t?"background: rgba(245,158,11,0.2); border: 1px solid rgba(245,158,11,0.3);":"border: 1px solid transparent;")}">${Z(t)}</button>`)}),o("\x3c!--]--\x3e</div>"),"custom"===e.animRange?o(`<div class="space-y-3 p-3 rounded-xl" style="${oe({background:"rgba(0,0,0,0.2)"})}"><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-12">Start</span><input type="range" min="0" max="100" step="1"${J("value",e.animStart)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(245,158,11)",background:"rgba(255,255,255,0.1)"})}"><span class="text-amber-400 font-mono font-bold text-base w-10 text-right">${Z(e.animStart)}%</span></div><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-12">End</span><input type="range" min="0" max="100" step="1"${J("value",e.animEnd)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(245,158,11)",background:"rgba(255,255,255,0.1)"})}"><span class="text-amber-400 font-mono font-bold text-base w-10 text-right">${Z(e.animEnd)}%</span></div></div>`):o("\x3c!----\x3e"),o(`<div class="p-3 rounded-xl" style="${oe({background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"})}">`),"full"===e.animRange?o('<p class="text-gray-500 text-base leading-relaxed"> Plays the <span class="text-white font-medium">entire animation</span> from start to end. </p>'):"half"===e.animRange?o('<p class="text-gray-500 text-base leading-relaxed"> Plays only the <span class="text-white font-medium">first half</span> of the animation (0% â€“ 50%). </p>'):o(`<p class="text-gray-500 text-base leading-relaxed"> Plays from <span class="text-amber-400 font-medium">${Z(e.animStart)}%</span> to <span class="text-amber-400 font-medium">${Z(e.animEnd)}%</span> of the animation. </p>`),o("</div></div>")}}),Ol=Dl.setup;Dl.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dConfigTabAnimation.vue"),Ol?Ol(e,t):void 0};const Rl=Object.assign(Dl,{__name:"Room3dConfigTabAnimation"}),Il=e({__name:"Room3dConfigTabAutomation",__ssrInlineRender:!0,props:{triggers:{},presets:{},lightingMode:{}},emits:["update:triggers"],setup:(e,{emit:t})=>(t,o,n,s)=>{o(`<div${F(p({class:"space-y-4"},s))} data-v-da998ce6><p class="text-gray-400 text-base" data-v-da998ce6>Automatically toggle this switch when a lighting preset starts or ends in Cycle mode.</p>`),e.triggers.length>0?(o('<div class="space-y-2" data-v-da998ce6>\x3c!--[--\x3e'),N(e.triggers,(t,n)=>{o(`<div class="flex items-center gap-2 p-3 rounded-xl" style="${oe({background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)"})}" data-v-da998ce6><span class="text-gray-400 text-base font-medium shrink-0" data-v-da998ce6>When</span><select${J("value",t.presetId)} class="trigger-select flex-1 min-w-0" data-v-da998ce6><option value="" disabled data-v-da998ce6>Select preset...</option>\x3c!--[--\x3e`),N(e.presets,e=>{o(`<option${J("value",e.id)} data-v-da998ce6>${Z(e.name)}</option>`)}),o(`\x3c!--]--\x3e</select><select${J("value",t.timing)} class="trigger-select w-24 shrink-0" data-v-da998ce6><option value="start" data-v-da998ce6>starts</option><option value="end" data-v-da998ce6>ends</option></select><span class="text-gray-600 text-base shrink-0" data-v-da998ce6>â†’</span><select${J("value",t.action)} class="trigger-select w-32 shrink-0" data-v-da998ce6><option value="on" data-v-da998ce6>Switch ON</option><option value="off" data-v-da998ce6>Switch OFF</option></select><button class="w-8 h-8 rounded-lg flex items-center justify-center text-gray-600 hover:text-red-400 hover:bg-red-500/10 transition-all shrink-0" data-v-da998ce6><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-da998ce6><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-da998ce6></path></svg></button></div>`)}),o("\x3c!--]--\x3e</div>")):o(`<div class="text-center py-6 rounded-xl" style="${oe({background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-da998ce6><p class="text-gray-500 text-base" data-v-da998ce6>No triggers configured.</p><p class="text-gray-600 text-base mt-1" data-v-da998ce6>Add a trigger to automate this switch.</p></div>`),o(`<button class="w-full py-2.5 rounded-xl text-base font-bold text-teal-400 hover:text-teal-300 transition-all" style="${oe({background:"rgba(20,184,166,0.08)",border:"1px solid rgba(20,184,166,0.2)"})}" data-v-da998ce6> + Add Trigger </button>`),"cycle"!==e.lightingMode?o(`<div class="flex items-start gap-2 px-3 py-2.5 rounded-xl" style="${oe({background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)"})}" data-v-da998ce6><span class="text-amber-400 text-base shrink-0 mt-0.5" data-v-da998ce6>!</span><p class="text-amber-300/80 text-base leading-tight" data-v-da998ce6> Triggers only fire in <strong class="text-amber-300" data-v-da998ce6>Cycle</strong> lighting mode. Current mode is <strong class="text-amber-300" data-v-da998ce6>${Z(e.lightingMode)}</strong>. </p></div>`):o("\x3c!----\x3e"),e.triggers.length>0?o(`<div class="p-3 rounded-xl" style="${oe({background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-da998ce6><p class="text-gray-500 text-base leading-relaxed" data-v-da998ce6> Triggers fire when the lighting cycle transitions between presets. A preset <span class="text-white font-medium" data-v-da998ce6>&quot;starts&quot;</span> when it becomes active, and <span class="text-white font-medium" data-v-da998ce6>&quot;ends&quot;</span> when the next preset takes over. </p></div>`):o("\x3c!----\x3e"),o("</div>")}}),jl=Il.setup;Il.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dConfigTabAutomation.vue"),jl?jl(e,t):void 0};const Fl=Object.assign(Le(Il,[["__scopeId","data-v-da998ce6"]]),{__name:"Room3dConfigTabAutomation"});let _l=.7;function f2(e){}function v2(e,t){}async function g2(e,t){}function p2(e){}function b2(e){_l=Math.max(0,Math.min(1,e))}function m2(){return _l}function y2(){}function qo(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}}function Qi(e,t){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}}function Po(e,t){return{x:e.x*t,y:e.y*t,z:e.z*t}}function _n(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function Rd(e,t){return{x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}}function lr(e){const t=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}(e);return t>1e-10?{x:e.x/t,y:e.y/t,z:e.z/t}:{x:0,y:0,z:1}}function z0(e){const t=e.length;if(t<3)return{normal:{x:0,y:0,z:1},center:{x:0,y:0,z:0}};let o=0,n=0,s=0;for(const t of e)o+=t.x,n+=t.y,s+=t.z;const c={x:o/t,y:n/t,z:s/t};let u=0,p=0,v=0;for(let o=0;o<t;o++){const n=e[o],s=e[(o+1)%t];u+=(n.y-s.y)*(n.z+s.z),p+=(n.z-s.z)*(n.x+s.x),v+=(n.x-s.x)*(n.y+s.y)}return{normal:lr({x:u,y:p,z:v}),center:c}}function jc(e,t,o,n){return e.map(e=>{const s=Qi(e,t);return{x:_n(s,o),y:_n(s,n)}})}function I0(e){if(0===e.length)return{minU:0,maxU:0,minV:0,maxV:0};let t=1/0,o=-1/0,n=1/0,s=-1/0;for(const c of e)c.x<t&&(t=c.x),c.x>o&&(o=c.x),c.y<n&&(n=c.y),c.y>s&&(s=c.y);return{minU:t,maxU:o,minV:n,maxV:s}}function el(e){const{normal:t,center:o}=z0(e),{u:n,v:s}=function(e){const t=Math.abs(e.x),o=Math.abs(e.y),n=Math.abs(e.z);let s;s=t<=o&&t<=n?{x:1,y:0,z:0}:o<=n?{x:0,y:1,z:0}:{x:0,y:0,z:1};const c=lr(Qi(s,Po(e,_n(s,e))));return{u:c,v:Rd(e,c)}}(t),c=jc(e,o,n,s);return{planeNormal:t,planeCenter:o,basisU:n,basisV:s,bounds2D:I0(c),vertices2D:c}}function Vb(e,t,o,n,s){const c=qo(Po(n,t),Po(s,o));return e.map(e=>qo(e,c))}const Ll=t(!1),Bl=t(null),El=[],Ul=n(null);let Nl=null,Gl=null,ql=null,Kl=[],Yl=null,Jl=null;const Zl=new Ue.MeshBasicMaterial({color:56831,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.45}),Ql=new Ue.MeshBasicMaterial({color:16776960,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.9}),Xl=new Ue.LineBasicMaterial({color:56831,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.8});new Ue.MeshBasicMaterial({color:43775,transparent:!0,opacity:.2,side:Ue.DoubleSide,depthWrite:!1,depthTest:!1});const ei=new Ue.SphereGeometry(.001,8,8),ti=new Ue.SphereGeometry(.002,8,8);let ai=null;const oi=new Ue.Vector2,ni=new Ue.Vector3,li=t(0);function E0(){var e;ql&&(null==(e=ql.parent)||e.remove(ql),Yl&&(Yl.geometry.dispose(),Yl=null),Kl.length=0,Jl&&(Jl=null),ql=null)}function L0(){var e;ql||(ql=new Ue.Group,ql.name="__polygonToolFeedback",ql.renderOrder=9999,null==(e=Ul.value)||e.add(ql))}function Db(){if(L0(),Yl&&(ql.remove(Yl),Yl.geometry.dispose(),Yl=null),El.length<2)return;const e=new Float32Array(3*El.length);for(let t=0;t<El.length;t++){const o=El[t];e[3*t]=o.x,e[3*t+1]=o.y,e[3*t+2]=o.z}const t=new Ue.BufferGeometry;t.setAttribute("position",new Ue.BufferAttribute(e,3)),Yl=new Ue.Line(t,Xl),Yl.renderOrder=9999,ql.add(Yl)}function Rb(e){const t=Vt();if(!t||(ni.copy(e),ni.project(t),ni.z>1))return null;const o=(void 0).innerWidth,n=(void 0).innerHeight;return{x:(ni.x+1)/2*o,y:(1-ni.y)/2*n}}function F2(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)}function E2(e,t,o,n){Ob(),Ul.value=e,Bl.value=t,Nl=o,Gl=n||null,El.length=0,li.value=0,Ll.value=!0}function L2(){var e,t;if(!Ll.value||!Ul.value)return!1;const o=Vt();if(!o)return!1;oi.set(0,0),Rt.setFromCamera(oi,o);const n=function(){const e=Ul.value;if(!e)return[];const t=[];return e.traverse(e=>{e.isMesh&&!e.userData.isCollisionProxy&&!e.userData.isPolygonFeedback&&t.push(e)}),t}();if(0===n.length)return!0;const s=Rt.intersectObjects(n,!1);if(0===s.length)return!0;const c=s[0],u=c.point.clone(),p=(null==(t=null==(e=c.face)?void 0:e.normal)?void 0:t.clone())||new Ue.Vector3(0,1,0);if(c.object.matrixWorld){const e=(new Ue.Matrix3).getNormalMatrix(c.object.matrixWorld);p.applyMatrix3(e).normalize()}const v=Ul.value.worldToLocal(u),f=(new Ue.Matrix4).copy(Ul.value.matrixWorld).invert(),g=p.clone().transformDirection(f).normalize();if(El.length>=3){const e=El[0],t=new Ue.Vector3(e.x,e.y,e.z);Ul.value.localToWorld(t);const o=Rb(t),n={x:(void 0).innerWidth/2,y:(void 0).innerHeight/2};if(o){const e=o.x-n.x,t=o.y-n.y;if(Math.sqrt(e*e+t*t)<20)return function(){if(El.length<3)return;const e=El.map(e=>({...e})),t={id:F2(),vertices:e,normalOffset:.005};B0(t),E0(),El.length=0,li.value=0;const o=Nl;Nl=null,Gl=null,Ll.value=!1,Bl.value=null,Ul.value=null,o&&o(t)}(),!0}}const b={x:v.x,y:v.y,z:v.z,nx:g.x,ny:g.y,nz:g.z};return El.push(b),li.value=El.length,function(e){L0();const t=new Ue.Mesh(ei,Zl);t.position.copy(e),t.renderOrder=9999,ql.add(t),Kl.push(t)}(v),Db(),!0}function B2(){if(!Ll.value||El.length<3||!Ul.value)return void(Jl&&(Jl.visible=!1));const e=El[0],t=new Ue.Vector3(e.x,e.y,e.z);Ul.value.localToWorld(t);const o=Rb(t);if(!o)return void(Jl&&(Jl.visible=!1));const n=(void 0).innerWidth/2,s=(void 0).innerHeight/2,c=o.x-n,u=o.y-s;Math.sqrt(c*c+u*u)<20?(Jl||(L0(),Jl=new Ue.Mesh(ti,Ql),Jl.renderOrder=9999,ql.add(Jl)),Jl.position.set(e.x,e.y,e.z),Jl.visible=!0):Jl&&(Jl.visible=!1)}function j2(){if(!Ll.value||0===El.length)return;El.pop(),li.value=El.length;const e=Kl.pop();e&&ql&&ql.remove(e),Db()}function Ob(){if(!Ll.value)return;E0(),El.length=0,li.value=0,Ul.value=null,Ll.value=!1,Bl.value=null;const e=Gl;Nl=null,Gl=null,e&&e()}function B0(e){const t=e.vertices.map(e=>({x:e.x,y:e.y,z:e.z}));if(t.length<3)return;const o=el(t);e.planeNormal=o.planeNormal,e.planeCenter=o.planeCenter,e.basisU=o.basisU,e.basisV=o.basisV,e.bounds2D=o.bounds2D}function N2(e,t,o=43775,n=.15,s="flat",c=.5,u=0,p=0){(!t.planeCenter||!t.planeNormal||!t.basisU||!t.basisV)&&B0(t);const v=new Ue.Group;v.name=`__polygonVisual_${t.id}`,v.userData.isPolygonFeedback=!0,e.add(v);const f=t.vertices.map(e=>({x:e.x,y:e.y,z:e.z})),g=el(f);let b=g.planeNormal;const h=t.vertices.reduce((e,t)=>e+t.nx,0)/t.vertices.length,x=t.vertices.reduce((e,t)=>e+t.ny,0)/t.vertices.length,S=t.vertices.reduce((e,t)=>e+t.nz,0)/t.vertices.length;b.x*h+b.y*x+b.z*S<0&&(b={x:-b.x,y:-b.y,z:-b.z});const w=e=>{const t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return t>1e-10?{x:e.x/t,y:e.y/t,z:e.z/t}:{x:0,y:0,z:1}};let $,M;if(Math.abs(b.y)>.99){const e=-b.z;$=w({x:-e*b.x,y:-e*b.y,z:-1-e*b.z})}else{const e=b.y;$=w({x:-e*b.x,y:1-e*b.y,z:-e*b.z})}M={x:$.y*b.z-$.z*b.y,y:$.z*b.x-$.x*b.z,z:$.x*b.y-$.y*b.x};let T=jc(f,g.planeCenter,M,$);if(T.length<3)return v;const V=new Ue.Shape;V.moveTo(T[0].x,T[0].y);for(let e=1;e<T.length;e++)V.lineTo(T[e].x,T[e].y);let O;if(V.closePath(),"flat"!==s){const e="glossy"===s?Math.min(c,.3):c,t="glossy"===s?Math.max(u,.15):u,v={color:o,transparent:!0,opacity:n,side:Ue.DoubleSide,roughness:e,metalness:t};p>0&&(v.bumpMap=function(){if(ai)return ai;const e=128,t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d"),n=o.createImageData(e,e);for(let e=0;e<n.data.length;e+=4){const t=Math.floor(80*Math.random()+170);n.data[e]=t,n.data[e+1]=t,n.data[e+2]=t,n.data[e+3]=255}return o.putImageData(n,0,0),ai=new Ue.CanvasTexture(t),ai.wrapS=Ue.RepeatWrapping,ai.wrapT=Ue.RepeatWrapping,ai.repeat.set(3,3),ai}(),v.bumpScale=p),O=new Ue.MeshStandardMaterial(v)}else O=new Ue.MeshBasicMaterial({color:o,transparent:!0,opacity:n,side:Ue.DoubleSide,depthWrite:!1,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1});const I=new Ue.Mesh(new Ue.ShapeGeometry(V),O);I.renderOrder=0;const j=g.planeCenter;I.position.set(j.x+b.x*t.normalOffset,j.y+b.y*t.normalOffset,j.z+b.z*t.normalOffset);const F=(new Ue.Matrix4).makeBasis(new Ue.Vector3(M.x,M.y,M.z),new Ue.Vector3($.x,$.y,$.z),new Ue.Vector3(b.x,b.y,b.z));return I.quaternion.setFromRotationMatrix(F),I.userData.isPolygonFeedback=!0,v.add(I),v}function W2(e){var t;e.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&!e.material._shared&&e.material.dispose()}),null==(t=e.parent)||t.remove(e)}function H2(){E0(),El.length=0,li.value=0,Ul.value=null,Ll.value=!1,Bl.value=null,Nl=null,Gl=null}const ii=new Ue.SphereGeometry(.002,12,12),si=new Ue.MeshBasicMaterial({color:16768256,depthTest:!1,depthWrite:!1,transparent:!0,opacity:.9});let ri=[],di=null;function q2(e,t,o){zb(),di=e;for(const n of o){const o=t[n];if(!o)continue;const s=new Ue.Mesh(ii,si);s.position.set(o.x,o.y,o.z),s.renderOrder=1e4,s.userData.isPolygonFeedback=!0,e.add(s),ri.push(s)}}function zb(){if(di)for(const e of ri)di.remove(e);ri.length=0,di=null}function j0(){return{polygonToolActive:Ll,polygonToolPurpose:Bl,vertexCount:li,startTracing:E2,handleTracingClick:L2,updateTracingHover:B2,undoLastVertex:j2,cancelTracing:Ob,stopTracing:H2,recomputePolygonDerived:B0,createPolygonVisual:N2,disposePolygonVisual:W2,showVertexSelectionHighlights:q2,clearVertexSelectionHighlights:zb}}const ci=[],ui=t([]),pi={fontFamily:"",fontSize:.3,textColor:"#00ff00",backgroundColor:"#000000",backgroundOpacity:.8,backgroundTransparent:!1,surfaceType:"matte",roughness:.85,metalness:0,textAlign:"center",uppercase:!1,maxChars:0,padding:.003,letterSpacing:0,lineHeight:1.2,wrapMode:"wrap",mode:"static",previewText:"Hello World",verticalOffset:0,grainIntensity:0};async function J2(){await async function(){return!1}(),await Fb()}async function Fb(){try{const e=await $fetch("/api/room3d/fonts");ui.value=e}catch{}}function Q2(e,t){return null}function _2(e,t){const o=e.data.config;Object.assign(o,t);const n=e.textMesh;if(n){if(void 0!==t.fontFamily&&(n.font=o.fontFamily),void 0!==t.fontSize){const t=el(e.data.polygon.vertices.map(e=>({x:e.x,y:e.y,z:e.z}))),s=t.bounds2D.maxV-t.bounds2D.minV;n.fontSize=s>0?s*Math.max(.01,o.fontSize):.01}if(void 0!==t.textColor&&(n.color=new Ue.Color(o.textColor).getHex()),void 0!==t.textAlign&&(n.textAlign=o.textAlign,n.anchorX=o.textAlign),void 0!==t.letterSpacing&&(n.letterSpacing=o.letterSpacing),void 0!==t.lineHeight&&(n.lineHeight=o.lineHeight),void 0!==t.wrapMode&&(n.overflowWrap="wrap"===o.wrapMode?"break-word":"normal",n.whiteSpace="wrap"===o.wrapMode?"normal":"nowrap"),void 0!==t.previewText||void 0!==t.uppercase||void 0!==t.maxChars){const e=o.uppercase?o.previewText.toUpperCase():o.previewText;n.text=o.maxChars>0?e.slice(0,o.maxChars):e}if(void 0!==t.verticalOffset){const t=el(e.data.polygon.vertices.map(e=>({x:e.x,y:e.y,z:e.z}))),s=t.bounds2D.maxV-t.bounds2D.minV,c=(t.bounds2D.minV+t.bounds2D.maxV)/2;n.position.y=c+s*(o.verticalOffset||0)}if(void 0!==t.padding&&e.data.polygon.bounds2D){const t=e.data.polygon.bounds2D,s=t.maxU-t.minU-2*o.padding;n.maxWidth=s>0?s:.1}if(e.bgMesh)if(void 0!==t.surfaceType)e.bgMesh.material.dispose(),e.bgMesh.material=function(e){if("flat"===e.surfaceType)return new Ue.MeshBasicMaterial({color:new Ue.Color(e.backgroundColor),transparent:!0,opacity:e.backgroundOpacity,side:Ue.DoubleSide,depthWrite:!1,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1});const t="glossy"===e.surfaceType?Math.min(e.roughness,.3):e.roughness,o="glossy"===e.surfaceType?Math.max(e.metalness,.15):e.metalness;return new Ue.MeshStandardMaterial({color:new Ue.Color(e.backgroundColor),transparent:!0,opacity:e.backgroundOpacity,side:Ue.DoubleSide,depthWrite:!1,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1,roughness:t,metalness:o})}(o);else{const n=e.bgMesh.material;void 0!==t.backgroundColor&&n.color.set(o.backgroundColor),void 0!==t.backgroundOpacity&&(n.opacity=o.backgroundOpacity),n instanceof Ue.MeshStandardMaterial&&(void 0!==t.roughness&&(n.roughness=o.roughness),void 0!==t.metalness&&(n.metalness=o.metalness))}n.sync()}}function e3(e){const t=ci.findIndex(t=>t.id===e);t>=0&&ci[t].dispose()}function t3(e){for(let t=ci.length-1;t>=0;t--)ci[t].parentGroup===e&&ci[t].dispose()}function a3(e){return ci.find(t=>t.id===e)}function o3(e){return ci.filter(t=>t.parentGroup===e)}function n3(){for(let e=ci.length-1;e>=0;e--)ci[e].dispose();ci.length=0}function U0(){return{availableFonts:ui,DEFAULT_TEXT_PANEL_CONFIG:pi,initTextPanels:J2,loadAvailableFonts:Fb,createTextPanel:Q2,updateTextPanelConfig:_2,removeTextPanel:e3,removeAllPanelsForObject:t3,getTextPanelById:a3,getTextPanelsForObject:o3,disposeAllTextPanels:n3}}const vi={fontFamily:"",fontSize:.4,textColor:"#ffffff",backgroundColor:"#000000",backgroundOpacity:0,backgroundTransparent:!0,surfaceType:"flat",roughness:.5,metalness:0,textAlign:"center",uppercase:!1,maxChars:0,padding:0,letterSpacing:0,lineHeight:1.2,wrapMode:"nowrap",mode:"static",previewText:""},fi={character:"",confirm:"OK",delete:"DEL",clear:"CLR"},gi={character:"",confirm:"__CONFIRM__",delete:"__DELETE__",clear:"__CLEAR__"};function Eb(e){return e.labelConfig||(e.labelConfig={...vi,textColor:e.labelColor||"#ffffff",fontSize:e.labelFontSize||.4}),delete e.labelColor,delete e.labelFontSize,e}const bi=[],mi=n(null);let yi="local";const ki=t(!1),Si=t(0),Ci=n(null),$i=t({}),Mi=t([]),Ti=t(null),Vi=new Ue.Vector2;function tc(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)}function W0(e){const t=[];return e.traverse(e=>{e.isMesh&&!e.userData.isCollisionProxy&&!e.userData.isPolygonFeedback&&t.push(e)}),t}function Hr(e){return Ne.find(t=>t.group===e)}function s3(e){const t=el(e.polygon.vertices.map(e=>({x:e.x,y:e.y,z:e.z})));return{polygon2D:t.vertices2D,center3D:t.planeCenter,normal:t.planeNormal,basisU:t.basisU,basisV:t.basisV}}function Lb(e,t){const o=e.x-t.center3D.x,n=e.y-t.center3D.y,s=e.z-t.center3D.z;return function(e,t){let o=!1;for(let n=0,s=t.length-1;n<t.length;s=n++){const c=t[n].x,u=t[n].y,p=t[s].x,v=t[s].y;u>e.y!=v>e.y&&e.x<(p-c)*(e.y-u)/(v-u)+c&&(o=!o)}return o}({x:o*t.basisU.x+n*t.basisU.y+s*t.basisU.z,y:o*t.basisV.x+n*t.basisV.y+s*t.basisV.z},t.polygon2D)}function Bb(e,t,o=!1){var n,s,c,u,p,v,f,g,b,h,x,S,$,M,T;const V=U0(),O=j0(),I=V.createTextPanel(e,t.display);for(let e=0;e<t.buttons.length;e++)t.buttons[e]=Eb(t.buttons[e]);const j=[];for(const o of t.buttons){const I=s3(o);let F;if(o.areaTransparent)F=new Ue.Group,F.name=`__kpBtn_${o.id}`,F.userData.isPolygonFeedback=!0,e.add(F);else{const t=o.labelConfig||vi;F=O.createPolygonVisual(e,o.polygon,new Ue.Color(o.areaColor).getHex(),o.areaOpacity,t.surfaceType||"flat",null!=(n=t.roughness)?n:.5,null!=(s=t.metalness)?s:0,null!=(c=t.grainIntensity)?c:0)}let _=null;if(o.label){const n=o.labelConfig||vi,s={fontFamily:n.fontFamily||t.display.config.fontFamily,fontSize:null!=(u=n.fontSize)?u:.4,textColor:n.textColor||"#ffffff",backgroundColor:n.backgroundColor||"#000000",backgroundOpacity:null!=(p=n.backgroundOpacity)?p:0,backgroundTransparent:null==(v=n.backgroundTransparent)||v,surfaceType:n.surfaceType||"flat",roughness:null!=(f=n.roughness)?f:.5,metalness:null!=(g=n.metalness)?g:0,textAlign:n.textAlign||"center",uppercase:null!=(b=n.uppercase)&&b,maxChars:null!=(h=n.maxChars)?h:0,padding:null!=(x=n.padding)?x:0,letterSpacing:null!=(S=n.letterSpacing)?S:0,lineHeight:null!=($=n.lineHeight)?$:1.2,wrapMode:n.wrapMode||"nowrap",mode:"static",previewText:o.label,verticalOffset:null!=(M=n.verticalOffset)?M:0,grainIntensity:null!=(T=n.grainIntensity)?T:0},c={id:`${o.id}_label`,polygon:o.polygon,config:s};_=V.createTextPanel(e,c)}j.push({buttonId:o.id,visual:F,labelPanel:_,...I})}const F={data:t,parentGroup:e,displayPanel:I,buttonVisuals:j,currentInput:"",isUnlocked:o,interacting:!1,feedbackTimer:null,unlockedPlayerIds:new Set};return bi.push(F),I&&(o&&"single"===t.logic.behavior?(I.setText(t.logic.onTrue.text||"UNLOCKED"),I.setColor(t.logic.onTrue.textColor||"#00ff00")):I.setText(t.display.config.previewText||"")),F}function jb(e){const t=j0();for(let o=bi.length-1;o>=0;o--){const n=bi[o];if(n.parentGroup===e){n.displayPanel&&n.displayPanel.dispose();for(const e of n.buttonVisuals)e.labelPanel&&e.labelPanel.dispose(),t.disposePolygonVisual(e.visual);n.feedbackTimer&&clearTimeout(n.feedbackTimer),mi.value===n&&(mi.value=null),bi.splice(o,1)}}}function r3(){for(const e of bi){e.displayPanel&&e.displayPanel.dispose();for(const t of e.buttonVisuals)t.labelPanel&&t.labelPanel.dispose();e.feedbackTimer&&clearTimeout(e.feedbackTimer)}bi.length=0,mi.value=null}function d3(e){const t=Vt();if(!t)return null;Rt.setFromCamera(new Ue.Vector2(0,0),t),Rt.far=e;for(const t of bi){const o=W0(t.parentGroup);if(0===o.length)continue;const n=Rt.intersectObjects(o,!1);if(n.length>0&&n[0].distance<=e)return t}return null}function c3(e){e.interacting=!0,mi.value=e,(!e.isUnlocked||"repeatable"===e.data.logic.behavior)&&(e.currentInput="",e.displayPanel&&(e.displayPanel.setText(e.data.display.config.previewText||""),e.displayPanel.setColor(e.data.display.config.textColor),e.data.display.config.backgroundTransparent||e.displayPanel.setBgColor(e.data.display.config.backgroundColor,e.data.display.config.backgroundOpacity)))}function u3(){mi.value&&(mi.value.interacting=!1,mi.value=null)}function f3(e){const t=Vt();if(!t||0===bi.length)return!1;Vi.set(0,0),Rt.setFromCamera(Vi,t),Rt.far=e;for(const t of bi){const o=W0(t.parentGroup);if(0===o.length)continue;const n=Rt.intersectObjects(o,!1);if(0===n.length||n[0].distance>e)continue;const s=n[0].point.clone(),c=t.parentGroup.worldToLocal(s),u={x:c.x,y:c.y,z:c.z};for(let e=0;e<t.buttonVisuals.length;e++){const o=t.buttonVisuals[e];if(Lb(u,o)){return Ub(t,t.data.buttons[e],o),!0}}}return!1}function v3(e,t){const o=mi.value;if(!o)return;const n=Vt();if(!n)return;Vi.set(e/(void 0).innerWidth*2-1,-t/(void 0).innerHeight*2+1),Rt.setFromCamera(Vi,n);const s=W0(o.parentGroup),c=Rt.intersectObjects(s,!1);if(c.length>0){const e=c[0].point.clone(),t=o.parentGroup.worldToLocal(e),n={x:t.x,y:t.y,z:t.z};for(const e of o.buttonVisuals)if(Lb(n,e))break}}function Ub(e,t,o){switch(function(e){e.visual.traverse(e=>{if(!e.isMesh||!e.material)return;e.userData._origMat||(e.userData._origMat=e.material,e.material=e.material.clone());const t=e.material,o=t.opacity;t.opacity=Math.min(o+.4,1),setTimeout(()=>{t.opacity=o},120)})}(o),t.type){case"character":{const o=e.data.display.config.maxChars||99;e.currentInput.length<o&&(e.currentInput+=t.value,e.displayPanel&&e.displayPanel.setText(e.currentInput),"auto"===e.data.logic.verificationMode&&e.currentInput.length>=o&&setTimeout(()=>jg(e),100));break}case"delete":e.currentInput.length>0&&(e.currentInput=e.currentInput.slice(0,-1),e.displayPanel&&e.displayPanel.setText(e.currentInput));break;case"clear":e.currentInput="",e.displayPanel&&e.displayPanel.setText(e.data.display.config.previewText||"");break;case"confirm":jg(e)}}function jg(e){const t=e.data.logic;if(e.currentInput===t.secretCode){e.isUnlocked=!0,e.displayPanel&&(e.displayPanel.setText(t.onTrue.text||"OK"),e.displayPanel.setColor(t.onTrue.textColor||"#00ff00"),!t.onTrue.bgTransparent&&e.displayPanel.bgMesh&&e.displayPanel.setBgColor(t.onTrue.bgColor||"#003300",e.data.display.config.backgroundOpacity));const o=Hr(e.parentGroup);o&&(o.keypadUnlocked=!0),yi&&e.unlockedPlayerIds.add(yi),Ai&&Ai(e.parentGroup,!0),t.action&&"none"!==t.action.type&&Pi&&Pi(t.action,e.parentGroup,!0),"repeatable"===t.behavior&&(e.feedbackTimer=setTimeout(()=>{e.isUnlocked=!1,e.currentInput="",o&&(o.keypadUnlocked=!1),e.displayPanel&&(e.displayPanel.setText(e.data.display.config.previewText||""),e.displayPanel.setColor(e.data.display.config.textColor),!e.data.display.config.backgroundTransparent&&e.displayPanel.bgMesh&&e.displayPanel.setBgColor(e.data.display.config.backgroundColor,e.data.display.config.backgroundOpacity)),Ai&&Ai(e.parentGroup,!1),t.action&&"none"!==t.action.type&&Pi&&Pi(t.action,e.parentGroup,!1),e.feedbackTimer=null},t.feedbackDuration))}else e.displayPanel&&(e.displayPanel.setText(t.onFalse.text||"ERROR"),e.displayPanel.setColor(t.onFalse.textColor||"#ff0000"),!t.onFalse.bgTransparent&&e.displayPanel.bgMesh&&e.displayPanel.setBgColor(t.onFalse.bgColor||"#330000",e.data.display.config.backgroundOpacity)),e.feedbackTimer=setTimeout(()=>{e.currentInput="",e.displayPanel&&(e.displayPanel.setText(e.data.display.config.previewText||""),e.displayPanel.setColor(e.data.display.config.textColor),!e.data.display.config.backgroundTransparent&&e.displayPanel.bgMesh&&e.displayPanel.setBgColor(e.data.display.config.backgroundColor,e.data.display.config.backgroundOpacity)),e.feedbackTimer=null},t.feedbackDuration)}function p3(e){var t;return null==(t=bi.find(t=>t.parentGroup===e))?void 0:t.isUnlocked}function b3(e){for(const t of bi){const o=Hr(t.parentGroup);if(!o)continue;const n=t.parentGroup.position;if(`${o.assetFile}|${Math.round(1e4*n.x)/1e4},${Math.round(1e4*n.y)/1e4},${Math.round(1e4*n.z)/1e4}`===e)return t.isUnlocked}return!1}function m3(e){return bi.find(t=>t.parentGroup===e)}new Ue.Vector3,new Ue.Vector3;let Ai=null,Pi=null;function y3(e){Ai=e}function h3(e){Pi=e}function x3(e,t){for(const o of bi){const n=Hr(o.parentGroup);if(!n)continue;const s=o.parentGroup.position;if(`${n.assetFile}|${Math.round(1e4*s.x)/1e4},${Math.round(1e4*s.y)/1e4},${Math.round(1e4*s.z)/1e4}`===e)return o.unlockedPlayerIds.has(t)}return!1}function w3(e){const t=Hr(e);if(t){if(Ci.value=e,Si.value=0,t.keypadData){const e=t.keypadData;$i.value={...e},Ti.value=e.display?{...e.display}:null,Mi.value=e.buttons?e.buttons.map(e=>({...Eb({...e})})):[]}else $i.value={id:tc(),logic:{secretCode:"1234",verificationMode:"auto",feedbackDuration:2e3,onTrue:{text:"OPEN",textColor:"#00ff00",bgColor:"#003300",bgTransparent:!1},onFalse:{text:"WRONG",textColor:"#ff0000",bgColor:"#330000",bgTransparent:!1},behavior:"repeatable",action:{type:"none"}}},Ti.value=null,Mi.value=[];ki.value=!0}}function Nb(){ki.value=!1,Ci.value=null,$i.value={},Ti.value=null,Mi.value=[],Si.value=0}function k3(){Si.value++}function S3(e){Si.value=e}function C3(){Si.value>0&&Si.value--}function T3(e){const t=Ci.value;if(!t)return;const o=Hr(t);if(!o||!Ti.value)return;const n={id:$i.value.id||tc(),display:Ti.value,buttons:Mi.value,logic:$i.value.logic};return jb(t),Bb(t,n),o.keypadData=n,Nb(),{data:n,scope:e}}function Wb(e,t,o){const n=e.polygon.vertices.map(e=>({x:e.x,y:e.y,z:e.z})),s=el(n),c=Vb(n,t,o,s.basisU,s.basisV);return{id:tc(),polygon:{id:tc(),vertices:c.map((t,o)=>({x:t.x,y:t.y,z:t.z,nx:e.polygon.vertices[o].nx,ny:e.polygon.vertices[o].ny,nz:e.polygon.vertices[o].nz})),normalOffset:e.polygon.normalOffset},type:e.type,value:"",label:"",labelConfig:{...e.labelConfig||vi},areaColor:e.areaColor,areaTransparent:e.areaTransparent,areaOpacity:e.areaOpacity}}function M3(e,t,o,n,s){const c=el(e.polygon.vertices.map(e=>({x:e.x,y:e.y,z:e.z}))),u=function(e,t,o,n,s,c,u){const p=e.maxU-e.minU,v=e.maxV-e.minV,f=-(o*p+(o-1)*n)/2+p/2,g=(t*v+(t-1)*n)/2-v/2,b=[];for(let e=0;e<t;e++){const t=[];for(let b=0;b<o;b++){const o=f+b*(p+n),h=g-e*(v+n);t.push(qo(s,qo(Po(c,o),Po(u,h))))}b.push(t)}return b}(c.bounds2D,t,o,n,c.planeCenter,c.basisU,c.basisV),p=[];let v=0;for(let n=0;n<t;n++)for(let t=0;t<o;t++){const o=u[n][t],f=(o.x-c.planeCenter.x)*c.basisU.x+(o.y-c.planeCenter.y)*c.basisU.y+(o.z-c.planeCenter.z)*c.basisU.z,g=(o.x-c.planeCenter.x)*c.basisV.x+(o.y-c.planeCenter.y)*c.basisV.y+(o.z-c.planeCenter.z)*c.basisV.z,b=s[v]||"",h=Wb(e,f,g);h.label=b,h.type="OK"===b||"âœ“"===b?"confirm":"âŒ«"===b||"DEL"===b?"delete":"CLR"===b||"C"===b?"clear":"character",h.value="character"===h.type?b:gi[h.type],p.push(h),v++}return p}function $3(e,t){if(t<0||t>=e.data.buttons.length)return;const o=e.data.buttons[t],n=e.buttonVisuals[t];o&&n&&Ub(e,o,n)}function H0(){return{activeKeypadInteraction:mi,keypadWizardVisible:ki,keypadWizardStep:Si,keypadWizardTarget:Ci,keypadWizardData:$i,keypadWizardDisplay:Ti,keypadWizardButtons:Mi,attachKeypad:Bb,detachKeypad:jb,disposeAllKeypads:r3,getNearbyKeypad:d3,startKeypadInteraction:c3,stopKeypadInteraction:u3,handleKeypadCrosshairClick:f3,updateKeypadHover:v3,pressButtonByIndex:$3,getKeypadUnlocked:p3,getKeypadUnlockedById:b3,getKeypadForObject:m3,isUnlockedForPlayer:x3,setOnKeypadUnlockCallback:y3,setOnKeypadActionCallback:h3,setLocalPlayerId:e=>{yi=e},openKeypadWizard:w3,closeKeypadWizard:Nb,wizardNextStep:k3,wizardPrevStep:C3,wizardGoStep:S3,saveKeypadFromWizard:T3,cloneButton:Wb,generateButtonGrid:M3}}let zi=null;function A3(e){zi=e}let Di=null;function V3(e){Di=e}let Oi="local";function P3(e){Oi=e}let Ri=null;function D3(e){Ri=e}const Ii=is(),ji=t(!1),Fi=n(null),_i=t(null);let Li=null,Bi=null;function bn(e){return Math.round(1e4*e)/1e4}const Ui=new Ue.Raycaster,Wi=new Ue.Vector2(0,0);let Ni=[],Hi=new Map,Gi=!0;const qi=new Ue.Vector3;function R3(e){Li=e}function O3(e){Fi.value=e,ji.value=!0}function Hb(){ji.value=!1,Fi.value=null}function z3(e){if(!Fi.value)return;const t=Ne.find(e=>e.group===Fi.value);if(t){if(e){if(t.deviceBinding=e,Li){const o=Li.getChannel(e.deviceId);if(o){const n=e.invertAnimation?!o.isOn:o.isOn;Ii.remoteToggle(t.group,n)}}}else delete t.deviceBinding;Gi=!0,Hb()}}function I3(){var e,t;return Fi.value&&null!=(t=null==(e=Ne.find(e=>e.group===Fi.value))?void 0:e.deviceBinding)?t:null}function Gb(){var e,t;return Fi.value&&null!=(t=null==(e=Ne.find(e=>e.group===Fi.value))?void 0:e.assetFile)?t:null}function Kb(e){var t;if(null==(t=e.doorIds)?void 0:t.length)for(const t of e.doorIds){const e=Ne.find(e=>{const o=e.group.position;return`${e.assetFile}|${bn(o.x)},${bn(o.y)},${bn(o.z)}`===t});if(e){const t=Ii.getToggleState(e.group);Ii.remoteToggle(e.group,void 0===t||!t)}}}function Mu(e,t){var o;if((null==(o=e.envLightIds)?void 0:o.length)&&zi)for(const t of e.envLightIds)zi(t);Kb(e)}function qb(e){var t;const o=Vt();if(!o)return null;if(Ui.setFromCamera(Wi,o),Ui.far=e,Gi){Ni=[],Hi=new Map;for(const e of Ne)e.deviceBinding&&e.group.traverse(t=>{t.isMesh&&(Ni.push(t),Hi.set(t,e))});Gi=!1}if(0===Ni.length)return null;const n=Ui.intersectObjects(Ni,!1);return 0===n.length?null:null!=(t=Hi.get(n[0].object))?t:null}function F3(){var e;const t=qb(Math.max(3,3*Ye));if(!t||!t.deviceBinding)return!1;if(t.deviceBinding.isDecorative){const e=!Ii.getToggleState(t.group);if(Ii.remoteToggle(t.group,e),t.deviceBinding.ambientLightStates&&Di){const o=e?t.deviceBinding.ambientLightStates.onState:t.deviceBinding.ambientLightStates.offState;Di(o)}else Mu(t.deviceBinding);return!0}if("scene_object"===t.deviceBinding.deviceType&&t.deviceBinding.sceneObjectId){const e=Ne.find(e=>{const o=e.group.position;return`${e.assetFile}|${bn(o.x)},${bn(o.y)},${bn(o.z)}`===t.deviceBinding.sceneObjectId});if(e){const o=Ii.getToggleState(e.group),n=void 0===o||!o;Ii.remoteToggle(e.group,n);const s=t.deviceBinding.invertAnimation?!n:n;if(Ii.remoteToggle(t.group,s),t.deviceBinding.ambientLightStates&&Di){const e=s?t.deviceBinding.ambientLightStates.onState:t.deviceBinding.ambientLightStates.offState;Di(e)}else Mu(t.deviceBinding)}return!0}if("env_light"===t.deviceBinding.deviceType){const o=!Ii.getToggleState(t.group);if(t.deviceBinding.ambientLightStates&&Di){const e=o?t.deviceBinding.ambientLightStates.onState:t.deviceBinding.ambientLightStates.offState;Di(e)}else if(zi){const o=(null==(e=t.deviceBinding.envLightIds)?void 0:e.length)?t.deviceBinding.envLightIds:[t.deviceBinding.deviceId];for(const e of o)zi(e)}return Kb(t.deviceBinding),Ii.remoteToggle(t.group,o),!0}if(!Li)return!1;const o=Li.getChannel(t.deviceBinding.deviceId);if(!o)return!1;if(!o.canDirectControl)return!0;o.toggle().catch(e=>{});const n=!o.isOn,s=t.deviceBinding.invertAnimation?!n:n;if(Ii.remoteToggle(t.group,s),t.deviceBinding.ambientLightStates&&Di){const e=s?t.deviceBinding.ambientLightStates.onState:t.deviceBinding.ambientLightStates.offState;Di(e)}else Mu(t.deviceBinding);return!0}function E3(){if(!Ri)return!1;const e=Vt();if(!e)return!1;const t=Math.max(3,3*Ye);Ui.setFromCamera(Wi,e),Ui.far=t;const o=[],n=new Map;for(const e of Ne)e.doorTarget&&e.group.traverse(t=>{t.isMesh&&(o.push(t),n.set(t,e))});if(0===o.length)return!1;const s=Ui.intersectObjects(o,!1);if(0===s.length)return!1;const c=n.get(s[0].object);if(!c||!c.doorTarget)return!1;if(c.keypadLock){const e=H0();if("per-player"===c.keypadLockMode){const t=Oi||"local";if(!e.isUnlockedForPlayer(c.keypadLock,t))return!0}else if(!e.getKeypadUnlockedById(c.keypadLock))return!0}return Ri(c.doorTarget.envId,c.doorTarget.spawnKey),!0}function L3(e){var t,o,n,s,c;if(e.showRadial||e.placingAsset||e.showModal||!Li)return void(_i.value=null);const u=Vt();if(!u)return void(_i.value=null);const p=Math.max(3,3*Ye),v=qb(p);if(!v||!v.deviceBinding){if(Ri){Ui.setFromCamera(Wi,u),Ui.far=p;const e=[],t=new Map;for(const o of Ne)o.doorTarget&&o.group.traverse(n=>{n.isMesh&&(e.push(n),t.set(n,o))});if(e.length>0){const o=Ui.intersectObjects(e,!1);if(o.length>0){const e=t.get(o[0].object);if((null==e?void 0:e.doorTarget)&&(qi.copy(e.group.position),qi.y+=.3*Ye,qi.project(u),qi.z<=1)){const t=(void 0).innerWidth,o=(void 0).innerHeight,n=e.doorTarget.envId;let s=!1;if(e.keypadLock){const t=H0();s="per-player"===e.keypadLockMode?!t.isUnlockedForPlayer(e.keypadLock,Oi||"local"):!t.getKeypadUnlockedById(e.keypadLock)}return void(_i.value={deviceId:"__door__",displayName:s?"Unlock to open":`Enter ${n}`,isOn:!s,canControl:!s,screenX:(qi.x+1)/2*t,screenY:(1-qi.y)/2*o})}}}}return void(_i.value=null)}if(v.deviceBinding.isDecorative){if(qi.copy(v.group.position),qi.y+=.3*Ye,qi.project(u),qi.z>1)return void(_i.value=null);const e=(void 0).innerWidth,o=(void 0).innerHeight,n=null!=(t=Ii.getToggleState(v.group))&&t;return void(_i.value={deviceId:"__decorative__",displayName:"Light Switch",isOn:n,canControl:!0,screenX:(qi.x+1)/2*e,screenY:(1-qi.y)/2*o})}if("scene_object"===v.deviceBinding.deviceType&&v.deviceBinding.sceneObjectId){if(qi.copy(v.group.position),qi.y+=.3*Ye,qi.project(u),qi.z>1)return void(_i.value=null);const e=(void 0).innerWidth,t=(void 0).innerHeight,c=Ne.find(e=>{const t=e.group.position;return`${e.assetFile}|${bn(t.x)},${bn(t.y)},${bn(t.z)}`===v.deviceBinding.sceneObjectId}),p=!!c&&(null!=(o=Ii.getToggleState(c.group))&&o),f=(null==c?void 0:c.name)||(null==(s=null==(n=v.deviceBinding.sceneObjectId.split("|")[0])?void 0:n.split("/").pop())?void 0:s.replace(".glb",""))||"Object";return void(_i.value={deviceId:"__scene_object__",displayName:f,isOn:p,canControl:!0,screenX:(qi.x+1)/2*e,screenY:(1-qi.y)/2*t})}if("env_light"===v.deviceBinding.deviceType){if(qi.copy(v.group.position),qi.y+=.3*Ye,qi.project(u),qi.z>1)return void(_i.value=null);const e=(void 0).innerWidth,t=(void 0).innerHeight,o=null!=(c=Ii.getToggleState(v.group))&&c;return void(_i.value={deviceId:"__env_light__",displayName:v.deviceBinding.deviceId,isOn:o,canControl:!0,screenX:(qi.x+1)/2*e,screenY:(1-qi.y)/2*t})}const f=Li.getChannel(v.deviceBinding.deviceId);if(!f)return void(_i.value=null);if(qi.copy(v.group.position),qi.y+=.3*Ye,qi.project(u),qi.z>1)return void(_i.value=null);const g=(void 0).innerWidth,b=(void 0).innerHeight;_i.value={deviceId:f.id,displayName:f.displayName,isOn:f.isOn,canControl:f.canDirectControl,screenX:(qi.x+1)/2*g,screenY:(1-qi.y)/2*b}}function Yb(){if(Li)for(const e of Ne){if(!e.deviceBinding||e.deviceBinding.isDecorative||"scene_object"===e.deviceBinding.deviceType||"env_light"===e.deviceBinding.deviceType)continue;const t=Li.getChannel(e.deviceBinding.deviceId);if(!t)continue;const o=e.deviceBinding.invertAnimation?!t.isOn:t.isOn,n=Ii.getToggleState(e.group);if(void 0!==n&&n!==o&&Ii.remoteToggle(e.group,o),e.deviceBinding.ambientLightStates&&Di){const t=o?e.deviceBinding.ambientLightStates.onState:e.deviceBinding.ambientLightStates.offState;Di(t)}}}function B3(e=5e3){q0(),Ne.some(e=>e.deviceBinding&&!e.deviceBinding.isDecorative&&"scene_object"!==e.deviceBinding.deviceType&&"env_light"!==e.deviceBinding.deviceType)&&(Li&&Li.fetchAllStates().catch(()=>{}).finally(Yb),Bi=Xt())}function q0(){Bi&&(clearInterval(Bi),Bi=null)}function j3(e){if(!e.deviceBinding||e.deviceBinding.isDecorative||!Li)return;const t=Li.getChannel(e.deviceBinding.deviceId);if(!t)return;const o=e.deviceBinding.invertAnimation?!t.isOn:t.isOn;Ii.remoteToggle(e.group,o)}function Zb(){const e=Gb();return e&&e.split("/").pop()||null}function U3(){const e=Zb();return e?e.replace(/\.glb$/i,"").replace(/[-_]/g," "):null}function N3(){q0(),ji.value=!1,Fi.value=null,_i.value=null,Li=null,zi=null,Di=null,Ri=null,Ni=[],Hi=new Map,Gi=!0}function Xb(){return{showBindModal:ji,bindTargetGroup:Fi,nearbyDevice:_i,init:R3,openBindModal:O3,closeBindModal:Hb,saveBinding:z3,getCurrentBinding:I3,getTargetAssetFile:Gb,handleEKey:F3,updateProximityHUD:L3,syncAllBindings:Yb,syncSingleBinding:j3,startPolling:B3,stopPolling:q0,getTargetAssetFilename:Zb,getTargetAssetName:U3,setToggleEnvLightCallback:A3,setSetEnvLightStateCallback:V3,setRoomTransitionCallback:D3,handleDoorTravel:E3,setLocalPlayerId:P3,cleanup:N3}}const Ki=new Map,Ji=[];function H3(e,t){let o=Ki.get(e);return o||(o=new Set,Ki.set(e,o)),o.add(t),()=>Jb(e,t)}function Jb(e,t){const o=Ki.get(e);o&&(o.delete(t),0===o.size&&Ki.delete(e))}function G3(e,t){Ji.push({event:e,payload:t,timestamp:performance.now()}),Ji.length>200&&Ji.shift();const o=Ki.get(e);if(o)for(const e of[...o])try{e(t)}catch{}}function K3(){Ki.clear(),Ji.length=0}function q3(){return Ji}function Y3(e){var t,o;return null!=(o=null==(t=Ki.get(e))?void 0:t.size)?o:0}function Y0(){return{on:H3,off:Jb,emit:G3,clear:K3,getHistory:q3,listenerCount:Y3}}const Zi=Y0();let Xi=null,es=null,ts=null,as=null,os=null,ns=null,ls=null;function Z3(e){Xi=e}function X3(e){es=e}function J3(e){ts=e}function Q3(e){as=e}function _3(e){os=e}function ew(e){ns=e}function tw(e){ls=e}const ss=new Map;let ds=1;function Ug(e){return new Promise(t=>setTimeout(t,e))}async function om(e,t){var o,n;e.delay&&e.delay>0&&await Ug(e.delay);const s=function(e,t){if("self"===e.target.mode)return[t];if("specific"===e.target.mode&&e.target.objectId)return[e.target.objectId];if("tagged"===e.target.mode&&e.target.tag){const o=e.target.tag,n=Ne.filter(e=>{var t;return null==(t=e.tags)?void 0:t.includes(o)}).map(e=>e.systemId||`${e.assetFile}|${e.group.position.x.toFixed(3)},${e.group.position.y.toFixed(3)},${e.group.position.z.toFixed(3)}`);return n.length>0?n:[t]}return[t]}(e,t);switch(e.type){case"play-animation":{const t=e.params.direction?{direction:e.params.direction||"toggle",range:e.params.range||"full",rangeStart:e.params.rangeStart,rangeEnd:e.params.rangeEnd}:void 0,o="reverse"!==(null==t?void 0:t.direction);for(const e of s)null==Xi||Xi(e,o,t);break}case"stop-animation":for(const e of s)null==Xi||Xi(e,!1);break;case"travel-to-room":null==es||es(e.params.roomId,e.params.spawnKey);break;case"teleport-to-point":Zi.emit("navigation:travel",{roomId:e.params.roomId||"",spawnKey:e.params.spawnKey});break;case"set-property":for(const t of s)null==ns||ns(t,e.params.property,e.params.value),Zi.emit("property:changed",{objectId:t,property:e.params.property,value:e.params.value,oldValue:void 0});break;case"toggle-property":for(const t of s){const s=null==(n=null==(o=Ne.find(e=>e.systemId===t))?void 0:o.properties)?void 0:n[e.params.property],c="boolean"!=typeof s||!s;null==ns||ns(t,e.params.property,c),Zi.emit("property:changed",{objectId:t,property:e.params.property,value:c,oldValue:s})}break;case"toggle-collision":for(const t of s)null==ts||ts(t,!!e.params.enabled),Zi.emit("collision:toggle",{objectId:t,enabled:!!e.params.enabled});break;case"toggle-visibility":for(const t of s)null==ls||ls(t,!!e.params.visible);break;case"toggle-light":null==os||os(e.params.lightIds||[],!!e.params.enabled);break;case"play-sound":for(const t of s)null==as||as(t,e.params.soundUrl,!0,{volume:e.params.volume,spatial:e.params.spatial,loop:e.params.loop});break;case"stop-sound":for(const e of s)null==as||as(e,"",!1);break;case"send-message":Zi.emit("message:broadcast",{name:e.params.messageName||"",senderObjectId:t,data:e.params.data,tag:e.params.tag});break;case"delay":await Ug(e.params.duration||0)}}async function ow(e,t){if(!e||0===e.length)return;const o=ds++;ss.set(t,o);for(const n of e){if(ss.get(t)!==o)return;await om(n,t)}ss.get(t)===o&&ss.delete(t)}function nw(e){ss.delete(e)}function lw(e){return ss.has(e)}function iw(){ss.clear(),ds=1}function nm(){return{setAnimateCallback:Z3,setTravelCallback:X3,setToggleCollisionCallback:J3,setSoundCallback:Q3,setLightCallback:_3,setPropertyCallback:ew,setToggleVisibilityCallback:tw,executeChain:ow,executeStep:om,cancelChain:nw,hasActiveChain:lw,clear:iw}}const cs=Y0(),us=nm(),ps=is();let vs=null,fs=null,gs=null,bs=null,ms=null,hs=null,xs="local";function sw(e){vs=e}function rw(e){fs=e}function dw(e){gs=e}function cw(e){bs=e}function uw(e,t){ms=e,hs=t}function fw(e){xs=e}const ys=new Map,ws=new Map,ks=new Ue.Raycaster,Ss=new Ue.Vector2(0,0),Cs=new Ue.Vector3;function Ei(e){return e.systemId||`${e.assetFile}|${e.group.position.x.toFixed(4)},${e.group.position.y.toFixed(4)},${e.group.position.z.toFixed(4)}`}function lm(e){var t;const o=Vt();if(!o)return null;ks.setFromCamera(Ss,o),ks.far=e;const n=[],s=new Map;for(const e of Ne)e.behavior&&e.group.traverse(t=>{t.isMesh&&(n.push(t),s.set(t,e))});if(0===n.length)return null;const c=ks.intersectObjects(n,!1);return 0===c.length?null:null!=(t=s.get(c[0].object))?t:null}function hw(){const e=lm(Math.max(3,3*Ye));if(!e||!e.behavior)return!1;switch(e.behavior.type){case"button":return function(e){var t,o;if(e.deviceBinding&&e.deviceBinding.deviceType&&!e.deviceBinding.isDecorative&&("socket"===e.deviceBinding.deviceType||"light"===e.deviceBinding.deviceType||"blower"===e.deviceBinding.deviceType))return!1;const n=e.behavior.config,s=Ei(e),c=performance.now();if(c<(ys.get(s)||0))return!0;ys.set(s,c+(n.cooldown||500));const u=ps.getToggleState(e.group);return void 0!==u&&ps.remoteToggle(e.group,!u),null==bs||bs(),cs.emit("object:interact",{objectId:s}),cs.emit("object:activated",{objectId:s}),(null==(t=e.behavior.onInteract)?void 0:t.length)&&us.executeChain(e.behavior.onInteract,s),"click"===n.mode&&(cs.emit("object:deactivated",{objectId:s}),(null==(o=e.behavior.onDeactivate)?void 0:o.length)&&us.executeChain(e.behavior.onDeactivate,s)),!0}(e);case"switch":return function(e){var t,o,n,s,c;if(e.deviceBinding&&e.deviceBinding.deviceType&&!e.deviceBinding.isDecorative&&("socket"===e.deviceBinding.deviceType||"light"===e.deviceBinding.deviceType||"blower"===e.deviceBinding.deviceType))return!1;const u=Ei(e),p=!(null!=(t=ps.getToggleState(e.group))&&t);ps.remoteToggle(e.group,p),null==bs||bs();const v=e.behavior.config;if(v.ambientLightStates&&gs){const e=p?v.ambientLightStates.onState:v.ambientLightStates.offState;gs(e)}if((null==(o=v.envLightIds)?void 0:o.length)&&fs)for(const e of v.envLightIds)fs(e);if(null==(n=v.doorIds)?void 0:n.length)for(const e of v.doorIds){const t=Ne.find(t=>Ei(t)===e);if(t){const e=ps.getToggleState(t.group);ps.remoteToggle(t.group,void 0===e||!e)}}if(v.sceneObjectId){const e=Ne.find(e=>Ei(e)===v.sceneObjectId);e&&ps.remoteToggle(e.group,p)}return cs.emit("object:interact",{objectId:u}),p?(cs.emit("object:activated",{objectId:u}),(null==(s=e.behavior.onActivate)?void 0:s.length)&&us.executeChain(e.behavior.onActivate,u)):(cs.emit("object:deactivated",{objectId:u}),(null==(c=e.behavior.onDeactivate)?void 0:c.length)&&us.executeChain(e.behavior.onDeactivate,u)),!0}(e);case"door":return function(e){var t;const o=e.behavior.config,n=Ei(e);if(o.requiresUnlock&&o.lockKeypadId)if("per-player"===o.lockMode){if(hs&&!hs(o.lockKeypadId,xs))return!0}else if(ms&&!ms(o.lockKeypadId))return!0;if(null==bs||bs(),"animated"===o.doorType||"both"===o.doorType){if(!0===ps.getToggleState(e.group)){ps.remoteToggle(e.group,!1),cs.emit("object:deactivated",{objectId:n});const t=ws.get(n);t&&(clearTimeout(t),ws.delete(n))}else if(ps.remoteToggle(e.group,!0),cs.emit("object:activated",{objectId:n}),(null==(t=e.behavior.onInteract)?void 0:t.length)&&us.executeChain(e.behavior.onInteract,n),o.travelAfterAnimation&&o.targetRoomId&&vs&&setTimeout(()=>{vs(o.targetRoomId,o.targetSpawnKey)},o.travelDelay||500),o.autoClose){const t=ws.get(n);t&&clearTimeout(t),ws.set(n,setTimeout(()=>{ps.remoteToggle(e.group,!1),cs.emit("object:deactivated",{objectId:n}),ws.delete(n)},o.autoCloseDelay||3e3))}}else"portal"===o.doorType&&(o.targetRoomId&&vs&&vs(o.targetRoomId,o.targetSpawnKey),cs.emit("object:interact",{objectId:n}));return!0}(e);case"keypad":case"screen":default:return!1;case"elevator":return function(e){var t;e.behavior.config;const o=Ei(e);return null==bs||bs(),ps.remoteToggle(e.group,!0),cs.emit("object:activated",{objectId:o}),(null==(t=e.behavior.onInteract)?void 0:t.length)&&us.executeChain(e.behavior.onInteract,o),!0}(e)}}function xw(e){var t;if(e.showRadial||e.placingAsset||e.showModal)return null;const o=Vt();if(!o)return null;const n=lm(Math.max(3,3*Ye));if(!n||!n.behavior||(Cs.copy(n.group.position),Cs.y+=.3*Ye,Cs.project(o),Cs.z>1))return null;const s=(void 0).innerWidth,c=(void 0).innerHeight,u=(Cs.x+1)/2*s,p=(1-Cs.y)/2*c,v=n.behavior.config,f=null!=(t=ps.getToggleState(n.group))&&t;switch(n.behavior.type){case"button":return{deviceId:"__behavior_button__",displayName:v.interactPrompt||"Press E",isOn:f,canControl:!0,screenX:u,screenY:p};case"switch":return{deviceId:"__behavior_switch__",displayName:v.interactPrompt||n.name||"Switch",isOn:f,canControl:!0,screenX:u,screenY:p};case"door":{const e=v;let t=!1;e.requiresUnlock&&e.lockKeypadId&&(t="per-player"===e.lockMode?!hs||!hs(e.lockKeypadId,xs):!ms||!ms(e.lockKeypadId));const o=e.targetRoomId||"Door";return{deviceId:"__behavior_door__",displayName:t?"Locked":e.targetRoomId?`Enter ${o}`:"Open",isOn:!t,canControl:!t,screenX:u,screenY:p}}case"elevator":return{deviceId:"__behavior_elevator__",displayName:"Call Elevator",isOn:f,canControl:!0,screenX:u,screenY:p};default:return null}}function ww(){ys.clear();for(const e of ws.values())clearTimeout(e);ws.clear()}function kw(e){switch(e){case"button":return{mode:"click",interactRange:3,interactPrompt:"Press E",cooldown:500,highlightOnHover:!0,highlightColor:"#00aaff"};case"switch":return{mode:"toggle",interactRange:3,interactPrompt:""};case"door":return{doorType:"portal",targetRoomId:"",targetSpawnKey:"",autoClose:!1,autoCloseDelay:3e3,disableCollisionWhenOpen:!0,travelAfterAnimation:!1,travelDelay:500,requiresUnlock:!1,lockKeypadId:"",lockMode:"everyone"};case"keypad":return{keypadData:null};case"screen":return{displayZones:[]};case"elevator":return{doorOpenAnimation:"",disableCollisionWhenOpen:!0,floors:[],doorOpenDuration:3e3,travelDelay:1e3};default:return{}}}function im(){return{setRoomTransitionCallback:sw,setToggleEnvLightCallback:rw,setEnvLightStateCallback:dw,setPlayClickSoundCallback:cw,setKeypadCallbacks:uw,setLocalPlayerId:fw,handleBehaviorInteraction:hw,getBehaviorProximityHUD:xw,getDefaultConfig:kw,clear:ww}}const $s=e({__name:"Room3dObjectConfigModal",__ssrInlineRender:!0,props:{show:{type:Boolean},targetObject:{},currentBinding:{},channels:{},sceneObjects:{},envLights:{},doors:{},animRange:{},animStart:{},animEnd:{},allPresetLights:{},lightingPresets:{},lightingMode:{},editMode:{type:Boolean},assetName:{}},emits:["close","trace-screen","open-display-editor","save"],setup(e,{emit:n}){const c=e,u=n,g=is(),b=Xb(),h=Bc(),x=im(),{socketNames:S}=la(),$=t(""),M=t(""),T=t(!1),V=t(""),O=t({}),I=t([]),j=t([]),E=t([]),ne=t(null),se=t(!1),re=t(""),ue=t(!1),pe=t(!1),ve=t("instance"),fe=t(null),ge=t(null),be=t(new Set),he=t(new Set),xe=t("full"),ye=t(0),we=t(100),ke=t({}),Se=t({}),Ce=t([]),$e=o(()=>{var e;return c.targetObject?(null==(e=c.targetObject.assetFile.split("/").pop())?void 0:e.replace(".glb",""))||"Object":""}),Me=o(()=>{switch(V.value){case"button":return"Triggers an action when pressed";case"switch":return"Toggles state on/off, controls devices";case"door":return"Opens/closes, optionally travels to another room";case"keypad":return"Numeric code entry with unlock actions";case"screen":return"Display surface for text, images, data";case"elevator":return"Animated doors + floor travel";default:return"No interaction behavior"}}),Te=o(()=>We.map(e=>({id:e.id,name:e.name}))),Ve=o(()=>{var e;return(null==(e=O.value)?void 0:e.displayZones)||[]}),Pe=o(()=>Ne.filter(e=>{var t,o,n;return(null==(o=null==(t=e.keypadData)?void 0:t.buttons)?void 0:o.length)>0||"keypad"===(null==(n=e.behavior)?void 0:n.type)}).map(e=>{var t;return{id:e.systemId||`${e.assetFile}|${e.group.position.x.toFixed(4)},${e.group.position.y.toFixed(4)},${e.group.position.z.toFixed(4)}`,name:e.name||(null==(t=e.assetFile.split("/").pop())?void 0:t.replace(".glb",""))||"Keypad"}})),ze=t("behavior"),De=o(()=>{const e=[];return e.push({id:"behavior",label:V.value?ot(V.value):"Behavior"}),"switch"===V.value&&(e.push({id:"ambient",label:"Ambient"}),e.push({id:"automation",label:"Automation"})),c.targetObject&&g.isAnimatedAsset(c.targetObject.assetFile)&&e.push({id:"animation",label:"Animation"}),e});function ot(e){return e.charAt(0).toUpperCase()+e.slice(1)}const Oe=t(!1),Re=t(null);let Ie=null,je=null,Fe=null,_e=null,Le=null,He=null,Ge=null,qe=null,Ye=0,Je=new Ue.Clock,Ze="",Qe=2,et=0,tt=0,nt=3;function Be(e){var t;ne.value=e,fe.value=null,ge.value=null,e&&("socket"===(null==(t=c.channels.find(t=>t.id===e))?void 0:t.type)?re.value=S.value[e]||"":re.value="")}function Ee(e){ne.value=`__scene__:${e.id}`,fe.value=e.id,ge.value=null}function W(e){const t=new Set(be.value);t.has(e.id)?t.delete(e.id):t.add(e.id),be.value=t;const o=t.size>0?[...t][0]:null;ge.value=o,ne.value=o?`__envlight__:${o}`:null,fe.value=null}function C(e){const t=new Set(he.value);t.has(e.id)?t.delete(e.id):t.add(e.id),he.value=t}function Q(e){const t="on"===e?ke.value:Se.value;u("save",{binding:null,animRange:xe.value,animStart:ye.value,animEnd:we.value,editedName:`__preview__:${e}:${JSON.stringify(t)}`})}function L(){Oe.value=!1,et=0,tt=0,Ye&&(cancelAnimationFrame(Ye),Ye=0),_e&&(_e.dispose(),_e=null),He&&(He.stop(),He=null),Le&&(Le.stopAllAction(),Le=null),Ge=null,qe&&(qe.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),qe=null),je&&(je.clear(),je=null),Ie&&(Ie.dispose(),Ie=null),Fe=null,Ze=""}return s(()=>c.show,e=>{var t,o,n,s,u,p,v,f,x,F,_,U,N;if(e){const e=c.targetObject;if(ze.value="behavior",$.value=(null==e?void 0:e.name)||"",M.value=((null==e?void 0:e.tags)||[]).join(", "),T.value=null!=(t=null==e?void 0:e.locked)&&t,(null==e?void 0:e.behavior)?(V.value=e.behavior.type,O.value=JSON.parse(JSON.stringify(e.behavior.config||{})),I.value=e.behavior.onInteract?JSON.parse(JSON.stringify(e.behavior.onInteract)):[],j.value=e.behavior.onActivate?JSON.parse(JSON.stringify(e.behavior.onActivate)):[],E.value=e.behavior.onDeactivate?JSON.parse(JSON.stringify(e.behavior.onDeactivate)):[]):(V.value="",O.value={},I.value=[],j.value=[],E.value=[]),ue.value=null!=(n=null==(o=c.currentBinding)?void 0:o.isDecorative)&&n,pe.value=null!=(u=null==(s=c.currentBinding)?void 0:s.configLocked)&&u,ve.value="instance",fe.value=null,ge.value=null,be.value=new Set,he.value=new Set,se.value=null!=(v=null==(p=c.currentBinding)?void 0:p.invertAnimation)&&v,c.currentBinding)if((null==(f=c.currentBinding.envLightIds)?void 0:f.length)&&(be.value=new Set(c.currentBinding.envLightIds)),(null==(x=c.currentBinding.doorIds)?void 0:x.length)&&(he.value=new Set(c.currentBinding.doorIds)),c.currentBinding.isDecorative)ne.value=null;else if("scene_object"===c.currentBinding.deviceType&&c.currentBinding.sceneObjectId)fe.value=c.currentBinding.sceneObjectId,ne.value=`__scene__:${c.currentBinding.sceneObjectId}`;else if("env_light"===c.currentBinding.deviceType)ge.value=c.currentBinding.deviceId,ne.value=`__envlight__:${c.currentBinding.deviceId}`,(null==(F=c.currentBinding.envLightIds)?void 0:F.length)||(be.value=new Set([c.currentBinding.deviceId]));else{ne.value=c.currentBinding.deviceId;const e=c.channels.find(e=>e.id===c.currentBinding.deviceId);"socket"===(null==e?void 0:e.type)&&(re.value=S.value[e.id]||"")}else ne.value=null,re.value="";if(xe.value=c.animRange,ye.value=c.animStart,we.value=c.animEnd,null==(_=c.currentBinding)?void 0:_.ambientLightStates)ke.value={...c.currentBinding.ambientLightStates.onState},Se.value={...c.currentBinding.ambientLightStates.offState};else{const e={};for(const t of c.allPresetLights||[])for(const o of t.lights)e[o.id]=o.enabled;ke.value={...e},Se.value={...e}}Ce.value=(null==(U=c.currentBinding)?void 0:U.presetTriggers)?JSON.parse(JSON.stringify(c.currentBinding.presetTriggers)):[];const J=(null==e?void 0:e.assetFile)||b.getTargetAssetFile();if(J){const e=J.split("/").pop()||"";nt=null!=(N=h.getThumbOffset(e).light)?N:3}else nt=3;!function(){let e=0;const k=()=>{const t=Re.value;t&&t.clientWidth>10&&t.clientHeight>10?function(){var e;L();const t=Re.value;if(!t)return;const o=t.clientWidth||240,n=t.clientHeight||300;et=o,tt=n;const s=(null==(e=c.targetObject)?void 0:e.assetFile)||b.getTargetAssetFile();if(!s)return;Ze=s;const u=Xe.get(s);if(!u)return;const p=g.getCachedClips(s);Ie=new Ue.WebGLRenderer({canvas:t,antialias:!0,alpha:!1}),Ie.setPixelRatio(Math.min(devicePixelRatio,2)),Ie.setSize(o,n,!1),Ie.toneMapping=Ue.ACESFilmicToneMapping,Ie.toneMappingExposure=1.2,je=new Ue.Scene,je.background=new Ue.Color(657940);const v=new Ue.AmbientLight(16777215,.8*nt);je.add(v);const f=new Ue.DirectionalLight(16777215,1.2*nt);f.position.set(2,3,2),je.add(f);const x=new Ue.DirectionalLight(8956671,.4*nt);x.position.set(-2,1,-1),je.add(x),qe=g.cloneTemplate(u),qe.updateMatrixWorld(!0),p&&p.length>0&&(Ge=p[0],Le=new Ue.AnimationMixer(qe),He=Le.clipAction(Ge),He.setLoop(Ue.LoopOnce,1),He.clampWhenFinished=!0,He.play(),Le.update(1/60),qe.updateMatrixWorld(!0),He.paused=!0);const S=new Ue.Box3;qe.traverse(e=>{if(!e.isMesh||!e.geometry)return;const t=e.geometry;if(t.boundingBox||t.computeBoundingBox(),!t.boundingBox||t.boundingBox.isEmpty())return;const o=t.boundingBox.clone();o.applyMatrix4(e.matrixWorld),S.union(o)}),S.isEmpty()&&S.set(new Ue.Vector3(-.5,-.5,-.5),new Ue.Vector3(.5,.5,.5));const $=S.getCenter(new Ue.Vector3),M=S.getSize(new Ue.Vector3);let T=Math.max(M.x,M.y,M.z);(!isFinite(T)||T<1e-4)&&(T=1),qe.position.sub($),je.add(qe);const V=40;Qe=T/(2*Math.tan(V/2*Math.PI/180))*1.4;const O=.001*Qe,I=20*Qe;Fe=new Ue.PerspectiveCamera(V,o/n,O,I);const j=Ze.split("/").pop()||"",F=h.getThumbOffset(j),_=new Ue.Vector3(F.x,F.y,F.z),E=Qe/Math.max(.1,F.zoom);Fe.position.set(0,.35*E,E),Fe.lookAt(_),_e=new na(Fe,t),_e.target.copy(_),_e.enableDamping=!0,_e.dampingFactor=.1,_e.minDistance=.05*Qe,_e.maxDistance=15*Qe,_e.enablePan=!0,_e.autoRotate=!1,Je=new Ue.Clock,Oe.value=!0;const _o=()=>{if(Ye=requestAnimationFrame(_o),!(Ie&&je&&Fe&&_e))return;const e=Ie.domElement,t=e.clientWidth,o=e.clientHeight;t>0&&o>0&&(t!==et||o!==tt)&&(Ie.setSize(t,o,!1),Fe.aspect=t/o,Fe.updateProjectionMatrix(),et=t,tt=o);const n=Je.getDelta();_e.update(),Le&&Le.update(n),Ie.render(je,Fe)};_o()}():e++<60&&requestAnimationFrame(k)};requestAnimationFrame(k)}()}else L()}),s(V,(e,t)=>{e&&e!==t&&(void 0!==t&&""!==t?(O.value=x.getDefaultConfig(e),I.value=[],j.value=[],E.value=[]):Object.keys(O.value).length||(O.value=x.getDefaultConfig(e)))}),(t,o,n,s)=>{const c=Cl,u=Tl,g=zl,b=Rl,h=Fl;e.show?(o(`<div${F(p({class:"absolute inset-0 z-40 flex items-center justify-center"},s))} data-v-7eff1a68><div class="absolute inset-0 bg-black/50 backdrop-blur-sm" data-v-7eff1a68></div><div class="config-panel relative flex flex-col" style="${oe({"max-width":"960px",width:"calc(100% - 2rem)","max-height":"85vh"})}" data-v-7eff1a68><div class="flex items-center justify-between px-6 py-4 shrink-0" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.08)"})}" data-v-7eff1a68><div class="flex items-center gap-2.5" data-v-7eff1a68><div class="w-9 h-9 rounded-xl flex items-center justify-center" style="${oe({background:"rgba(245,158,11,0.15)",border:"1px solid rgba(245,158,11,0.3)"})}" data-v-7eff1a68>`),o(_(v(ce),{class:"w-5 h-5 text-amber-400"},null,n)),o(`</div><div data-v-7eff1a68><h2 class="text-white font-black text-xl tracking-wide" data-v-7eff1a68>CONFIGURE</h2><p class="text-gray-500 text-base" data-v-7eff1a68>${Z(v($)||v($e)||"Object")}</p></div></div><button class="w-10 h-10 rounded-xl flex items-center justify-center text-gray-500 hover:text-white hover:bg-white/10 transition-all border border-transparent hover:border-white/15" data-v-7eff1a68>`),o(_(v(de),{class:"w-5 h-5"},null,n)),o(`</button></div><div class="flex flex-1 min-h-0 overflow-hidden" data-v-7eff1a68><div class="w-[300px] shrink-0 flex flex-col px-5 py-4 overflow-y-auto" style="${oe({"border-right":"1px solid rgba(255,255,255,0.06)"})}" data-v-7eff1a68><div class="w-full rounded-xl overflow-hidden relative" style="${oe({"aspect-ratio":"4/5",background:"linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01))"})}" data-v-7eff1a68><div class="relative w-full h-full" data-v-7eff1a68><canvas class="preview-canvas w-full h-full block" data-v-7eff1a68></canvas>`),v(Oe)?o("\x3c!----\x3e"):o('<div class="absolute inset-0 flex items-center justify-center pointer-events-none" data-v-7eff1a68><div class="w-8 h-8 border-2 border-teal-500/30 border-t-teal-500 rounded-full animate-spin" data-v-7eff1a68></div></div>'),o(`</div></div><div class="mt-4" data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Name</label><input${J("value",v($))} class="w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-base text-white focus:border-teal-500 outline-none" placeholder="Object name..." data-v-7eff1a68></div><div class="mt-3" data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Tags</label><input${J("value",v(M))} class="w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-base text-white focus:border-teal-500 outline-none" placeholder="tag1, tag2..." data-v-7eff1a68><p class="text-base text-gray-600 mt-1" data-v-7eff1a68>Comma-separated labels for targeting</p></div><div class="mt-4" data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Behavior</label><select class="w-full bg-gray-900 border border-gray-600 rounded-lg px-3 py-2 text-base text-white focus:border-teal-500 outline-none" data-v-7eff1a68><option value="" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),""):le(v(V),""))?" selected":""}>None (static prop)</option><option value="button" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"button"):le(v(V),"button"))?" selected":""}>Button</option><option value="switch" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"switch"):le(v(V),"switch"))?" selected":""}>Switch</option><option value="door" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"door"):le(v(V),"door"))?" selected":""}>Door</option><option value="keypad" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"keypad"):le(v(V),"keypad"))?" selected":""}>Keypad</option><option value="screen" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"screen"):le(v(V),"screen"))?" selected":""}>Screen</option><option value="elevator" data-v-7eff1a68${X(Array.isArray(v(V))?ee(v(V),"elevator"):le(v(V),"elevator"))?" selected":""}>Elevator</option></select><p class="text-base text-gray-600 mt-1" data-v-7eff1a68>${Z(v(Me))}</p></div>`),e.editMode?o(`<div class="mt-3 flex items-center gap-3" data-v-7eff1a68><label class="text-base text-gray-400 font-medium" data-v-7eff1a68>Locked</label><button class="${U([v(T)?"bg-teal-500":"bg-gray-700","w-10 h-5 rounded-full transition-colors relative"])}" data-v-7eff1a68><div class="${U([v(T)?"translate-x-5":"translate-x-0.5","w-4 h-4 rounded-full bg-white absolute top-0.5 transition-transform"])}" data-v-7eff1a68></div></button></div>`):o("\x3c!----\x3e"),o(`</div><div class="flex-1 flex flex-col min-w-0" data-v-7eff1a68><div class="px-4 pt-3 pb-1 shrink-0" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.06)"})}" data-v-7eff1a68><div class="flex gap-1 p-1 rounded-xl" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-7eff1a68>\x3c!--[--\x3e`),N(v(De),e=>{o(`<button class="${U([v(ze)===e.id?"config-tab--active":"config-tab--idle","flex-1 py-2 rounded-lg text-base font-bold transition-all"])}" data-v-7eff1a68>${Z(e.label)}</button>`)}),o('\x3c!--]--\x3e</div></div><div class="flex-1 overflow-y-auto px-4 py-3" data-v-7eff1a68>'),"behavior"===v(ze)?(o("\x3c!--[--\x3e"),"button"===v(V)?(o(`<div class="space-y-4" data-v-7eff1a68><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Mode</label><select class="cfg-select" data-v-7eff1a68><option value="click" data-v-7eff1a68${X(Array.isArray(v(O).mode)?ee(v(O).mode,"click"):le(v(O).mode,"click"))?" selected":""}>Click (single fire)</option><option value="hold" data-v-7eff1a68${X(Array.isArray(v(O).mode)?ee(v(O).mode,"hold"):le(v(O).mode,"hold"))?" selected":""}>Hold</option><option value="toggle" data-v-7eff1a68${X(Array.isArray(v(O).mode)?ee(v(O).mode,"toggle"):le(v(O).mode,"toggle"))?" selected":""}>Toggle</option></select></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Interact Prompt</label><input${J("value",v(O).interactPrompt)} class="cfg-input" placeholder="Press E to activate" data-v-7eff1a68></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Cooldown (ms)</label><input type="number"${J("value",v(O).cooldown)} class="cfg-input" min="0" step="100" data-v-7eff1a68></div>`),o(_(c,{modelValue:v(I),"onUpdate:modelValue":e=>f(I)?I.value=e:null,label:"On Press"},null,n)),o("</div>")):"switch"===v(V)?(o('<div class="space-y-4" data-v-7eff1a68>'),o(_(u,{channels:e.channels,"scene-objects":e.sceneObjects,"env-lights":e.envLights,doors:e.doors,"selected-device-id":v(ne),"selected-scene-object-id":v(fe),"selected-env-light-ids":v(be),"selected-door-ids":v(he),"edit-mode":e.editMode,"is-decorative":v(ue),"config-locked":v(pe),"apply-scope":v(ve),"edit-name":v(re),onSelectDevice:Be,onSelectSceneObject:Ee,onSelectEnvLight:W,onSelectDoor:C,"onUpdate:decorative":e=>ue.value=e,"onUpdate:configLocked":e=>pe.value=e,"onUpdate:applyScope":e=>ve.value=e,"onUpdate:editName":e=>re.value=e},null,n)),o(_(c,{modelValue:v(j),"onUpdate:modelValue":e=>f(j)?j.value=e:null,label:"On Activate"},null,n)),o(_(c,{modelValue:v(E),"onUpdate:modelValue":e=>f(E)?E.value=e:null,label:"On Deactivate"},null,n)),o("</div>")):"door"===v(V)?(o(`<div class="space-y-4" data-v-7eff1a68><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Door Type</label><select class="cfg-select" data-v-7eff1a68><option value="portal" data-v-7eff1a68${X(Array.isArray(v(O).doorType)?ee(v(O).doorType,"portal"):le(v(O).doorType,"portal"))?" selected":""}>Portal (instant travel)</option><option value="animated" data-v-7eff1a68${X(Array.isArray(v(O).doorType)?ee(v(O).doorType,"animated"):le(v(O).doorType,"animated"))?" selected":""}>Animated (open/close)</option><option value="both" data-v-7eff1a68${X(Array.isArray(v(O).doorType)?ee(v(O).doorType,"both"):le(v(O).doorType,"both"))?" selected":""}>Animated + Travel</option></select></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Target Room</label><select class="cfg-select" data-v-7eff1a68><option value="" data-v-7eff1a68${X(Array.isArray(v(O).targetRoomId)?ee(v(O).targetRoomId,""):le(v(O).targetRoomId,""))?" selected":""}>None</option>\x3c!--[--\x3e`),N(v(Te),e=>{o(`<option${J("value",e.id)} data-v-7eff1a68${X(Array.isArray(v(O).targetRoomId)?ee(v(O).targetRoomId,e.id):le(v(O).targetRoomId,e.id))?" selected":""}>${Z(e.name)}</option>`)}),o(`\x3c!--]--\x3e</select></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Spawn Key</label><input${J("value",v(O).targetSpawnKey)} class="cfg-input" placeholder="(default spawn)" data-v-7eff1a68></div>`),"portal"!==v(O).doorType?(o(`<div class="space-y-3" data-v-7eff1a68><div class="flex items-center gap-3" data-v-7eff1a68><input type="checkbox"${X(Array.isArray(v(O).disableCollisionWhenOpen)?ee(v(O).disableCollisionWhenOpen,null):v(O).disableCollisionWhenOpen)?" checked":""} class="w-4 h-4 accent-teal-500" data-v-7eff1a68><span class="text-base text-gray-300" data-v-7eff1a68>Disable collision when open</span></div><div class="flex items-center gap-3" data-v-7eff1a68><input type="checkbox"${X(Array.isArray(v(O).travelAfterAnimation)?ee(v(O).travelAfterAnimation,null):v(O).travelAfterAnimation)?" checked":""} class="w-4 h-4 accent-teal-500" data-v-7eff1a68><span class="text-base text-gray-300" data-v-7eff1a68>Travel after animation</span></div>`),v(O).travelAfterAnimation?o(`<div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Travel delay (ms)</label><input type="number"${J("value",v(O).travelDelay)} class="cfg-input" min="0" step="100" data-v-7eff1a68></div>`):o("\x3c!----\x3e"),o(`<div class="flex items-center gap-3" data-v-7eff1a68><input type="checkbox"${X(Array.isArray(v(O).autoClose)?ee(v(O).autoClose,null):v(O).autoClose)?" checked":""} class="w-4 h-4 accent-teal-500" data-v-7eff1a68><span class="text-base text-gray-300" data-v-7eff1a68>Auto-close</span></div>`),v(O).autoClose?o(`<div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Auto-close delay (ms)</label><input type="number"${J("value",v(O).autoCloseDelay)} class="cfg-input" min="0" step="500" data-v-7eff1a68></div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o(`<div class="space-y-3" data-v-7eff1a68><div class="flex items-center gap-3" data-v-7eff1a68><input type="checkbox"${X(Array.isArray(v(O).requiresUnlock)?ee(v(O).requiresUnlock,null):v(O).requiresUnlock)?" checked":""} class="w-4 h-4 accent-teal-500" data-v-7eff1a68><span class="text-base text-gray-300" data-v-7eff1a68>Requires keypad unlock</span></div>`),v(O).requiresUnlock?(o(`\x3c!--[--\x3e<div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Lock Keypad</label><select class="cfg-select" data-v-7eff1a68><option value="" data-v-7eff1a68${X(Array.isArray(v(O).lockKeypadId)?ee(v(O).lockKeypadId,""):le(v(O).lockKeypadId,""))?" selected":""}>None</option>\x3c!--[--\x3e`),N(v(Pe),e=>{o(`<option${J("value",e.id)} data-v-7eff1a68${X(Array.isArray(v(O).lockKeypadId)?ee(v(O).lockKeypadId,e.id):le(v(O).lockKeypadId,e.id))?" selected":""}>${Z(e.name)}</option>`)}),o(`\x3c!--]--\x3e</select></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Lock Mode</label><select class="cfg-select" data-v-7eff1a68><option value="everyone" data-v-7eff1a68${X(Array.isArray(v(O).lockMode)?ee(v(O).lockMode,"everyone"):le(v(O).lockMode,"everyone"))?" selected":""}>Everyone (global unlock)</option><option value="per-player" data-v-7eff1a68${X(Array.isArray(v(O).lockMode)?ee(v(O).lockMode,"per-player"):le(v(O).lockMode,"per-player"))?" selected":""}>Per Player</option></select></div>\x3c!--]--\x3e`)):o("\x3c!----\x3e"),o("</div>"),o(_(c,{modelValue:v(I),"onUpdate:modelValue":e=>f(I)?I.value=e:null,label:"On Open"},null,n)),o("</div>")):"keypad"===v(V)?(o('\x3c!--[--\x3e<div class="text-base text-gray-400 py-4" data-v-7eff1a68><p data-v-7eff1a68>This object uses the Keypad system. Open the Keypad Wizard from the radial menu to configure buttons and codes.</p></div>'),o(_(c,{modelValue:v(I),"onUpdate:modelValue":e=>f(I)?I.value=e:null,label:"On Unlock"},null,n)),o("\x3c!--]--\x3e")):"screen"===v(V)?(o('<div class="space-y-3" data-v-7eff1a68><p class="text-base text-gray-400" data-v-7eff1a68>Trace a display surface on this object, then add content (text, images, sensor data).</p>'),v(Ve).length>0?(o('<div class="space-y-2" data-v-7eff1a68><div class="text-base font-medium text-gray-300" data-v-7eff1a68>Display Zones</div>\x3c!--[--\x3e'),N(v(Ve),(e,t)=>{var n;o(`<div class="flex items-center gap-2 bg-gray-800/50 rounded-lg p-2 border border-gray-700/50" data-v-7eff1a68><div class="flex-1" data-v-7eff1a68><span class="text-base text-white" data-v-7eff1a68>Zone ${Z(Number(t)+1)}</span><span class="text-base text-gray-500 ml-2" data-v-7eff1a68>${Z((null==(n=e.elements)?void 0:n.length)||0)} elements</span></div><button class="px-3 py-1 text-base text-teal-400 bg-teal-500/10 border border-teal-500/30 rounded hover:bg-teal-500/20 transition-colors" data-v-7eff1a68> Edit </button><button class="p-1 text-gray-500 hover:text-red-400 transition-colors" title="Remove zone" data-v-7eff1a68><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-7eff1a68><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" data-v-7eff1a68></path></svg></button></div>`)}),o("\x3c!--]--\x3e</div>")):o("\x3c!----\x3e"),o(`<button class="w-full py-3 px-4 rounded-xl text-base font-bold text-teal-400 transition-all" style="${oe({background:"rgba(20,184,166,0.1)",border:"1px solid rgba(20,184,166,0.3)"})}" data-v-7eff1a68> + Trace Display Surface </button><p class="text-base text-gray-600" data-v-7eff1a68>Click to close this modal and trace a polygon on the object&#39;s surface with the crosshair.</p></div>`)):"elevator"===v(V)?(o(`<div class="space-y-4" data-v-7eff1a68><div class="flex items-center gap-3" data-v-7eff1a68><input type="checkbox"${X(Array.isArray(v(O).disableCollisionWhenOpen)?ee(v(O).disableCollisionWhenOpen,null):v(O).disableCollisionWhenOpen)?" checked":""} class="w-4 h-4 accent-teal-500" data-v-7eff1a68><span class="text-base text-gray-300" data-v-7eff1a68>Disable collision when doors open</span></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Door open duration (ms)</label><input type="number"${J("value",v(O).doorOpenDuration)} class="cfg-input" min="0" step="500" data-v-7eff1a68></div><div data-v-7eff1a68><label class="text-base text-gray-400 font-medium mb-1 block" data-v-7eff1a68>Floors</label>\x3c!--[--\x3e`),N(v(O).floors||[],(e,t)=>{o(`<div class="flex gap-2 mb-2" data-v-7eff1a68><input${J("value",e.name)} class="cfg-input flex-1" placeholder="Floor name" data-v-7eff1a68><select class="cfg-select flex-1" data-v-7eff1a68><option value="" data-v-7eff1a68${X(Array.isArray(e.roomId)?ee(e.roomId,""):le(e.roomId,""))?" selected":""}>Room...</option>\x3c!--[--\x3e`),N(v(Te),t=>{o(`<option${J("value",t.id)} data-v-7eff1a68${X(Array.isArray(e.roomId)?ee(e.roomId,t.id):le(e.roomId,t.id))?" selected":""}>${Z(t.name)}</option>`)}),o('\x3c!--]--\x3e</select><button class="text-red-400 hover:text-red-300 px-2" data-v-7eff1a68>Ã—</button></div>')}),o('\x3c!--]--\x3e<button class="text-base text-teal-400 hover:text-teal-300" data-v-7eff1a68>+ Add Floor</button></div>'),o(_(c,{modelValue:v(I),"onUpdate:modelValue":e=>f(I)?I.value=e:null,label:"On Call"},null,n)),o("</div>")):o('<div class="text-base text-gray-500 py-8 text-center" data-v-7eff1a68><p data-v-7eff1a68>This object has no behavior assigned.</p><p class="mt-2" data-v-7eff1a68>Select a behavior from the dropdown on the left to make it interactive.</p></div>'),o("\x3c!--]--\x3e")):o("\x3c!----\x3e"),"ambient"===v(ze)?o(_(g,{"preset-groups":e.allPresetLights||[],"on-states":v(ke),"off-states":v(Se),"onUpdate:onStates":e=>ke.value=e,"onUpdate:offStates":e=>Se.value=e,onPreview:Q},null,n)):o("\x3c!----\x3e"),"animation"===v(ze)?o(_(b,{"anim-range":v(xe),"anim-start":v(ye),"anim-end":v(we),"onUpdate:animRange":e=>xe.value=e,"onUpdate:animStart":e=>ye.value=e,"onUpdate:animEnd":e=>we.value=e},null,n)):o("\x3c!----\x3e"),"automation"===v(ze)?o(_(h,{triggers:v(Ce),presets:e.lightingPresets,"lighting-mode":e.lightingMode,"onUpdate:triggers":e=>Ce.value=e},null,n)):o("\x3c!----\x3e"),o(`</div><div class="px-4 py-3 shrink-0 flex justify-end gap-3" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-7eff1a68><button class="px-5 py-2.5 text-base text-gray-400 hover:text-white transition-colors rounded-xl font-medium" style="${oe({border:"1px solid rgba(255,255,255,0.08)"})}" data-v-7eff1a68> Cancel </button><button class="px-6 py-2.5 text-white text-base font-bold rounded-xl transition-all" style="${oe({background:"linear-gradient(135deg, rgba(20,184,166,0.8), rgba(16,185,129,0.8))",border:"1px solid rgba(20,184,166,0.5)"})}" data-v-7eff1a68> Save </button></div></div></div></div></div>`)):o("\x3c!----\x3e")}}}),Ms=$s.setup;$s.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dObjectConfigModal.vue"),Ms?Ms(e,t):void 0};const Ts=Object.assign(Le($s,[["__scopeId","data-v-7eff1a68"]]),{__name:"Room3dObjectConfigModal"}),As=e({__name:"Room3dFontSelector",__ssrInlineRender:!0,props:{modelValue:{},fonts:{}},emits:["update:modelValue","uploaded"],setup(e,{emit:n}){const s=e,c=t(!1),u=o(()=>{var e,t;return(null==(e=s.fonts.find(e=>e.path===s.modelValue))?void 0:e.name)||(null==(t=s.modelValue.split("/").pop())?void 0:t.replace(/\.[^.]+$/,""))||""});return(t,o,n,s)=>{o(`<div${F(p({class:"space-y-2"},s))}><label class="text-gray-400 text-base">Font</label><div class="relative"><button class="w-full text-left px-3 py-2 rounded-lg text-base text-white truncate transition-all" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}">${Z(v(u)||"Select font...")}</button>`),v(c)?(o(`<div class="absolute left-0 right-0 mt-1 max-h-48 overflow-y-auto rounded-lg z-50" style="${oe({background:"rgba(15,15,25,0.98)",border:"1px solid rgba(255,255,255,0.15)","backdrop-filter":"blur(20px)"})}">\x3c!--[--\x3e`),N(e.fonts,t=>{o(`<button class="${U([t.path===e.modelValue?"text-cyan-300":"text-white","w-full text-left px-3 py-2 text-base hover:bg-white/10 transition-colors truncate"])}"><span class="opacity-40 text-base mr-1">${Z("user"===t.source?"â˜…":"")}</span> ${Z(t.name)}</button>`)}),o("\x3c!--]--\x3e"),0===e.fonts.length?o('<div class="px-3 py-2 text-gray-500 text-base">No fonts found</div>'):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),o(`</div><label class="flex items-center justify-center gap-1 px-3 py-1.5 rounded-lg text-base text-cyan-400 cursor-pointer hover:bg-cyan-500/10 transition-all" style="${oe({border:"1px dashed rgba(6,182,212,0.3)"})}"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"></path></svg> Upload Font <input type="file" accept=".woff2,.woff,.ttf,.otf" class="hidden"></label></div>`)}}}),Ps=As.setup;As.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dFontSelector.vue"),Ps?Ps(e,t):void 0};const zs=Object.assign(As,{__name:"Room3dFontSelector"}),Ds=e({__name:"Room3dDisplayEditor",__ssrInlineRender:!0,props:{zone:{}},emits:["save","close"],setup(n,{emit:s}){var c;const u=n,f=t(JSON.parse(JSON.stringify(u.zone.elements||[]))),b=t(u.zone.backgroundColor||"#111111"),O=t(null!=(c=u.zone.backgroundOpacity)?c:.9),I=t(u.zone.contentRotation||0),j=t(null),E=t(new Set),X=t(null),ee=t(!1);function y(e){return j.value===e||E.value.has(e)}t(null),t(null);const ne=o(()=>f.value.find(e=>e.id===j.value)||null),le=t([]),se=new Set;function P(e){le.value.find(t=>t.path===e.path)||le.value.push(e)}function R(e,t="inherit"){var o;if(!e)return t;const n=(null==(o=e.split("/").pop())?void 0:o.replace(/\.[^.]+$/,""))||t;return async function(e){var t;if(!e||se.has(e))return;const o=(null==(t=e.split("/").pop())?void 0:t.replace(/\.[^.]+$/,""))||"";if(o)try{const t=new FontFace(o,`url(${e})`);await t.load(),(void 0).fonts.add(t),se.add(e)}catch{}}(e),se.has(e)?n:t}const re=t({w:800,h:600}),de=t(1),ce=t(0),ue=t(0),pe=o(()=>{const e=u.zone.polygonWidth,t=u.zone.polygonHeight;if(e&&t&&e>0&&t>0)return e/t;const[o,n]=u.zone.resolution||[1024,768];return o/n}),ve=t(600),fe=o(()=>{const e=re.value.w-48,t=re.value.h-48,o=pe.value;return e/t>o?{w:t*o,h:t}:{w:e,h:e/o}}),ge=o(()=>{const e=Math.round(fe.value.w*de.value),t=Math.round(fe.value.h*de.value);ve.value=t;const o=(re.value.w-e)/2+ce.value,n=(re.value.h-t)/2+ue.value;return{width:e+"px",height:t+"px",left:Math.round(o)+"px",top:Math.round(n)+"px"}}),be=o(()=>ve.value/1e3),he=[{type:"text",icon:"Aa",label:"Text"},{type:"sensor",icon:"ðŸ“Š",label:"Sensor"},{type:"clock",icon:"â±",label:"Clock"},{type:"image",icon:"ðŸ–¼",label:"Image"},{type:"video",icon:"â–¶",label:"Video"},{type:"divider",icon:"â€”",label:"Divider"}],xe=[{type:"chart",icon:"ðŸ“ˆ",label:"Chart",desc:"Time-series"},{type:"sensorCard",icon:"ðŸŒ¡",label:"Sensor Card",desc:"Value + stats"},{type:"socketStatus",icon:"ðŸ”Œ",label:"Sockets",desc:"ON/OFF grid"},{type:"lightStatus",icon:"ðŸ’¡",label:"Lights",desc:"Brightness"},{type:"blowerStatus",icon:"ðŸŒ€",label:"Blower",desc:"Speed gauge"},{type:"powerSummary",icon:"âš¡",label:"Power",desc:"kWh + cost"},{type:"eventLog",icon:"ðŸ“‹",label:"Events",desc:"Socket log"}],ye=[{value:"temperature",label:"Temperature"},{value:"humidity",label:"Humidity"},{value:"vpd",label:"VPD"},{value:"co2",label:"CO2"},{value:"soil_moisture",label:"Soil Moisture"},{value:"soil_ec",label:"Soil EC"}],we=[{value:"temperature",label:"Temperature"},{value:"humidity",label:"Humidity"},{value:"vpd",label:"VPD"},{value:"co2",label:"CO2"},{value:"soil_temp",label:"Soil Temperature"},{value:"soil_moisture",label:"Soil Moisture"},{value:"soil_ec",label:"Soil EC"},{value:"blower",label:"Blower"},{value:"fan",label:"Fan"}],ke=[{value:"1h",label:"1 Hour"},{value:"4h",label:"4 Hours"},{value:"6h",label:"6 Hours"},{value:"12h",label:"12 Hours"},{value:"24h",label:"24 Hours"},{value:"48h",label:"48 Hours"},{value:"7d",label:"7 Days"}],Se=["tl","tr","bl","br"];function at(e){return{tl:"-top-1.5 -left-1.5",tr:"-top-1.5 -right-1.5",bl:"-bottom-1.5 -left-1.5",br:"-bottom-1.5 -right-1.5"}[e]||""}function Ae(e){return Math.max(1,Math.round(e*be.value))+"px"}function ot(e){const t=da(),o=t.current,n=t.soil,s={temperature:null!=(null==o?void 0:o.temp)?`${o.temp.toFixed(1)}Â°C`:"24.5Â°C",humidity:null!=(null==o?void 0:o.humi)?`${Math.round(o.humi)}%`:"62%",vpd:null!=(null==o?void 0:o.vpd)?`${o.vpd.toFixed(2)} kPa`:"1.2 kPa",co2:null!=(null==o?void 0:o.co2)?`${Math.round(o.co2)} ppm`:"820 ppm",soil_moisture:null!=(null==n?void 0:n.humi_soil)?`${Math.round(n.humi_soil)}%`:"45%",soil_ec:null!=(null==n?void 0:n.ec_soil)?`${n.ec_soil.toFixed(1)} mS/cm`:"1.8 mS/cm"}[e.sensorType]||"â€”";return e.showUnit?s:s.split(/[Â°%\s]/)[0]||s}function me(e){return"chalk"===e?{background:"transparent",border:"1px solid rgba(220,220,220,0.2)"}:"neon"===e?{background:"#050505",border:"1px solid #1a1a2e"}:{background:"#0d1117",border:"1px solid rgba(48,54,61,0.5)"}}const Ce=t(0),$e=e({props:{title:String},setup:(e,{slots:t})=>()=>{var o;return h("div",{class:"mb-4 pb-4",style:"border-bottom: 1px solid rgba(255,255,255,0.04)"},[h("div",{class:"text-base text-gray-500 uppercase tracking-wide mb-2"},e.title),null==(o=t.default)?void 0:o.call(t)])}}),Me=e({props:{label:String,modelValue:Number,min:Number,max:Number,step:Number},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("label",{class:"block"},[h("span",{class:"text-base text-gray-400"},e.label),h("input",{type:"number",value:e.modelValue,min:e.min,max:e.max,step:e.step,class:"w-full rounded-lg px-2 py-1 text-base text-white mt-0.5",style:"background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);",onInput:e=>t("update:modelValue",Number(e.target.value))})])}),Te=e({props:{label:String,modelValue:Number,min:Number,max:Number,step:Number},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>{var o;return h("label",{class:"block"},[h("div",{class:"flex items-center justify-between"},[h("span",{class:"text-base text-gray-400"},e.label),h("span",{class:"text-base text-gray-500"},String(Math.round(100*(null!=(o=e.modelValue)?o:0)))+"%")]),h("input",{type:"range",value:e.modelValue,min:e.min,max:e.max,step:e.step,class:"w-full accent-teal-500 mt-1",onInput:e=>t("update:modelValue",Number(e.target.value))})])}}),Ve=e({props:{label:String,modelValue:String},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("label",{class:"flex items-center gap-2"},[h("span",{class:"text-base text-gray-400"},e.label),h("input",{type:"color",value:e.modelValue,class:"w-8 h-8 rounded cursor-pointer bg-transparent border-none",onInput:e=>t("update:modelValue",e.target.value)})])}),Pe=e({props:{label:String,modelValue:String,options:Array},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("label",{class:"block"},[h("span",{class:"text-base text-gray-400"},e.label),h("select",{value:e.modelValue,class:"w-full rounded-lg px-2 py-1.5 text-base text-white mt-0.5",style:"background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);",onChange:e=>t("update:modelValue",e.target.value)},(e.options||[]).map(e=>h("option",{value:e.value,key:e.value},e.label)))])}),ze=e({props:{label:String,modelValue:String,placeholder:String},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("label",{class:"block mt-2"},[h("span",{class:"text-base text-gray-400"},e.label),h("input",{type:"text",value:e.modelValue||"",placeholder:e.placeholder,class:"w-full rounded-lg px-2 py-1 text-base text-white mt-0.5",style:"background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);",onInput:e=>t("update:modelValue",e.target.value)})])}),De=e({props:{label:String,modelValue:Boolean},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("label",{class:"flex items-center gap-1.5 cursor-pointer"},[h("div",{class:"w-8 h-4 rounded-full relative transition-colors cursor-pointer",style:"background: "+(e.modelValue?"rgba(45,212,191,0.5)":"rgba(255,255,255,0.1)"),onClick:()=>t("update:modelValue",!e.modelValue)},[h("div",{class:"absolute top-0.5 w-3 h-3 rounded-full transition-all",style:`background: ${e.modelValue?"#2dd4bf":"#666"}; left: ${e.modelValue?"18px":"2px"}`})]),h("span",{class:"text-base text-gray-400"},e.label)])}),Oe=e({props:{config:Object,fonts:Array},emits:["fontUploaded"],setup(e,{emit:t}){const o=zs;return()=>{var n;const s=e.config;return h("div",{class:"space-y-2"},[h(o,{modelValue:s.fontFamily,fonts:e.fonts||[],"onUpdate:modelValue":e=>{s.fontFamily=e},onUploaded:e=>t("fontUploaded",e)}),h("div",{class:"grid grid-cols-2 gap-2"},[h(Me,{label:"Size",modelValue:s.fontSize,min:8,max:200,step:1,"onUpdate:modelValue":e=>{s.fontSize=e}}),h("label",{class:"flex items-center gap-2"},[h("span",{class:"text-base text-gray-400"},"Color"),h("input",{type:"color",value:s.color,class:"w-8 h-8 rounded cursor-pointer bg-transparent border-none",onInput:e=>{s.color=e.target.value}})])]),h("div",{class:"flex gap-2"},[h("button",{class:"px-3 py-1 rounded text-base transition-colors "+(s.bold?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{s.bold=!s.bold}},"B"),h("button",{class:"px-3 py-1 rounded text-base italic transition-colors "+(s.italic?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{s.italic=!s.italic}},"I"),...["left","center","right"].map(e=>h("button",{class:"px-3 py-1 rounded text-base transition-colors "+(s.align===e?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{s.align=e}},"left"===e?"â«·":"center"===e?"â‰¡":"â«¸"))]),h(Te,{label:"Opacity",modelValue:null!=(n=s.opacity)?n:1,min:0,max:1,step:.05,"onUpdate:modelValue":e=>{s.opacity=e}})])}}}),Re=e({props:{config:Object,fonts:Array},emits:["fontUploaded"],setup(e,{emit:t}){const o=zs;return()=>{const n=e.config;return h("div",{class:"space-y-2"},[h(o,{modelValue:n.fontFamily||"",fonts:e.fonts||[],"onUpdate:modelValue":e=>{n.fontFamily=e},onUploaded:e=>t("fontUploaded",e)}),h("div",{class:"grid grid-cols-2 gap-2"},[h(Me,{label:"Size",modelValue:n.fontSize,min:8,max:200,step:1,"onUpdate:modelValue":e=>{n.fontSize=e}}),h("label",{class:"flex items-center gap-2"},[h("span",{class:"text-base text-gray-400"},"Color"),h("input",{type:"color",value:n.color,class:"w-8 h-8 rounded cursor-pointer bg-transparent border-none",onInput:e=>{n.color=e.target.value}})])]),h("div",{class:"flex gap-2"},[h("button",{class:"px-3 py-1 rounded text-base transition-colors "+(n.bold?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.bold=!n.bold}},"B"),h("button",{class:"px-3 py-1 rounded text-base italic transition-colors "+(n.italic?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.italic=!n.italic}},"I"),...["left","center","right"].map(e=>h("button",{class:"px-3 py-1 rounded text-base transition-colors "+((n.align||"left")===e?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.align=e}},"left"===e?"â«·":"center"===e?"â‰¡":"â«¸"))])])}}}),Ie=e({props:{config:Object,fonts:Array},emits:["fontUploaded"],setup(e,{emit:t}){const o=zs;return()=>{const n=e.config;return h("div",{class:"space-y-2"},[h(o,{modelValue:n.fontFamily||"",fonts:e.fonts||[],"onUpdate:modelValue":e=>{n.fontFamily=e},onUploaded:e=>t("fontUploaded",e)}),h("div",{class:"grid grid-cols-2 gap-2"},[h(Me,{label:"Size",modelValue:n.fontSize,min:8,max:200,step:1,"onUpdate:modelValue":e=>{n.fontSize=e}}),h("label",{class:"flex items-center gap-2"},[h("span",{class:"text-base text-gray-400"},"Color"),h("input",{type:"color",value:n.color,class:"w-8 h-8 rounded cursor-pointer bg-transparent border-none",onInput:e=>{n.color=e.target.value}})])]),h("div",{class:"flex gap-2"},[h("button",{class:"px-3 py-1 rounded text-base transition-colors "+(n.bold?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.bold=!n.bold}},"B"),h("button",{class:"px-3 py-1 rounded text-base italic transition-colors "+(n.italic?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.italic=!n.italic}},"I"),...["left","center","right"].map(e=>h("button",{class:"px-3 py-1 rounded text-base transition-colors "+((n.align||"left")===e?"bg-teal-500/30 text-teal-400":"bg-white/5 text-gray-400"),style:"border: 1px solid rgba(255,255,255,0.1);",onClick:()=>{n.align=e}},"left"===e?"â«·":"center"===e?"â‰¡":"â«¸"))])])}}}),je=e({props:{config:Object},setup(e){const o=t([]),n=t(!1),s=t(!1);async function G(){try{const e=await $fetch("/api/room3d/display-images");o.value=e.filter(e=>"image"===e.type||!e.type)}catch{}}async function L(t){var o;const n=t.target,c=null==(o=n.files)?void 0:o[0];if(!c)return;s.value=!0;const u=new FormData;u.append("file",c);try{const{getAuthHeaders:t}=Gt(),o=Je.value?"/api/room3d/display-image-upload?editor=1":"/api/room3d/display-image-upload",n=await $fetch(o,{method:"POST",body:u,headers:t()});n.ok&&(e.config.src=n.path,G())}catch{}s.value=!1,n.value=""}return()=>{const t=e.config;return h("div",{class:"space-y-2"},[t.src?h("div",{class:"relative rounded-lg overflow-hidden",style:"border: 1px solid rgba(255,255,255,0.1); aspect-ratio: 16/9;"},[h("img",{src:t.src,class:"w-full h-full object-contain",style:"background: rgba(0,0,0,0.3);"}),h("button",{class:"absolute top-1 right-1 w-6 h-6 rounded-full flex items-center justify-center text-base text-red-400 hover:bg-red-500/20",style:"background: rgba(0,0,0,0.6);",onClick:()=>{t.src=""}},"Ã—")]):null,h("label",{class:"flex items-center justify-center gap-2 py-2 rounded-lg text-base text-teal-400 cursor-pointer hover:bg-teal-500/10 transition-all",style:"border: 1px dashed rgba(45,212,191,0.3);"},[s.value?"Uploading...":"Upload Image",h("input",{type:"file",accept:"image/*",class:"hidden",onChange:L})]),h("button",{class:"w-full text-center py-1.5 rounded-lg text-base text-gray-400 hover:text-white hover:bg-white/5 transition-all",onClick:()=>{n.value=!n.value,n.value&&G()}},n.value?"Hide gallery":"Choose from gallery"),n.value?h("div",{class:"grid grid-cols-3 gap-1.5 max-h-40 overflow-y-auto"},o.value.map(e=>h("div",{key:e.path,class:"rounded overflow-hidden cursor-pointer transition-all "+(t.src===e.path?"ring-2 ring-teal-400":"hover:ring-1 hover:ring-white/30"),style:"aspect-ratio: 1; border: 1px solid rgba(255,255,255,0.06);",onClick:()=>{t.src=e.path}},[h("img",{src:e.path,class:"w-full h-full object-cover"})]))):null])}}}),Fe=e({props:{config:Object},setup(e){const o=t([]),n=t([]),s=t([]),c=t(!1);async function z(t){var u;const p=t.target,v=null==(u=p.files)?void 0:u[0];if(!v)return;c.value=!0;const f=new FormData;f.append("file",v);try{const{getAuthHeaders:t}=Gt(),c=Je.value?"/api/room3d/display-image-upload?editor=1":"/api/room3d/display-image-upload",u=await $fetch(c,{method:"POST",body:f,headers:t()});u.ok&&(e.config.src=u.path,e.config.srcType="upload",async function(){try{const e=await $fetch("/api/room3d/display-images");o.value=e.filter(e=>"video"===e.type)}catch{}try{const e=await $fetch("/api/cameras");n.value=e.cameras||[];const t=[];for(const e of n.value.slice(0,5))try{const o=await $fetch(`/api/cameras/${e.id}/timelapse-days`);for(const n of(o.days||[]).filter(e=>e.hasVideo))t.push({date:n.date,url:n.videoUrl,cameraName:e.name})}catch{}s.value=t}catch{}}())}catch{}c.value=!1,p.value=""}return()=>{const t=e.config;return h("div",{class:"space-y-3"},[h("div",{class:"flex gap-1 rounded-lg p-0.5",style:"background: rgba(0,0,0,0.3);"},[...["upload","timelapse","camera"].map(e=>h("button",{key:e,class:"flex-1 py-1.5 rounded text-base transition-all "+(t.srcType===e?"text-teal-400":"text-gray-500 hover:text-gray-300"),style:t.srcType===e?"background: rgba(45,212,191,0.15);":"",onClick:()=>{t.srcType=e}},"upload"===e?"File":"timelapse"===e?"Timelapse":"Camera"))]),"upload"===t.srcType?h("div",{class:"space-y-2"},[t.src?h("div",{class:"text-base text-gray-300 truncate px-2"},t.src.split("/").pop()):null,h("label",{class:"flex items-center justify-center gap-2 py-2 rounded-lg text-base text-teal-400 cursor-pointer hover:bg-teal-500/10 transition-all",style:"border: 1px dashed rgba(45,212,191,0.3);"},[c.value?"Uploading...":"Upload Video",h("input",{type:"file",accept:"video/*",class:"hidden",onChange:z})]),o.value.length>0?h("div",{class:"space-y-1"},[h("div",{class:"text-base text-gray-500 mt-2"},"Uploaded videos:"),...o.value.map(e=>h("button",{key:e.path,class:"w-full text-left px-2 py-1.5 rounded text-base transition-all "+(t.src===e.path?"text-teal-400 bg-teal-500/10":"text-gray-400 hover:bg-white/5"),onClick:()=>{t.src=e.path,t.srcType="upload"}},e.name))]):null]):null,"timelapse"===t.srcType?h("div",{class:"space-y-1"},[s.value.length>0?h("div",{class:"max-h-48 overflow-y-auto space-y-1"},s.value.map(e=>h("button",{key:e.url,class:"w-full text-left px-2 py-1.5 rounded text-base transition-all "+(t.src===e.url?"text-teal-400 bg-teal-500/10":"text-gray-400 hover:bg-white/5"),onClick:()=>{t.src=e.url}},`${e.cameraName} â€” ${e.date}`))):h("div",{class:"text-base text-gray-500 py-2 text-center"},"No timelapse videos available")]):null,"camera"===t.srcType?h("div",{class:"space-y-1"},[n.value.length>0?n.value.map(e=>h("button",{key:e.id,class:"w-full text-left px-2 py-1.5 rounded text-base transition-all "+(t.cameraId===e.id?"text-teal-400 bg-teal-500/10":"text-gray-400 hover:bg-white/5"),onClick:()=>{t.cameraId=e.id,t.src=`/api/cameras/stream/${e.id}`}},e.name)):h("div",{class:"text-base text-gray-500 py-2 text-center"},"No cameras configured")]):null])}}}),_e=e({props:{modelValue:{type:String,default:"default"}},emits:["update:modelValue"],setup:(e,{emit:t})=>()=>h("div",{class:"mt-2"},[h("span",{class:"text-base text-gray-400"},"Theme"),h("div",{class:"flex gap-1.5 mt-1"},["default","chalk","neon"].map(o=>h("button",{key:o,class:"flex-1 py-1.5 rounded-lg text-base font-medium transition-all "+(e.modelValue===o?"text-teal-400":"text-gray-500 hover:text-gray-300"),style:e.modelValue===o?"background: rgba(45,212,191,0.15); border: 1px solid rgba(45,212,191,0.3);":"background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.06);",onClick:()=>t("update:modelValue",o)},o.charAt(0).toUpperCase()+o.slice(1))))])});return(e,t,o,n)=>{t(`<div${F(p({class:"fixed inset-0 z-[200] flex flex-col select-none",style:{background:"linear-gradient(135deg, #0a0a14 0%, #0d1117 50%, #0a0a14 100%)"}},n))} data-v-9848d89f><div class="flex items-center justify-between px-5 py-2.5 shrink-0" style="${oe({background:"rgba(0,0,0,0.5)","border-bottom":"1px solid rgba(45,212,191,0.15)"})}" data-v-9848d89f><div class="flex items-center gap-4" data-v-9848d89f><div class="flex items-center gap-2" data-v-9848d89f><div class="w-2 h-2 rounded-full bg-teal-400 animate-pulse" data-v-9848d89f></div><span class="text-lg font-bold text-white tracking-wide" data-v-9848d89f>DISPLAY EDITOR</span></div><div class="text-base text-gray-500" data-v-9848d89f>${Z(v(f).length)} elements</div></div><div class="flex items-center gap-3" data-v-9848d89f><div class="flex items-center gap-2 px-3 py-1 rounded-lg" style="${oe({background:"rgba(255,255,255,0.05)"})}" data-v-9848d89f><span class="text-base text-gray-400" data-v-9848d89f>BG</span><input type="color"${J("value",v(b))} class="w-6 h-6 rounded cursor-pointer bg-transparent border-none" data-v-9848d89f><input type="range"${J("value",v(O))} min="0" max="1" step="0.05" class="w-16 accent-teal-500" data-v-9848d89f></div><div class="flex items-center gap-1.5 px-3 py-1 rounded-lg" style="${oe({background:"rgba(255,255,255,0.05)"})}" data-v-9848d89f><button class="text-base text-gray-400 hover:text-white px-1" data-v-9848d89f>-</button><button class="text-base text-gray-300 hover:text-white min-w-[3rem] text-center" data-v-9848d89f>${Z(Math.round(100*v(de)))}%</button><button class="text-base text-gray-400 hover:text-white px-1" data-v-9848d89f>+</button></div><button class="${U([v(I)?"text-teal-400":"text-gray-400","flex items-center gap-1.5 px-3 py-1 rounded-lg text-base transition-all hover:bg-white/10"])}" style="${oe({background:"rgba(255,255,255,0.05)"})}" title="Rotate content (0Â°/90Â°/180Â°/270Â°)" data-v-9848d89f><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-9848d89f><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" data-v-9848d89f></path></svg> ${Z(v(I))}Â° </button><button class="px-5 py-1.5 rounded-lg text-base font-semibold text-white transition-all hover:scale-105" style="${oe({background:"linear-gradient(135deg, #0d9488, #14b8a6)","box-shadow":"0 0 20px rgba(20,184,166,0.3)"})}" data-v-9848d89f> Save </button><button class="px-4 py-1.5 rounded-lg text-base text-gray-300 transition-all hover:bg-white/10" style="${oe({border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9848d89f> Close </button></div></div><div class="flex-1 flex overflow-hidden min-h-0" data-v-9848d89f><div class="flex-1 relative overflow-hidden" data-v-9848d89f><div class="absolute overflow-hidden" style="${oe([v(ge),{border:"1px solid rgba(45,212,191,0.2)","border-radius":"8px","box-shadow":"0 0 40px rgba(0,0,0,0.5), inset 0 0 60px rgba(0,0,0,0.3)"}])}" data-v-9848d89f><div class="absolute inset-0" style="${oe({backgroundColor:v(b),opacity:v(O)})}" data-v-9848d89f></div><div class="absolute inset-0 pointer-events-none" style="${oe({"background-image":"linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px)","background-size":"5% 5%"})}" data-v-9848d89f></div>`),v(X)?t(`<div class="absolute pointer-events-none" style="${oe({left:v(X).x+"%",top:v(X).y+"%",width:v(X).w+"%",height:v(X).h+"%",border:"1px dashed rgba(45,212,191,0.6)",background:"rgba(45,212,191,0.08)"})}" data-v-9848d89f></div>`):t("\x3c!----\x3e"),t("\x3c!--[--\x3e"),N(v(f),e=>{t(`<div class="${U(["absolute transition-shadow duration-150",y(e.id)?"":"hover:outline hover:outline-1 hover:outline-white/20"])}" style="${oe(function(e){return{left:e.x+"%",top:e.y+"%",width:e.width+"%",height:e.height+"%",cursor:"move"}}(e))}" data-v-9848d89f>`),y(e.id)?t(`<div class="absolute -inset-px pointer-events-none rounded-sm" style="${oe(v(j)===e.id?"border: 2px solid rgba(45,212,191,0.7); box-shadow: 0 0 12px rgba(45,212,191,0.3);":"border: 1.5px solid rgba(45,212,191,0.4);")}" data-v-9848d89f></div>`):t("\x3c!----\x3e"),"text"===e.type?t(`<div class="w-full h-full flex items-center overflow-hidden px-1" style="${oe(function(e){var t;return{color:e.color,fontSize:Ae(e.fontSize),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:e.align,justifyContent:"center"===e.align?"center":"right"===e.align?"flex-end":"flex-start",opacity:String(null!=(t=e.opacity)?t:1),fontFamily:R(e.fontFamily)}}(e.config))}" data-v-9848d89f>${Z(e.config.text||"Text")}</div>`):"sensor"===e.type?(t(`<div class="w-full h-full flex items-center gap-1 overflow-hidden px-1" style="${oe(function(e){return{color:e.color,fontSize:Ae(e.fontSize),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:e.align||"left",justifyContent:"center"===(e.align||"left")?"center":"right"===(e.align||"left")?"flex-end":"flex-start",fontFamily:R(e.fontFamily)}}(e.config))}" data-v-9848d89f>`),e.config.showLabel?t(`<span class="opacity-50" data-v-9848d89f>${Z(function(e){return e.labelText?e.labelText:{temperature:"Temp",humidity:"RH",vpd:"VPD",co2:"CO2",soil_moisture:"Soil",soil_ec:"EC"}[e.sensorType]||e.sensorType}(e.config))}:</span>`):t("\x3c!----\x3e"),t(`<span class="font-bold" data-v-9848d89f>${Z(ot(e.config))}</span></div>`)):"clock"===e.type?t(`<div class="w-full h-full flex items-center overflow-hidden px-1" style="${oe(function(e){return{color:e.color,fontSize:Ae(e.fontSize),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:e.align||"left",justifyContent:"center"===(e.align||"left")?"center":"right"===(e.align||"left")?"flex-end":"flex-start",fontFamily:R(e.fontFamily,"monospace")}}(e.config))}" data-v-9848d89f>${Z(function(e){Ce.value;const t=new Date,o="12h"===e.format?t.getHours()%12||12:t.getHours(),n=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0"),c="12h"===e.format?t.getHours()>=12?" PM":" AM":"";return`${o}:${n}${e.showSeconds?":"+s:""}${c}`}(e.config))}</div>`):"image"===e.type?(t('<div class="w-full h-full overflow-hidden" data-v-9848d89f>'),e.config.src?t(`<img${J("src",e.config.src)} style="${oe({objectFit:e.config.fit,borderRadius:e.config.borderRadius+"px",opacity:e.config.opacity})}" class="w-full h-full" data-v-9848d89f>`):t(`<div class="w-full h-full flex items-center justify-center text-gray-500 text-base" style="${oe({border:"1px dashed rgba(255,255,255,0.1)"})}" data-v-9848d89f>No image</div>`),t("</div>")):"video"===e.type?(t('<div class="w-full h-full overflow-hidden" data-v-9848d89f>'),e.config.src?t(`<div class="w-full h-full flex items-center justify-center" style="${oe([{opacity:e.config.opacity},{background:"rgba(0,0,0,0.5)"}])}" data-v-9848d89f><div class="text-center" data-v-9848d89f><svg class="w-8 h-8 mx-auto text-teal-400 opacity-60" fill="currentColor" viewBox="0 0 24 24" data-v-9848d89f><path d="M8 5v14l11-7z" data-v-9848d89f></path></svg><div class="text-base text-gray-400 mt-1" data-v-9848d89f>${Z(function(e){var t;if("camera"===e.srcType)return"Camera feed";if("timelapse"===e.srcType)return"Timelapse";const o=(null==(t=e.src)?void 0:t.split("/").pop())||"Video";return o.length>20?o.slice(0,17)+"...":o}(e.config))}</div></div></div>`):t(`<div class="w-full h-full flex items-center justify-center text-gray-500 text-base" style="${oe({border:"1px dashed rgba(255,255,255,0.1)"})}" data-v-9848d89f>No video</div>`),t("</div>")):"divider"===e.type?t(`<div class="w-full h-full flex items-center justify-center" data-v-9848d89f><div class="w-full" style="${oe({height:Ae(e.config.thickness||2),backgroundColor:e.config.color,transform:`rotate(${e.config.rotation||0}deg)`})}" data-v-9848d89f></div></div>`):"chart"===e.type?t(`<div class="w-full h-full flex items-center justify-center overflow-hidden rounded" style="${oe({background:"#0d1117",border:"1px solid rgba(48,54,61,0.5)"})}" data-v-9848d89f><div class="text-center" data-v-9848d89f><div class="text-base text-teal-400 font-bold" data-v-9848d89f>${Z(function(e){return{temperature:"Temperature",humidity:"Humidity",vpd:"VPD",co2:"CO2",soil_temp:"Soil Temp",soil_moisture:"Soil Moisture",soil_ec:"Soil EC",blower:"Blower",fan:"Fan"}[e]||e}(e.config.metric))}</div><div class="text-base text-gray-500" data-v-9848d89f>${Z(e.config.range)}</div></div></div>`):"sensorCard"===e.type?(t(`<div class="w-full h-full flex flex-col justify-center px-2 rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f>`),!1!==e.config.showLabel?t(`<div class="text-gray-400 uppercase" style="${oe({fontSize:Ae(e.config.titleFontSize||13)})}" data-v-9848d89f>${Z(function(e){return{temperature:"Temperature",humidity:"Humidity",vpd:"VPD",co2:"CO2",soil_moisture:"Soil Moist.",soil_ec:"EC"}[e]||e}(e.config.sensorType))}</div>`):t("\x3c!----\x3e"),!1!==e.config.showUnit?t(`<div class="font-bold" style="${oe({fontSize:Ae(e.config.fontSize||28),color:e.config.valueColor||"#ffffff"})}" data-v-9848d89f>${Z(ot({sensorType:e.config.sensorType,showUnit:!0}))}</div>`):t("\x3c!----\x3e"),e.config.showStats?t(`<div class="flex gap-2 mt-0.5" style="${oe({fontSize:Ae(.7*(e.config.titleFontSize||13))})}" data-v-9848d89f><span class="text-blue-400" data-v-9848d89f>Min --</span><span class="text-green-400" data-v-9848d89f>Avg --</span><span class="text-red-400" data-v-9848d89f>Max --</span></div>`):t("\x3c!----\x3e"),t("</div>")):"socketStatus"===e.type?t(`<div class="w-full h-full flex items-center justify-center rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f><div class="text-base text-green-400 font-bold" data-v-9848d89f>Sockets</div></div>`):"lightStatus"===e.type?t(`<div class="w-full h-full flex items-center justify-center rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f><div class="text-base text-yellow-400 font-bold" data-v-9848d89f>Lights</div></div>`):"blowerStatus"===e.type?t(`<div class="w-full h-full flex items-center justify-center rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f><div class="text-base text-cyan-400 font-bold" data-v-9848d89f>Blower</div></div>`):"powerSummary"===e.type?t(`<div class="w-full h-full flex items-center justify-center rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f><div class="text-base text-emerald-400 font-bold" data-v-9848d89f>Power</div></div>`):"eventLog"===e.type?t(`<div class="w-full h-full flex items-center justify-center rounded" style="${oe(me(e.config.theme))}" data-v-9848d89f><div class="text-base text-purple-400 font-bold" data-v-9848d89f>Events</div></div>`):t("\x3c!----\x3e"),v(j)===e.id?(t("\x3c!--[--\x3e"),N(Se,e=>{t(`<div class="${U(["absolute w-3 h-3 rounded-full z-10",at(e)])}" style="${oe({background:"rgba(45,212,191,0.9)",border:"1px solid rgba(255,255,255,0.5)",cursor:"nwse-resize"})}" data-v-9848d89f></div>`)}),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),t("</div>")}),t(`\x3c!--]--\x3e</div></div><div class="w-[340px] shrink-0 flex flex-col overflow-hidden" style="${oe({background:"rgba(0,0,0,0.4)","border-left":"1px solid rgba(45,212,191,0.1)"})}" data-v-9848d89f><div class="flex-1 overflow-y-auto custom-scrollbar" data-v-9848d89f><div class="p-4" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.06)"})}" data-v-9848d89f><div class="text-base font-bold text-teal-400/70 uppercase tracking-widest mb-3" data-v-9848d89f>Add Element</div><div class="text-base text-gray-600 uppercase tracking-wide mb-1.5" data-v-9848d89f>Basic</div><div class="grid grid-cols-3 gap-1.5 mb-3" data-v-9848d89f>\x3c!--[--\x3e`),N(he,e=>{t(`<button class="group p-2 rounded-lg text-center transition-all duration-200 hover:scale-[1.03] hover:border-teal-500/30" style="${oe({background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-9848d89f><div class="text-lg mb-0.5 opacity-70 group-hover:opacity-100 transition-opacity" data-v-9848d89f>${Z(e.icon)}</div><div class="text-base text-white font-medium" data-v-9848d89f>${Z(e.label)}</div></button>`)}),t('\x3c!--]--\x3e</div><div class="text-base text-gray-600 uppercase tracking-wide mb-1.5" data-v-9848d89f>Dashboard</div><div class="grid grid-cols-2 gap-1.5" data-v-9848d89f>\x3c!--[--\x3e'),N(xe,e=>{t(`<button class="group p-2 rounded-lg text-left transition-all duration-200 hover:scale-[1.03] hover:border-teal-500/30" style="${oe({background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-9848d89f><div class="flex items-center gap-1.5" data-v-9848d89f><div class="text-lg opacity-70 group-hover:opacity-100 transition-opacity" data-v-9848d89f>${Z(e.icon)}</div><div data-v-9848d89f><div class="text-base text-white font-medium" data-v-9848d89f>${Z(e.label)}</div><div class="text-base text-gray-500 leading-tight" data-v-9848d89f>${Z(e.desc)}</div></div></div></button>`)}),t("\x3c!--]--\x3e</div></div>"),v(ne)?(t('<div class="p-4" data-v-9848d89f><div class="flex items-center justify-between mb-3" data-v-9848d89f><div class="text-base font-bold text-teal-400/70 uppercase tracking-widest" data-v-9848d89f>Properties</div><button class="text-base text-red-400/70 hover:text-red-400 transition-colors px-2 py-0.5 rounded hover:bg-red-500/10" data-v-9848d89f> Delete </button></div>'),t(_(v($e),{title:"Position & Size"},{default:x((e,t,o,n)=>{if(!t)return[g("div",{class:"grid grid-cols-2 gap-2"},[g(v(Me),{label:"X %",modelValue:v(ne).x,"onUpdate:modelValue":e=>v(ne).x=e,min:0,max:100,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Y %",modelValue:v(ne).y,"onUpdate:modelValue":e=>v(ne).y=e,min:0,max:100,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"W %",modelValue:v(ne).width,"onUpdate:modelValue":e=>v(ne).width=e,min:2,max:100,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"H %",modelValue:v(ne).height,"onUpdate:modelValue":e=>v(ne).height=e,min:2,max:100,step:1},null,8,["modelValue","onUpdate:modelValue"])])];t(`<div class="grid grid-cols-2 gap-2" data-v-9848d89f${n}>`),t(_(v(Me),{label:"X %",modelValue:v(ne).x,"onUpdate:modelValue":e=>v(ne).x=e,min:0,max:100,step:1},null,o,n)),t(_(v(Me),{label:"Y %",modelValue:v(ne).y,"onUpdate:modelValue":e=>v(ne).y=e,min:0,max:100,step:1},null,o,n)),t(_(v(Me),{label:"W %",modelValue:v(ne).width,"onUpdate:modelValue":e=>v(ne).width=e,min:2,max:100,step:1},null,o,n)),t(_(v(Me),{label:"H %",modelValue:v(ne).height,"onUpdate:modelValue":e=>v(ne).height=e,min:2,max:100,step:1},null,o,n)),t("</div>")}),_:1},o)),"text"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Content"},{default:x((e,t,o,n)=>{if(!t)return[S(g("textarea",{"onUpdate:modelValue":e=>v(ne).config.text=e,rows:"3",class:"w-full rounded-lg px-3 py-2 text-base text-white resize-none",style:{background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"},onFocus:e=>ee.value=!0,onBlur:e=>ee.value=!1},null,40,["onUpdate:modelValue","onFocus","onBlur"]),[[$,v(ne).config.text]])];t(`<textarea rows="3" class="w-full rounded-lg px-3 py-2 text-base text-white resize-none" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-9848d89f${n}>${Z(v(ne).config.text)}</textarea>`)}),_:1},o)),t(_(v($e),{title:"Typography"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Oe),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,8,["config","fonts"])];t(_(v(Oe),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"sensor"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Data"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Sensor",modelValue:v(ne).config.sensorType,"onUpdate:modelValue":e=>v(ne).config.sensorType=e,options:ye},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex gap-3 mt-2"},[g(v(De),{label:"Label",modelValue:v(ne).config.showLabel,"onUpdate:modelValue":e=>v(ne).config.showLabel=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Unit",modelValue:v(ne).config.showUnit,"onUpdate:modelValue":e=>v(ne).config.showUnit=e},null,8,["modelValue","onUpdate:modelValue"])]),v(ne).config.showLabel?(M(),T(v(ze),{key:0,label:"Custom Label",modelValue:v(ne).config.labelText,"onUpdate:modelValue":e=>v(ne).config.labelText=e,placeholder:"(auto)"},null,8,["modelValue","onUpdate:modelValue"])):V("",!0)];t(_(v(Pe),{label:"Sensor",modelValue:v(ne).config.sensorType,"onUpdate:modelValue":e=>v(ne).config.sensorType=e,options:ye},null,o,n)),t(`<div class="flex gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Label",modelValue:v(ne).config.showLabel,"onUpdate:modelValue":e=>v(ne).config.showLabel=e},null,o,n)),t(_(v(De),{label:"Unit",modelValue:v(ne).config.showUnit,"onUpdate:modelValue":e=>v(ne).config.showUnit=e},null,o,n)),t("</div>"),v(ne).config.showLabel?t(_(v(ze),{label:"Custom Label",modelValue:v(ne).config.labelText,"onUpdate:modelValue":e=>v(ne).config.labelText=e,placeholder:"(auto)"},null,o,n)):t("\x3c!----\x3e")}),_:1},o)),t(_(v($e),{title:"Typography"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Re),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,8,["config","fonts"])];t(_(v(Re),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"clock"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Clock"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Format",modelValue:v(ne).config.format,"onUpdate:modelValue":e=>v(ne).config.format=e,options:[{value:"24h",label:"24h"},{value:"12h",label:"12h"}]},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Seconds",modelValue:v(ne).config.showSeconds,"onUpdate:modelValue":e=>v(ne).config.showSeconds=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Pe),{label:"Format",modelValue:v(ne).config.format,"onUpdate:modelValue":e=>v(ne).config.format=e,options:[{value:"24h",label:"24h"},{value:"12h",label:"12h"}]},null,o,n)),t(_(v(De),{label:"Seconds",modelValue:v(ne).config.showSeconds,"onUpdate:modelValue":e=>v(ne).config.showSeconds=e},null,o,n))}),_:1},o)),t(_(v($e),{title:"Typography"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Ie),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,8,["config","fonts"])];t(_(v(Ie),{config:v(ne).config,fonts:v(le),onFontUploaded:P},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"image"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Image"},{default:x((e,t,o,n)=>{if(!t)return[g(v(je),{config:v(ne).config},null,8,["config"])];t(_(v(je),{config:v(ne).config},null,o,n))}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Fit",modelValue:v(ne).config.fit,"onUpdate:modelValue":e=>v(ne).config.fit=e,options:[{value:"cover",label:"Cover"},{value:"contain",label:"Contain"},{value:"fill",label:"Fill"}]},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Border Radius",modelValue:v(ne).config.borderRadius,"onUpdate:modelValue":e=>v(ne).config.borderRadius=e,min:0,max:50,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Te),{label:"Opacity",modelValue:v(ne).config.opacity,"onUpdate:modelValue":e=>v(ne).config.opacity=e,min:0,max:1,step:.05},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Pe),{label:"Fit",modelValue:v(ne).config.fit,"onUpdate:modelValue":e=>v(ne).config.fit=e,options:[{value:"cover",label:"Cover"},{value:"contain",label:"Contain"},{value:"fill",label:"Fill"}]},null,o,n)),t(_(v(Me),{label:"Border Radius",modelValue:v(ne).config.borderRadius,"onUpdate:modelValue":e=>v(ne).config.borderRadius=e,min:0,max:50,step:1},null,o,n)),t(_(v(Te),{label:"Opacity",modelValue:v(ne).config.opacity,"onUpdate:modelValue":e=>v(ne).config.opacity=e,min:0,max:1,step:.05},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"video"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Video Source"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Fe),{config:v(ne).config},null,8,["config"])];t(_(v(Fe),{config:v(ne).config},null,o,n))}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Fit",modelValue:v(ne).config.fit,"onUpdate:modelValue":e=>v(ne).config.fit=e,options:[{value:"cover",label:"Cover"},{value:"contain",label:"Contain"},{value:"fill",label:"Fill"}]},null,8,["modelValue","onUpdate:modelValue"]),g(v(Te),{label:"Opacity",modelValue:v(ne).config.opacity,"onUpdate:modelValue":e=>v(ne).config.opacity=e,min:0,max:1,step:.05},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex gap-3 mt-2"},[g(v(De),{label:"Loop",modelValue:v(ne).config.loop,"onUpdate:modelValue":e=>v(ne).config.loop=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Autoplay",modelValue:v(ne).config.autoplay,"onUpdate:modelValue":e=>v(ne).config.autoplay=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Muted",modelValue:v(ne).config.muted,"onUpdate:modelValue":e=>v(ne).config.muted=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Fit",modelValue:v(ne).config.fit,"onUpdate:modelValue":e=>v(ne).config.fit=e,options:[{value:"cover",label:"Cover"},{value:"contain",label:"Contain"},{value:"fill",label:"Fill"}]},null,o,n)),t(_(v(Te),{label:"Opacity",modelValue:v(ne).config.opacity,"onUpdate:modelValue":e=>v(ne).config.opacity=e,min:0,max:1,step:.05},null,o,n)),t(`<div class="flex gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Loop",modelValue:v(ne).config.loop,"onUpdate:modelValue":e=>v(ne).config.loop=e},null,o,n)),t(_(v(De),{label:"Autoplay",modelValue:v(ne).config.autoplay,"onUpdate:modelValue":e=>v(ne).config.autoplay=e},null,o,n)),t(_(v(De),{label:"Muted",modelValue:v(ne).config.muted,"onUpdate:modelValue":e=>v(ne).config.muted=e},null,o,n)),t("</div>")}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"divider"===v(ne).type?t(_(v($e),{title:"Divider"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Ve),{label:"Color",modelValue:v(ne).config.color,"onUpdate:modelValue":e=>v(ne).config.color=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Thickness",modelValue:v(ne).config.thickness,"onUpdate:modelValue":e=>v(ne).config.thickness=e,min:1,max:20,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Rotation Â°",modelValue:v(ne).config.rotation,"onUpdate:modelValue":e=>v(ne).config.rotation=e,min:0,max:360,step:1},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Ve),{label:"Color",modelValue:v(ne).config.color,"onUpdate:modelValue":e=>v(ne).config.color=e},null,o,n)),t(_(v(Me),{label:"Thickness",modelValue:v(ne).config.thickness,"onUpdate:modelValue":e=>v(ne).config.thickness=e,min:1,max:20,step:1},null,o,n)),t(_(v(Me),{label:"Rotation Â°",modelValue:v(ne).config.rotation,"onUpdate:modelValue":e=>v(ne).config.rotation=e,min:0,max:360,step:1},null,o,n))}),_:1},o)):t("\x3c!----\x3e"),"chart"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Chart Data"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Metric",modelValue:v(ne).config.metric,"onUpdate:modelValue":e=>v(ne).config.metric=e,options:we},null,8,["modelValue","onUpdate:modelValue"]),g(v(Pe),{label:"Time Range",modelValue:v(ne).config.range,"onUpdate:modelValue":e=>v(ne).config.range=e,options:ke},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Show Title",modelValue:v(ne).config.showTitle,"onUpdate:modelValue":e=>v(ne).config.showTitle=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Show Axes",modelValue:v(ne).config.showAxes,"onUpdate:modelValue":e=>v(ne).config.showAxes=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Pe),{label:"Metric",modelValue:v(ne).config.metric,"onUpdate:modelValue":e=>v(ne).config.metric=e,options:we},null,o,n)),t(_(v(Pe),{label:"Time Range",modelValue:v(ne).config.range,"onUpdate:modelValue":e=>v(ne).config.range=e,options:ke},null,o,n)),t(_(v(De),{label:"Show Title",modelValue:v(ne).config.showTitle,"onUpdate:modelValue":e=>v(ne).config.showTitle=e},null,o,n)),t(_(v(De),{label:"Show Axes",modelValue:v(ne).config.showAxes,"onUpdate:modelValue":e=>v(ne).config.showAxes=e},null,o,n))}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Ve),{label:"Line Color",modelValue:v(ne).config.lineColor,"onUpdate:modelValue":e=>v(ne).config.lineColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Ve),{label:"Line Color",modelValue:v(ne).config.lineColor,"onUpdate:modelValue":e=>v(ne).config.lineColor=e},null,o,n)),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"sensorCard"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Data"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Sensor",modelValue:v(ne).config.sensorType,"onUpdate:modelValue":e=>v(ne).config.sensorType=e,options:ye},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex flex-wrap gap-3 mt-2"},[g(v(De),{label:"Stats",modelValue:v(ne).config.showStats,"onUpdate:modelValue":e=>v(ne).config.showStats=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Status",modelValue:v(ne).config.showStatusDot,"onUpdate:modelValue":e=>v(ne).config.showStatusDot=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Label",modelValue:v(ne).config.showLabel,"onUpdate:modelValue":e=>v(ne).config.showLabel=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Value",modelValue:v(ne).config.showUnit,"onUpdate:modelValue":e=>v(ne).config.showUnit=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Sensor",modelValue:v(ne).config.sensorType,"onUpdate:modelValue":e=>v(ne).config.sensorType=e,options:ye},null,o,n)),t(`<div class="flex flex-wrap gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Stats",modelValue:v(ne).config.showStats,"onUpdate:modelValue":e=>v(ne).config.showStats=e},null,o,n)),t(_(v(De),{label:"Status",modelValue:v(ne).config.showStatusDot,"onUpdate:modelValue":e=>v(ne).config.showStatusDot=e},null,o,n)),t(_(v(De),{label:"Label",modelValue:v(ne).config.showLabel,"onUpdate:modelValue":e=>v(ne).config.showLabel=e},null,o,n)),t(_(v(De),{label:"Value",modelValue:v(ne).config.showUnit,"onUpdate:modelValue":e=>v(ne).config.showUnit=e},null,o,n)),t("</div>")}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Value Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:12,max:120,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:60,step:1},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"grid grid-cols-2 gap-2 mt-2"},[g(v(Ve),{label:"Value",modelValue:v(ne).config.valueColor,"onUpdate:modelValue":e=>v(ne).config.valueColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"Label",modelValue:v(ne).config.labelColor,"onUpdate:modelValue":e=>v(ne).config.labelColor=e},null,8,["modelValue","onUpdate:modelValue"])]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Value Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:12,max:120,step:1},null,o,n)),t(_(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:60,step:1},null,o,n)),t(`<div class="grid grid-cols-2 gap-2 mt-2" data-v-9848d89f${n}>`),t(_(v(Ve),{label:"Value",modelValue:v(ne).config.valueColor,"onUpdate:modelValue":e=>v(ne).config.valueColor=e},null,o,n)),t(_(v(Ve),{label:"Label",modelValue:v(ne).config.labelColor,"onUpdate:modelValue":e=>v(ne).config.labelColor=e},null,o,n)),t("</div>"),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"socketStatus"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Layout"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Layout",modelValue:v(ne).config.layout,"onUpdate:modelValue":e=>v(ne).config.layout=e,options:[{value:"grid",label:"Grid"},{value:"horizontal",label:"Horizontal"},{value:"vertical",label:"Vertical"}]},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex flex-wrap gap-3 mt-2"},[g(v(De),{label:"Mode",modelValue:v(ne).config.showModeName,"onUpdate:modelValue":e=>v(ne).config.showModeName=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Watts",modelValue:v(ne).config.showWattage,"onUpdate:modelValue":e=>v(ne).config.showWattage=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Layout",modelValue:v(ne).config.layout,"onUpdate:modelValue":e=>v(ne).config.layout=e,options:[{value:"grid",label:"Grid"},{value:"horizontal",label:"Horizontal"},{value:"vertical",label:"Vertical"}]},null,o,n)),t(`<div class="flex flex-wrap gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Mode",modelValue:v(ne).config.showModeName,"onUpdate:modelValue":e=>v(ne).config.showModeName=e},null,o,n)),t(_(v(De),{label:"Watts",modelValue:v(ne).config.showWattage,"onUpdate:modelValue":e=>v(ne).config.showWattage=e},null,o,n)),t("</div>")}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Font Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"grid grid-cols-2 gap-2 mt-2"},[g(v(Ve),{label:"ON",modelValue:v(ne).config.onColor,"onUpdate:modelValue":e=>v(ne).config.onColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"OFF",modelValue:v(ne).config.offColor,"onUpdate:modelValue":e=>v(ne).config.offColor=e},null,8,["modelValue","onUpdate:modelValue"])]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Font Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,o,n)),t(`<div class="grid grid-cols-2 gap-2 mt-2" data-v-9848d89f${n}>`),t(_(v(Ve),{label:"ON",modelValue:v(ne).config.onColor,"onUpdate:modelValue":e=>v(ne).config.onColor=e},null,o,n)),t(_(v(Ve),{label:"OFF",modelValue:v(ne).config.offColor,"onUpdate:modelValue":e=>v(ne).config.offColor=e},null,o,n)),t("</div>"),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"lightStatus"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Light"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Light",modelValue:v(ne).config.lightId,"onUpdate:modelValue":e=>v(ne).config.lightId=e,options:[{value:"all",label:"All Lights"},{value:"light",label:"Light 1"},{value:"light2",label:"Light 2"}]},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex flex-wrap gap-3 mt-2"},[g(v(De),{label:"Bar",modelValue:v(ne).config.showBrightnessBar,"onUpdate:modelValue":e=>v(ne).config.showBrightnessBar=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Mode",modelValue:v(ne).config.showMode,"onUpdate:modelValue":e=>v(ne).config.showMode=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Watts",modelValue:v(ne).config.showWattage,"onUpdate:modelValue":e=>v(ne).config.showWattage=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Light",modelValue:v(ne).config.lightId,"onUpdate:modelValue":e=>v(ne).config.lightId=e,options:[{value:"all",label:"All Lights"},{value:"light",label:"Light 1"},{value:"light2",label:"Light 2"}]},null,o,n)),t(`<div class="flex flex-wrap gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Bar",modelValue:v(ne).config.showBrightnessBar,"onUpdate:modelValue":e=>v(ne).config.showBrightnessBar=e},null,o,n)),t(_(v(De),{label:"Mode",modelValue:v(ne).config.showMode,"onUpdate:modelValue":e=>v(ne).config.showMode=e},null,o,n)),t(_(v(De),{label:"Watts",modelValue:v(ne).config.showWattage,"onUpdate:modelValue":e=>v(ne).config.showWattage=e},null,o,n)),t("</div>")}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"Bar Color",modelValue:v(ne).config.barColor,"onUpdate:modelValue":e=>v(ne).config.barColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,o,n)),t(_(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,o,n)),t(_(v(Ve),{label:"Bar Color",modelValue:v(ne).config.barColor,"onUpdate:modelValue":e=>v(ne).config.barColor=e},null,o,n)),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"blowerStatus"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Blower"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Style",modelValue:v(ne).config.style,"onUpdate:modelValue":e=>v(ne).config.style=e,options:[{value:"bar",label:"Bar"},{value:"arc",label:"Arc Gauge"}]},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex flex-wrap gap-3 mt-2"},[g(v(De),{label:"Title",modelValue:v(ne).config.showTitle,"onUpdate:modelValue":e=>v(ne).config.showTitle=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Speed",modelValue:v(ne).config.showSpeed,"onUpdate:modelValue":e=>v(ne).config.showSpeed=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Status",modelValue:v(ne).config.showStatus,"onUpdate:modelValue":e=>v(ne).config.showStatus=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Style",modelValue:v(ne).config.style,"onUpdate:modelValue":e=>v(ne).config.style=e,options:[{value:"bar",label:"Bar"},{value:"arc",label:"Arc Gauge"}]},null,o,n)),t(`<div class="flex flex-wrap gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Title",modelValue:v(ne).config.showTitle,"onUpdate:modelValue":e=>v(ne).config.showTitle=e},null,o,n)),t(_(v(De),{label:"Speed",modelValue:v(ne).config.showSpeed,"onUpdate:modelValue":e=>v(ne).config.showSpeed=e},null,o,n)),t(_(v(De),{label:"Status",modelValue:v(ne).config.showStatus,"onUpdate:modelValue":e=>v(ne).config.showStatus=e},null,o,n)),t("</div>")}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"Gauge",modelValue:v(ne).config.gaugeColor,"onUpdate:modelValue":e=>v(ne).config.gaugeColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,o,n)),t(_(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,o,n)),t(_(v(Ve),{label:"Gauge",modelValue:v(ne).config.gaugeColor,"onUpdate:modelValue":e=>v(ne).config.gaugeColor=e},null,o,n)),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"powerSummary"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Power"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Pe),{label:"Range",modelValue:v(ne).config.range,"onUpdate:modelValue":e=>v(ne).config.range=e,options:[{value:"24h",label:"24 Hours"},{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"}]},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"flex flex-wrap gap-3 mt-2"},[g(v(De),{label:"Cost",modelValue:v(ne).config.showCost,"onUpdate:modelValue":e=>v(ne).config.showCost=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Breakdown",modelValue:v(ne).config.showBreakdown,"onUpdate:modelValue":e=>v(ne).config.showBreakdown=e},null,8,["modelValue","onUpdate:modelValue"])])];t(_(v(Pe),{label:"Range",modelValue:v(ne).config.range,"onUpdate:modelValue":e=>v(ne).config.range=e,options:[{value:"24h",label:"24 Hours"},{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"}]},null,o,n)),t(`<div class="flex flex-wrap gap-3 mt-2" data-v-9848d89f${n}>`),t(_(v(De),{label:"Cost",modelValue:v(ne).config.showCost,"onUpdate:modelValue":e=>v(ne).config.showCost=e},null,o,n)),t(_(v(De),{label:"Breakdown",modelValue:v(ne).config.showBreakdown,"onUpdate:modelValue":e=>v(ne).config.showBreakdown=e},null,o,n)),t("</div>")}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"Accent",modelValue:v(ne).config.accentColor,"onUpdate:modelValue":e=>v(ne).config.accentColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:60,step:1},null,o,n)),t(_(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:40,step:1},null,o,n)),t(_(v(Ve),{label:"Accent",modelValue:v(ne).config.accentColor,"onUpdate:modelValue":e=>v(ne).config.accentColor=e},null,o,n)),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),"eventLog"===v(ne).type?(t("\x3c!--[--\x3e"),t(_(v($e),{title:"Event Log"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Max Entries",modelValue:v(ne).config.maxEntries,"onUpdate:modelValue":e=>v(ne).config.maxEntries=e,min:3,max:30,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(De),{label:"Trigger Source",modelValue:v(ne).config.showTriggerSource,"onUpdate:modelValue":e=>v(ne).config.showTriggerSource=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Max Entries",modelValue:v(ne).config.maxEntries,"onUpdate:modelValue":e=>v(ne).config.maxEntries=e,min:3,max:30,step:1},null,o,n)),t(_(v(De),{label:"Trigger Source",modelValue:v(ne).config.showTriggerSource,"onUpdate:modelValue":e=>v(ne).config.showTriggerSource=e},null,o,n))}),_:1},o)),t(_(v($e),{title:"Style"},{default:x((e,t,o,n)=>{if(!t)return[g(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:40,step:1},null,8,["modelValue","onUpdate:modelValue"]),g(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:30,step:1},null,8,["modelValue","onUpdate:modelValue"]),g("div",{class:"grid grid-cols-2 gap-2 mt-2"},[g(v(Ve),{label:"ON",modelValue:v(ne).config.onColor,"onUpdate:modelValue":e=>v(ne).config.onColor=e},null,8,["modelValue","onUpdate:modelValue"]),g(v(Ve),{label:"OFF",modelValue:v(ne).config.offColor,"onUpdate:modelValue":e=>v(ne).config.offColor=e},null,8,["modelValue","onUpdate:modelValue"])]),g(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,8,["modelValue","onUpdate:modelValue"])];t(_(v(Me),{label:"Content Size",modelValue:v(ne).config.fontSize,"onUpdate:modelValue":e=>v(ne).config.fontSize=e,min:10,max:40,step:1},null,o,n)),t(_(v(Me),{label:"Title Size",modelValue:v(ne).config.titleFontSize,"onUpdate:modelValue":e=>v(ne).config.titleFontSize=e,min:8,max:30,step:1},null,o,n)),t(`<div class="grid grid-cols-2 gap-2 mt-2" data-v-9848d89f${n}>`),t(_(v(Ve),{label:"ON",modelValue:v(ne).config.onColor,"onUpdate:modelValue":e=>v(ne).config.onColor=e},null,o,n)),t(_(v(Ve),{label:"OFF",modelValue:v(ne).config.offColor,"onUpdate:modelValue":e=>v(ne).config.offColor=e},null,o,n)),t("</div>"),t(_(v(_e),{modelValue:v(ne).config.theme,"onUpdate:modelValue":e=>v(ne).config.theme=e},null,o,n))}),_:1},o)),t("\x3c!--]--\x3e")):t("\x3c!----\x3e"),t("</div>")):t('<div class="p-6 flex-1 flex items-center justify-center" data-v-9848d89f><div class="text-center" data-v-9848d89f><div class="text-base text-gray-600 mb-2" data-v-9848d89f>No element selected</div><div class="text-base text-gray-700" data-v-9848d89f>Click an element or add one from the palette</div></div></div>'),t("</div></div></div></div>")}}}),Os=Ds.setup;Ds.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dDisplayEditor.vue"),Os?Os(e,t):void 0};const Rs=Object.assign(Le(Ds,[["__scopeId","data-v-9848d89f"]]),{__name:"Room3dDisplayEditor"}),Is=e({__name:"Room3dPolygonEditor",__ssrInlineRender:!0,props:{vertices:{},normalOffset:{}},emits:["updateVertex","updateOffset","alignH","alignV","snapRect","selectionChanged","nudgeAll"],setup(e,{expose:n,emit:s}){const c=t(new Set),u=t(.005),f=[.001,.005,.01],g=o(()=>c.value.size);function d(e){return e.toFixed(3)}return n({selectedIndices:c}),(t,o,n,s)=>{o(`<div${F(p({class:"space-y-3"},s))} data-v-eefe743b><div class="flex items-center gap-1.5" data-v-eefe743b><button${X(v(g)<2)?" disabled":""} class="${U([v(g)>=2?"text-cyan-300 hover:bg-cyan-500/20":"text-gray-600 cursor-not-allowed","px-3 py-1.5 rounded-lg text-base font-bold transition-all"])}" style="${oe({background:"rgba(6,182,212,0.08)",border:"1px solid rgba(6,182,212,0.2)"})}" title="Align selected horizontally" data-v-eefe743b> â†” Align H </button><button${X(v(g)<2)?" disabled":""} class="${U([v(g)>=2?"text-cyan-300 hover:bg-cyan-500/20":"text-gray-600 cursor-not-allowed","px-3 py-1.5 rounded-lg text-base font-bold transition-all"])}" style="${oe({background:"rgba(6,182,212,0.08)",border:"1px solid rgba(6,182,212,0.2)"})}" title="Align selected vertically" data-v-eefe743b> â†• Align V </button>`),4===e.vertices.length?o(`<button class="px-3 py-1.5 rounded-lg text-base font-bold text-amber-300 hover:bg-amber-500/20 transition-all" style="${oe({background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)"})}" title="Snap to rectangle" data-v-eefe743b> â–¬ Rect </button>`):o("\x3c!----\x3e"),o(`<span class="ml-auto text-gray-600 text-base font-mono" data-v-eefe743b>${Z(v(g)>0?`${v(g)} sel`:`${e.vertices.length} pts`)}</span></div><div class="max-h-40 overflow-y-auto space-y-1" style="${oe({"scrollbar-width":"thin"})}" data-v-eefe743b>\x3c!--[--\x3e`),N(e.vertices,(e,t)=>{o(`<button class="w-full flex items-center gap-2 px-3 py-2 rounded-lg transition-all text-left group" style="${oe(v(c).has(t)?"background: rgba(6,182,212,0.12); border: 1px solid rgba(6,182,212,0.5); box-shadow: 0 0 8px rgba(6,182,212,0.15);":"background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);")}" data-v-eefe743b><span class="${U([v(c).has(t)?"text-cyan-300":"text-gray-500","w-6 h-6 rounded-md flex items-center justify-center text-base font-bold shrink-0"])}" style="${oe(v(c).has(t)?"background: rgba(6,182,212,0.25);":"background: rgba(255,255,255,0.06);")}" data-v-eefe743b>${Z(t+1)}</span><div class="flex-1 flex gap-3 font-mono text-base" data-v-eefe743b><span class="${U(v(c).has(t)?"text-cyan-300":"text-cyan-400/60")}" data-v-eefe743b>${Z(d(e.x))}</span><span class="${U(v(c).has(t)?"text-emerald-300":"text-emerald-400/60")}" data-v-eefe743b>${Z(d(e.y))}</span><span class="${U(v(c).has(t)?"text-blue-300":"text-blue-400/60")}" data-v-eefe743b>${Z(d(e.z))}</span></div><div class="${U([v(c).has(t)?"bg-cyan-400 shadow-[0_0_6px_rgba(6,182,212,0.6)]":"bg-white/10 group-hover:bg-white/20","w-2 h-2 rounded-full shrink-0 transition-all"])}" data-v-eefe743b></div></button>`)}),o(`\x3c!--]--\x3e</div><div class="rounded-xl overflow-hidden" style="${oe({background:"rgba(0,0,0,0.25)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-eefe743b><div class="flex items-center justify-between px-3 py-2" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.05)"})}" data-v-eefe743b><span class="text-gray-500 text-base font-bold" data-v-eefe743b>Move</span><div class="flex gap-0.5 p-0.5 rounded-md" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-eefe743b>\x3c!--[--\x3e`),N(f,e=>{o(`<button class="${U([v(u)===e?"text-cyan-300":"text-gray-600 hover:text-gray-400","px-2 py-0.5 rounded text-base font-mono transition-all"])}" style="${oe(v(u)===e?"background: rgba(6,182,212,0.2);":"")}" data-v-eefe743b>${Z(e)}</button>`)}),o(`\x3c!--]--\x3e</div></div><div class="flex items-center justify-center gap-3 px-3 py-3" data-v-eefe743b><div class="grid grid-cols-3 gap-1 w-[8.5rem]" data-v-eefe743b><div data-v-eefe743b></div><button class="nudge-btn" title="V+" data-v-eefe743b><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" data-v-eefe743b></path></svg></button><div data-v-eefe743b></div><button class="nudge-btn" title="U-" data-v-eefe743b><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" data-v-eefe743b></path></svg></button><div class="w-10 h-9 rounded-lg flex items-center justify-center text-gray-700 text-base font-mono" style="${oe({background:"rgba(255,255,255,0.02)",border:"1px solid rgba(255,255,255,0.04)"})}" data-v-eefe743b>${Z(v(g)>0?"Sel":"All")}</div><button class="nudge-btn" title="U+" data-v-eefe743b><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" data-v-eefe743b></path></svg></button><div data-v-eefe743b></div><button class="nudge-btn" title="V-" data-v-eefe743b><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" data-v-eefe743b></path></svg></button><div data-v-eefe743b></div></div><div class="flex flex-col gap-1" data-v-eefe743b><span class="text-gray-600 text-base text-center font-bold" data-v-eefe743b>Depth</span><button class="depth-btn" title="Push forward" data-v-eefe743b><svg class="w-3.5 h-3.5 mr-0.5" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m0-15l-3 3m3-3l3 3" data-v-eefe743b></path></svg> Fwd </button><button class="depth-btn" title="Pull back" data-v-eefe743b><svg class="w-3.5 h-3.5 mr-0.5" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-eefe743b><path stroke-linecap="round" stroke-linejoin="round" d="M12 19.5V4.5m0 15l-3-3m3 3l3-3" data-v-eefe743b></path></svg> Back </button><span class="${U([e.normalOffset>0?"text-emerald-400/70":e.normalOffset<0?"text-red-400/70":"text-gray-600","text-center font-mono text-base"])}" data-v-eefe743b>${Z(e.normalOffset>=0?"+":"")}${Z(e.normalOffset.toFixed(3))}</span></div></div></div></div>`)}}}),js=Is.setup;Is.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dPolygonEditor.vue"),js?js(e,t):void 0};const Fs=Object.assign(Le(Is,[["__scopeId","data-v-eefe743b"]]),{__name:"Room3dPolygonEditor"}),_s=e({__name:"Room3dTextPanelEditor",__ssrInlineRender:!0,props:{config:{},fonts:{},alwaysShowSurface:{type:Boolean},hidePreviewText:{type:Boolean}},emits:["update","fontUploaded"],setup(e,{emit:t}){const o=t,n=[{id:"flat",label:"Flat"},{id:"matte",label:"Matte"},{id:"glossy",label:"Glossy"}];return(t,s,c,u)=>{const v=zs;s(`<div${F(p({class:"space-y-3"},u))}>`),s(_(v,{"model-value":e.config.fontFamily,fonts:e.fonts,"onUpdate:modelValue":e=>function(e,t){o("update",e,t)}("fontFamily",e),onUploaded:e=>t.$emit("fontUploaded",e)},null,c)),s(`<div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Size</span><input type="range" min="0.05" max="1" step="0.01"${J("value",e.config.fontSize)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}"><span class="text-cyan-400 font-mono text-base w-12 text-right">${Z(Math.round(100*e.config.fontSize))}%</span></div><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Text Color</span><input type="color"${J("value",e.config.textColor)} class="w-8 h-8 rounded border-0 cursor-pointer" style="${oe({background:"transparent"})}"><span class="text-white text-base font-mono">${Z(e.config.textColor)}</span></div><div class="space-y-2"><div class="flex items-center gap-2"><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox"${X(!e.config.backgroundTransparent)?" checked":""} class="w-4 h-4 rounded accent-cyan-500"><span class="text-gray-400 text-base">Background</span></label></div>`),e.config.backgroundTransparent?s("\x3c!----\x3e"):s(`<div class="flex items-center gap-2 pl-6"><input type="color"${J("value",e.config.backgroundColor)} class="w-8 h-8 rounded border-0 cursor-pointer" style="${oe({background:"transparent"})}"><input type="range" min="0" max="1" step="0.05"${J("value",e.config.backgroundOpacity)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}"><span class="text-cyan-400 font-mono text-base w-8 text-right">${Z(Math.round(100*e.config.backgroundOpacity))}%</span></div>`),s("</div>"),!e.config.backgroundTransparent||e.alwaysShowSurface?(s(`<div class="space-y-2"><span class="text-gray-400 text-base">Surface</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}">\x3c!--[--\x3e`),N(n,t=>{s(`<button class="${U([e.config.surfaceType===t.id?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-md transition-all text-center"])}" style="${oe(e.config.surfaceType===t.id?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}">${Z(t.label)}</button>`)}),s("\x3c!--]--\x3e</div>"),"flat"!==e.config.surfaceType?s(`<div class="flex items-center gap-2 pl-2"><span class="text-gray-500 text-base w-20 shrink-0">Roughness</span><input type="range" min="0" max="1" step="0.05"${J("value",e.config.roughness)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(16,185,129)",background:"rgba(255,255,255,0.1)"})}"><span class="text-emerald-400 font-mono text-base w-8 text-right">${Z(Math.round(100*e.config.roughness))}%</span></div>`):s("\x3c!----\x3e"),"flat"!==e.config.surfaceType?s(`<div class="flex items-center gap-2 pl-2"><span class="text-gray-500 text-base w-20 shrink-0">Metallic</span><input type="range" min="0" max="1" step="0.05"${J("value",e.config.metalness)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(168,85,247)",background:"rgba(255,255,255,0.1)"})}"><span class="text-purple-400 font-mono text-base w-8 text-right">${Z(Math.round(100*e.config.metalness))}%</span></div>`):s("\x3c!----\x3e"),s("</div>")):s("\x3c!----\x3e"),s(`<div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Align</span><div class="flex gap-1 p-1 rounded-lg flex-1" style="${oe({background:"rgba(0,0,0,0.3)"})}">\x3c!--[--\x3e`),N(["left","center","right"],t=>{s(`<button class="${U([e.config.textAlign===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-md transition-all capitalize"])}" style="${oe(e.config.textAlign===t?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}">${Z(t)}</button>`)}),s(`\x3c!--]--\x3e</div></div><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox"${X(e.config.uppercase)?" checked":""} class="w-4 h-4 rounded accent-cyan-500"><span class="text-gray-400 text-base">Uppercase</span></label><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Max Chars</span><input type="number" min="0" max="100" step="1"${J("value",e.config.maxChars)} class="w-20 px-2 py-1 rounded-lg text-base text-white text-center" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}"><span class="text-gray-500 text-base">0 = unlimited</span></div><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Wrap</span><div class="flex gap-1 p-1 rounded-lg flex-1" style="${oe({background:"rgba(0,0,0,0.3)"})}">\x3c!--[--\x3e`),N(["nowrap","wrap"],t=>{s(`<button class="${U([e.config.wrapMode===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-1.5 rounded-md transition-all capitalize"])}" style="${oe(e.config.wrapMode===t?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}">${Z("nowrap"===t?"No Wrap":"Wrap")}</button>`)}),s(`\x3c!--]--\x3e</div></div><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Padding</span><input type="range" min="0" max="0.02" step="0.0005"${J("value",e.config.padding)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}"><span class="text-cyan-400 font-mono text-base w-12 text-right">${Z(e.config.padding.toFixed(3))}</span></div><div class="flex items-center gap-2"><span class="text-gray-400 text-base w-20 shrink-0">Spacing</span><input type="range" min="-0.02" max="0.05" step="0.001"${J("value",e.config.letterSpacing)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}"><span class="text-cyan-400 font-mono text-base w-12 text-right">${Z(e.config.letterSpacing.toFixed(3))}</span></div>`),e.hidePreviewText?s("\x3c!----\x3e"):s(`<div class="space-y-1"><span class="text-gray-400 text-base">Preview Text</span><textarea rows="2" class="w-full px-3 py-2 rounded-lg text-base text-white resize-none" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" placeholder="Enter text...">${Z(e.config.previewText)}</textarea></div>`),s("</div>")}}}),Ls=_s.setup;_s.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dTextPanelEditor.vue"),Ls?Ls(e,t):void 0};const Bs=Object.assign(_s,{__name:"Room3dTextPanelEditor"}),Es=e({__name:"Room3dKeypadWizard",__ssrInlineRender:!0,props:{visible:{type:Boolean},step:{},tracingActive:{type:Boolean},displayData:{},displayConfig:{},buttons:{},logic:{},fonts:{},isEditing:{type:Boolean},initialMode:{},animationTargets:{},doorTargets:{}},emits:["close","delete","next","prev","goStep","startDisplayTrace","resetDisplay","startButtonTrace","updateDisplayConfig","updateButton","deleteButton","cloneButton","generateGrid","updateLogic","save","fontUploaded","updateDisplayPolygon","updateButtonPolygon","displaySelectionChanged","buttonSelectionChanged","retraceDisplay","retraceButton","updateAllButtons"],setup(e,{emit:n}){const c=e,u=n,f=t(c.initialMode||null),g=["character","confirm","delete","clear"],b=t("instance"),h=t(null),x=t(0),S=[{id:"flat",label:"Flat"},{id:"matte",label:"Matte"},{id:"glossy",label:"Glossy"}],$=o(()=>"text"===f.value?["Text Area","Save"]:["Setup","Display","Buttons","Save"]),M=o(()=>$.value.length-1),T=o(()=>!!f.value&&c.step>0),V=o(()=>!!f.value&&c.step<M.value),O=o(()=>"text"!==f.value&&0!==c.step&&1!==c.step||!!c.displayData),I=o(()=>c.buttons.some(e=>"confirm"===e.type)),j=o(()=>{var e,t;return(null==(t=null==(e=c.logic)?void 0:e.action)?void 0:t.type)||"none"}),E=o(()=>{var e,t;return(null==(t=null==(e=c.logic)?void 0:e.action)?void 0:t.targetId)||""}),ee=o(()=>{var e,t;return(null==(t=null==(e=c.logic)?void 0:e.action)?void 0:t.doorAccessMode)||"everyone"});function H(e){return"character"===e?"Char":"confirm"===e?"OK":"delete"===e?"Del":"Clr"}function q(e){var t;return(null==(t=e.labelConfig)?void 0:t.surfaceType)||"flat"}function B(e,t){u("updateDisplayConfig",e,t)}function K(e,t){u("updateDisplayPolygon",e,t)}function te(e,t,o){u("updateButtonPolygon",e,t,o)}s(()=>c.buttons.length,(e,t)=>{e>(null!=t?t:0)&&c.buttons.length>0&&(h.value=c.buttons[c.buttons.length-1].id)}),s(()=>c.visible,e=>{var t,o;if(e){f.value=c.initialMode||(c.isEditing?"keypad":null),h.value=null;const e=c.buttons[0];x.value=null!=(o=null==(t=null==e?void 0:e.labelConfig)?void 0:t.verticalOffset)?o:0}else f.value=null,h.value=null});const ne=t(!1),le=t(4),se=t(3),re=t("1,2,3,4,5,6,7,8,9,*,0,#");return(t,o,n,s)=>{const c=Fs,u=Bs;e.visible?(o(`<div${F(p({class:"fixed right-0 top-0 bottom-0 z-50 flex flex-col w-96 overflow-hidden",style:{background:"rgba(10,10,20,0.96)","backdrop-filter":"blur(20px)","border-left":"1px solid rgba(255,255,255,0.08)"}},s))} data-v-c76153a6><div class="shrink-0 p-4 space-y-3" style="${oe({"border-bottom":"1px solid rgba(255,255,255,0.08)"})}" data-v-c76153a6><div class="flex items-center justify-between" data-v-c76153a6><h3 class="text-white font-bold text-lg" data-v-c76153a6>${Z(e.isEditing?"Edit":"Create")} ${Z("text"===v(f)?"Text Panel":"Keypad")}</h3><div class="flex items-center gap-1" data-v-c76153a6>`),e.isEditing?o('<button class="w-8 h-8 rounded-lg flex items-center justify-center text-red-500 hover:text-red-300 hover:bg-red-500/10 transition-all" title="Delete" data-v-c76153a6><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-c76153a6><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" data-v-c76153a6></path></svg></button>'):o("\x3c!----\x3e"),o('<button class="w-8 h-8 rounded-lg flex items-center justify-center text-gray-500 hover:text-white hover:bg-white/10 transition-all" data-v-c76153a6><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-c76153a6><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-c76153a6></path></svg></button></div></div>'),v(f)?(o('\x3c!--[--\x3e<div class="flex gap-1" data-v-c76153a6>\x3c!--[--\x3e'),N(v($),(t,n)=>{o(`<div class="${U([n===e.step?"bg-cyan-500":n<e.step?"bg-cyan-800":"bg-white/10","flex-1 h-1 rounded-full transition-all"])}" data-v-c76153a6></div>`)}),o(`\x3c!--]--\x3e</div><div class="flex items-center gap-2" data-v-c76153a6><span class="text-cyan-400 font-bold text-base" data-v-c76153a6>Step ${Z(e.step+1)}:</span><span class="text-gray-300 text-base" data-v-c76153a6>${Z(v($)[e.step])}</span></div>\x3c!--]--\x3e`)):o("\x3c!----\x3e"),o(`</div><div class="flex-1 overflow-y-auto p-4 space-y-4 min-h-0" style="${oe({"scrollbar-width":"thin"})}" data-v-c76153a6>`),v(f)?o("\x3c!----\x3e"):o(`\x3c!--[--\x3e<p class="text-gray-400 text-base" data-v-c76153a6>What do you want to create?</p><button class="w-full p-4 rounded-xl text-left transition-all hover:scale-[1.02]" style="${oe({background:"rgba(6,182,212,0.08)",border:"1px solid rgba(6,182,212,0.25)"})}" data-v-c76153a6><div class="text-cyan-300 font-bold text-lg" data-v-c76153a6>Text Panel</div><div class="text-gray-400 text-base mt-1" data-v-c76153a6>Label, sign, note â€” static text on a surface.</div></button><button class="w-full p-4 rounded-xl text-left transition-all hover:scale-[1.02]" style="${oe({background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.25)"})}" data-v-c76153a6><div class="text-amber-300 font-bold text-lg" data-v-c76153a6>Keypad</div><div class="text-gray-400 text-base mt-1" data-v-c76153a6>Display + buttons + code verification logic.</div></button>\x3c!--]--\x3e`),"keypad"===v(f)&&0===e.step?(o(`<div class="space-y-4" data-v-c76153a6><div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base font-bold" data-v-c76153a6>Action</span><p class="text-gray-500 text-base" data-v-c76153a6>What happens when the correct code is entered?</p><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["none","animation","door"],e=>{o(`<button class="${U([v(j)===e?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all capitalize"])}" style="${oe(v(j)===e?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z("none"===e?"None":"animation"===e?"Animation":"Door")}</button>`)}),o("\x3c!--]--\x3e</div></div>"),"animation"===v(j)?(o('<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Target object</span>'),0===e.animationTargets.length?o(`<div class="p-3 rounded-xl text-gray-500 text-base text-center" style="${oe({background:"rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-c76153a6> No animated objects in this room. </div>`):(o(`<div class="space-y-1 max-h-48 overflow-y-auto" style="${oe({"scrollbar-width":"thin"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(e.animationTargets,e=>{o(`<button class="${U([v(E)===e.id?"border-cyan-500/50 bg-cyan-500/10":"border-transparent hover:border-white/10 hover:bg-white/5","w-full p-2 rounded-lg text-left text-base text-white transition-all"])}" style="${oe({border:"1px solid"})}" data-v-c76153a6><span class="${U(v(E)===e.id?"text-cyan-300":"text-white")}" data-v-c76153a6>${Z(e.name)}</span></button>`)}),o("\x3c!--]--\x3e</div>")),o("</div>")):o("\x3c!----\x3e"),"door"===v(j)?(o('\x3c!--[--\x3e<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Door target</span>'),0===e.doorTargets.length?o(`<div class="p-3 rounded-xl text-gray-500 text-base text-center" style="${oe({background:"rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-c76153a6> No door objects in this room. </div>`):(o(`<div class="space-y-1 max-h-48 overflow-y-auto" style="${oe({"scrollbar-width":"thin"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(e.doorTargets,e=>{o(`<button class="${U([v(E)===e.id?"border-emerald-500/50 bg-emerald-500/10":"border-transparent hover:border-white/10 hover:bg-white/5","w-full p-2 rounded-lg text-left text-base text-white transition-all"])}" style="${oe({border:"1px solid"})}" data-v-c76153a6><span class="${U(v(E)===e.id?"text-emerald-300":"text-white")}" data-v-c76153a6>${Z(e.name)}</span></button>`)}),o("\x3c!--]--\x3e</div>")),o("</div>"),v(E)?(o(`\x3c!--[--\x3e<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Access mode</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["everyone","per-player"],e=>{o(`<button class="${U([v(ee)===e?"text-emerald-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all"])}" style="${oe(v(ee)===e?"background: rgba(16,185,129,0.2); border: 1px solid rgba(16,185,129,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z("everyone"===e?"Everyone":"Per Player")}</button>`)}),o(`\x3c!--]--\x3e</div><p class="text-gray-500 text-base" data-v-c76153a6>${Z("everyone"===v(ee)?"Once anyone enters the code, door opens for all":"Each player must enter the code to pass")}</p></div><div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Door behavior</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["single","repeatable"],t=>{o(`<button class="${U([e.logic.behavior===t?"text-emerald-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all"])}" style="${oe(e.logic.behavior===t?"background: rgba(16,185,129,0.2); border: 1px solid rgba(16,185,129,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z("single"===t?"Stay Open":"Re-lock")}</button>`)}),o(`\x3c!--]--\x3e</div><p class="text-gray-500 text-base" data-v-c76153a6>${Z("single"===e.logic.behavior?"Door stays open after correct code":"Door re-locks after feedback duration, code needed each time")}</p></div>\x3c!--]--\x3e`)):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")):o("\x3c!----\x3e"),o(`<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base font-bold" data-v-c76153a6>Secret Code</span><input${J("value",e.logic.secretCode)} class="w-full px-3 py-2 rounded-lg text-base text-white font-mono tracking-widest" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" placeholder="Enter code" data-v-c76153a6></div>`),v(I)?(o(`<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Verification</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["auto","manual"],t=>{o(`<button class="${U([e.logic.verificationMode===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all capitalize"])}" style="${oe(e.logic.verificationMode===t?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z(t)}</button>`)}),o(`\x3c!--]--\x3e</div><p class="text-gray-500 text-base" data-v-c76153a6>${Z("auto"===e.logic.verificationMode?"Verifies when max chars reached":"Requires a Confirm button press")}</p></div>`)):o("\x3c!----\x3e"),o(`<div class="p-3 rounded-xl space-y-2" style="${oe({background:"rgba(0,80,0,0.15)",border:"1px solid rgba(0,200,0,0.2)"})}" data-v-c76153a6><span class="text-emerald-400 text-base font-bold" data-v-c76153a6>On Correct</span><div class="flex gap-2" data-v-c76153a6><input${J("value",e.logic.onTrue.text)} class="flex-1 px-2 py-1 rounded-lg text-base text-white" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" placeholder="OPEN" data-v-c76153a6><input type="color"${J("value",e.logic.onTrue.textColor)} class="w-8 h-8 rounded border-0 cursor-pointer shrink-0" style="${oe({background:"transparent"})}" data-v-c76153a6></div></div><div class="p-3 rounded-xl space-y-2" style="${oe({background:"rgba(80,0,0,0.15)",border:"1px solid rgba(200,0,0,0.2)"})}" data-v-c76153a6><span class="text-red-400 text-base font-bold" data-v-c76153a6>On Wrong</span><div class="flex gap-2" data-v-c76153a6><input${J("value",e.logic.onFalse.text)} class="flex-1 px-2 py-1 rounded-lg text-base text-white" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" placeholder="WRONG" data-v-c76153a6><input type="color"${J("value",e.logic.onFalse.textColor)} class="w-8 h-8 rounded border-0 cursor-pointer shrink-0" style="${oe({background:"transparent"})}" data-v-c76153a6></div></div><div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-400 text-base w-20 shrink-0" data-v-c76153a6>Duration</span><input type="range" min="500" max="5000" step="100"${J("value",e.logic.feedbackDuration)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-12 text-right" data-v-c76153a6>${Z((e.logic.feedbackDuration/1e3).toFixed(1))}s</span></div>`),"door"!==v(j)?(o(`<div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Behavior</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["single","repeatable"],t=>{o(`<button class="${U([e.logic.behavior===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all capitalize"])}" style="${oe(e.logic.behavior===t?"background: rgba(6,182,212,0.2); border: 1px solid rgba(6,182,212,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z(t)}</button>`)}),o(`\x3c!--]--\x3e</div><p class="text-gray-500 text-base" data-v-c76153a6>${Z("single"===e.logic.behavior?"Stays unlocked permanently":"Re-locks after feedback duration")}</p></div>`)):o("\x3c!----\x3e"),o(`<button class="w-full py-3 rounded-xl text-base font-bold text-cyan-300 hover:text-cyan-200 hover:bg-cyan-500/10 transition-all" style="${oe({border:"1px solid rgba(6,182,212,0.3)"})}" data-v-c76153a6> Edit Model â–¶ </button></div>`)):o("\x3c!----\x3e"),"text"===v(f)&&0===e.step||"keypad"===v(f)&&1===e.step?(o("\x3c!--[--\x3e"),e.displayData?(o(`<div class="space-y-3" data-v-c76153a6><div class="flex items-center gap-2" data-v-c76153a6><div class="w-3 h-3 rounded-full bg-emerald-400" data-v-c76153a6></div><span class="text-emerald-400 text-base font-bold" data-v-c76153a6>Area set</span><button class="ml-auto text-cyan-400 text-base hover:text-cyan-300 transition-all" data-v-c76153a6>Re-trace</button><button class="text-red-400 text-base hover:text-red-300 transition-all" data-v-c76153a6>Reset</button></div><div class="p-3 rounded-xl" style="${oe({background:"rgba(0,0,0,0.15)",border:"1px solid rgba(255,255,255,0.06)"})}" data-v-c76153a6><div class="flex items-center gap-2 mb-2" data-v-c76153a6><span class="text-gray-400 text-base font-bold" data-v-c76153a6>Position</span></div>`),o(_(c,{vertices:e.displayData.polygon.vertices,"normal-offset":e.displayData.polygon.normalOffset,onUpdateVertex:(e,t,o)=>K("updateVertex",{index:e,axis:t,value:o}),onUpdateOffset:e=>K("updateOffset",{value:e}),onAlignH:e=>K("alignH",{indices:e}),onAlignV:e=>K("alignV",{indices:e}),onSnapRect:e=>K("snapRect",{}),onNudgeAll:(e,t,o)=>K("nudge",{axis:e,amount:t,selected:o}),onSelectionChanged:e=>t.$emit("displaySelectionChanged",e)},null,n)),o("</div>"),o(_(u,{config:e.displayConfig,fonts:e.fonts,onUpdate:B,onFontUploaded:e=>t.$emit("fontUploaded",e)},null,n)),o("</div>")):o(`<div class="space-y-3" data-v-c76153a6><p class="text-gray-400 text-base" data-v-c76153a6>Trace the ${Z("text"===v(f)?"text":"display")} area on the surface.</p><button${X(e.tracingActive)?" disabled":""} class="${U([e.tracingActive?"text-gray-500 cursor-not-allowed":"text-cyan-300 hover:bg-cyan-500/20","w-full py-3 rounded-xl text-base font-bold transition-all"])}" style="${oe({border:"1px dashed rgba(6,182,212,0.4)"})}" data-v-c76153a6>${Z(e.tracingActive?"Tracing... click on surface":"Trace Area")}</button></div>`),o("\x3c!--]--\x3e")):o("\x3c!----\x3e"),"keypad"===v(f)&&2===e.step?(o(`<div class="space-y-3" data-v-c76153a6><div class="flex items-center gap-2" data-v-c76153a6><button${X(e.tracingActive)?" disabled":""} class="${U([e.tracingActive?"text-gray-500 cursor-not-allowed":"text-cyan-300 hover:bg-cyan-500/20","flex-1 py-2 rounded-xl text-base font-bold transition-all"])}" style="${oe({border:"1px dashed rgba(6,182,212,0.4)"})}" data-v-c76153a6>${Z(e.tracingActive?"Tracing...":"+ Add Button")}</button>`),e.buttons.length>0?o(`<button class="px-3 py-2 rounded-xl text-base font-bold text-amber-300 hover:bg-amber-500/20 transition-all" style="${oe({border:"1px solid rgba(245,158,11,0.3)"})}" data-v-c76153a6> Grid </button>`):o("\x3c!----\x3e"),o("</div>"),e.buttons.length>0?o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-24 shrink-0" data-v-c76153a6>Label Y Offset</span><input type="range" min="-0.3" max="0.3" step="0.01"${J("value",v(x))} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-12 text-right" data-v-c76153a6>${Z(v(x)>0?"+":"")}${Z(v(x).toFixed(2))}</span></div>`):o("\x3c!----\x3e"),o("\x3c!--[--\x3e"),N(e.buttons,(e,s)=>{var u,p,f,b,x,$,M,T,V,O,I,j,F,E,ee,ne;o(`<div class="rounded-xl overflow-hidden" style="${oe({background:"rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.08)"})}" data-v-c76153a6><div class="flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-white/5 transition-all" data-v-c76153a6><span class="text-gray-500 text-base" data-v-c76153a6>${Z(v(h)===e.id?"â–¼":"â–¶")}</span><span class="text-white font-bold text-base" data-v-c76153a6>Key: ${Z(e.label||"?")}</span><span class="px-2 py-0.5 rounded text-base font-bold" style="${oe({background:"rgba(6,182,212,0.15)",color:"rgba(6,182,212,0.8)"})}" data-v-c76153a6>${Z(H(e.type))}</span><div class="flex-1" data-v-c76153a6></div><button class="text-cyan-400 text-base hover:text-cyan-300 px-1" data-v-c76153a6>Clone</button><button class="text-red-400 text-base hover:text-red-300 px-1" data-v-c76153a6>Delete</button></div>`),v(h)===e.id?(o(`<div class="px-3 pb-3 space-y-2" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-c76153a6><div class="flex gap-1 p-0.5 rounded-lg mt-2" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(g,t=>{o(`<button class="${U([e.type===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base py-1 rounded-md transition-all capitalize"])}" style="${oe(e.type===t?"background: rgba(6,182,212,0.2);":"")}" data-v-c76153a6>${Z(H(t))}</button>`)}),o(`\x3c!--]--\x3e</div><div class="space-y-1" data-v-c76153a6><span class="text-gray-500 text-base" data-v-c76153a6>Label</span><input${J("value",e.label)} class="w-full px-2 py-1 rounded-lg text-base text-white" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}"${J("placeholder",v(fi)[e.type]||"1")} data-v-c76153a6></div><div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Font Size</span><input type="range" min="0.05" max="1" step="0.05"${J("value",null!=(p=null==(u=e.labelConfig)?void 0:u.fontSize)?p:.4)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-8 text-right" data-v-c76153a6>${Z(Math.round(100*(null!=(b=null==(f=e.labelConfig)?void 0:f.fontSize)?b:.4)))}%</span></div><div class="flex items-center gap-2" data-v-c76153a6><label class="flex items-center gap-1 cursor-pointer" data-v-c76153a6><input type="checkbox"${X(!e.areaTransparent)?" checked":""} class="w-3.5 h-3.5 rounded accent-cyan-500" data-v-c76153a6><span class="text-gray-500 text-base" data-v-c76153a6>Area BG</span></label>`),e.areaTransparent?o("\x3c!----\x3e"):o(`<input type="color"${J("value",e.areaColor)} class="w-6 h-6 rounded border-0 cursor-pointer" style="${oe({background:"transparent"})}" data-v-c76153a6>`),o("</div>"),e.areaTransparent?o("\x3c!----\x3e"):o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Opacity</span><input type="range" min="0.05" max="1" step="0.05"${J("value",e.areaOpacity)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-8 text-right" data-v-c76153a6>${Z(Math.round(100*e.areaOpacity))}%</span></div>`),o(`<div class="space-y-1" data-v-c76153a6><span class="text-gray-500 text-base" data-v-c76153a6>Surface</span><div class="flex gap-1 p-0.5 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(S,t=>{o(`<button class="${U([q(e)===t.id?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base py-1 rounded-md transition-all"])}" style="${oe(q(e)===t.id?"background: rgba(6,182,212,0.2);":"")}" data-v-c76153a6>${Z(t.label)}</button>`)}),o("\x3c!--]--\x3e</div></div>"),"flat"!==q(e)?o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Roughness</span><input type="range" min="0" max="1" step="0.05"${J("value",null!=($=null==(x=e.labelConfig)?void 0:x.roughness)?$:.5)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-8 text-right" data-v-c76153a6>${Z(Math.round(100*(null!=(T=null==(M=e.labelConfig)?void 0:M.roughness)?T:.5)))}%</span></div>`):o("\x3c!----\x3e"),"flat"!==q(e)?o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Metallic</span><input type="range" min="0" max="1" step="0.05"${J("value",null!=(O=null==(V=e.labelConfig)?void 0:V.metalness)?O:0)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-8 text-right" data-v-c76153a6>${Z(Math.round(100*(null!=(j=null==(I=e.labelConfig)?void 0:I.metalness)?j:0)))}%</span></div>`):o("\x3c!----\x3e"),"flat"!==q(e)?o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Grain</span><input type="range" min="0" max="0.02" step="0.001"${J("value",null!=(E=null==(F=e.labelConfig)?void 0:F.grainIntensity)?E:0)} class="flex-1 h-1.5 rounded-full appearance-none cursor-pointer" style="${oe({"accent-color":"rgb(6,182,212)",background:"rgba(255,255,255,0.1)"})}" data-v-c76153a6><span class="text-cyan-400 font-mono text-base w-12 text-right" data-v-c76153a6>${Z((1e3*(null!=(ne=null==(ee=e.labelConfig)?void 0:ee.grainIntensity)?ne:0)).toFixed(1))}</span></div>`):o("\x3c!----\x3e"),o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-500 text-base w-20 shrink-0" data-v-c76153a6>Align</span><div class="flex gap-1 p-0.5 rounded-lg flex-1" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["left","center","right"],t=>{var n,s;o(`<button class="${U([((null==(n=e.labelConfig)?void 0:n.textAlign)||"center")===t?"text-cyan-300":"text-gray-500 hover:text-gray-300","flex-1 text-base py-1 rounded-md transition-all capitalize"])}" style="${oe(((null==(s=e.labelConfig)?void 0:s.textAlign)||"center")===t?"background: rgba(6,182,212,0.2);":"")}" data-v-c76153a6>${Z(t)}</button>`)}),o(`\x3c!--]--\x3e</div></div><div class="pt-2" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-c76153a6><div class="flex items-center gap-2 mb-2" data-v-c76153a6><span class="text-gray-400 text-base font-bold" data-v-c76153a6>Position</span><button class="ml-auto text-cyan-400 text-base hover:text-cyan-300 transition-all" data-v-c76153a6> Re-trace </button></div>`),o(_(c,{vertices:e.polygon.vertices,"normal-offset":e.polygon.normalOffset,onUpdateVertex:(t,o,n)=>te(e.id,"updateVertex",{index:t,axis:o,value:n}),onUpdateOffset:t=>te(e.id,"updateOffset",{value:t}),onAlignH:t=>te(e.id,"alignH",{indices:t}),onAlignV:t=>te(e.id,"alignV",{indices:t}),onSnapRect:t=>te(e.id,"snapRect",{}),onNudgeAll:(t,o,n)=>te(e.id,"nudge",{axis:t,amount:o,selected:n}),onSelectionChanged:o=>t.$emit("buttonSelectionChanged",e.id,o)},null,n)),o("</div></div>")):o("\x3c!----\x3e"),o("</div>")}),o("\x3c!--]--\x3e"),0===e.buttons.length?o('<p class="text-gray-500 text-base text-center py-4" data-v-c76153a6> No buttons yet. Trace buttons on the object surface. </p>'):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e"),e.step===v(M)?(o(`<div class="space-y-4" data-v-c76153a6><div class="p-3 rounded-xl space-y-2" style="${oe({background:"rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.08)"})}" data-v-c76153a6><div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Type:</span><span class="text-white text-base" data-v-c76153a6>${Z("text"===v(f)?"Text Panel":"Keypad")}</span></div><div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Display:</span><span class="text-white text-base" data-v-c76153a6>${Z(e.displayData?"Set":"Not set")}</span></div>`),"keypad"===v(f)?(o(`\x3c!--[--\x3e<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Buttons:</span><span class="text-white text-base" data-v-c76153a6>${Z(e.buttons.length)}</span></div>`),e.logic.secretCode?o(`<div class="flex items-center gap-2" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Code:</span><span class="text-white text-base font-mono tracking-widest" data-v-c76153a6>${Z(e.logic.secretCode)}</span></div>`):o("\x3c!----\x3e"),o("\x3c!--]--\x3e")):o("\x3c!----\x3e"),o(`</div><div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Save scope</span><div class="flex gap-1 p-1 rounded-lg" style="${oe({background:"rgba(0,0,0,0.3)"})}" data-v-c76153a6>\x3c!--[--\x3e`),N(["instance","default"],e=>{o(`<button class="${U([v(b)===e?"text-amber-300":"text-gray-500 hover:text-gray-300","flex-1 text-base font-bold py-2 rounded-md transition-all"])}" style="${oe(v(b)===e?"background: rgba(245,158,11,0.2); border: 1px solid rgba(245,158,11,0.3);":"border: 1px solid transparent;")}" data-v-c76153a6>${Z("instance"===e?"This Object":"Model Default")}</button>`)}),o(`\x3c!--]--\x3e</div><p class="text-gray-500 text-base" data-v-c76153a6>${Z("instance"===v(b)?"Only this placed object":"All new copies of this model")}</p></div></div>`)):o("\x3c!----\x3e"),o(`</div><div class="shrink-0 p-4 flex gap-2" style="${oe({"border-top":"1px solid rgba(255,255,255,0.08)"})}" data-v-c76153a6>`),v(T)?o(`<button class="px-4 py-2 rounded-xl text-base font-bold text-gray-400 hover:text-white transition-all" style="${oe({background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-c76153a6> â—€ Back </button>`):o("\x3c!----\x3e"),o('<div class="flex-1" data-v-c76153a6></div>'),v(V)?o(`<button${X(!v(O))?" disabled":""} class="${U([v(O)?"text-cyan-300 hover:text-cyan-200":"text-gray-600 cursor-not-allowed","px-6 py-2 rounded-xl text-base font-bold transition-all"])}" style="${oe(v(O)?"background: rgba(6,182,212,0.15); border: 1px solid rgba(6,182,212,0.3);":"background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);")}" data-v-c76153a6> Next â–¶ </button>`):o("\x3c!----\x3e"),v(f)&&e.step===v(M)?o(`<button class="px-6 py-2 rounded-xl text-base font-bold text-emerald-300 hover:text-emerald-200 transition-all" style="${oe({background:"rgba(16,185,129,0.15)",border:"1px solid rgba(16,185,129,0.3)"})}" data-v-c76153a6> Save </button>`):o("\x3c!----\x3e"),o("</div>"),v(ne)?o(`<div class="absolute inset-0 z-60 flex items-center justify-center" style="${oe({background:"rgba(0,0,0,0.6)"})}" data-v-c76153a6><div class="w-72 rounded-2xl p-5 space-y-4" style="${oe({background:"rgba(15,15,25,0.98)",border:"1px solid rgba(255,255,255,0.15)"})}" data-v-c76153a6><h4 class="text-white font-bold text-lg" data-v-c76153a6>Grid Layout</h4><div class="flex gap-3" data-v-c76153a6><div class="flex-1 space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Rows</span><input type="number"${J("value",v(le))} min="1" max="6" class="w-full px-2 py-1 rounded-lg text-base text-white text-center" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-c76153a6></div><div class="flex-1 space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Cols</span><input type="number"${J("value",v(se))} min="1" max="6" class="w-full px-2 py-1 rounded-lg text-base text-white text-center" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-c76153a6></div></div><div class="space-y-1" data-v-c76153a6><span class="text-gray-400 text-base" data-v-c76153a6>Labels (comma-separated)</span><input${J("value",v(re))} class="w-full px-2 py-1 rounded-lg text-base text-white" style="${oe({background:"rgba(0,0,0,0.3)",border:"1px solid rgba(255,255,255,0.1)"})}" placeholder="1,2,3,4,5,6,7,8,9,*,0,#" data-v-c76153a6></div><div class="flex gap-2" data-v-c76153a6><button class="flex-1 py-2 rounded-xl text-base font-bold text-gray-400 hover:text-white transition-all" style="${oe({background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"})}" data-v-c76153a6> Cancel </button><button class="flex-1 py-2 rounded-xl text-base font-bold text-amber-300 hover:text-amber-200 transition-all" style="${oe({background:"rgba(245,158,11,0.15)",border:"1px solid rgba(245,158,11,0.3)"})}" data-v-c76153a6> Generate </button></div></div></div>`):o("\x3c!----\x3e"),o("</div>")):o("\x3c!----\x3e")}}}),Us=Es.setup;Es.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dKeypadWizard.vue"),Us?Us(e,t):void 0};const Ws=Object.assign(Le(Es,[["__scopeId","data-v-c76153a6"]]),{__name:"Room3dKeypadWizard"}),Ns=[{name:"small",label:"Small",dimensions:"60Ã—60Ã—160cm",plantEstimate:"1â€“2 plants",config:{width:.6,depth:.6,height:1.6,ventDiameter:.1,vents:[{wall:"left",position:"top"},{wall:"right",position:"top"}]}},{name:"medium",label:"Medium",dimensions:"90Ã—90Ã—180cm",plantEstimate:"2â€“4 plants",config:{width:.9,depth:.9,height:1.8,ventDiameter:.15,vents:[{wall:"left",position:"top"},{wall:"right",position:"top"}]}},{name:"standard",label:"Standard",dimensions:"120Ã—120Ã—200cm",plantEstimate:"4â€“6 plants",config:{width:1.2,depth:1.2,height:2,ventDiameter:.15,vents:[{wall:"left",position:"top"},{wall:"right",position:"top"}]}},{name:"large",label:"Large",dimensions:"150Ã—150Ã—200cm",plantEstimate:"6â€“9 plants",config:{width:1.5,depth:1.5,height:2,ventDiameter:.15,vents:[{wall:"left",position:"top"},{wall:"right",position:"top"}]}},{name:"xl",label:"XL",dimensions:"120Ã—240Ã—200cm",plantEstimate:"8â€“12 plants",config:{width:1.2,depth:2.4,height:2,ventDiameter:.2,vents:[{wall:"left",position:"top"},{wall:"right",position:"top"}]}}],Hs=10,Gs=14,qs=.97,Ks=new WeakMap;let Ys=null,Js=null,Zs=null,Qs=null,Xs=null,er=null;const tr=[],ar=new Ue.TextureLoader;function Ja(e,t,o,n=!1){const s=ar.load(e,void 0,void 0,e=>{});return s.wrapS=s.wrapT=Ue.RepeatWrapping,s.repeat.set(t,o),n&&(s.colorSpace=Ue.SRGBColorSpace),tr.push(s),s}function Ow(e="silver"){const t="green"===e?2771498:3815994;Ys&&Ys.color.getHex()!==t&&dm(),Ys||function(e="silver"){const t="green"===e?2771498:3815994;Ys=new Ue.MeshStandardMaterial({color:t,roughness:.4,metalness:.85});const o="/models/textures/leader1/Fabric030_1K-JPG_",n=Ja(o+"Color.jpg",8,8,!0),s=Ja(o+"NormalGL.jpg",8,8),c=Ja(o+"Roughness.jpg",8,8),u=Ja(o+"AmbientOcclusion.jpg",8,8);Js=new Ue.MeshStandardMaterial({color:6710886,map:n,normalMap:s,normalScale:new Ue.Vector2(4,4),roughnessMap:c,roughness:1,aoMap:u,aoMapIntensity:1,metalness:0,emissive:2236962,emissiveIntensity:.3,emissiveMap:n,side:Ue.FrontSide});const p="/models/textures/metal1/Metal061A_1K-JPG_",v=Ja(p+"Color.jpg",2,2,!0),f=Ja(p+"NormalGL.jpg",2,2),g=Ja(p+"Roughness.jpg",2,2),b=Ja(p+"Metalness.jpg",2,2);Zs=new Ue.MeshStandardMaterial({color:16777215,map:v,normalMap:f,normalScale:new Ue.Vector2(.8,.8),roughnessMap:g,roughness:1,metalnessMap:b,metalness:1,emissive:8947848,emissiveIntensity:.3,emissiveMap:v,envMapIntensity:2,side:Ue.BackSide}),Qs=new Ue.MeshStandardMaterial({color:1710618,roughness:.9,metalness:0,normalMap:s.clone(),normalScale:new Ue.Vector2(.3,.3),side:Ue.DoubleSide}),Xs=new Ue.MeshStandardMaterial({color:10066329,roughness:.25,metalness:.85,emissive:4473924,emissiveIntensity:.5});const h=Ja(p+"Color.jpg",2,2,!0);er=new Ue.MeshStandardMaterial({color:16777215,map:h,normalMap:Ja(p+"NormalGL.jpg",2,2),normalScale:new Ue.Vector2(.5,.5),roughnessMap:Ja(p+"Roughness.jpg",2,2),roughness:1,metalnessMap:Ja(p+"Metalness.jpg",2,2),metalness:1,emissive:8947848,emissiveIntensity:.2,emissiveMap:h,side:Ue.DoubleSide})}(e)}function ba(e,t,o){const n=(new Ue.Vector3).subVectors(t,e),s=n.length(),c=.012*o,u=new Ue.CylinderGeometry(c,c,s,8),p=new Ue.Mesh(u,Ys);p.position.lerpVectors(e,t,.5);const v=new Ue.Vector3(0,1,0),f=n.clone().normalize();return Math.abs(f.dot(v))<.9999&&p.quaternion.setFromUnitVectors(v,f),p}function rm(e,t,o){const n=e.getAttribute("uv");if(!n)return;const s=t/2;for(let e=0;e<n.count;e++)n.setX(e,(n.getX(e)+s)/t),n.setY(e,n.getY(e)/o);n.needsUpdate=!0}function Vu(e,t,o){if(!o||0===o.length){const o=new Ue.PlaneGeometry(e,t);return o.translate(0,t/2,0),o.attributes.uv&&o.setAttribute("uv2",o.attributes.uv),o}const n=e/2,s=new Ue.Shape;s.moveTo(-n,0),s.lineTo(n,0),s.lineTo(n,t),s.lineTo(-n,t),s.closePath();for(const e of o){const t=new Ue.Path;t.absarc(e.x,e.y,e.r,0,2*Math.PI,!1),s.holes.push(t)}const c=new Ue.ShapeGeometry(s);return rm(c,e,t),c.attributes.uv&&c.setAttribute("uv2",c.attributes.uv),c}const or={top:.85,mid:.5,bottom:.15};function Ew(e){var t,o,n,s,c;if(e.vents&&Array.isArray(e.vents))return e;const u=Math.min(null!=(t=e.ventCount)?t:2,6);return{width:null!=(o=e.width)?o:1.2,depth:null!=(n=e.depth)?n:1.2,height:null!=(s=e.height)?s:2,ventDiameter:null!=(c=e.ventDiameter)?c:.15,vents:[{wall:"back",position:"top"},{wall:"left",position:"bottom"},{wall:"right",position:"bottom"},{wall:"back",position:"bottom"},{wall:"left",position:"mid"},{wall:"right",position:"mid"}].slice(0,u),frameColor:e.frameColor}}function Vs(e,t,o,n){const s=new Ue.Mesh(t,Js);s.position.copy(o),s.rotation.copy(n);const c=new Ue.Mesh(t,Zs);c.position.copy(o),c.rotation.copy(n),s.userData.isTentSurface=!0,c.userData.isTentSurface=!0,e.add(s),e.add(c)}function Bw(e,t,o,n,s,c,u,p,v,f,g){const b=new Ue.Group;b.name="Walls";const h=2*t+2*s,x=2*o+2*s,S=n+s,$=[],M=[],T=[];for(const e of c){const t={x:e.holeX,y:e.holeY,r:u};"back"===e.slot.wall?$.push(t):"left"===e.slot.wall?M.push(t):T.push(t)}Vs(b,Vu(h,S,$),new Ue.Vector3(0,0,-(o+s)),new Ue.Euler(0,Math.PI,0)),Vs(b,Vu(x,S,M),new Ue.Vector3(-(t+s),0,0),new Ue.Euler(0,-Math.PI/2,0)),Vs(b,Vu(x,S,T),new Ue.Vector3(t+s,0,0),new Ue.Euler(0,Math.PI/2,0)),Vs(b,function(e,t,o,n,s,c){const u=e/2,p=new Ue.Shape;p.moveTo(-u,0),p.lineTo(u,0),p.lineTo(u,t),p.lineTo(-u,t),p.closePath();const v=new Ue.Path;v.moveTo(o,0),v.lineTo(o,s),v.lineTo(n-c,s),v.absarc(n-c,s-c,c,Math.PI/2,0,!0),v.lineTo(n,c),v.absarc(n-c,c,c,0,-Math.PI/2,!0),v.lineTo(o,0),v.closePath(),p.holes.push(v);const f=new Ue.ShapeGeometry(p);return rm(f,e,t),f.attributes.uv&&f.setAttribute("uv2",f.attributes.uv),f}(h,S,p,v,f,g),new Ue.Vector3(0,0,o+s),new Ue.Euler(0,0,0)),Vs(b,new Ue.PlaneGeometry(h,x),new Ue.Vector3(0,n+s,0),new Ue.Euler(-Math.PI/2,0,0));const V=new Ue.Mesh(new Ue.PlaneGeometry(h,x),er);return V.position.set(0,.001,0),V.rotation.set(-Math.PI/2,0,0),V.userData.isTentSurface=!0,b.add(V),b}function Hw(e,t){var o;Ow(null!=(o=e.frameColor)?o:"silver");const n=t,s=e.width/2*n,c=e.depth/2*n,u=e.height*n,p=.012*n,v=e.ventDiameter/2*n,f=function(e,t,o,n,s){var c;const u=[];for(const p of e.vents){const e=n*(null!=(c=or[p.position])?c:.5);let v,f;switch(p.wall){case"back":default:v=new Ue.Vector3(0,e,-(o+s)),f=new Ue.Vector3(0,0,-1);break;case"left":v=new Ue.Vector3(-(t+s),e,0),f=new Ue.Vector3(-1,0,0);break;case"right":v=new Ue.Vector3(t+s,e,0),f=new Ue.Vector3(1,0,0)}u.push({slot:p,position:v,normal:f,holeX:0,holeY:e})}return u}(e,s,c,u,p),g=s+p,b=-g,h=g-.05*n,x=.92*u,S=.04*n,$=c+p,M=new Ue.Group;M.name="GrowTent",M.userData.isTent=!0,M.add(function(e,t,o,n){const s=new Ue.Group;s.name="Frame";const c=new Ue.Vector3(-e,0,t),u=new Ue.Vector3(e,0,t),p=new Ue.Vector3(-e,0,-t),v=new Ue.Vector3(e,0,-t),f=new Ue.Vector3(-e,o,t),g=new Ue.Vector3(e,o,t),b=new Ue.Vector3(-e,o,-t),h=new Ue.Vector3(e,o,-t);s.add(ba(c,f,n)),s.add(ba(u,g,n)),s.add(ba(p,b,n)),s.add(ba(v,h,n)),s.add(ba(c,u,n)),s.add(ba(p,v,n)),s.add(ba(c,p,n)),s.add(ba(u,v,n)),s.add(ba(f,g,n)),s.add(ba(b,h,n)),s.add(ba(f,b,n)),s.add(ba(g,h,n));const x=2*t/3;return s.add(ba(new Ue.Vector3(-e,o,-t+x),new Ue.Vector3(e,o,-t+x),n)),s.add(ba(new Ue.Vector3(-e,o,2*x-t),new Ue.Vector3(e,o,2*x-t),n)),s.add(ba(new Ue.Vector3(0,o,t),new Ue.Vector3(0,o,-t),n)),s}(s,c,u,n)),M.add(Bw(0,s,c,u,p,f,v,b,h,x,S)),M.add(function(e,t,o,n,s,c){const u=.003*c,p=[];p.push(new Ue.Vector3(e,o,s+u)),p.push(new Ue.Vector3(t-n,o,s+u));for(let e=0;e<=12;e++){const c=Math.PI/2-e/12*(Math.PI/2);p.push(new Ue.Vector3(t-n+Math.cos(c)*n,o-n+Math.sin(c)*n,s+u))}p.push(new Ue.Vector3(t,n,s+u));for(let e=0;e<=12;e++){const o=0-e/12*(Math.PI/2);p.push(new Ue.Vector3(t-n+Math.cos(o)*n,n+Math.sin(o)*n,s+u))}p.push(new Ue.Vector3(e,0,s+u));const v=new Ue.CatmullRomCurve3(p,!1),f=new Ue.TubeGeometry(v,64,.004*c,6,!1),g=new Ue.Mesh(f,Xs);return g.name="ZipperLine",g}(b,h,x,S,$,n));const T=new Ue.Group;T.name="Door",T.position.set(0,0,$);const V=function(e,t,o,n,s,c){const u=t-e,p=(e+t)/2,v=new Ue.PlaneGeometry(u,o,Hs,Gs);v.translate(p,o/2,.003);const f=v.getAttribute("position");for(let e=0;e<f.count;e++){const n=f.getX(e),s=f.getY(e);if(n>t-c&&s>o-c){const u=n-(t-c),p=s-(o-c);if(u*u+p*p>c*c){const n=Math.atan2(p,u);f.setX(e,t-c+Math.cos(n)*c),f.setY(e,o-c+Math.sin(n)*c)}}if(n>t-c&&s<c){const o=n-(t-c),u=s-c;if(o*o+u*u>c*c){const n=Math.atan2(u,o);f.setX(e,t-c+Math.cos(n)*c),f.setY(e,c+Math.sin(n)*c)}}}f.needsUpdate=!0;const g=v.getAttribute("position"),b=g.count,h=new Float32Array(g.array),x=new Float32Array(h),S=new Float32Array(h),$=new Uint8Array(b);for(let e=0;e<=Gs;e++)$[11*e]=1;const M=[];function D(e,t){const o=3*e,n=3*t,s=h[n]-h[o],c=h[n+1]-h[o+1],u=h[n+2]-h[o+2];M.push(e,t,Math.sqrt(s*s+c*c+u*u))}for(let e=0;e<=Gs;e++)for(let t=0;t<=Hs;t++){const o=11*e+t;t<Hs&&D(o,o+1),e<Gs&&D(o,o+11),t<Hs&&e<Gs&&(D(o,o+11+1),D(o+1,o+11))}const T=M.length/3,V=new Float32Array(M),O=new Float32Array(T);for(let e=0;e<T;e++)O[e]=M[3*e+2];const I=new Ue.Mesh(v,Js);I.name="DoorClothOuter";const j=new Ue.Mesh(v,Zs);j.name="DoorClothInner";const F=h[0];return{meshOuter:I,meshInner:j,fillPanel:null,geometry:v,cols:Hs,rows:Gs,numVerts:b,positions:h,prevPositions:x,restPositions:S,pinned:$,constraints:V,originalConstraintRestLens:O,numConstraints:T,isOpen:!1,widthFactor:1,targetWidthFactor:1,hingeX:F}}(b,h,x,0,0,S);T.add(V.meshOuter),T.add(V.meshInner);const O=new Ue.Object3D;O.name="DoorTrigger",T.add(O),M.add(T),Ks.set(M,V),M.userData.disableCollisionWhenOpen=!0;const I=new Ue.PointLight(16774630,5,8*u,1);I.position.set(0,.75*u,0),I.name="TentInteriorLight",M.add(I);const j=new Ue.PointLight(16774630,3,6*u,1);j.position.set(0,.3*u,0),j.name="TentInteriorLight2",M.add(j),M.add(function(e,t,o){const n=new Ue.Group;n.name="VentSocks";const s=.12*o,c=new Ue.CylinderGeometry(t,t,s,16,1,!0);for(const t of e){const e=new Ue.Mesh(c,Qs);e.name=`VentSock-${t.slot.wall}-${t.slot.position}`,e.position.copy(t.position).addScaledVector(t.normal,s/2);const o=new Ue.Vector3(0,1,0);Math.abs(t.normal.dot(o))<.999&&e.quaternion.setFromUnitVectors(o,t.normal),n.add(e)}return n}(f,v,n));const F=function(e,t,o,n,s,c){const u=[];for(let o=0;o<t.length;o++){const n=t[o];u.push({id:`vent-${o}`,type:"vent",position:n.position.clone(),normal:n.normal.clone(),radius:e.ventDiameter/2})}u.push({id:"hook-center",type:"hookPoint",position:new Ue.Vector3(0,s-.02*c,0),normal:new Ue.Vector3(0,-1,0),radius:.03});const p=.3*c,v=.15*c,f=Math.max(1,Math.floor(2*(o-v)/p)),g=Math.max(1,Math.floor(2*(n-v)/p)),b=-(f-1)*p/2,h=-(g-1)*p/2;for(let e=0;e<f;e++)for(let t=0;t<g;t++)u.push({id:`pot-${e}-${t}`,type:"potSlot",position:new Ue.Vector3(b+e*p,.01*c,h+t*p),normal:new Ue.Vector3(0,1,0),radius:.12});return u}(e,f,s,c,u,n);M.userData._tentConfig={...e},M.userData.connectionPoints=F,M.userData.skipContactShadow=!1;return{group:M,connectionPoints:F,doorAnimClip:new Ue.AnimationClip("TentDoor",.05,[new Ue.NumberKeyframeTrack("DoorTrigger.scale[x]",[0,.05],[1,1])])}}function Gw(e,t,o){const n=Math.min(t,.05),s=2.5*n;e.widthFactor+=(e.targetWidthFactor-e.widthFactor)*s;const c=e.widthFactor,u=e.constraints,p=e.hingeX,v=e.restPositions;if(c<.99)for(let t=0;t<e.numConstraints;t++){const e=3*t,o=3*(0|u[e]),n=3*(0|u[e+1]),s=p+(v[o]-p)*c-(p+(v[n]-p)*c),f=v[o+1]-v[n+1],g=v[o+2]-v[n+2];u[e+2]=Math.sqrt(s*s+f*f+g*g)}else for(let t=0;t<e.numConstraints;t++)u[3*t+2]=e.originalConstraintRestLens[t];if(e.isOpen){const t=n/3,s=-9.81*o*t*t,c=-1.5*o*t*t,p=-.3*o*t*t,v=e.cols+1;for(let t=0;t<3;t++){for(let t=0;t<e.numVerts;t++){if(e.pinned[t])continue;const o=3*t,n=t%v/e.cols,u=e.positions[o],f=e.positions[o+1],g=e.positions[o+2],b=(u-e.prevPositions[o])*qs,h=(f-e.prevPositions[o+1])*qs,x=(g-e.prevPositions[o+2])*qs;e.prevPositions[o]=u,e.prevPositions[o+1]=f,e.prevPositions[o+2]=g,e.positions[o]=u+b+c*n,e.positions[o+1]=f+h+s,e.positions[o+2]=g+x+p*n}for(let t=0;t<3;t++)for(let t=0;t<e.numConstraints;t++){const o=3*t,n=0|u[o],s=0|u[o+1],c=u[o+2],p=3*n,v=3*s,f=e.positions[p],g=e.positions[p+1],b=e.positions[p+2],h=e.positions[v],x=e.positions[v+1],S=e.positions[v+2],$=h-f,M=x-g,T=S-b,V=Math.sqrt($*$+M*M+T*T);if(V<1e-4)continue;const O=(V-c)/V,I=e.pinned[n],j=e.pinned[s];if(!I||!j)if(I)e.positions[v]=h-$*O,e.positions[v+1]=x-M*O,e.positions[v+2]=S-T*O;else if(j)e.positions[p]=f+$*O,e.positions[p+1]=g+M*O,e.positions[p+2]=b+T*O;else{const t=.5*O;e.positions[p]=f+$*t,e.positions[p+1]=g+M*t,e.positions[p+2]=b+T*t,e.positions[v]=h-$*t,e.positions[v+1]=x-M*t,e.positions[v+2]=S-T*t}}for(let t=0;t<e.numVerts;t++)e.pinned[t]||e.positions[3*t+1]<.001&&(e.positions[3*t+1]=.001);const t=-.05*o;for(let o=0;o<e.numVerts;o++)e.pinned[o]||e.positions[3*o+2]<t&&(e.positions[3*o+2]=t)}}else{const t=4*n;for(let o=0;o<e.numVerts;o++){if(e.pinned[o])continue;const n=3*o;e.positions[n]=e.positions[n]+(e.restPositions[n]-e.positions[n])*t,e.positions[n+1]=e.positions[n+1]+(e.restPositions[n+1]-e.positions[n+1])*t,e.positions[n+2]=e.positions[n+2]+(e.restPositions[n+2]-e.positions[n+2])*t}e.prevPositions.set(e.positions)}const f=e.geometry.getAttribute("position");f.array.set(e.positions),f.needsUpdate=!0,e.geometry.computeVertexNormals()}function Kw(e,t,o){if(e.isOpen=t,e.fillPanel&&(e.fillPanel.visible=!t),e.targetWidthFactor=t?.4:1,t){const t=e.cols+1;for(let n=0;n<=e.rows;n++)for(let s=0;s<=e.cols;s++){const c=n*t+s;if(e.pinned[c])continue;const u=s/e.cols,p=n/e.rows,v=3*c;e.prevPositions[v]=e.prevPositions[v]+.025*o*u,e.prevPositions[v+2]=e.prevPositions[v+2]-.008*o*u,e.prevPositions[v+1]=e.prevPositions[v+1]-.005*o*u*p}}}function dm(){null==Ys||Ys.dispose(),Ys=null,null==Js||Js.dispose(),Js=null,null==Zs||Zs.dispose(),Zs=null,null==Qs||Qs.dispose(),Qs=null,null==Xs||Xs.dispose(),Xs=null,null==er||er.dispose(),er=null;for(const e of tr)e.dispose();tr.length=0}function qw(e){e.traverse(e=>{var t;e instanceof Ue.Mesh&&(null==(t=e.geometry)||t.dispose())}),e.removeFromParent()}function Yw(){return{buildGrowTent:Hw,presets:Ns,disposeTent:qw,cleanup(){dm()},getDisplayName:e=>`Grow Tent ${Math.round(100*e.width)}Ã—${Math.round(100*e.depth)}Ã—${Math.round(100*e.height)}cm`,validateConfig:e=>e.width<.6||e.width>3?"Width must be 0.6â€“3.0m":e.depth<.6||e.depth>3?"Depth must be 0.6â€“3.0m":e.height<1.2||e.height>2.4?"Height must be 1.2â€“2.4m":!e.vents||e.vents.length>6?"Max 6 vents allowed":e.ventDiameter<.1||e.ventDiameter>.3?"Vent diameter must be 0.1â€“0.3m":null,migrateConfig:Ew,getClothState:e=>Ks.get(I(e)),initClothForGroup:e=>function(e){const t=Ks.get(e);if(t)return t;let o=null,n=null;if(e.traverse(e=>{e instanceof Ue.Mesh&&("DoorClothOuter"===e.name&&(o=e),"DoorClothInner"===e.name&&(n=e))}),!o||!n)return;const s=o,c=n,u=s.geometry,p=u.getAttribute("position"),v=p.count,f=new Float32Array(p.array),g=new Float32Array(f),b=new Float32Array(f),h=new Uint8Array(v),x=11;for(let e=0;e<=Gs;e++)h[e*x]=1;const S=[];function w(e,t){const o=3*e,n=3*t,s=f[n]-f[o],c=f[n+1]-f[o+1],u=f[n+2]-f[o+2];S.push(e,t,Math.sqrt(s*s+c*c+u*u))}for(let e=0;e<=Gs;e++)for(let t=0;t<=Hs;t++){const o=e*x+t;t<Hs&&w(o,o+1),e<Gs&&w(o,o+x),t<Hs&&e<Gs&&(w(o,o+x+1),w(o+1,o+x))}let $=0;for(let e=0;e<=Gs;e++)$+=f[e*x*3];const M=$/15,T=S.length/3,V=new Float32Array(S),O=new Float32Array(T);for(let e=0;e<T;e++)O[e]=S[3*e+2];const I={meshOuter:s,meshInner:c,fillPanel:null,geometry:u,cols:Hs,rows:Gs,numVerts:v,positions:f,prevPositions:g,restPositions:b,pinned:h,constraints:V,originalConstraintRestLens:O,numConstraints:T,isOpen:!1,widthFactor:1,targetWidthFactor:1,hingeX:M};return Ks.set(e,I),I}(I(e)),updateDoorCloth:Gw,setDoorOpen:Kw}}const nr=e({__name:"Room3dGrowTentWizard",__ssrInlineRender:!0,props:{visible:{type:Boolean}},emits:["close","place"],setup(e){const n=Ns,s=["Size","Vents & Frame","Review"],c=t(0),u=t("standard"),f=t(!1),g=O({...Ns[2].config,vents:[...Ns[2].config.vents]}),b=[{label:"10cm",desc:'4"',value:.1},{label:"15cm",desc:'6"',value:.15},{label:"20cm",desc:'8"',value:.2}],h=[{id:"b-top",wall:"back",position:"top",cx:149,cy:47,label:"T"},{id:"b-mid",wall:"back",position:"mid",cx:149,cy:82,label:"M"},{id:"b-bot",wall:"back",position:"bottom",cx:149,cy:117,label:"B"}],x=[{id:"l-top",wall:"left",position:"top",cx:49,cy:47,label:"T"},{id:"l-mid",wall:"left",position:"mid",cx:49,cy:82,label:"M"},{id:"l-bot",wall:"left",position:"bottom",cx:49,cy:117,label:"B"}],S=[{id:"r-top",wall:"right",position:"top",cx:251,cy:47,label:"T"},{id:"r-mid",wall:"right",position:"mid",cx:251,cy:82,label:"M"},{id:"r-bot",wall:"right",position:"bottom",cx:251,cy:117,label:"B"}];function y(e,t){return g.vents.some(o=>o.wall===e&&o.position===t)}const $=o(()=>`Grow Tent ${Math.round(100*g.width)}Ã—${Math.round(100*g.depth)}Ã—${Math.round(100*g.height)}cm`),M=o(()=>Math.max(1,Math.floor((g.width-.3)/.3))*Math.max(1,Math.floor((g.depth-.3)/.3))),T=o(()=>{const e=g.vents.filter(e=>"top"===e.position).length,t=g.vents.filter(e=>"mid"===e.position).length,o=g.vents.filter(e=>"bottom"===e.position).length,n=[];return e>0&&n.push(`${e} exhaust (top)`),t>0&&n.push(`${t} mid`),o>0&&n.push(`${o} intake (bottom)`),n.join(" + ")}),V=o(()=>{const e=70/Math.max(g.width,g.depth),t=g.width*e,o=g.depth*e;return{x:50-t/2,y:50-o/2,w:t,h:o}}),I=o(()=>{const e=V.value,t=.82*e.w,o=e.x+(e.w-t)/2,n=o+t,s=e.y+e.h,c=t/2;return`M ${o} ${s} L ${o} ${s-.35*e.h} A ${c} ${c} 0 0 1 ${n} ${s-.35*e.h} L ${n} ${s}`});return(t,o,O,j)=>{var E,X,ee;e.visible?(o(`<div${F(p({class:"fixed right-0 top-0 bottom-0 z-50 w-96 flex flex-col",style:{background:"rgba(10,10,20,0.96)","backdrop-filter":"blur(20px)","border-left":"1px solid rgba(255,255,255,0.08)"}},j))} data-v-2e5ea7f9><div class="px-5 pt-5 pb-3 flex-shrink-0" data-v-2e5ea7f9><div class="flex items-center justify-between mb-3" data-v-2e5ea7f9><h2 class="text-xl font-bold text-white" data-v-2e5ea7f9>Build Grow Tent</h2><button class="w-8 h-8 rounded-lg flex items-center justify-center transition-colors" style="${oe({background:"rgba(255,255,255,0.06)"})}" data-v-2e5ea7f9>`),o(_(v(de),{class:"w-5 h-5 text-white/60"},null,O)),o('</button></div><div class="flex gap-1" data-v-2e5ea7f9>\x3c!--[--\x3e'),N(s,(e,t)=>{o(`<div class="${U([t===v(c)?"bg-teal-500":t<v(c)?"bg-teal-800":"bg-white/10","flex-1 h-1 rounded-full transition-colors cursor-pointer"])}" data-v-2e5ea7f9></div>`)}),o('\x3c!--]--\x3e</div><div class="flex justify-between mt-1" data-v-2e5ea7f9>\x3c!--[--\x3e'),N(s,(e,t)=>{o(`<span class="${U([t===v(c)?"text-teal-400":"text-white/30","text-base"])}" data-v-2e5ea7f9>${Z(e)}</span>`)}),o(`\x3c!--]--\x3e</div></div><div class="flex-1 overflow-y-auto px-5 py-3" style="${oe({"scrollbar-width":"thin"})}" data-v-2e5ea7f9>`),0===v(c)?(o('<div data-v-2e5ea7f9><p class="text-base text-white/60 mb-4" data-v-2e5ea7f9>Choose a preset or set custom dimensions.</p><div class="grid grid-cols-2 gap-2 mb-5" data-v-2e5ea7f9>\x3c!--[--\x3e'),N(v(n),e=>{o(`<button class="${U([v(u)===e.name?"border-teal-500/50 bg-teal-500/10":"border-white/10 bg-white/5 hover:border-teal-500/30 hover:bg-teal-500/5","p-3 rounded-lg border transition-all text-left"])}" data-v-2e5ea7f9><div class="text-base font-semibold text-white" data-v-2e5ea7f9>${Z(e.label)}</div><div class="text-base text-white/50" data-v-2e5ea7f9>${Z(e.dimensions)}</div><div class="text-base text-teal-400/70 mt-1" data-v-2e5ea7f9>${Z(e.plantEstimate)}</div></button>`)}),o(`\x3c!--]--\x3e</div><button class="${U([v(f)?"border-amber-500/50 bg-amber-500/10 text-amber-300":"border-white/10 bg-white/5 text-white/50 hover:text-white/80","w-full text-base py-2 rounded-lg border transition-all mb-3"])}" data-v-2e5ea7f9>${Z(v(f)?"Custom Dimensions":"Custom...")}</button>`),v(f)?o(`<div class="space-y-3" data-v-2e5ea7f9><div data-v-2e5ea7f9><div class="flex justify-between text-base text-white/70 mb-1" data-v-2e5ea7f9><span data-v-2e5ea7f9>Width</span><span class="text-teal-400" data-v-2e5ea7f9>${Z((100*v(g).width).toFixed(0))}cm</span></div><input type="range" min="60" max="300" step="10"${J("value",100*v(g).width)} class="w-full accent-teal-500" data-v-2e5ea7f9></div><div data-v-2e5ea7f9><div class="flex justify-between text-base text-white/70 mb-1" data-v-2e5ea7f9><span data-v-2e5ea7f9>Depth</span><span class="text-teal-400" data-v-2e5ea7f9>${Z((100*v(g).depth).toFixed(0))}cm</span></div><input type="range" min="60" max="300" step="10"${J("value",100*v(g).depth)} class="w-full accent-teal-500" data-v-2e5ea7f9></div><div data-v-2e5ea7f9><div class="flex justify-between text-base text-white/70 mb-1" data-v-2e5ea7f9><span data-v-2e5ea7f9>Height</span><span class="text-teal-400" data-v-2e5ea7f9>${Z((100*v(g).height).toFixed(0))}cm</span></div><input type="range" min="120" max="240" step="10"${J("value",100*v(g).height)} class="w-full accent-teal-500" data-v-2e5ea7f9></div></div>`):o("\x3c!----\x3e"),o(`<div class="mt-4 flex justify-center" data-v-2e5ea7f9><svg${J("viewBox","0 0 100 100")} class="w-48 h-48" style="${oe({background:"rgba(0,0,0,0.2)","border-radius":"8px"})}" data-v-2e5ea7f9><rect${J("x",v(V).x)}${J("y",v(V).y)}${J("width",v(V).w)}${J("height",v(V).h)} fill="none" stroke="rgba(20,184,166,0.5)" stroke-width="2" data-v-2e5ea7f9></rect><path${J("d",v(I))} fill="none" stroke="rgba(251,191,36,0.7)" stroke-width="3" data-v-2e5ea7f9></path><text${J("x",50)}${J("y",v(V).y-4)} text-anchor="middle" fill="rgba(255,255,255,0.5)" font-size="10" data-v-2e5ea7f9>${Z((100*v(g).width).toFixed(0))}cm </text><text${J("x",v(V).x-6)}${J("y",50)} text-anchor="middle" fill="rgba(255,255,255,0.5)" font-size="10" transform="rotate(-90, 0, 50)" style="${oe({"transform-origin":"center"})}" data-v-2e5ea7f9>${Z((100*v(g).depth).toFixed(0))}cm </text></svg></div></div>`)):o("\x3c!----\x3e"),1===v(c)?(o(`<div data-v-2e5ea7f9><p class="text-base text-white/60 mb-4" data-v-2e5ea7f9>Click to place vents on each wall. Max 6 total.</p><div class="mb-5" data-v-2e5ea7f9><div class="text-base text-white/70 mb-2" data-v-2e5ea7f9> Vent Placement <span class="text-teal-400 ml-2" data-v-2e5ea7f9>${Z(v(g).vents.length)}/6</span></div><div class="rounded-xl border border-white/10 p-4" style="${oe({background:"rgba(0,0,0,0.2)"})}" data-v-2e5ea7f9><svg viewBox="0 0 300 160" class="w-full" data-v-2e5ea7f9><text x="50" y="14" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="11" data-v-2e5ea7f9>LEFT</text><text x="150" y="14" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="11" data-v-2e5ea7f9>BACK</text><text x="250" y="14" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="11" data-v-2e5ea7f9>RIGHT</text><rect x="5" y="22" width="88" height="120" rx="3" fill="rgba(20,184,166,0.05)" stroke="rgba(20,184,166,0.3)" stroke-width="1" data-v-2e5ea7f9></rect><rect x="105" y="22" width="88" height="120" rx="3" fill="rgba(20,184,166,0.05)" stroke="rgba(20,184,166,0.3)" stroke-width="1" data-v-2e5ea7f9></rect><rect x="207" y="22" width="88" height="120" rx="3" fill="rgba(20,184,166,0.05)" stroke="rgba(20,184,166,0.3)" stroke-width="1" data-v-2e5ea7f9></rect>\x3c!--[--\x3e`),N(h,e=>{o(`<circle${J("cx",e.cx)}${J("cy",e.cy)} r="10"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,0.4)":"rgba(255,255,255,0.05)")}${J("stroke",y(e.wall,e.position)?"rgba(20,184,166,0.8)":"rgba(255,255,255,0.15)")} stroke-width="2" class="cursor-pointer hover:stroke-teal-400 transition-colors" data-v-2e5ea7f9></circle>`)}),o("\x3c!--]--\x3e\x3c!--[--\x3e"),N(h,e=>{o(`<text${J("x",e.cx)}${J("y",e.cy+4)} text-anchor="middle"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,1)":"rgba(255,255,255,0.3)")} font-size="8" class="pointer-events-none select-none" data-v-2e5ea7f9>${Z(e.label)}</text>`)}),o("\x3c!--]--\x3e\x3c!--[--\x3e"),N(x,e=>{o(`<circle${J("cx",e.cx)}${J("cy",e.cy)} r="10"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,0.4)":"rgba(255,255,255,0.05)")}${J("stroke",y(e.wall,e.position)?"rgba(20,184,166,0.8)":"rgba(255,255,255,0.15)")} stroke-width="2" class="cursor-pointer hover:stroke-teal-400 transition-colors" data-v-2e5ea7f9></circle>`)}),o("\x3c!--]--\x3e\x3c!--[--\x3e"),N(x,e=>{o(`<text${J("x",e.cx)}${J("y",e.cy+4)} text-anchor="middle"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,1)":"rgba(255,255,255,0.3)")} font-size="8" class="pointer-events-none select-none" data-v-2e5ea7f9>${Z(e.label)}</text>`)}),o("\x3c!--]--\x3e\x3c!--[--\x3e"),N(S,e=>{o(`<circle${J("cx",e.cx)}${J("cy",e.cy)} r="10"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,0.4)":"rgba(255,255,255,0.05)")}${J("stroke",y(e.wall,e.position)?"rgba(20,184,166,0.8)":"rgba(255,255,255,0.15)")} stroke-width="2" class="cursor-pointer hover:stroke-teal-400 transition-colors" data-v-2e5ea7f9></circle>`)}),o("\x3c!--]--\x3e\x3c!--[--\x3e"),N(S,e=>{o(`<text${J("x",e.cx)}${J("y",e.cy+4)} text-anchor="middle"${J("fill",y(e.wall,e.position)?"rgba(20,184,166,1)":"rgba(255,255,255,0.3)")} font-size="8" class="pointer-events-none select-none" data-v-2e5ea7f9>${Z(e.label)}</text>`)}),o(`\x3c!--]--\x3e</svg></div><div class="text-base text-white/30 mt-1" data-v-2e5ea7f9>${Z(0===v(g).vents.length?"No ventilation ports â€” click circles to add":v(T))}</div></div>`),v(g).vents.length>0?(o('<div class="mb-5" data-v-2e5ea7f9><div class="text-base text-white/70 mb-2" data-v-2e5ea7f9>Vent Diameter</div><div class="flex gap-2" data-v-2e5ea7f9>\x3c!--[--\x3e'),N(b,e=>{o(`<button class="${U([v(g).ventDiameter===e.value?"border-teal-500/50 bg-teal-500/10 text-teal-300":"border-white/10 bg-white/5 text-white/50 hover:border-teal-500/30","flex-1 py-2 rounded-lg border transition-all text-center"])}" data-v-2e5ea7f9><div class="text-base font-medium" data-v-2e5ea7f9>${Z(e.label)}</div><div class="text-base text-white/40" data-v-2e5ea7f9>${Z(e.desc)}</div></button>`)}),o("\x3c!--]--\x3e</div></div>")):o("\x3c!----\x3e"),o(`<div class="mb-5" data-v-2e5ea7f9><div class="text-base text-white/70 mb-2" data-v-2e5ea7f9>Frame Color</div><div class="flex gap-2" data-v-2e5ea7f9><button class="${U(["silver"===(null!=(E=v(g).frameColor)?E:"silver")?"border-teal-500/50 bg-teal-500/10 text-teal-300":"border-white/10 bg-white/5 text-white/50 hover:border-teal-500/30","flex-1 py-3 rounded-lg border transition-all text-center"])}" data-v-2e5ea7f9><div class="w-6 h-6 rounded-full mx-auto mb-1" style="${oe({background:"#3a3a3a"})}" data-v-2e5ea7f9></div><div class="text-base" data-v-2e5ea7f9>Silver</div></button><button class="${U(["green"===v(g).frameColor?"border-teal-500/50 bg-teal-500/10 text-teal-300":"border-white/10 bg-white/5 text-white/50 hover:border-teal-500/30","flex-1 py-3 rounded-lg border transition-all text-center"])}" data-v-2e5ea7f9><div class="w-6 h-6 rounded-full mx-auto mb-1" style="${oe({background:"#2a4a2a"})}" data-v-2e5ea7f9></div><div class="text-base" data-v-2e5ea7f9>Green</div></button></div></div></div>`)):o("\x3c!----\x3e"),2===v(c)?o(`<div data-v-2e5ea7f9><p class="text-base text-white/60 mb-4" data-v-2e5ea7f9>Review your tent configuration.</p><div class="rounded-xl border border-white/10 overflow-hidden" style="${oe({background:"rgba(0,0,0,0.2)"})}" data-v-2e5ea7f9><div class="px-4 py-3 border-b border-white/5" data-v-2e5ea7f9><div class="text-lg font-semibold text-white" data-v-2e5ea7f9>${Z(v($))}</div></div><div class="divide-y divide-white/5" data-v-2e5ea7f9><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Dimensions</span><span class="text-base text-white" data-v-2e5ea7f9>${Z((100*v(g).width).toFixed(0))} Ã— ${Z((100*v(g).depth).toFixed(0))} Ã— ${Z((100*v(g).height).toFixed(0))}cm </span></div><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Door</span><span class="text-base text-white" data-v-2e5ea7f9>Rectangle with rounded corners</span></div><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Vents</span><span class="text-base text-white" data-v-2e5ea7f9>${Z(v(g).vents.length)} Ã— ${Z((100*v(g).ventDiameter).toFixed(0))}cm</span></div><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Frame</span><span class="text-base text-white capitalize" data-v-2e5ea7f9>${Z(null!=(X=v(g).frameColor)?X:"silver")} metallic</span></div><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Floor Area</span><span class="text-base text-white" data-v-2e5ea7f9>${Z((v(g).width*v(g).depth).toFixed(2))} mÂ²</span></div><div class="px-4 py-2 flex justify-between" data-v-2e5ea7f9><span class="text-base text-white/50" data-v-2e5ea7f9>Pot Capacity</span><span class="text-base text-teal-400" data-v-2e5ea7f9>${Z(v(M))} pots (30cm grid)</span></div></div></div><div class="mt-4 space-y-2" data-v-2e5ea7f9><div class="text-base text-white/50 mb-1" data-v-2e5ea7f9>Materials</div><div class="flex items-center gap-2" data-v-2e5ea7f9><div class="w-4 h-4 rounded" style="${oe({background:"green"===(null!=(ee=v(g).frameColor)?ee:"silver")?"#2a4a2a":"#3a3a3a"})}" data-v-2e5ea7f9></div><span class="text-base text-white/70" data-v-2e5ea7f9>Metallic steel frame</span></div><div class="flex items-center gap-2" data-v-2e5ea7f9><div class="w-4 h-4 rounded" style="${oe({background:"#111"})}" data-v-2e5ea7f9></div><span class="text-base text-white/70" data-v-2e5ea7f9>600D Oxford fabric exterior</span></div><div class="flex items-center gap-2" data-v-2e5ea7f9><div class="w-4 h-4 rounded" style="${oe({background:"#ccc"})}" data-v-2e5ea7f9></div><span class="text-base text-white/70" data-v-2e5ea7f9>Reflective mylar interior</span></div></div></div>`):o("\x3c!----\x3e"),o('</div><div class="px-5 py-4 flex-shrink-0 border-t border-white/5 flex justify-between" data-v-2e5ea7f9>'),v(c)>0?o(`<button class="px-5 py-2 rounded-lg text-base text-white/70 transition-colors" style="${oe({background:"rgba(255,255,255,0.06)"})}" data-v-2e5ea7f9> Back </button>`):o("<div data-v-2e5ea7f9></div>"),v(c)<s.length-1?o(`<button class="px-5 py-2 rounded-lg text-base font-semibold text-white transition-colors" style="${oe({background:"rgba(20,184,166,0.3)",border:"1px solid rgba(20,184,166,0.3)"})}" data-v-2e5ea7f9> Next </button>`):o(`<button class="px-5 py-2 rounded-lg text-base font-semibold text-white transition-colors" style="${oe({background:"rgba(20,184,166,0.5)",border:"1px solid rgba(20,184,166,0.4)"})}" data-v-2e5ea7f9> Place in Room </button>`),o("</div></div>")):o("\x3c!----\x3e")}}}),ir=nr.setup;nr.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dGrowTentWizard.vue"),ir?ir(e,t):void 0};const sr=Object.assign(Le(nr,[["__scopeId","data-v-2e5ea7f9"]]),{__name:"Room3dGrowTentWizard"}),rr=e({__name:"Room3dWateringHud",__ssrInlineRender:!0,props:{state:{}},setup(e){const t=e,n=o(()=>{const e=t.state.aimedPotMoisture;return e<.2?"text-red-400":e<.5?"text-amber-400":e<.8?"text-green-400":"text-blue-400"});return(t,o,s,c)=>{E(o,t=>{e.state.active?(t('<div class="fixed z-[120] pointer-events-none" data-v-832bc794>'),e.state.aimedPotMoisture>=0?t(`<div class="fixed top-1/2 left-1/2 translate-x-8 -translate-y-4" data-v-832bc794><div class="bg-black/70 backdrop-blur-sm border border-white/10 rounded-xl px-3 py-1.5 flex items-center gap-2" data-v-832bc794><svg class="${U([v(n),"w-4 h-4"])}" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-832bc794><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a8 8 0 006.93-12L12 2l-6.93 7A8 8 0 0012 21z" data-v-832bc794></path></svg><span class="text-white/80 text-base font-medium" data-v-832bc794>${Z(e.state.aimedPotName)}</span><span class="${U([v(n),"text-base font-bold"])}" data-v-832bc794>${Z(Math.round(100*e.state.aimedPotMoisture))}% </span></div></div>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e")},"body",!1,s)}}}),dr=rr.setup;rr.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("components/room3d/Room3dWateringHud.vue"),dr?dr(e,t):void 0};const cr=Object.assign(Le(rr,[["__scopeId","data-v-832bc794"]]),{__name:"Room3dWateringHud"}),ur=[];for(let e=0;e<30;e++)ur.push({position:new Ue.Vector3,rotationY:0,animation:"idle",receiveTime:0,seq:0});function Pu(e){ur.length<30&&ur.push(e)}class _w{constructor(e){var t,o;__publicField(this,"buffer",[]),__publicField(this,"maxBufferSize",20),__publicField(this,"adaptiveDelay"),__publicField(this,"minDelay"),__publicField(this,"maxDelay"),__publicField(this,"lastReceiveTime",0),__publicField(this,"jitterEstimate",0),__publicField(this,"intervalEstimate",50),__publicField(this,"lastVelocity",new Ue.Vector3),__publicField(this,"lastRotVelocity",0),__publicField(this,"lastAnimation","idle"),__publicField(this,"lastPosition",new Ue.Vector3),__publicField(this,"lastRotation",0),__publicField(this,"lastReceive",0),__publicField(this,"maxExtrapolation",200),__publicField(this,"hasEverReceived",!1),__publicField(this,"_outPosition",new Ue.Vector3),__publicField(this,"_outResult",{position:null,rotationY:0,animation:"idle",hasData:!1}),this.minDelay=null!=(t=null==e?void 0:e.minDelay)?t:40,this.maxDelay=null!=(o=null==e?void 0:e.maxDelay)?o:200,this.adaptiveDelay=80,this._outResult.position=this._outPosition}pushState(e){const t=performance.now();if(this.buffer.length>0){const t=this.buffer[this.buffer.length-1];if(e.seq<=t.seq)return}if(this.buffer.length>0){const o=this.buffer[this.buffer.length-1],n=(t-o.receiveTime)/1e3;if(n>.005&&n<2){this.lastVelocity.set(e.position.x-o.position.x,e.position.y-o.position.y,e.position.z-o.position.z).divideScalar(n);let t=e.rotationY-o.rotationY;t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),this.lastRotVelocity=t/n}}if(this.lastReceiveTime>0){const e=t-this.lastReceiveTime;this.intervalEstimate=.9*this.intervalEstimate+.1*e;const o=Math.abs(e-this.intervalEstimate);this.jitterEstimate=.9*this.jitterEstimate+.1*o;const n=1.5*this.intervalEstimate+3*this.jitterEstimate;this.adaptiveDelay=.95*this.adaptiveDelay+.05*Math.max(this.minDelay,Math.min(this.maxDelay,n))}this.lastReceiveTime=t,this.lastPosition.set(e.position.x,e.position.y,e.position.z),this.lastRotation=e.rotationY,this.lastAnimation=e.animation,this.lastReceive=t,this.hasEverReceived=!0;const o=ur.pop()||{position:new Ue.Vector3,rotationY:0,animation:"idle",receiveTime:0,seq:0};if(o.position.set(e.position.x,e.position.y,e.position.z),o.rotationY=e.rotationY,o.animation=e.animation,o.receiveTime=t,o.seq=e.seq,this.buffer.push(o),this.buffer.length>this.maxBufferSize){const e=this.buffer.length-this.maxBufferSize;for(let t=0;t<e;t++)Pu(this.buffer[t]);this.buffer.splice(0,e)}}getInterpolatedState(){if(!this.hasEverReceived)return this._outPosition.set(0,0,0),this._outResult.rotationY=0,this._outResult.animation="idle",this._outResult.hasData=!1,this._outResult;if(0===this.buffer.length)return this._extrapolate();const e=performance.now()-this.adaptiveDelay,t=this.buffer[0];if(e<=t.receiveTime)return this._outPosition.copy(t.position),this._outResult.rotationY=t.rotationY,this._outResult.animation=t.animation,this._outResult.hasData=!0,this._outResult;let o=0;for(;o<this.buffer.length-1&&this.buffer[o+1].receiveTime<=e;)o++;if(o>0){for(let e=0;e<o;e++)Pu(this.buffer[e]);this.buffer.splice(0,o),o=0}const n=this.buffer[0];if(this.buffer.length<2)return this._extrapolate();const s=this.buffer[1],c=s.receiveTime-n.receiveTime;if(c<=0)return this._outPosition.copy(s.position),this._outResult.rotationY=s.rotationY,this._outResult.animation=s.animation,this._outResult.hasData=!0,this._outResult;const u=Math.max(0,Math.min(1,(e-n.receiveTime)/c));this._outPosition.copy(n.position).lerp(s.position,u);let p=s.rotationY-n.rotationY;return p>Math.PI&&(p-=2*Math.PI),p<-Math.PI&&(p+=2*Math.PI),this._outResult.rotationY=n.rotationY+p*u,this._outResult.animation=u>.5?s.animation:n.animation,this._outResult.hasData=!0,this._outResult}_extrapolate(){const e=(performance.now()-this.lastReceive)/1e3,t=Math.min(e,this.maxExtrapolation/1e3),o="idle"!==this.lastAnimation;this._outPosition.copy(this.lastPosition);let n=this.lastRotation;return o&&t>0&&(this._outPosition.addScaledVector(this.lastVelocity,t),n+=this.lastRotVelocity*t),this._outResult.rotationY=n,this._outResult.animation=this.lastAnimation,this._outResult.hasData=!0,this._outResult}clear(){for(const e of this.buffer)Pu(e);this.buffer.length=0,this.lastVelocity.set(0,0,0),this.lastRotVelocity=0,this.lastReceive=0,this.hasEverReceived=!1,this.lastReceiveTime=0,this.jitterEstimate=0,this.adaptiveDelay=80}}const pr={scaleMultiplier:1,yOffset:0,labelOffset:0},vr={idle:"Idle","walk-f":"Walk Forward","walk-b":"Walk Backward","walk-l":"Walk Left","walk-r":"Walk Right","walk-fl":"Walk Forward Left","walk-fr":"Walk Forward Right","walk-bl":"Walk Backward Left"},fr={"run-f":"walk-f","run-b":"walk-b","run-l":"walk-l","run-r":"walk-r","run-fl":"walk-fl","run-fr":"walk-fr","run-bl":"walk-bl","run-br":"walk-br"};class l8{constructor(e,t,o,n){__publicField(this,"scene"),__publicField(this,"players",new Map),__publicField(this,"floorY"),__publicField(this,"cameraY"),__publicField(this,"_roomUnitPerMeter",1),__publicField(this,"_defaultCharacterFile"),__publicField(this,"modelCache",new Map),__publicField(this,"loadingModels",new Map),__publicField(this,"_externalNamedClips",new Map),__publicField(this,"_externalAnimsLoaded",!1),__publicField(this,"_externalAnimsLoadPromise",null),__publicField(this,"_calibrationMap",{}),__publicField(this,"deferredPlayers",[]),__publicField(this,"loader",new va),__publicField(this,"_positionCache",[]),this.scene=e,this.floorY=t,this.cameraY=o,this._defaultCharacterFile=this._pathToFile(n),this._roomUnitPerMeter=(o-t)/1.7}_pathToFile(e){return decodeURIComponent(e.split("/").pop()||"")}_fileToPath(e){return`/data/appdata/models/characters/${encodeURIComponent(e)}`}async preloadModel(){await this._ensureModel(this._defaultCharacterFile)}async _ensureModel(e){const t=this._fileToPath(e);if(this.modelCache.has(t))return this.modelCache.get(t);if(this.loadingModels.has(t))return this.loadingModels.get(t);const o=this._loadModel(t,e);this.loadingModels.set(t,o);try{return await o}finally{this.loadingModels.delete(t)}}async _loadModel(e,t){try{const t=await new Promise((t,o)=>{this.loader.load(e,t,void 0,o)}),o=t.scene;o.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});const n=(new Ue.Box3).setFromObject(o),s=n.max.y-n.min.y;let c=!0,u=[];t.animations&&t.animations.length>0?(u=t.animations,c=!1):await this._ensureExternalAnimations();const p={template:o,embeddedClips:u,useExternalAnims:c,nativeHeight:s};return this.modelCache.set(e,p),p}catch{return null}}async _ensureExternalAnimations(){if(!this._externalAnimsLoaded)return this._externalAnimsLoadPromise||(this._externalAnimsLoadPromise=this._loadExternalAnimations()),this._externalAnimsLoadPromise}async _loadExternalAnimations(){const e=[];for(const[t,o]of Object.entries(vr)){const n=`/data/appdata/models/characters/animations/${encodeURIComponent(o)}.glb`,s=new Promise(e=>{this.loader.load(n,o=>{if(o.animations.length>0){const e=o.animations.find(e=>!e.name.includes("T-Pose"))||o.animations[0];e&&this._externalNamedClips.set(t,e)}e()},void 0,()=>{e()})});e.push(s)}await Promise.all(e),!this._externalNamedClips.has("walk-br")&&this._externalNamedClips.has("walk-bl")&&this._externalNamedClips.set("walk-br",this._externalNamedClips.get("walk-bl"));for(const[e,t]of Object.entries(fr)){const o=this._externalNamedClips.get(t);o&&this._externalNamedClips.set(e,o)}const t=this._externalNamedClips.get("walk-f");t&&(this._externalNamedClips.set("walk",t),this._externalNamedClips.set("run",t)),this._externalAnimsLoaded=!0}getCalibration(e){return this._calibrationMap[e]||pr}computeScale(e,t){return(this.cameraY-this.floorY)*t.scaleMultiplier/Math.max(e,.01)}computeFloorY(e){return this.floorY+e.yOffset*this._roomUnitPerMeter}get modelTemplate(){var e,t;return null!=(t=null==(e=this.modelCache.get(this._fileToPath(this._defaultCharacterFile)))?void 0:e.template)?t:null}get animationClips(){var e,t;return null!=(t=null==(e=this.modelCache.get(this._fileToPath(this._defaultCharacterFile)))?void 0:e.embeddedClips)?t:[]}get namedClips(){return this._externalNamedClips}get useExternalAnims(){var e,t;return null==(t=null==(e=this.modelCache.get(this._fileToPath(this._defaultCharacterFile)))?void 0:e.useExternalAnims)||t}get modelNativeHeight(){var e,t;return null!=(t=null==(e=this.modelCache.get(this._fileToPath(this._defaultCharacterFile)))?void 0:e.nativeHeight)?t:1}get modelScale(){const e=this.getCalibration(this._defaultCharacterFile);return this.computeScale(this.modelNativeHeight,e)}get roomUnitPerMeter(){return this._roomUnitPerMeter}updateRoomScale(e,t){this.floorY=e,this.cameraY=t,this._roomUnitPerMeter=(t-e)/1.7;for(const e of this.players.values()){const t=this.getCalibration(e.characterFile),o=this.computeScale(e.nativeHeight,t);e.group.scale.setScalar(o),e.group.position.y=this.computeFloorY(t),this._updateLabelSprite(e)}}setCalibration(e,t){const o=t||this._defaultCharacterFile;this._calibrationMap[o]={...e};for(const t of this.players.values())if(t.characterFile===o){const o=this.computeScale(t.nativeHeight,e);t.group.scale.setScalar(o),this._updateLabelSprite(t)}}setCalibrationMap(e){this._calibrationMap={...e};for(const e of this.players.values()){const t=this.getCalibration(e.characterFile),o=this.computeScale(e.nativeHeight,t);e.group.scale.setScalar(o),this._updateLabelSprite(e)}}_updateLabelSprite(e){const t=this.getCalibration(e.characterFile),o=1/this.computeScale(e.nativeHeight,t),n=1.5*this._roomUnitPerMeter*o,s=.4*this._roomUnitPerMeter*o;e.labelSprite.scale.set(n,s,1),e.labelSprite.position.set(0,e.nativeHeight+.15+t.labelOffset,0)}addPlayer(e,t,o,n){if(this.players.has(e)||this.deferredPlayers.some(t=>t.peerId===e))return;const s=n&&n.length>0?n:this._defaultCharacterFile,c=this._fileToPath(s),u=this.modelCache.get(c);u?this._createPlayerFromCache(e,t,o,s,u):(this.deferredPlayers.push({peerId:e,displayName:t,color:o,characterFile:s}),this.loadingModels.has(c)||this._ensureModel(s).then(()=>{this._processDeferredPlayers(s)}))}_processDeferredPlayers(e){const t=this._fileToPath(e),o=this.modelCache.get(t);if(!o)return;const n=[];for(const t of this.deferredPlayers)t.characterFile!==e||this.players.has(t.peerId)?t.characterFile!==e&&n.push(t):(this._createPlayerFromCache(t.peerId,t.displayName,t.color,t.characterFile,o),t.initialPosition&&this.pushInitialPosition(t.peerId,t.initialPosition,t.initialRotationY,t.initialAnimation));this.deferredPlayers=n}_createPlayerFromCache(e,t,o,n,s){const c=this.getCalibration(n),u=this.computeScale(s.nativeHeight,c),p=ea.clone(s.template);p.scale.setScalar(u),p.visible=!1;const v=new Ue.AnimationMixer(p),f={};if(s.useExternalAnims)for(const[e,t]of this._externalNamedClips){const o=v.clipAction(t);e.startsWith("run")&&o.setEffectiveTimeScale(1.6),f[e]=o}else{const e={idle:0,run:1,walk:3};for(const[t,o]of Object.entries(e))s.embeddedClips[o]&&(f[t]=v.clipAction(s.embeddedClips[o]))}f.idle&&f.idle.play(),v.update(0);const g=function(e,t){const o=(void 0).createElement("canvas");o.width=256,o.height=64;const n=o.getContext("2d");n.font="bold 24px sans-serif";const s=n.measureText(e).width,c=Math.min(256,Math.max(80,s+32)),u=(256-c)/2;n.fillStyle="rgba(0, 0, 0, 0.6)",function(e,t,o,n,s,c){e.beginPath(),e.moveTo(t+c,o),e.lineTo(t+n-c,o),e.quadraticCurveTo(t+n,o,t+n,o+c),e.lineTo(t+n,o+s-c),e.quadraticCurveTo(t+n,o+s,t+n-c,o+s),e.lineTo(t+c,o+s),e.quadraticCurveTo(t,o+s,t,o+s-c),e.lineTo(t,o+c),e.quadraticCurveTo(t,o,t+c,o),e.closePath()}(n,u,4,c,48,12),n.fill(),n.font="bold 24px sans-serif",n.textAlign="center",n.textBaseline="middle",n.fillStyle=t,n.fillText(e,128,30);const p=new Ue.CanvasTexture(o),v=new Ue.SpriteMaterial({map:p,transparent:!0,depthTest:!1}),f=new Ue.Sprite(v);return f.scale.set(2,.5,1),f}(t,o);p.add(g),this.scene.add(p);const b={group:p,mixer:v,actions:f,currentAnimation:"idle",interpolation:new _w,labelSprite:g,peerId:e,displayName:t,characterFile:n,nativeHeight:s.nativeHeight,useExternalAnims:s.useExternalAnims,hasReceivedPosition:!1};this._updateLabelSprite(b),this.players.set(e,b)}pushInitialPosition(e,t,o=0,n="idle"){if(!t)return;const s=this.deferredPlayers.find(t=>t.peerId===e);if(s)return s.initialPosition=t,s.initialRotationY=o,void(s.initialAnimation=n);const c=this.players.get(e);if(!c||c.hasReceivedPosition)return;const u=this.getCalibration(c.characterFile),p=this.computeFloorY(u);c.hasReceivedPosition=!0,c.group.visible=!0,c.group.position.set(t.x,p,t.z),c.group.rotation.y=o}pushPlayerState(e,t){const o=this.players.get(e);if(!o)return;const n=this.getCalibration(o.characterFile),s=this.computeFloorY(n);o.interpolation.pushState({position:{x:t.position.x,y:s,z:t.position.z},rotationY:t.rotationY,animation:t.animation,seq:t.seq}),o.hasReceivedPosition||(o.hasReceivedPosition=!0,o.group.visible=!0,o.group.position.set(t.position.x,s,t.position.z))}updateAll(e){for(const t of this.players.values()){if(!t.hasReceivedPosition)continue;const o=t.interpolation.getInterpolatedState();if(!o.hasData)continue;t.group.position.copy(o.position),t.group.rotation.y=o.rotationY;const n=this.resolveAnimation(o.animation,t.actions);if(n!==t.currentAnimation&&t.actions[n]){const e=t.actions[t.currentAnimation],o=t.actions[n];if(e&&o){const s=n.startsWith("run")&&t.useExternalAnims?1.6:1;o.reset().setEffectiveTimeScale(s).setEffectiveWeight(1),o.crossFadeFrom(e,.3,!0),o.play()}else o&&o.reset().play();t.currentAnimation=n}t.mixer.update(e)}}resolveAnimation(e,t){return t[e]?e:e.startsWith("walk-")?t["walk-f"]?"walk-f":t.walk?"walk":"idle":e.startsWith("run-")?t["run-f"]?"run-f":t.run?"run":t["walk-f"]?"walk-f":"idle":"walk"===e?t["walk-f"]?"walk-f":"idle":"run"===e?t["run-f"]?"run-f":t["walk-f"]?"walk-f":"idle":t.idle?"idle":e}hasPlayer(e){return this.players.has(e)}removePlayer(e){const t=this.players.get(e);t&&(t.mixer.stopAllAction(),this.scene.remove(t.group),t.group.traverse(e=>{var t,o;const n=e;n.isMesh&&(null==(t=n.geometry)||t.dispose(),Array.isArray(n.material)?n.material.forEach(e=>e.dispose()):n.material&&n.material.dispose());const s=e;s.isSprite&&(null==(o=s.material.map)||o.dispose(),s.material.dispose())}),t.interpolation.clear(),this.players.delete(e),this.deferredPlayers=this.deferredPlayers.filter(t=>t.peerId!==e))}removeStale(e){for(const t of[...this.players.keys()])e.has(t)||this.removePlayer(t);this.deferredPlayers=this.deferredPlayers.filter(t=>e.has(t.peerId))}dispose(){for(const e of[...this.players.keys()])this.removePlayer(e);this.deferredPlayers=[]}get count(){return this.players.size}getPlayerPosition3D(e){const t=this.players.get(e);if(!t||!t.hasReceivedPosition)return null;const o=t.group.position;return{x:o.x,y:o.y,z:o.z}}getPlayerPeerIds(){return[...this.players.keys()]}setSpeaking(e,t){const o=this.players.get(e);o&&o.labelSprite.material.color.set(t?6220500:16777215)}getPlayerPositions(){const e=this._positionCache;let t=0;for(const o of this.players.values())o.hasReceivedPosition&&(t<e.length?(e[t].x=o.group.position.x,e[t].z=o.group.position.z):e.push({x:o.group.position.x,z:o.group.position.z}),t++);return e.length=t,e}}const gr=t(!1),br=t(""),mr=O({scaleMultiplier:1,yOffset:0,labelOffset:0}),hr=t(!1);let xr=null,yr=null,wr=null,kr=null,Sr=null;function d8(e){Sr=e}async function um(e){var t,o,n,s;try{const c=null==(t=await $fetch("/api/room3d/character-calibration"))?void 0:t[e];c?(mr.scaleMultiplier=null!=(o=c.scaleMultiplier)?o:1,mr.yOffset=null!=(n=c.yOffset)?n:0,mr.labelOffset=null!=(s=c.labelOffset)?s:0):(mr.scaleMultiplier=1,mr.yOffset=0,mr.labelOffset=0)}catch{}}async function fm(){try{const{getAuthHeaders:e}=Gt();if(await $fetch("/api/room3d/character-calibration",{method:"POST",body:{filename:br.value,...mr,system:Je.value},headers:e()}),Sr&&br.value){const{selectedCharacter:e}=globalThis.__room3dLobby||{selectedCharacter:t("")};br.value===e.value&&Sr.setCalibration(mr)}}catch{}}async function u8(e){const{getAuthHeaders:t}=Gt(),o=t(),n={...mr};for(const t of e)try{await $fetch("/api/room3d/character-calibration",{method:"POST",body:{filename:t,...n,system:Je.value},headers:o})}catch{}Sr&&Sr.setCalibration(n),hr.value=!0,setTimeout(()=>{hr.value=!1},2e3)}async function f8(e){br.value=e;const t=`/data/appdata/models/characters/${encodeURIComponent(e)}`;await um(e);const o=St(),n=Vt();(new ta).load(t,t=>{if(!o)return;gr.value=!0;const s=t.scene;s.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)}),xr=ea.clone(s);const c=(new Ue.Box3).setFromObject(s),u=c.max.y-c.min.y,p=(zt-Pt)*mr.scaleMultiplier/Math.max(u,.01);xr.scale.setScalar(p),xr.userData.nativeH=u;const v=new Ue.Vector3;n.getWorldDirection(v),v.y=0,v.normalize();const f=n.position.clone().addScaledVector(v,3*Ye);f.y=Pt+mr.yOffset*Ye,xr.position.copy(f),xr.rotation.y=Math.atan2(v.x,v.z)+Math.PI;const g=kt(e),b=(void 0).createElement("canvas");b.width=256,b.height=64;const h=b.getContext("2d");h.fillStyle="rgba(0,0,0,0.6)",h.beginPath(),h.moveTo(52,4),h.lineTo(204,4),h.quadraticCurveTo(216,4,216,16),h.lineTo(216,40),h.quadraticCurveTo(216,52,204,52),h.lineTo(52,52),h.quadraticCurveTo(40,52,40,40),h.lineTo(40,16),h.quadraticCurveTo(40,4,52,4),h.closePath(),h.fill(),h.font="bold 24px sans-serif",h.textAlign="center",h.textBaseline="middle",h.fillStyle="#5eead4",h.fillText(g,128,30);const x=new Ue.CanvasTexture(b),S=new Ue.SpriteMaterial({map:x,transparent:!0,depthTest:!1});wr=new Ue.Sprite(S),wr.position.set(0,u+.15+mr.labelOffset,0);const $=1/p;if(wr.scale.set(1.5*Ye*$,.4*Ye*$,1),xr.add(wr),yr=new Ue.AnimationMixer(xr),t.animations&&t.animations.length>0)yr.clipAction(t.animations[0]).play();else{const e="/data/appdata/models/characters/animations/"+encodeURIComponent("Idle")+".glb";(new ta).load(e,e=>{if(!yr||!xr)return;const t=e.animations.find(e=>!e.name.includes("T-Pose"))||e.animations[0];t&&yr.clipAction(t).play()},void 0,e=>{})}o.add(xr)},void 0,e=>{})}function v8(){if(!xr)return;const e=xr.userData.nativeH||1.83,t=(zt-Pt)*mr.scaleMultiplier/Math.max(e,.01);if(xr.scale.setScalar(t),xr.position.y=Pt+mr.yOffset*Ye,wr){wr.position.set(0,e+.15+mr.labelOffset,0);const o=1/t;wr.scale.set(1.5*Ye*o,.4*Ye*o,1)}kr&&clearTimeout(kr),kr=setTimeout(()=>{kr=null,fm()},400)}function g8(){kr&&(clearTimeout(kr),kr=null,fm()),vm()}function vm(){const e=St();xr&&e&&(e.remove(xr),ut(xr),xr=null),yr&&(yr.stopAllAction(),yr=null),wr=null,gr.value=!1}function p8(e){yr&&yr.update(e)}const Cr=[],$r=[],Mr=t(!1),Tr=t(!1);function Wc(){Mr.value=Cr.length>0,Tr.value=$r.length>0}let Vr=null,Ar=null;function h8(e){Vr=e.executeUndo,Ar=e.executeRedo}function x8(e){Cr.push(e),Cr.length>50&&Cr.shift(),$r.length=0,Wc()}function w8(){if(0===Cr.length||!Vr)return;const e=Cr.pop();$r.push(e),Vr(e),Wc()}function k8(){if(0===$r.length||!Ar)return;const e=$r.pop();Cr.push(e),Ar(e),Wc()}function S8(){Cr.length=0,$r.length=0,Wc()}const Pr=is(),zr={canUndo:Mr,canRedo:Tr,pushCommand:x8,undo:w8,redo:k8,clearHistory:S8,setHistoryCallbacks:h8},{settings:Dr}=h0(),Or=Bc(),Ir=Oc();let jr=null,Fr=null,_r=null,Lr=null,Br=null,Er=null,Wr=null,Nr=null,Gr=null,Kr=null,Yr=null,Zr=null;function $8(e){var t,o,n;jr=e.saveRoomState,Fr=e.attachTVScreen,_r=e.detachTVScreen,Lr=e.attachAnimation,Br=e.detachAnimation,Er=e.computeAssetScale,Wr=e.extractUserMultiplier,Nr=e.saveAssetScale,Gr=e.saveAssetRotation,Kr=null!=(t=e.sendObjectDelta)?t:null,Yr=null!=(o=e.markOctreeDirty)?o:null,Zr=null!=(n=e.attachDisplayZones)?n:null}const Xr=t(null),ad=t(!1),od=t(!1);let id=null,sd=0,dd=0,cd=0,ud=null,pd=null;function lv(e){const t=e.group.position;return`${e.assetFile}|${He(t.x)},${He(t.y)},${He(t.z)}`}function bm(e){const t=e.group.position,o=e.group.quaternion;return{assetFile:e.assetFile,position:{x:He(t.x),y:He(t.y),z:He(t.z)},quaternion:{x:He(o.x),y:He(o.y),z:He(o.z),w:He(o.w)},scale:He(e.scale),name:e.name,...e.tvConfig&&{tvConfig:{...e.tvConfig,widgets:[...e.tvConfig.widgets]}},...e.deviceBinding&&{deviceBinding:{...e.deviceBinding}}}}const vd=new Ue.Vector3,fd=new Ue.Vector3(0,1,0),gd=new Ue.Vector2(0,0),bd=new Ue.Vector3,md=new Ue.Vector3,hd=new Ue.Vector3(0,-1,0),yd=new Ue.Vector3(0,1,0),kd=new Ue.Vector3(1,0,0),Sd=new Ue.Vector3(0,0,1),Cd=new Ue.Quaternion,$d=new Ue.Quaternion,Md=new Ue.Quaternion,Td=new Ue.Box3,Vd=new Ue.Vector3,Ad=new Ue.Vector3,Pd=n(null);let zd=new Ue.Quaternion,Od=1,Id=[];const jd=n(null),Fd=t("");let _d=[];function iv(e,t){const o=Pr.cloneTemplate(e);return o.userData.isGhost=!0,o.scale.setScalar(t),o.traverse(e=>{if(!e.isMesh)return;Array.isArray(e.material)?e.material=e.material.map(e=>e.clone()):e.material=e.material.clone();const t=Array.isArray(e.material)?e.material:[e.material];for(const e of t)e.emissive&&(e.emissive.setHex(65416),e.emissiveIntensity=.15),e.transparent=!0,e.opacity=.85}),o}function lp(e){if(!id)return;const t=e?65416:16729156;id.traverse(e=>{if(!e.isMesh)return;const o=Array.isArray(e.material)?e.material:[e.material];for(const e of o)e.emissive&&e.emissive.setHex(t)})}async function O8(e,t,o){var n;const s=St();ud=null,sv(),xm(),Xr.value=e,sd=0,dd=0,cd=0,vd.set(0,0,0);const u=t[Qe(e.file)];u&&(sd=u.y,dd=u.x,cd=u.z);let p=Xe.get(e.file);if(!p&&o&&(p=o,Xe.set(e.file,p)),!p){const t=new ta;try{const o=await new Promise((o,n)=>t.load(e.file,o,void 0,n));p=o.scene,await Ir.processAssetTemplate(p,Qe(e.file)),Xe.set(e.file,p),Pr.cacheAnimationClips(e.file,o.animations||[])}catch{return void(Xr.value=null)}}const v=Qe(e.file),f=Er?Er(p,v):1;id=iv(p,f),s.add(id),await c(),null==(n=qe())||n.lock()}function sv(){var e;const t=St();if(id&&(t.remove(id),id.traverse(e=>{if(!e.isMesh)return;const t=Array.isArray(e.material)?e.material:[e.material];for(const e of t)null==e||e.dispose()}),id=null),Xr.value=null,ad.value=!1,pd=null,vd.set(0,0,0),ud){const o=Xe.get(ud.assetFile);if(o){const n=Pr.cloneTemplate(o);n.position.copy(ud.position),n.quaternion.copy(ud.quaternion),n.scale.setScalar(ud.scale),n.userData.placed=!0,n.userData.assetFile=ud.assetFile,t.add(n),n.updateMatrixWorld(!0),Mt(n),n.traverse(e=>{e.isMesh&&it.push(e)}),rt(n),Ne.push({group:n,assetFile:ud.assetFile,scale:ud.scale,name:ud.name,...ud.tvConfig&&{tvConfig:ud.tvConfig},...ud.systemId&&{systemId:ud.systemId},...null!=ud.locked&&{locked:ud.locked},...ud.deviceBinding&&{deviceBinding:ud.deviceBinding},...ud.doorTarget&&{doorTarget:ud.doorTarget},...ud.animRange&&{animRange:ud.animRange},...null!=ud.animRangeStart&&{animRangeStart:ud.animRangeStart},...null!=ud.animRangeEnd&&{animRangeEnd:ud.animRangeEnd},...ud.keypadData&&{keypadData:ud.keypadData},...ud.textPanels&&{textPanels:ud.textPanels},...null!=ud.keypadUnlocked&&{keypadUnlocked:ud.keypadUnlocked},...ud.keypadLock&&{keypadLock:ud.keypadLock},...ud.keypadLockMode&&{keypadLockMode:ud.keypadLockMode},...ud.behavior&&{behavior:ud.behavior},...ud.components&&{components:ud.components},...ud.bindings&&{bindings:ud.bindings},...ud.properties&&{properties:ud.properties},...ud.tags&&{tags:ud.tags},...null!=ud.collisionEnabled&&{collisionEnabled:ud.collisionEnabled}}),Fr&&Fr(n,ud.assetFile,ud.tvConfig),Lr&&Lr(n,ud.assetFile);const s=Ne[Ne.length-1];s&&Zr&&"screen"===(null==(e=s.behavior)?void 0:e.type)&&Zr(s)}ud=null}}function z8(){var e;if(!id||!Xr.value)return;const t=St(),o=Xe.get(Xr.value.file);if(!o)return;const n=Pr.cloneTemplate(o);n.position.copy(id.position),n.quaternion.copy(id.quaternion),n.scale.copy(id.scale),n.userData.placed=!0,n.userData.assetFile=Xr.value.file,t.add(n),n.updateMatrixWorld(!0),Mt(n),n.traverse(e=>{e.isMesh&&it.push(e)}),rt(n),Yr&&Yr();const s=id.scale.x,c=(null==ud?void 0:ud.tvConfig)||pd||void 0,u=null==ud?void 0:ud.systemId,p=null==ud?void 0:ud.locked,v=null==ud?void 0:ud.deviceBinding,f=null==ud?void 0:ud.identifier;if(Ne.push({group:n,assetFile:Xr.value.file,scale:s,name:Xr.value.name,...c&&{tvConfig:c},...u&&{systemId:u},...null!=p&&{locked:p},...v&&{deviceBinding:v},...(null==ud?void 0:ud.doorTarget)&&{doorTarget:ud.doorTarget},...(null==ud?void 0:ud.animRange)&&{animRange:ud.animRange},...null!=(null==ud?void 0:ud.animRangeStart)&&{animRangeStart:ud.animRangeStart},...null!=(null==ud?void 0:ud.animRangeEnd)&&{animRangeEnd:ud.animRangeEnd},...(null==ud?void 0:ud.keypadData)&&{keypadData:ud.keypadData},...(null==ud?void 0:ud.textPanels)&&{textPanels:ud.textPanels},...null!=(null==ud?void 0:ud.keypadUnlocked)&&{keypadUnlocked:ud.keypadUnlocked},...(null==ud?void 0:ud.keypadLock)&&{keypadLock:ud.keypadLock},...(null==ud?void 0:ud.keypadLockMode)&&{keypadLockMode:ud.keypadLockMode},...(null==ud?void 0:ud.behavior)&&{behavior:ud.behavior},...(null==ud?void 0:ud.components)&&{components:ud.components},...(null==ud?void 0:ud.bindings)&&{bindings:ud.bindings},...(null==ud?void 0:ud.properties)&&{properties:ud.properties},...(null==ud?void 0:ud.tags)&&{tags:ud.tags},...null!=(null==ud?void 0:ud.collisionEnabled)&&{collisionEnabled:ud.collisionEnabled}}),!u){const e=Ne[Ne.length-1],t=bm(e),o=lv(e);f?zr.pushCommand({type:"move",object:t,oldIdentifier:f,oldTransform:{position:t.position,quaternion:t.quaternion,scale:t.scale},newIdentifier:o,newTransform:{position:t.position,quaternion:t.quaternion,scale:t.scale}}):zr.pushCommand({type:"place",object:t,identifier:o})}const g=Xr.value.file;if(ud=null,pd=null,jr&&jr(),Kr&&Kr(f?{type:"object:moved",identifier:f,position:{x:He(n.position.x),y:He(n.position.y),z:He(n.position.z)},quaternion:{x:He(n.quaternion.x),y:He(n.quaternion.y),z:He(n.quaternion.z),w:He(n.quaternion.w)},scale:He(s)}:{type:"object:placed",object:{assetFile:g,position:{x:He(n.position.x),y:He(n.position.y),z:He(n.position.z)},quaternion:{x:He(n.quaternion.x),y:He(n.quaternion.y),z:He(n.quaternion.z),w:He(n.quaternion.w)},scale:He(s),name:Xr.value.name,...c&&{tvConfig:c}},systemId:u,locked:p}),Je.value&&!u&&Gr){const e=Qe(g);Gr(e,{x:He(dd),y:He(sd),z:He(cd)})}Fr&&Fr(n,g,c),Lr&&Lr(n,g);const b=Ne[Ne.length-1];b&&Zr&&"screen"===(null==(e=b.behavior)?void 0:e.type)&&Zr(b)}function I8(){zr.canUndo.value&&zr.undo()}function F8(){zr.canRedo.value&&zr.redo()}function xd(e){const t=St(),o=Ne.findIndex(t=>lv(t)===e);if(o<0)return;const n=Ne[o];Br&&Br(n.group),_r&&_r(n.group),tt(n.group),t.remove(n.group),nt(n.group),Ne.splice(o,1),Yr&&Yr(),jr&&jr(),Kr&&Kr({type:"object:deleted",identifier:e})}async function wd(e){const t=St();let o=Xe.get(e.assetFile);if(!o){const t=new ta;try{o=(await new Promise((o,n)=>t.load(e.assetFile,o,void 0,n))).scene,Xe.set(e.assetFile,o)}catch{return}}const n=Pr.cloneTemplate(o);n.position.set(e.position.x,e.position.y,e.position.z),n.quaternion.set(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w),n.scale.setScalar(e.scale),n.userData.placed=!0,n.userData.assetFile=e.assetFile,t.add(n),n.updateMatrixWorld(!0),Mt(n),n.traverse(e=>{e.isMesh&&it.push(e)}),rt(n),Ne.push({group:n,assetFile:e.assetFile,scale:e.scale,name:e.name,...e.tvConfig&&{tvConfig:e.tvConfig},...e.deviceBinding&&{deviceBinding:e.deviceBinding}}),Yr&&Yr(),Fr&&Fr(n,e.assetFile,e.tvConfig),Lr&&Lr(n,e.assetFile),jr&&jr(),Kr&&Kr({type:"object:placed",object:{assetFile:e.assetFile,position:e.position,quaternion:e.quaternion,scale:e.scale,name:e.name,...e.tvConfig&&{tvConfig:e.tvConfig}}})}function E8(){const e=St(),t=jd.value;if(!t)return;const o=Ne.findIndex(e=>e.group===t);if(o>=0){const t=Ne[o],n=`${t.assetFile}|${He(t.group.position.x)},${He(t.group.position.y)},${He(t.group.position.z)}`;t.systemId||zr.pushCommand({type:"delete",object:bm(t),identifier:n}),t.systemId&&Or.markSystemObjectDeleted(t.systemId),Br&&Br(t.group),_r&&_r(t.group),tt(t.group),e.remove(t.group),nt(t.group),Ne.splice(o,1),Yr&&Yr(),jr&&jr(),Kr&&Kr({type:"object:deleted",identifier:n})}}function L8(){const e=jd.value;e&&(Pd.value=e,zd=e.quaternion.clone(),Od=e.scale.x,Id=$t(e,Ut,Et))}function B8(){Id.length>0&&et(Id),Id=[],Pd.value=null}function j8(){if(!Pd.value)return;Pd.value.quaternion.copy(zd),Pd.value.scale.setScalar(Od);const e=Ne.find(e=>e.group===Pd.value);e&&(e.scale=Od),Id.length>0&&et(Id),Id=[],Pd.value=null}function U8(e){const t=St(),o=jd.value;if(!o)return;const n=Ne.findIndex(e=>e.group===o);if(n<0)return;const s=Ne[n],c=Xe.get(s.assetFile);if(!c)return;ud={assetFile:s.assetFile,position:s.group.position.clone(),quaternion:s.group.quaternion.clone(),scale:s.scale,name:s.name,...s.tvConfig&&{tvConfig:{...s.tvConfig,widgets:[...s.tvConfig.widgets]}},...s.systemId&&{systemId:s.systemId},...null!=s.locked&&{locked:s.locked},...s.deviceBinding&&{deviceBinding:{...s.deviceBinding}},...s.doorTarget&&{doorTarget:{...s.doorTarget}},...s.animRange&&{animRange:s.animRange},...null!=s.animRangeStart&&{animRangeStart:s.animRangeStart},...null!=s.animRangeEnd&&{animRangeEnd:s.animRangeEnd},...s.keypadData&&{keypadData:JSON.parse(JSON.stringify(s.keypadData))},...s.textPanels&&{textPanels:JSON.parse(JSON.stringify(s.textPanels))},...null!=s.keypadUnlocked&&{keypadUnlocked:s.keypadUnlocked},...s.keypadLock&&{keypadLock:s.keypadLock},...s.keypadLockMode&&{keypadLockMode:s.keypadLockMode},...s.behavior&&{behavior:JSON.parse(JSON.stringify(s.behavior))},...s.components&&{components:JSON.parse(JSON.stringify(s.components))},...s.bindings&&{bindings:JSON.parse(JSON.stringify(s.bindings))},...s.properties&&{properties:{...s.properties}},...s.tags&&{tags:[...s.tags]},...null!=s.collisionEnabled&&{collisionEnabled:s.collisionEnabled},identifier:lv(s)};const u=s.scale,p=s.assetFile;pd=s.tvConfig?{...s.tvConfig,widgets:[...s.tvConfig.widgets]}:null,Br&&Br(s.group),_r&&_r(s.group),tt(s.group),t.remove(s.group),nt(s.group),Ne.splice(n,1),Xr.value=e.find(e=>e.file===p)||{id:p,name:s.name,category:"Object",file:p},sd=0,dd=0,cd=0,vd.set(0,0,0),id=iv(c,u),t.add(id)}function N8(e){const t=St(),o=jd.value;if(!o)return;const n=Ne.findIndex(e=>e.group===o);if(n<0)return;const s=Ne[n],c=Xe.get(s.assetFile);c&&(ud=null,sv(),pd=s.tvConfig?{...s.tvConfig,widgets:[...s.tvConfig.widgets]}:null,Xr.value=e.find(e=>e.file===s.assetFile)||{id:s.assetFile,name:s.name,category:"Object",file:s.assetFile},sd=0,dd=0,cd=0,id=iv(c,s.scale),t.add(id))}function W8(){const e=Ne.find(e=>e.group===jd.value);e&&(e.locked=!e.locked,jr&&jr())}function H8(){const e=Vt();if(!id||!e||!Ge.value)return;const t=it.filter(e=>{let t=e;for(;t;){if(t===id)return!1;t=t.parent}return!0});Rt.setFromCamera(gd,e),Rt.far=Math.max(20,20*Ye);let o=Rt.intersectObjects(t,!1);if(0===o.length&&(e.getWorldDirection(bd),md.copy(e.position).addScaledVector(bd,Math.max(5,5*Ye)),md.y=zt+2*Ye,Rt.set(md,hd),Rt.far=20*Ye,o=Rt.intersectObjects(t,!1)),o.length>0){const e=o[0];fd.copy(e.face.normal).transformDirection(e.object.matrixWorld).normalize();const t=Math.abs(fd.y)<.3?Math.atan2(fd.x,fd.z)+sd:At()+sd;Cd.setFromAxisAngle(yd,t),$d.setFromAxisAngle(kd,dd),Md.setFromAxisAngle(Sd,cd),id.quaternion.copy(Cd).multiply($d).multiply(Md),id.position.copy(e.point),id.updateMatrixWorld(!0),Td.setFromObject(id);let n=1/0;for(let t=0;t<2;t++)for(let o=0;o<2;o++)for(let s=0;s<2;s++){Vd.set(t?Td.max.x:Td.min.x,o?Td.max.y:Td.min.y,s?Td.max.z:Td.min.z);const c=Vd.sub(e.point).dot(fd);c<n&&(n=c)}if(n<0&&id.position.addScaledVector(fd,-n),vd.lengthSq()>0&&id.position.add(vd),Dr.gridSnap){const e=Dr.gridSize*Ye;id.position.x=Math.round(id.position.x/e)*e,id.position.z=Math.round(id.position.z/e)*e}id.visible=!0,ad.value=!0,lp(!0)}else{e.getWorldDirection(Ad),id.position.copy(e.position).addScaledVector(Ad,5*Ye),id.position.y=Pt;const t=At()+sd;Cd.setFromAxisAngle(yd,t),$d.setFromAxisAngle(kd,dd),Md.setFromAxisAngle(Sd,cd),id.quaternion.copy(Cd).multiply($d).multiply(Md),id.visible=!0,ad.value=!1,lp(!1)}}function G8(){id&&(id.scale.multiplyScalar(1.15),rv())}function K8(){id&&(id.scale.multiplyScalar(.87),rv())}function rv(){if(!id||!Xr.value)return;const e=Xe.get(Xr.value.file);if(!e||!Wr||!Nr)return;const t=Qe(Xr.value.file);Nr(t,Wr(e,id.scale.x)),od.value=!0,setTimeout(()=>{od.value=!1},1500)}function xm(){_d.length>0&&et(_d),_d=[],jd.value=null,Fd.value=""}function q8(e){const t=Vt();if(!id||!t)return;const o=.02*Ye,n=fd,s=Math.abs(n.y)<.3;let c;if("up"===e||"down"===e)s?c=new Ue.Vector3(0,"up"===e?1:-1,0):(c=new Ue.Vector3,t.getWorldDirection(c),c.y=0,c.normalize(),"down"===e&&c.negate());else{const o=new Ue.Vector3;t.getWorldDirection(o);const u=(new Ue.Vector3).crossVectors(o,new Ue.Vector3(0,1,0)).normalize();s?(c=u.clone().addScaledVector(n,-u.dot(n)),c.lengthSq()>1e-4?c.normalize():c.set(1,0,0)):c=u,"left"===e&&c.negate()}vd.addScaledVector(c,o)}function Y8(e){if(!id)return;const t=.02*Ye;vd.addScaledVector(fd,e*t)}function Z8(){vd.set(0,0,0)}function X8(){return sd}function J8(e){sd=e}function Q8(){return dd}function _8(e){dd=e}function e4(){return cd}function t4(e){cd=e}function a4(){return id}function o4(){return zr.canUndo.value}function n4(){return zr.canRedo.value}function l4(){return null!==ud}zr.setHistoryCallbacks({executeUndo(e){"place"===e.type?xd(e.identifier):"delete"===e.type?wd(e.object):"move"===e.type&&(xd(e.newIdentifier),wd({...e.object,position:e.oldTransform.position,quaternion:e.oldTransform.quaternion,scale:e.oldTransform.scale}))},executeRedo(e){"place"===e.type?wd(e.object):"delete"===e.type?xd(e.identifier):"move"===e.type&&(xd(e.oldIdentifier),wd({...e.object,position:e.newTransform.position,quaternion:e.newTransform.quaternion,scale:e.newTransform.scale}))}});const Ld={forward:!1,backward:!1,left:!1,right:!1,sprint:!1,crouch:!1},Bd={x:0,y:0,active:!1};function s4(e,t,o){Bd.x=e,Bd.y=t,Bd.active=o}let Ed=0,Ud=!0,Nd=0,Hd=0,Gd=0,qd=0;let Yd=0;let Jd=0;let Qd=0,Xd=0,ec=0,ac=0;let oc=0,nc=1.7,lc=1.7,ic=1.7,sc=!1;const rc=new Ue.Raycaster,dc=new Ue.Vector3,cc=new Ue.Vector3(0,-1,0),uc=[];let pc=[],vc=!1;const fc=new Ue.Box3,gc=new Ue.Box3,bc=new Ue.Vector2(0,0);function km(){nc=1.7*Ye,lc=zt-Pt,oc=Pt,ic=lc,sc=!0}function m4(){nc=1.7*Ye,lc=zt-Pt,ic=lc}function Ff(e,t,o=!1){if(dc.set(e.x,e.y+.5*Ye,e.z),rc.set(dc,cc),rc.far=nc+10*Ye,rc.near=0,uc.length=0,rc.intersectObjects(vt,!1,uc),o&&(uu&&fv(),nu.length>0&&rc.intersectObjects(nu,!1,uc)),0===uc.length)return Pt;const n=null!=t?t:e.y-ic+.1*Ye;let s=Pt;for(const e of uc)e.point.y<=n&&e.point.y>s&&(s=e.point.y);return Math.max(s,Pt)}let hc=null,xc=!1;const wc=n(null),kc=t("");let Sc=null,Cc=[],$c=[];function y4(e){$c=e}function sp(e,t,o,n){const s=t-e;if(Math.abs(s)<.01)return t;const c=Math.abs(t)>=Math.abs(e)?o:n;return e+Math.sign(s)*Math.min(Math.abs(s),c)}function Sm(){pc=[];for(const e of Ne)pc.push((new Ue.Box3).setFromObject(e.group));vc=!1,Lt(pc)}function h4(){vc=!0,uu=!0,Hc=!0}function x4(){Sm(),uu=!0}function w4(){}function Cm(e){hc||(hc||(hc=new Audio("/data/appdata/sound/Footsteps.mp3"),hc.loop=!0,hc.volume=1,hc.playbackRate=1.8)),hc&&(hc.playbackRate=e?2.4:1.8,xc?hc.playbackRate=e?2.4:1.8:(hc.currentTime=0,hc.play().catch(()=>{}),xc=!0))}function uv(){!hc||!xc||(hc.pause(),hc.currentTime=0,xc=!1)}const Mc=new Ue.Vector3,Tc=[];function Rr(e,t){if(0===vt.length)return!1;const o=null!=t?t:oc,n=o+nc,s=o+.15*nc;for(const t of[n,s]){Mc.set(e.x,t,e.z);for(const e of It)if(Ft.set(Mc,e),Ft.far=_t,Ft.near=0,Tc.length=0,Ft.intersectObjects(vt,!1,Tc),Tc.length>0)return!0}return!1}function Al(e,t,o){if(0===pc.length)return!1;const n=null!=o?o:oc,s=n+nc;fc.min.set(t.x-_t,n,t.z-_t),fc.max.set(t.x+_t,s,t.z+_t),gc.min.set(e.x-_t,n,e.z-_t),gc.max.set(e.x+_t,s,e.z+_t);for(const e of pc)if(fc.intersectsBox(e)&&!gc.intersectsBox(e))return!0;return!1}const Vc=new Ue.Vector3,Ac=new Ue.Vector3,Pc=[],zc=new Float64Array(8),Ic=new Float64Array(8);for(let e=0;e<8;e++){const t=e/8*Math.PI*2;zc[e]=Math.cos(t),Ic[e]=Math.sin(t)}const Fc=new Float64Array(8);let _c=0,Ec=0,Uc=NaN,Nc=NaN,Hc=!0,qc=0;const Kc=new Ue.Vector3,Yc=new Ue.Vector3,Jc=new Ue.Vector3,Zc=new Ue.Vector3(0,1,0),Qc=new Ue.Vector3,Xc=new Ue.Vector3,eu=new Ue.Vector3,tu=new Ue.Vector3,au=[];function fp(e,t){if(0===vt.length)return 0;Xc.copy(t),Xc.y=0;const o=Xc.length();if(o<1e-4)return 0;Xc.divideScalar(o);const n=oc+nc,s=oc+.15*nc;for(const t of[n,s])if(Mc.set(e.x,t,e.z),Ft.set(Mc,Xc),Ft.far=o+_t,Ft.near=0,au.length=0,Ft.intersectObjects(vt,!1,au),au.length>0){const e=au[0];return e.face&&(eu.copy(e.face.normal).transformDirection(e.object.matrixWorld),eu.y=0,eu.lengthSq()>1e-4)?(eu.normalize(),1):2}return 0}function vp(e,t){if(t){const t=fp(e.position,Jc);if(1===t){let t=Jc.dot(eu);t>0&&(eu.negate(),t=-t),tu.copy(eu).multiplyScalar(t),tu.subVectors(Jc,tu),tu.lengthSq()>1e-4&&(Qc.copy(e.position).add(tu),0===fp(e.position,tu)&&!Al(e.position,Qc)&&e.position.copy(Qc))}1!==t&&(0!==Jc.x&&(Qc.set(e.position.x+Jc.x,e.position.y,e.position.z),!Rr(Qc)&&!Al(e.position,Qc)&&(e.position.x+=Jc.x)),0!==Jc.z&&(Qc.set(e.position.x,e.position.y,e.position.z+Jc.z),!Rr(Qc)&&!Al(e.position,Qc)&&(e.position.z+=Jc.z)))}else 0!==Jc.x&&(Qc.set(e.position.x+Jc.x,e.position.y,e.position.z),Al(e.position,Qc)||(e.position.x+=Jc.x)),0!==Jc.z&&(Qc.set(e.position.x,e.position.y,e.position.z+Jc.z),Al(e.position,Qc)||(e.position.z+=Jc.z))}const ou=new Ue.Vector3;function Tm(e,t){const o=Vt();if(!o||(o.getWorldDirection(Kc),Kc.y=0,Kc.normalize(),Yc.crossVectors(Kc,Zc.set(0,1,0)).normalize(),Jc.set(0,0,0).addScaledVector(Kc,e).addScaledVector(Yc,t),0===Jc.lengthSq()))return;const n=vt.length>0;if(Qc.copy(o.position).add(Jc),n&&Rr(Qc)||Al(o.position,Qc))if(Ud){const e=.25*Ye;ou.copy(Qc),ou.y+=e;const t=oc+e;if(n&&Rr(ou,t)||Al(o.position,ou,t))vp(o,n);else{o.position.x=Qc.x,o.position.z=Qc.z;const e=Ff(ou);e>oc&&(oc=e,o.position.y=oc+ic+Hd+Qd)}}else vp(o,n);else o.position.copy(Qc);const s=2*_t,c=s*s;for(const e of $c){const t=o.position.x-e.x,n=o.position.z-e.z,u=t*t+n*n;if(u>=c)continue;if(u<1e-4){o.position.x+=.5*s;continue}const p=Math.sqrt(u),v=s-p;o.position.x+=t/p*v*.5,o.position.z+=n/p*v*.5}}const nu=[],lu=new Map,iu=[];let uu=!0;const pu=new Set,vu=new Ue.Box3,gu=new Ue.Box3;function fv(){nu.length=0,lu.clear(),pu.clear();for(const e of Ne)e.group.traverse(t=>{t.isMesh&&!t.userData.isCollisionProxy&&(pt(t),nu.push(t),lu.set(t,e.group))});const e=Ne.filter(e=>{var t;return"screen"===(null==(t=e.behavior)?void 0:t.type)});for(const t of e){pu.add(t.group),vu.setFromObject(t.group),vu.expandByScalar(.05);for(const e of Ne)e===t||pu.has(e.group)||(gu.setFromObject(e.group),vu.intersectsBox(gu)&&pu.add(e.group))}uu=!1}function Mm(e=12){var t;const o=Vt();return 0!==Ne.length&&o?(Rt.setFromCamera(bc,o),Rt.far=e,uu&&fv(),iu.length=0,Rt.intersectObjects(nu,!1,iu),iu.length>0&&null!=(t=lu.get(iu[0].object))?t:null):null}function M4(e){var t,o,n;const s=Vt();if(e.showRadial||e.rotatingObject||e.placingAsset||!s||0===Ne.length)return void(Sc&&(Cc.length>0&&et(Cc),Cc=[],Sc=null,wc.value=null,kc.value=""));const c=Mm(Math.max(3,3*Ye));if(c!==Sc&&(Cc.length>0&&et(Cc),Cc=[]),c){const e=Ne.find(e=>e.group===c),s=(null==(t=c.userData)?void 0:t.isTent)||(null==(o=c.children)?void 0:o.some(e=>{var t;return null==(t=e.userData)?void 0:t.isTent})),u=null==(n=c.children)?void 0:n.some(e=>{var t;return null==(t=e.userData)?void 0:t.isTVScreen});(null==e?void 0:e.locked)||pu.has(c)||s||u?(wc.value=null,kc.value=""):c!==Sc&&(wc.value=c,kc.value=(null==e?void 0:e.name)||"",Cc=$t(c,Ot,Dt))}else wc.value=null,kc.value="";Sc=c}function $4(){Cc.length>0&&et(Cc),Cc=[],Sc=null,wc.value=null,kc.value=""}function A4(e,t){const o=Vt();if(!o||!t)return;vc&&Sm(),sc||km();const n=Ld.crouch;ic+=((n?.6*lc:lc)-ic)*Math.min(10*e,1);const s=Ld.sprint&&!n,c=Bt*(n?.5:s?1.6:1);let u=0,p=0;Bd.active?(u=Bd.y*c,p=Bd.x*c,u<0&&(u*=.65)):(Ld.forward&&(u+=c),Ld.backward&&(u-=.65*c),Ld.right&&(p+=c),Ld.left&&(p-=c));const v=Math.sqrt(u*u+p*p);if(v>c){const e=c/v;u*=e,p*=e}const f=Ud?1:.3,g=800*e*f,b=1e3*e*f;Gd=sp(Gd,u,g,b),qd=sp(qd,p,g,b);const h=Gd*e,x=qd*e,S=Math.abs(Gd)>.01||Math.abs(qd)>.01;S&&Tm(h,x);const $=Ff(o.position);if(Ud){const t=$-oc;t<-.4*Ye?(Ud=!1,Ed=0):(t>.25*Ye||(oc+=($-oc)*Math.min(15*e,1)),o.position.y=oc+ic+Hd+Qd)}if(Ud&&(Yd=performance.now()/1e3),!Ud){ec=Ed,Ed-=12*Ye*e;const t=o.position.y;o.position.y+=Ed*e;const n=t-ic,s=Ff(o.position,n+.01,!0),c=s+ic;if(t>=c&&o.position.y<=c){o.position.y=c,oc=s;const e=Math.min(Math.abs(ec)/(10*Ye),1);e>.1&&(Qd=.15*-e*Ye,Xd=0),Ed=0,Ud=!0;const t=performance.now()/1e3;Jd>0&&t-Jd<.1&&(Jd=0,Ed=4*Ye,Ud=!1)}}const M=Pt+ic;o.position.y<M&&(o.position.y=M,oc=Pt,Ed=0,Ud=!0),function(e){if(0===vt.length&&0===pc.length||1&++qc)return;const t=_t,o=2*t,n=e.position.x,s=e.position.z;if(!Hc&&n===Uc&&s===Nc)return;Uc=n,Nc=s,Hc=!1;const c=oc,u=c+nc;let p=!1;for(const e of pc)if(!(n+o<e.min.x||n-o>e.max.x||s+o<e.min.z||s-o>e.max.z||u<=e.min.y||c>=e.max.y)){p=!0;break}p&&uu&&fv();const v=[c+.3*nc,c+.65*nc];Fc.fill(0);let f=0;for(let e=0;e<8;e++){const c=zc[e],u=Ic[e];for(const f of v){if(Vc.set(n+c*o,f,s+u*o),Ac.set(-c,0,-u),Ft.set(Vc,Ac),Ft.far=o,Ft.near=0,Pc.length=0,Ft.intersectObjects(vt,!1,Pc),p&&nu.length>0&&Ft.intersectObjects(nu,!1,Pc),0===Pc.length)continue;let v=0;for(let e=0;e<Pc.length;e++)Pc[e].distance>v&&(v=Pc[e].distance);const g=v>t?v-t:0;g>Fc[e]&&(Fc[e]=g)}Fc[e]>f&&(f=Fc[e])}if(0===f)return _c=0,void(Ec=0);let g=0,b=0,h=!1;for(let e=0;e<8;e++)Fc[e]>0?(g+=zc[e]*Fc[e],b+=Ic[e]*Fc[e]):h=!0;let x=0,S=0;if(h){const t=Math.sqrt(g*g+b*b);let o=-1/0;for(let n=0;n<8;n++){if(Fc[n]>0)continue;let s;t>.001?s=-(zc[n]*g+Ic[n]*b)/t:(e.getWorldDirection(Ac),s=zc[n]*Ac.x+Ic[n]*Ac.z),s>o&&(o=s,x=zc[n],S=Ic[n])}}else if(0!==_c||0!==Ec)x=_c,S=Ec;else{let e=1/0;for(let t=0;t<8;t++)Fc[t]<e&&(e=Fc[t],x=zc[t],S=Ic[t])}const $=Math.min(f,.5*t)+.02*Ye;e.position.x+=x*$,e.position.z+=S*$,_c=x,Ec=S}(o),S&&Ud?(Nd+=e*(s?2.6:n?1.4:2),Hd=.04*Math.sin(Nd*Math.PI*2)*Ye,Cm(s)):(Hd*=.85,Math.abs(Hd)<.001&&(Hd=0,Nd=0),uv()),Qd<-.001&&(Xd+=12*e,Qd+=Xd*e,Qd>0&&(Qd=0,Xd=0));const T=Math.abs(qd)>.01?Math.min(Math.abs(qd)/c,1):0,V=-Math.sign(qd)*T*.04;ac+=(V-ac)*Math.min(8*e,1)}function V4(){const e=performance.now()/1e3;Ud||e-Yd<.1?(Ed=4*Ye,Ud=!1,Yd=0,Jd=0):Jd=e}function P4(){return ac}function D4(){uv(),hc&&(hc.src="",hc.load()),hc=null,Ed=0,Ud=!0,Nd=0,Hd=0,Gd=0,qd=0,Yd=0,Jd=0,Qd=0,Xd=0,ec=0,ac=0,oc=0,nc=1.7,lc=1.7,ic=1.7,sc=!1,Cc.length>0&&et(Cc),Cc=[],Sc=null,wc.value=null,kc.value="",$c=[],pc=[],vc=!1,nu.length=0,lu.clear(),pu.clear(),uu=!0,_c=0,Ec=0}const mu=t(!1),hu=t(-1),xu=t(!1),yu=t(!1),wu=t(!1),ku=t(!1),Su=t(!1),Cu=t(!1);const $u=[{type:"air_sensors",label:"Air Sensors",desc:"Temp, Humi, VPD, CO2",emoji:"ðŸŒ¡ï¸",color:"#06b6d4"},{type:"soil_sensor",label:"Soil Sensors",desc:"Temp, Moisture, EC",emoji:"ðŸŒ±",color:"#f59e0b"},{type:"sockets",label:"Sockets",desc:"O1-O5 On/Off",emoji:"ðŸ”Œ",color:"#4ade80"},{type:"lights",label:"Lights",desc:"Brightness & Mode",emoji:"ðŸ’¡",color:"#facc15"},{type:"blower",label:"Blower",desc:"Fan Speed & Mode",emoji:"ðŸŒ€",color:"#a78bfa"},{type:"power",label:"Power",desc:"kWh & Cost",emoji:"âš¡",color:"#fb923c"},{type:"devices",label:"Devices",desc:"WiFi & Status",emoji:"ðŸ“¡",color:"#22d3ee"},{type:"tv_channel",label:"TV Channel",desc:"Live IPTV Stream",emoji:"ðŸ“º",color:"#818cf8"}];function $m(e){const{zone:t,deadzone:o=.15,maxRadius:n=60}=e,s=O({active:!1,x:0,y:0,magnitude:0,touchId:null,cx:0,cy:0,dx:0,dy:0});let c=!1,u=0;function d(e,o){const n=o/2;return"left"===(c?"left"===t?"right":"left":t)?e<n:e>=n}return{state:s,handleStart:function(e,t){return!(null!==s.touchId||!d(e.clientX,t))&&(s.touchId=e.identifier,s.active=!0,s.cx=e.clientX,s.cy=e.clientY,s.dx=0,s.dy=0,s.x=0,s.y=0,s.magnitude=0,!0)},handleMove:function(e){if(e.identifier!==s.touchId)return!1;const t=performance.now();if(t-u<14)return!0;u=t;let c=e.clientX-s.cx,p=e.clientY-s.cy;const v=Math.sqrt(c*c+p*p);v>n&&(c=c/v*n,p=p/v*n),s.dx=c,s.dy=p;const f=Math.min(v/n,1);if(f<o)s.x=0,s.y=0,s.magnitude=0;else{const e=(f-o)/(1-o),t=Math.atan2(p,c);s.x=Math.cos(t)*e,s.y=-Math.sin(t)*e,s.magnitude=e}return!0},handleEnd:function(e){return e.identifier===s.touchId&&(s.active=!1,s.touchId=null,s.x=0,s.y=0,s.magnitude=0,s.dx=0,s.dy=0,!0)},reset:function(){s.active=!1,s.touchId=null,s.x=0,s.y=0,s.magnitude=0,s.dx=0,s.dy=0,s.cx=0,s.cy=0},isInZone:d,setSwapped:function(e){c=e}}}new Ue.Vector3,new Ue.Vector2(0,0),t(!1),$m({zone:"left",deadzone:.15,maxRadius:60}),$m({zone:"right",deadzone:.12,maxRadius:60}),t(!1),t(!1),t(!0),t(1),t(0),t(null),new Ue.Euler(0,0,0,"YXZ");const Tu=t(!1),Au=t("floor"),zu=t(!1),Du=t(0),Ou=t(1);let Ru=null,Iu=null,ju=null,Fu=1,_u=0,Lu=1;const Bu=new Ue.Raycaster,Eu=new Ue.Vector3,Uu=new Ue.Vector3(0,-1,0),Wu=new Ue.Vector3(0,1,0);let Nu="",Hu=100,Gu=null,qu=null,Ku=null,Yu=null;function Y4(e){var t;Nu=e.envId,Hu=e.maxDim,Gu=e.persistSave,qu=e.physicsInit,Ku=e.saveSpawn,Yu=null!=(t=e.rescaleObjects)?t:null}function Z4(){const e=St();if(!e)return;Tu.value=!0,Au.value="floor",_u=Pt,Lu=Ye,Du.value=_u,Ou.value=Lu;const t=3*Lu,o=new Ue.CircleGeometry(t,64),n=new Ue.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,side:Ue.DoubleSide,depthWrite:!1});Ru=new Ue.Mesh(o,n),Ru.rotation.x=-Math.PI/2,Ru.position.y=_u+.01,Ru.renderOrder=999,e.add(Ru),Vm(),Gc()}function Vm(){const e=St();if(!e)return;Iu&&(e.remove(Iu),Iu.geometry.dispose(),Iu.material.dispose(),Iu=null);const t=1.7*Lu,o=.2*Lu,n=new Ue.CylinderGeometry(o,o,t,16),s=new Ue.MeshBasicMaterial({color:16729156,transparent:!0,opacity:.5,depthWrite:!1});Iu=new Ue.Mesh(n,s),Iu.renderOrder=998,e.add(Iu)}function Gc(){if(!Iu)return;const e=Vt(),t=new Ue.Vector3;e.getWorldDirection(t),t.y=0,t.normalize();const o=3*Lu,n=1.7*Lu,s=e.position.clone().addScaledVector(t,o);if(s.y=_u+n/2,Iu.position.copy(s),ju){const e=(new Ue.Vector3).crossVectors(t,new Ue.Vector3(0,1,0)).normalize(),o=s.clone().addScaledVector(e,1*Lu);o.y=_u,ju.position.copy(o),ju.rotation.y=Math.atan2(t.x,t.z)+Math.PI;const n=1.7*Lu/Math.max(Fu,.01);ju.scale.setScalar(n)}}function J4(e){if(!Tu.value||"floor"!==Au.value)return;_u-=.02*Lu*e;const t=Vt(),o=.15*Lu;let n=!1;Eu.set(t.position.x,_u+2*Lu,t.position.z),Bu.set(Eu,Uu),Bu.far=4*Lu,Bu.near=0;const s=Bu.intersectObjects(it,!1);Eu.set(t.position.x,_u-2*Lu,t.position.z),Bu.set(Eu,Wu),Bu.far=4*Lu,Bu.near=0;const c=Bu.intersectObjects(it,!1);let u=1/0,p=_u;for(const e of[...s,...c]){const t=Math.abs(e.point.y-_u);t<u&&(u=t,p=e.point.y)}if(u<o&&(_u=p,n=!0),zu.value=n,Du.value=Math.round(100*_u)/100,Ru){Ru.position.y=_u+.01;const e=Ru.material;e.color.setHex(n?65416:16763904),e.opacity=n?.4:.25}if(Iu){const e=1.7*Lu;Iu.position.y=_u+e/2}}function Q4(){!Tu.value||"floor"!==Au.value||(Au.value="scale",Gc(),async function(){const e=St();if(e&&!ju)try{const t=await $fetch("/api/room3d/characters");if(!(null==t?void 0:t.length))return;const o=t[0],n=`/data/appdata/models/characters/${encodeURIComponent(o)}`,s=new ta,c=await new Promise((e,t)=>{s.load(n,e,void 0,t)});if(!Tu.value)return void c.scene.traverse(e=>{var t;e.isMesh&&(null==(t=e.geometry)||t.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))});ju=c.scene,ju.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)});const u=(new Ue.Box3).setFromObject(ju);Fu=u.max.y-u.min.y;const p=1.7*Lu/Math.max(Fu,.01);ju.scale.setScalar(p),ju.renderOrder=997,e.add(ju),Gc()}catch{}}())}function _4(e){if(!Tu.value||"scale"!==Au.value)return;Lu*=1+.03*e,Lu=Math.max(.01,Lu),Ou.value=Math.round(1e3*Lu)/1e3,Vm(),Gc(),Ru&&(Ru.geometry.dispose(),Ru.geometry=new Ue.CircleGeometry(3*Lu,64))}function ek(){if(!Tu.value||"scale"!==Au.value)return;const e=Ye;ft(_u),yt(Lu);const t=_u+1.6*Lu;bt(t),mt(.25*Hu),ht(Math.max(.25,.015*Hu));const o=Vt();o.position.y=t,qu&&qu(),Yu&&Math.abs(e-Lu)>.001&&Yu(e,Lu),Gu&&Nu&&Gu(Nu,_u,Lu),Ku&&Nu&&Ku(Nu,{x:o.position.x,y:t,z:o.position.z}),pv(),Tu.value=!1}function tk(){pv(),Tu.value=!1}function pv(){const e=St();Ru&&e&&(e.remove(Ru),Ru.geometry.dispose(),Ru.material.dispose(),Ru=null),Iu&&e&&(e.remove(Iu),Iu.geometry.dispose(),Iu.material.dispose(),Iu=null),ju&&e&&(e.remove(ju),ju.traverse(e=>{var t;e.isMesh&&(null==(t=e.geometry)||t.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))}),ju=null)}function ak(){pv(),Tu.value=!1}const Ju=Oc(),Qu=t(!1),Xu=t(-1),ep=t(""),tp=t(0),ap=t(""),op=new Set,np=new Map,ip=new Map,rp=new Map,dp=new Map,cp=new Map;let up=-1,gp=null,bp=0;const mp=new Ue.Raycaster,hp=new Ue.Vector2(0,0);let kp=[],Sp=null;function lk(e){Sp=e}function pp(e){const t=e.clone();return t.transparent=!0,t.opacity=.15,t.depthWrite=!1,t}function Dm(e){Array.isArray(e.material)?(cp.set(kp.indexOf(e),e.material),e.material=e.material.map(pp)):(cp.set(kp.indexOf(e),e.material),e.material=pp(e.material))}function mc(e){const t=kp[e];if(!t)return;const o=cp.get(e);if(o){const n=t.material;Array.isArray(n)?n.forEach(e=>e.dispose()):n&&n.dispose(),t.material=o,cp.delete(e)}}function Rm(e){var t;if(e===up)return;qr();const o=kp[e];if(!o)return;const n=Array.isArray(o.material)?o.material[0]:o.material;if(!n)return;up=e,gp=n.emissive?n.emissive.clone():null,bp=null!=(t=n.emissiveIntensity)?t:0;const s=op.has(e)?16755200:65416;if(Array.isArray(o.material))for(const e of o.material)e.emissive&&(e.emissive.setHex(s),e.emissiveIntensity=.3);else n.emissive&&(n.emissive.setHex(s),n.emissiveIntensity=.3)}function qr(){if(up<0)return;const e=kp[up];if(e)if(Array.isArray(e.material))for(const t of e.material)t.emissive&&gp&&(t.emissive.copy(gp),t.emissiveIntensity=bp);else{const t=e.material;t.emissive&&gp&&(t.emissive.copy(gp),t.emissiveIntensity=bp)}up=-1,gp=null,bp=0}function yc(e,t){const o=(Qu.value?kp:it)[e];if(!o)return;o.userData._preOptGeo||(o.userData._preOptGeo=o.geometry);const n=o.userData._preOptGeo;o.geometry!==n&&o.geometry.dispose(),o.geometry=t>=.95?n:Ju.simplifyGeometry(n.clone(),t,.5)}function Om(e){if(e<0)return void(ap.value="");const t=kp[e];if(!t)return void(ap.value="");const o=t.userData._preOptGeo||t.geometry,n=Ju.getTriCount(t.geometry),s=Ju.getTriCount(o),i=e=>e.toLocaleString();ap.value=`${i(n)} / ${i(s)} tris`}function ik(e){var t;if(!Qu.value||Xu.value<0)return;const o=Xu.value,n=null!=(t=np.get(o))?t:1,s=e>0?Math.max(.1,+(n-.1).toFixed(2)):Math.min(1,+(n+.1).toFixed(2));Math.abs(s-n)<.001||(np.set(o,s),yc(o,s),Om(o))}function sk(e){for(const[t,o]of Object.entries(e)){const e=parseInt(t);e<0||e>=it.length||o>=.95||yc(e,o)}}function rk(e,t){kp=[...it],rp.clear(),cp.clear(),dp.clear(),op.clear(),np.clear(),ip.clear();for(let e=0;e<kp.length;e++){const t=kp[e];rp.set(e,t.visible)}if(t)for(const[e,o]of Object.entries(t)){const t=parseInt(e);t>=0&&t<kp.length&&(np.set(t,o),ip.set(t,o))}for(const t of e){if(t<0||t>=kp.length)continue;op.add(t);const e=kp[t];e.visible=!0,Dm(e)}tp.value=op.size,Qu.value=!0}function dk(){if(!Qu.value)return;const e=Vt();mp.setFromCamera(hp,e),mp.far=100;const t=mp.intersectObjects(kp,!1);if(t.length>0){const e=t[0].object,o=kp.indexOf(e);if(o>=0)return Xu.value=o,ep.value=e.name||`mesh_${o}`,Rm(o),void Om(o)}Xu.value=-1,ep.value="",ap.value="",qr()}function ck(e){if(!Qu.value||Xu.value<0)return;const t=Xu.value,o=op.has(t);0===e?o?(op.delete(t),mc(t)):(op.add(t),Dm(kp[t])):2===e&&o&&(op.delete(t),mc(t)),tp.value=op.size,qr(),Rm(t)}function uk(){qr();const e=Array.from(op).sort((e,t)=>e-t),t={};for(const[e,o]of np)o<.95&&(t[String(e)]=o);for(let e=0;e<kp.length;e++){const t=kp[e];if(op.has(e)){mc(e),t.visible=!1;const o=vt.indexOf(t);o>=0&&vt.splice(o,1)}else t.visible=!0}return Sp&&Sp(),bv(),{hidden:e,ratios:t}}function zm(){qr();for(let e=0;e<kp.length;e++){mc(e);const t=rp.get(e);null!=t&&(kp[e].visible=t)}for(const[e,t]of np){const t=ip.get(e);yc(e,null!=t?t:1)}bv()}function fk(e){if(0===e.length)return;const t=new Set(e);let o=0;for(let e=0;e<it.length;e++){if(!t.has(e))continue;const n=it[e];n.visible=!1;const s=vt.indexOf(n);s>=0&&vt.splice(s,1),o++}o>0&&Sp&&Sp()}function vk(e){return e<0||e>=it.length?`mesh_${e}`:it[e].name||`mesh_${e}`}function gk(e){if(e<0||e>=it.length)return;const t=it[e];t.visible=!0,vt.includes(t)||vt.push(t),Sp&&Sp()}function bv(){Qu.value=!1,Xu.value=-1,ep.value="",ap.value="",tp.value=0,op.clear(),np.clear(),ip.clear(),rp.clear(),cp.clear(),dp.clear(),kp=[],up=-1,gp=null,bp=0}function pk(){Qu.value&&zm(),bv()}const $p=t(!1);let Mp=!1,Ap="full",Pp=null,zp=!1;const Ip=new WeakMap,jp=new Ue.Vector2,Fp={};let _p={},Lp=0,Bp=0,Ep=0,Up=0;let Wp={drawCalls:0,triangles:0,frameTimeMs:0},Np=0,Hp={fps:0,frameTimeMs:0,drawCalls:0,triangles:0,geometries:0,textures:0,programs:0,sceneObjects:0,meshCount:0,lightCount:0,placedCount:0,collisionMeshes:0,timings:{},jsHeapMB:0,gpuMs:-1},Gp=0,qp=0,Kp=0,Yp=0,Jp=0,Zp=0,Qp=0,Xp=null,ev=null,tv=-1,av=null;function hk(e){Mp&&(_p[e]=performance.now())}function xk(e){!Mp||!_p[e]||(Fp[e]=performance.now()-_p[e])}function wk(){Mp&&(Gp=performance.now(),"full"===Ap&&av&&Xp&&ev&&(av.getParameter(Xp.GPU_DISJOINT_EXT),av.beginQuery(Xp.TIME_ELAPSED_EXT,ev)))}function kk(){var e,t,o,n;if(!Mp)return;const s=performance.now(),c=s-Gp;"full"===Ap&&av&&Xp&&ev&&(av.endQuery(Xp.TIME_ELAPSED_EXT),av.getQueryParameter(ev,av.QUERY_RESULT_AVAILABLE)&&(av.getParameter(Xp.GPU_DISJOINT_EXT)||(tv=av.getQueryParameter(ev,av.QUERY_RESULT)/1e6))),qp>0&&(Kp+=s-qp),qp=s,Jp++,s-Zp>=1e3&&(Qp=Jp,Jp=0,Zp=s);const u=Ct();if(u&&(Wp.drawCalls+=u.info.render.calls,Wp.triangles+=u.info.render.triangles,Wp.frameTimeMs+=c,u.info.reset()),Np++,Np>=30){if(Lp++,Lp%4==0){const e=St();e&&(Bp=0,Ep=0,Up=0,e.traverse(e=>{Up++,e.isMesh&&Bp++,e.isLight&&Ep++}))}const s=Bp,c=Ep,p=Up;Hp={fps:Qp,frameTimeMs:Wp.frameTimeMs/Np,drawCalls:Math.round(Wp.drawCalls/Np),triangles:Math.round(Wp.triangles/Np),geometries:null!=(e=null==u?void 0:u.info.memory.geometries)?e:0,textures:null!=(t=null==u?void 0:u.info.memory.textures)?t:0,programs:null!=(n=null==(o=(null==u?void 0:u.info).programs)?void 0:o.length)?n:0,sceneObjects:p,meshCount:s,lightCount:c,placedCount:Ne.length,collisionMeshes:vt.length,timings:{...Fp},jsHeapMB:performance.memory?Math.round(performance.memory.usedJSHeapSize/1048576):0,gpuMs:tv},Yp=Np>1?Kp/(Np-1):0,Wp.drawCalls=0,Wp.triangles=0,Wp.frameTimeMs=0,Kp=0,Np=0,function(){if(!Pp)return;const e=Hp,t=e.fps>=55?"#4ade80":e.fps>=30?"#facc15":"#f87171";if("simple"===Ap)return void(Pp.innerHTML=`<span style="color:${t};font-size:14px;font-weight:bold">${e.fps} FPS</span>`);const o=e.drawCalls<=100?"#4ade80":e.drawCalls<=300?"#facc15":"#f87171";let n='<div style="margin-bottom:6px;font-size:15px;font-weight:bold;color:#67e8f9">PERF MONITOR</div>';n+=`<div style="color:${t};font-size:16px;font-weight:bold">${e.fps} FPS</div>`;const s=Yp>33?"#f87171":Yp>16?"#facc15":"#4ade80";n+=`<div>Frame: <b style="color:${s}">${Yp.toFixed(1)}ms</b>`;const c=e.frameTimeMs>16?"#f87171":e.frameTimeMs>8?"#facc15":"#4ade80";if(n+=` (JS: <b style="color:${c}">${e.frameTimeMs.toFixed(1)}ms</b>)</div>`,e.gpuMs>=0){n+=`<div>GPU: <b style="color:${e.gpuMs>16?"#f87171":e.gpuMs>8?"#facc15":"#4ade80"}">${e.gpuMs.toFixed(1)}ms</b></div>`}n+='<div style="margin-top:4px;color:#999">â”€â”€ Rendering â”€â”€</div>',n+=`<div>Draw calls: <b style="color:${o}">${e.drawCalls}</b></div>`,n+=`<div>Triangles: <b>${function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":String(e)}(e.triangles)}</b></div>`,n+=`<div>Geometries: ${e.geometries} &nbsp; Textures: ${e.textures}</div>`,n+=`<div>Shader programs: ${e.programs}</div>`;const u=Ct();if(u){const e=u.getPixelRatio(),t=u.getSize(jp);n+=`<div>Canvas: ${Math.round(t.x*e)}Ã—${Math.round(t.y*e)} @${e.toFixed(1)}x</div>`}n+='<div style="margin-top:4px;color:#999">â”€â”€ Scene â”€â”€</div>',n+=`<div>Objects: ${e.sceneObjects} &nbsp; Meshes: ${e.meshCount}</div>`,n+=`<div>Lights: <b>${e.lightCount}</b> &nbsp; Placed: ${e.placedCount}</div>`,n+=`<div>Collision meshes: ${e.collisionMeshes}</div>`,e.jsHeapMB>0&&(n+='<div style="margin-top:4px;color:#999">â”€â”€ Memory â”€â”€</div>',n+=`<div>JS Heap: ${e.jsHeapMB} MB</div>`);const p=Object.keys(e.timings);if(p.length>0){n+='<div style="margin-top:4px;color:#999">â”€â”€ Subsystems â”€â”€</div>';for(const t of p){const o=e.timings[t];n+=`<div>${t}: <b style="color:${o>4?"#f87171":o>2?"#facc15":"#4ade80"}">${o.toFixed(2)}ms</b></div>`}}zp&&(n+='<div style="margin-top:6px;color:#c084fc;font-weight:bold">WIREFRAME ON (F4)</div>'),Pp.innerHTML=n}()}}function Sk(){Mp?Bm():(Mp=!0,$p.value=!0,Zp=performance.now(),Jp=0,Qp=0,Np=0,Wp.drawCalls=0,Wp.triangles=0,Wp.frameTimeMs=0,tv=-1,Xp||function(){const e=Ct();if(!e)return;const t=e.getContext();if(!t||"function"!=typeof t.createQuery)return;const o=t.getExtension("EXT_disjoint_timer_query_webgl2");o&&(Xp=o,av=t,ev=t.createQuery())}(),Pp||(Pp=(void 0).createElement("div"),Pp.id="r3d-perf-overlay",Object.assign(Pp.style,{position:"fixed",top:"8px",left:"8px",zIndex:"99999",background:"rgba(0,0,0,0.82)",color:"#e0e0e0",fontFamily:"monospace",fontSize:"13px",lineHeight:"1.5",border:"1px solid rgba(255,255,255,0.08)",pointerEvents:"none"}),(void 0).body.appendChild(Pp)),"simple"===Ap?Object.assign(Pp.style,{minWidth:"0",padding:"4px 10px",borderRadius:"6px"}):Object.assign(Pp.style,{minWidth:"260px",padding:"10px 14px",borderRadius:"10px"}),Pp.style.display="block")}function Ck(e){Ap=e,Pp&&("simple"===e?Object.assign(Pp.style,{minWidth:"0",padding:"4px 10px",borderRadius:"6px"}):Object.assign(Pp.style,{minWidth:"260px",padding:"10px 14px",borderRadius:"10px"}))}function Tk(){return Ap}function Mk(){return Mp}function Lm(){const e=St();if(!e)return;zp=!zp;const t=new Set;e.traverse(e=>{var o;if(!e.isMesh||!e.material)return;const n=Array.isArray(e.material)?e.material:[e.material];for(const e of n){if(t.has(e)||!("wireframe"in e))continue;t.add(e);const n=e;zp?(Ip.set(e,n.wireframe),n.wireframe=!0):(n.wireframe=null!=(o=Ip.get(e))&&o,Ip.delete(e))}})}function $k(){return zp}function Bm(){Mp=!1,$p.value=!1,Pp&&(Pp.style.display="none"),zp&&Lm(),av&&ev&&(av.deleteQuery(ev),ev=null),Xp=null,av=null}function Pk(){Bm(),Pp&&(Pp.remove(),Pp=null)}const ov={default:{bgPrimary:"#0d1117",bgSecondary:"#161b22",borderColor:"#30363d",borderWidth:1.5,textPrimary:"#e6edf3",textSecondary:"#8b949e",textMuted:"#484f58",textAccent:"#4ade80",fontFamily:"sans-serif",onColor:"#4ade80",offColor:"#484f58",warnColor:"#f97316",minColor:"#60a5fa",avgColor:"#4ade80",maxColor:"#f87171",barBg:"#21262d",roundedCorners:8,useShadow:!0,useGlow:!1},chalk:{bgPrimary:"transparent",bgSecondary:"transparent",borderColor:"transparent",borderWidth:0,textPrimary:"rgba(240,240,235,0.9)",textSecondary:"rgba(200,200,195,0.6)",textMuted:"rgba(180,180,175,0.4)",textAccent:"rgba(180,255,200,0.85)",fontFamily:"GloriaHallelujah-Regular",onColor:"rgba(150,238,150,0.85)",offColor:"rgba(150,150,145,0.5)",warnColor:"rgba(255,180,100,0.8)",minColor:"rgba(130,180,255,0.8)",avgColor:"rgba(150,238,150,0.8)",maxColor:"rgba(255,140,140,0.8)",barBg:"rgba(255,255,255,0.08)",roundedCorners:0,useShadow:!1,useGlow:!1},neon:{bgPrimary:"#050505",bgSecondary:"#0a0a0a",borderColor:"#1a1a2e",borderWidth:1,textPrimary:"#ffffff",textSecondary:"#888888",textMuted:"#444444",textAccent:"#00ff88",fontFamily:"monospace",onColor:"#00ff88",offColor:"#333333",warnColor:"#ff6600",minColor:"#00aaff",avgColor:"#00ff88",maxColor:"#ff4444",barBg:"#111111",roundedCorners:4,useShadow:!1,useGlow:!0}};function sl(e){return ov[e]||ov.default}function Zf(e,t,o,n,s,c){c<=0?e.rect(t,o,n,s):(c=Math.min(c,n/2,s/2),e.moveTo(t+c,o),e.arcTo(t+n,o,t+n,o+s,c),e.arcTo(t+n,o+s,t,o+s,c),e.arcTo(t,o+s,t,o,c),e.arcTo(t,o,t+n,o,c),e.closePath())}function jm(e,t,o,n,s,c,u,p,v){if(e.beginPath(),Zf(e,t,o,n,s,v),e.fillStyle=p,e.fill(),c>0){const p=Math.max(1,n*Math.min(c,100)/100);e.beginPath(),Zf(e,t,o,p,s,v),e.fillStyle=u,e.fill()}}function ct(e,t,o,n=!1,s=!1){const c=n?"bold":"normal",u=s?"italic":"normal";e.font=`${c} ${u} ${t}px ${o}, sans-serif`}function Wl(e,t,o){e.shadowColor=t,e.shadowBlur=o}function Hl(e){e.shadowColor="transparent",e.shadowBlur=0}function Um(){try{return da()}catch{return null}}function rs(){try{return ia()}catch{return null}}let nv=!1;let dv=!1,cv=null;let vv=!1,gv=null;function jk(e,t,o,n,s,c,u){var p,v,f,g,b,h,x,S,$;const M=sl(c.theme),T=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||M.fontFamily,V=(c.fontSize||28)*u,O=(c.titleFontSize||Math.round(.45*(c.fontSize||28)))*u,I=Um(),j=null==I?void 0:I.current;!function(){if(dv)return;dv=!0;const e=Um();(null==e?void 0:e.fetchStats)&&(e.fetchStats("24h"),cv=Xt())}();const F=null==I?void 0:I.stats;let _="--",E="",U="",N=c.sensorType;if(j)switch(c.sensorType){case"temperature":_=null!=(f=null==(v=j.temp)?void 0:v.toFixed(1))?f:"--",E="Â°C",U="Temperature",N="temp";break;case"humidity":_=null!=(b=null==(g=j.humi)?void 0:g.toFixed(1))?b:"--",E="%",U="Humidity",N="humi";break;case"vpd":_=null!=(x=null==(h=j.vpd)?void 0:h.toFixed(2))?x:"--",E="kPa",U="VPD",N="vpd";break;case"co2":_=null!=($=null==(S=j.co2)?void 0:S.toFixed(0))?$:"--",E="ppm",U="CO2",N="co2";break;case"soil_moisture":_="--",E="%",U="Soil Moisture",N="humi_soil";break;case"soil_ec":_="--",E="mS",U="Soil EC",N="ec_soil"}let J=M.textMuted;if(I){const e="temperature"===c.sensorType?I.temperatureStatus:"humidity"===c.sensorType?I.humidityStatus:"vpd"===c.sensorType?I.vpdStatus:void 0;"optimal"===e?J=M.onColor:"high"===e||"warn-high"===e?J=M.maxColor:"low"===e||"warn-low"===e?J=M.minColor:e&&(J=M.avgColor)}const Z=!1!==c.showUnit,X=!!c.showLabel,ee=!!c.showStats,oe=ee?null==F?void 0:F[N]:null,ne=.8*O;let le=0;const se=O+4*u,re=V+6*u;X&&(le+=se),Z&&(le+=re),ee&&oe&&(le+=oe?2*ne+4*u:0);let de=o+Math.max(0,(s-le)/2);if(X){if(ct(e,O,T,!1),e.fillStyle=c.labelColor||M.textSecondary,e.textAlign="left",e.textBaseline="top",e.fillText(U.toUpperCase(),t,de),c.showStatusDot){const o=.35*O,n=e.measureText(U.toUpperCase()).width;M.useGlow&&Wl(e,J,6*u),e.beginPath(),e.arc(t+n+2.5*o,de+O/2,o,0,2*Math.PI),e.fillStyle=J,e.fill(),M.useGlow&&Hl(e)}de+=se}if(Z&&(ct(e,V,T,!0),e.fillStyle=c.valueColor||M.textPrimary,e.textAlign="left",e.textBaseline="top",M.useGlow&&Wl(e,c.valueColor||M.textAccent,8*u),e.fillText(`${_} ${E}`,t,de),M.useGlow&&Hl(e),de+=re),ee&&oe){ct(e,ne,T);const o=["Min","Avg","Max"],s=[M.minColor,M.avgColor,M.maxColor],c=[oe.min,oe.avg,oe.max],p=n/3;for(let n=0;n<3;n++){const v=t+p*n;e.fillStyle=M.textMuted,e.textAlign="left",e.fillText(o[n],v,de),e.fillStyle=s[n];const f=c[n];e.fillText("number"==typeof f?f.toFixed(1):"--",v,de+ne+2*u)}}}const mv={0:"Manual",1:"Time Slot",2:"Cycle",3:"Temp",4:"Humidity",5:"CO2",14:"Drip"};function Nk(e,t,o,n,s,c,u){var p;const v=sl(c.theme),f=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||v.fontFamily,g=(c.fontSize||20)*u,b=rs(),h=null==b?void 0:b.states;if(!h)return;const x=["O1","O2","O3","O4","O5"].filter(e=>h[e]);if(0===x.length)return;const S="grid"===c.layout,$="vertical"===c.layout,M=S?Math.min(3,x.length):$?1:x.length,T=Math.ceil(x.length/M),V=n/M,O=s/T;x.forEach((n,s)=>{var p,x;const S=h[n],$=s%M,T=Math.floor(s/M),I=t+$*V,j=o+T*O,F=1===S.mOnOff,_=3*u,E=V-2*_,U=O-2*_;e.beginPath(),Zf(e,I+_,j+_,E,U,.6*v.roundedCorners),e.fillStyle=F?(c.onColor||v.onColor)+"22":(c.offColor||v.offColor)+"15",e.fill();const N=.18*g,J=I+_+N+4*u,Z=j+_+U/2;v.useGlow&&F&&Wl(e,c.onColor||v.onColor,6*u),e.beginPath(),e.arc(J,Z,N,0,2*Math.PI),e.fillStyle=F?c.onColor||v.onColor:c.offColor||v.offColor,e.fill(),v.useGlow&&Hl(e);const X=.75*g;ct(e,X,f,!0),e.fillStyle=F?v.textPrimary:v.textSecondary,e.textAlign="left",e.textBaseline="middle";const ee=n.replace("O","S");if(e.fillText(ee,J+N+4*u,Z-(c.showModeName?.4*X:0)),c.showModeName){ct(e,.65*X,f),e.fillStyle=v.textMuted,e.fillText(mv[S.modeType]||"Unknown",J+N+4*u,Z+.45*X)}if(c.showWattage){const t=null==(x=null==(p=null==b?void 0:b.wattage)?void 0:p[n])?void 0:x.watts;if(t&&t>0){ct(e,.6*X,f),e.fillStyle=F?"#facc15":v.textMuted,e.textAlign="right",e.fillText(`${t}W`,I+_+E-4*u,Z)}}})}const xv={0:"Manual",1:"Time Slot",2:"Cycle",12:"PPFD Auto"};function Hk(e,t,o,n,s,c,u){var p;const v=sl(c.theme),f=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||v.fontFamily,g=(c.fontSize||20)*u,b=(c.titleFontSize||Math.round(.7*(c.fontSize||20)))*u,h=function(){try{return sa()}catch{return null}}();if(!h)return;!function(){if(nv)return;nv=!0;const e=rs();(null==e?void 0:e.fetchWattage)&&!e.wattageLoaded&&e.fetchWattage()}();const x=rs(),S=("all"===c.lightId?["light","light2"]:[c.lightId]).filter(e=>!(!h.states[e]||"light"===e&&(null==x?void 0:x.isLight1Disabled)||"light2"===e&&(null==x?void 0:x.isLight2Disabled)));if(0===S.length)return;const $=s/S.length;S.forEach((s,p)=>{var S;const M=h.states[s];if(!M)return;const T=o+p*$,V=1===M.mOnOff,O=V&&M.mLevel||0;ct(e,b,f,!0),e.fillStyle=v.textPrimary,e.textAlign="left",e.textBaseline="top";const I="light"===s?"Light 1":"Light 2";e.fillText(I,t,T);const j=.7*b,F=V?"ON":"OFF";ct(e,b,f,!0);const _=e.measureText(I).width;ct(e,j,f,!0);const E=e.measureText(F).width+6*u,U=t+_+8*u;if(e.fillStyle=V?v.onColor+"20":v.offColor+"20",e.fillRect(U,T,E,j+4*u),e.fillStyle=V?v.onColor:v.offColor,e.textBaseline="top",e.fillText(F,U+3*u,T+2*u),c.showMode&&(ct(e,j,f),e.fillStyle=v.textSecondary,e.textAlign="right",e.fillText(xv[M.modeType]||"Unknown",t+n,T+2*u)),c.showBrightnessBar){const o=T+b+6*u,p=Math.max(6*u,.18*$),h=V?c.barColor||"#facc15":v.offColor;jm(e,t,o,n,p,O,h,v.barBg,.5*v.roundedCorners);if(ct(e,.55*g,f,!0),e.fillStyle=V?h:v.textMuted,e.textAlign="left",e.textBaseline="top",e.fillText(`${O}%`,t,o+p+3*u),c.showWattage){const c=null==(S=null==x?void 0:x.lightWattage)?void 0:S[s];if(c&&c.watts>0){const s=Math.round(c.watts*O/100);e.fillStyle=V?"#facc15":v.textMuted,e.textAlign="right",e.fillText(`${s}W`,t+n,o+p+3*u)}}}})}function Gk(e,t,o,n,s,c,u){var p,v,f,g;const b=sl(c.theme),h=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||b.fontFamily,x=(c.fontSize||24)*u,S=(c.titleFontSize||Math.round(.5*(c.fontSize||24)))*u,$=c.gaugeColor||"#06b6d4",M=function(){try{return ra()}catch{return null}}(),T=null!=(v=null==M?void 0:M.on)&&v,V=null!=(f=null==M?void 0:M.level)?f:0;if(null==(g=null==M?void 0:M.loaded)||!g)return ct(e,.5*x,h),e.fillStyle=b.textMuted,e.textAlign="center",e.textBaseline="middle",void e.fillText("Blower N/A",t+n/2,o+s/2);const O=!1!==c.showTitle;if("arc"===c.style){const p=t+n/2,v=O?S+4*u:0,f=o+v+.5*(s-v),g=.35*Math.min(n,s-v),M=.75*Math.PI,I=2.25*Math.PI,j=I-M;if(e.beginPath(),e.arc(p,f,g,M,I),e.strokeStyle=b.barBg,e.lineWidth=8*u,e.lineCap="round",e.stroke(),V>0){const t=M+j*(V/100);e.beginPath(),e.arc(p,f,g,M,t),e.strokeStyle=T?$:b.offColor,b.useGlow&&Wl(e,$,10*u),e.stroke(),b.useGlow&&Hl(e)}e.lineCap="butt",c.showSpeed&&(ct(e,1.2*x,h,!0),e.fillStyle=T?$:b.textMuted,e.textAlign="center",e.textBaseline="middle",b.useGlow&&T&&Wl(e,$,8*u),e.fillText(`${V}%`,p,f),b.useGlow&&Hl(e)),c.showStatus&&(ct(e,.8*S,h,!0),e.fillStyle=T?b.onColor:b.offColor,e.fillText(T?"RUNNING":"OFF",p,f+g+12*u)),O&&(ct(e,S,h),e.fillStyle=b.textSecondary,e.fillText("Blower",p,o+S))}else{let p=o;if(O){if(ct(e,S,h,!0),e.fillStyle=b.textPrimary,e.textAlign="left",e.textBaseline="top",e.fillText("Blower",t,p),c.showStatus){const o=.8*S;ct(e,S,h,!0);const n=e.measureText("Blower").width;ct(e,o,h,!0);const s=T?"ON":"OFF",c=e.measureText(s).width+6*u;e.fillStyle=T?b.onColor+"20":b.offColor+"20",e.fillRect(t+n+6*u,p,c,o+4*u),e.fillStyle=T?b.onColor:b.offColor,e.fillText(s,t+n+9*u,p+2*u)}p+=S+6*u}const v=Math.max(6*u,.15*s);jm(e,t,p,n,v,V,T?$:b.offColor,b.barBg,.5*b.roundedCorners),p+=v+4*u,c.showSpeed&&(ct(e,.7*x,h,!0),e.fillStyle=T?$:b.textMuted,e.textAlign="left",e.textBaseline="top",b.useGlow&&T&&Wl(e,$,6*u),e.fillText(`${V}%`,t,p),b.useGlow&&Hl(e))}}function Kk(e,t,o,n,s,c,u){var p,v,f,g;const b=sl(c.theme),h=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||b.fontFamily,x=(c.fontSize||22)*u,S=(c.titleFontSize||Math.round(.5*(c.fontSize||22)))*u,$=c.accentColor||b.textAccent,M=null==(v=rs())?void 0:v.powerStats;let T=o;if(ct(e,S,h,!0),e.fillStyle=b.textSecondary,e.textAlign="left",e.textBaseline="top",e.fillText("POWER",t,T),ct(e,.8*S,h),e.fillStyle=b.textMuted,e.textAlign="right",e.fillText(c.range.toUpperCase(),t+n,T),T+=S+6*u,!M)return ct(e,.5*x,h),e.fillStyle=b.textMuted,e.textAlign="center",void e.fillText("Loading...",t+n/2,T+x);const V=(null==(f=M.totals)?void 0:f.kWh)||0,O=V>=1e3?`${(V/1e3).toFixed(2)} MWh`:V>=10?`${V.toFixed(1)} kWh`:`${V.toFixed(2)} kWh`;if(ct(e,x,h,!0),e.fillStyle=b.textPrimary,e.textAlign="left",b.useGlow&&Wl(e,$,8*u),e.fillText(O,t,T),b.useGlow&&Hl(e),T+=x+4*u,c.showCost){const o=(null==(g=M.totals)?void 0:g.cost)||0;o>0&&(ct(e,.6*x,h,!0),e.fillStyle=$,e.fillText(`${o.toFixed(2)} EUR`,t,T),T+=.65*x+6*u)}if(c.showBreakdown){const c=.85*S,u=2.2*c;ct(e,c,h);const p=[];for(const e of M.lights||[])p.push({name:"light"===e.socket?"Light 1":"Light 2",kWh:e.kWh,cost:e.cost});for(const e of M.sockets||[])p.push({name:e.socket.replace("O","S"),kWh:e.kWh,cost:e.cost});M.blower&&p.push({name:"Blower",kWh:M.blower.kWh,cost:M.blower.cost});for(let v=0;v<p.length;v++){const f=p[v];if(T+c>o+s)break;e.fillStyle=b.textSecondary,e.textAlign="left",e.fillText(f.name,t,T),e.fillStyle=b.textPrimary,e.textAlign="right";const g=f.kWh<10?`${f.kWh.toFixed(2)} kWh`:`${f.kWh.toFixed(1)} kWh`;if(e.fillText(g,t+n,T),v<p.length-1){const o=T+c+.5*(u-c);e.beginPath(),e.moveTo(t,o),e.lineTo(t+n,o),e.strokeStyle=b.textMuted+"40",e.lineWidth=1,e.stroke()}T+=u}}}function qk(e,t,o,n,s,c,u){var p,v;const f=sl(c.theme),g=c.fontFamily&&(null==(p=c.fontFamily.split("/").pop())?void 0:p.replace(/\.[^.]+$/,""))||f.fontFamily,b=(c.fontSize||18)*u,h=(c.titleFontSize||Math.round(.6*(c.fontSize||18)))*u;!function(){if(vv)return;vv=!0;const e=rs();(null==e?void 0:e.fetchLog)&&(e.fetchLog(50),gv=Xt())}();const x=(null==(v=rs())?void 0:v.log)||[];let S=o;if(ct(e,h,g,!0),e.fillStyle=f.textSecondary,e.textAlign="left",e.textBaseline="top",e.fillText("EVENT LOG",t,S),S+=h+6*u,0===x.length)return ct(e,.5*b,g),e.fillStyle=f.textMuted,e.textAlign="center",void e.fillText("No events",t+n/2,S+b);const $=c.maxEntries||10,M=x.slice(0,$),T=o+s-S,V=Math.max(1.2*b,T/Math.min(M.length,$));for(const p of M){if(S+V>o+s)break;const v="on"===p.action,h=v?"ON":"OFF",x=Math.min(.75*V,b);ct(e,x,g,!0),e.textAlign="left";const $=e.measureText(h).width+6*u;e.fillStyle=v?(c.onColor||f.onColor)+"20":(c.offColor||f.maxColor)+"20",e.fillRect(t,S,$,V),e.fillStyle=v?c.onColor||f.onColor:c.offColor||f.maxColor,e.textBaseline="top",e.fillText(h,t+3*u,S+(V-x)/2),ct(e,x,g),e.fillStyle=f.textPrimary,e.textAlign="left";const M=(p.socket||"").replace("O","S");if(e.fillText(M,t+$+6*u,S+(V-x)/2),p.timestamp){const o=new Date(p.timestamp),s=`${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}:${String(o.getSeconds()).padStart(2,"0")}`;ct(e,.85*x,g),e.fillStyle=f.textMuted,e.textAlign="right",e.fillText(s,t+n,S+(V-x)/2)}if(c.showTriggerSource&&"trigger"===p.source&&p.flowName){if(S+=V+1*u,S+V>o+s)break;ct(e,.7*x,g),e.fillStyle="#a855f7",e.textAlign="left",e.fillText(`â†³ ${p.flowName}`,t+$+6*u,S)}S+=V+3*u}}fa.register(ga,ma,ha,xa,ya,wa,ka);const $v={temperature:"#22c55e",humidity:"#3b82f6",vpd:"#a855f7",co2:"#f59e0b",soil_temp:"#f97316",soil_moisture:"#eab308",soil_ec:"#06b6d4",blower:"#06b6d4",fan:"#14b8a6"},Mv={temperature:"Temperature (Â°C)",humidity:"Humidity (%)",vpd:"VPD (kPa)",co2:"CO2 (ppm)",soil_temp:"Soil Temp (Â°C)",soil_moisture:"Soil Moisture (%)",soil_ec:"Soil EC (mS)",blower:"Blower (%)",fan:"Fan (gear)"},Tv=new Set(["blower","fan"]),Vv=new Map;let Av=null,Pv=0;async function Qk(e,t){try{const o=function(e,t){return"blower"===e?`/api/sensors/blower-history?range=${t}`:"fan"===e?`/api/sensors/fan-history?range=${t}`:e.startsWith("soil_")?`/api/sensors/soil/history?range=${t}`:`/api/sensors/history?range=${t}`}(e,t),n=await $fetch(o);return n&&Array.isArray(n)?function(e,t){if("blower"===e||"fan"===e)return t.map(e=>{var t;return{x:new Date(e.timestamp).getTime(),y:null!=(t=e.value)?t:null}});const o={soil_temp:"temp_soil",soil_moisture:"humi_soil",soil_ec:"ec_soil",temperature:"temp",humidity:"humi",vpd:"vpd",co2:"co2"}[e]||e;return t.map(e=>{var t;return{x:new Date(e.timestamp).getTime(),y:null!=(t=e[o])?t:null}})}(e,n):[]}catch{return[]}}async function t6(e,t,o=800,n=400){Vv.has(e)&&function(e){const t=Vv.get(e);t&&(t.chart.destroy(),Vv.delete(e),Pv=Math.max(0,Pv-1),0===Pv&&Wm())}(e);const s=Math.max(200,Math.min(2048,Math.round(o))),c=Math.max(100,Math.min(1024,Math.round(n))),u=(void 0).createElement("canvas");u.width=s,u.height=c;const p=await Qk(t.metric,t.range),v=function(e,t){const o=e.lineColor||$v[e.metric]||"#4ade80",n=Tv.has(e.metric);sl(e.theme);const s="chalk"===e.theme?"rgba(200,200,200,0.12)":"neon"===e.theme?"#1a1a2e":"#374151",c="chalk"===e.theme?"rgba(200,200,200,0.5)":"neon"===e.theme?"#555555":"#9ca3af";return{type:"line",data:{datasets:[{label:Mv[e.metric]||e.metric,data:t,borderColor:o,backgroundColor:o+"1A",fill:!0,tension:n?0:.3,stepped:!!n&&"after",pointRadius:0,borderWidth:2}]},options:{responsive:!1,maintainAspectRatio:!1,animation:!1,devicePixelRatio:2,layout:{padding:{top:e.showTitle?24:4,right:4,bottom:2,left:2}},plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{type:"time",display:!1!==e.showAxes,time:{displayFormats:{minute:"HH:mm",hour:"HH:mm",day:"dd/MM HH:mm"}},grid:{color:s},ticks:{color:c,maxTicksLimit:6,font:{size:16}}},y:{display:!1!==e.showAxes,grid:{color:s},ticks:{color:c,font:{size:16}},..."blower"===e.metric?{min:0,max:100}:{},..."fan"===e.metric?{min:0,max:10}:{}}}}}}(t,p),f=new fa(u,v);(function(e,t){if(!t.showTitle)return;const o=e.getContext("2d");if(!o)return;const n=sl(t.theme),s="chalk"===t.theme?"GloriaHallelujah-Regular":"neon"===t.theme?"monospace":"sans-serif";o.save(),o.font=`bold 18px ${s}, sans-serif`,o.fillStyle=n.textSecondary,o.textAlign="left",o.textBaseline="top",o.fillText(Mv[t.metric]||t.metric,6,4),o.restore()})(u,t),Vv.set(e,{chart:f,canvas:u,config:{...t},lastFetch:Date.now(),data:p,targetW:s,targetH:c}),Pv++,1===Pv&&(Av||(Av=Xt()))}function o6(e){var t;return(null==(t=Vv.get(e))?void 0:t.canvas)||null}function n6(e){return Vv.has(e)}function Wm(){Av&&(clearInterval(Av),Av=null)}const zv=U0(),Dv=new Set;async function Hm(e){var t;if(!e)return"sans-serif";const o=(null==(t=e.split("/").pop())?void 0:t.replace(/\.[^.]+$/,""))||"sans-serif";if(Dv.has(o))return o;try{const t=new FontFace(o,`url(${e})`);await t.load(),(void 0).fonts.add(t),Dv.add(o)}catch{}return o}function Wd(e,t="sans-serif"){var o;if(!e)return t;const n=(null==(o=e.split("/").pop())?void 0:o.replace(/\.[^.]+$/,""))||t;return Dv.has(n)?n:t}async function Gm(e){var t;const o=new Set;for(const n of e.elements||[])(null==(t=n.config)?void 0:t.fontFamily)&&o.add(n.config.fontFamily);await Promise.all([...o].map(e=>Hm(e)))}const yp=e=>{const t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return t>1e-10?{x:e.x/t,y:e.y/t,z:e.z/t}:{x:0,y:0,z:1}};function Km(e){let t;if(Math.abs(e.y)>.99){const o=-1*e.z;t=yp({x:-o*e.x,y:-o*e.y,z:-1-o*e.z})}else{const o=e.y;t=yp({x:-o*e.x,y:1-o*e.y,z:-o*e.z})}return{bU:{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x},bV:t}}function qm(e,t){t.updateMatrixWorld(!0);const o=t.matrixWorld,n=(new Ue.Matrix3).getNormalMatrix(o),s=e.vertices.map(e=>{const t=new Ue.Vector3(e.x,e.y,e.z).applyMatrix4(o);return{x:t.x,y:t.y,z:t.z}}),c=new Ue.Vector3(e.vertices.reduce((e,t)=>e+t.nx,0)/e.vertices.length,e.vertices.reduce((e,t)=>e+t.ny,0)/e.vertices.length,e.vertices.reduce((e,t)=>e+t.nz,0)/e.vertices.length).applyMatrix3(n).normalize();return{verts:s,avgN:{x:c.x,y:c.y,z:c.z}}}function Ym(e,t){let o,n;if(t){const s=qm(e,t);o=s.verts,n=s.avgN}else o=e.vertices.map(e=>({x:e.x,y:e.y,z:e.z})),n={x:e.vertices.reduce((e,t)=>e+t.nx,0)/e.vertices.length,y:e.vertices.reduce((e,t)=>e+t.ny,0)/e.vertices.length,z:e.vertices.reduce((e,t)=>e+t.nz,0)/e.vertices.length};const{normal:s,center:c}=z0(o);let u=s;u.x*n.x+u.y*n.y+u.z*n.z<0&&(u={x:-u.x,y:-u.y,z:-u.z});const{bU:p,bV:v}=Km(u),f=I0(jc(o,c,p,v));return{w:f.maxU-f.minU,h:f.maxV-f.minV}}const Ov=new Map,Rv=new Map;let Iv=null,Fv=null;const _v=new Map;function d6(e){}function c6(e,t,o){const n=(void 0).createElement("video");return n.crossOrigin="anonymous",n.playsInline=!0,n.muted=o,n.autoplay=!0,n.loop=t,n.style.cssText="position:fixed;top:0;left:0;width:1px;height:1px;pointer-events:none;opacity:0.01;z-index:-9999",(void 0).body.appendChild(n),n.src=e,n.play().catch(()=>{}),n}function Zm(e){const t=(void 0).createElement("video");return t.crossOrigin="anonymous",t.playsInline=!0,t.muted=!0,t.autoplay=!0,t.style.cssText="position:fixed;top:0;left:0;width:1px;height:1px;pointer-events:none;opacity:0.01;z-index:-9999",(void 0).body.appendChild(t),t.src=`/api/cameras/stream/${encodeURIComponent(e)}?_t=${Date.now()}`,t.addEventListener("error",()=>function(e){const t=Rv.get(e);if(!t||!t.active||t.reconnectCount>=10)return;const o=t.reconnectCount;Xm(t);const n=Math.min(2e3*(o+1),2e4);setTimeout(()=>{if(!Rv.has(e))return;const t=Zm(e),n=performance.now();Rv.set(e,{video:t,cameraId:e,active:!0,lastGoodTime:n,lastCurrentTime:-1,reconnectCount:o+1,startedAt:n})},n)}(e)),t.addEventListener("stalled",()=>{t.play().catch(()=>{})}),t.play().catch(()=>{}),t}function Xm(e){e.active=!1;try{e.video.pause(),e.video.removeAttribute("src"),e.video.load()}catch{}e.video.remove()}let Lv=[];function Jm(){var e,t;yv(),Lv=[];const o=new Set,n=new Map;for(const s of Ne)if("screen"===(null==(e=s.behavior)?void 0:e.type)&&(null==(t=s.behavior.config)?void 0:t.displayZones))for(const e of s.behavior.config.displayZones){let t=!1;for(const s of e.elements||[]){if("video"!==s.type)continue;t=!0;const e=s.config;"camera"===e.srcType&&e.cameraId?o.add(e.cameraId):e.src&&n.set(e.src,{loop:!1!==e.loop,muted:!1!==e.muted})}t&&Lv.push({zone:e,zoneId:e.id})}if(0===o.size&&0===n.size)return;const s=performance.now();for(const e of o){const t=Zm(e);Rv.set(e,{video:t,cameraId:e,active:!0,lastGoodTime:s,lastCurrentTime:-1,reconnectCount:0,startedAt:s})}for(const[e,t]of n)_v.has(e)||_v.set(e,c6(e,t.loop,t.muted));Iv=Xt(),o.size>0&&(Fv=Xt())}function yv(){Iv&&(clearInterval(Iv),Iv=null),Fv&&(clearInterval(Fv),Fv=null),Lv=[];for(const[,e]of Rv)Xm(e);Rv.clear(),function(){for(const[,e]of _v)e.pause(),e.removeAttribute("src"),e.load(),e.remove();_v.clear()}()}function Kd(e,t,o,n,s,c,u){const p=t.videoWidth||t.naturalWidth||t.width||1,v=t.videoHeight||t.naturalHeight||t.height||1;if("cover"===u){const u=s/c;let f=0,g=0,b=p,h=v;p/v>u?(b=v*u,f=(p-b)/2):(h=p/u,g=(v-h)/2),e.drawImage(t,f,g,b,h,o,n,s,c)}else if("contain"===u){const u=p/v;let f=s,g=c;u>s/c?g=s/u:f=c*u,e.drawImage(t,o+(s-f)/2,n+(c-g)/2,f,g)}else e.drawImage(t,o,n,s,c)}function Qm(e,t,o,n,s,c,u){var p,v,f;const g=da();for(const b of e.elements){const e=b.x/100*o,h=b.y/100*n,x=b.width/100*o,S=b.height/100*n;if("text"===b.type){const o=b.config,n=o.bold?"bold":"normal",c=o.italic?"italic":"normal",u=Wd(o.fontFamily,"sans-serif");t.font=`${c} ${n} ${Math.round((o.fontSize||24)*s)}px ${u}`,t.fillStyle=o.color||"#ffffff",t.globalAlpha=null!=(p=o.opacity)?p:1,t.textBaseline="middle",t.textAlign=o.align||"left";const v="center"===o.align?e+x/2:"right"===o.align?e+x:e;t.fillText(o.text||"",v,h+S/2,x),t.globalAlpha=1}else if("sensor"===b.type){const o=b.config,n=g.current,c=g.soil,u={temperature:null!=(null==n?void 0:n.temp)?`${n.temp.toFixed(1)}Â°C`:"â€”",humidity:null!=(null==n?void 0:n.humi)?`${Math.round(n.humi)}%`:"â€”",vpd:null!=(null==n?void 0:n.vpd)?`${n.vpd.toFixed(2)} kPa`:"â€”",co2:null!=(null==n?void 0:n.co2)?`${Math.round(n.co2)} ppm`:"â€”",soil_moisture:null!=(null==c?void 0:c.humi_soil)?`${Math.round(c.humi_soil)}%`:"â€”",soil_ec:null!=(null==c?void 0:c.ec_soil)?`${c.ec_soil.toFixed(1)} mS/cm`:"â€”"},p={temperature:"Temp",humidity:"RH",vpd:"VPD",co2:"CO2",soil_moisture:"Soil",soil_ec:"EC"},v=o.bold?"bold":"normal",f=o.italic?"italic":"normal",$=Wd(o.fontFamily,"sans-serif");t.font=`${f} ${v} ${Math.round((o.fontSize||28)*s)}px ${$}`,t.fillStyle=o.color||"#4ade80",t.textBaseline="middle";const M=o.align||"left";t.textAlign=M;let T=u[o.sensorType]||"â€”";o.showUnit||(T=T.split(/[Â°%\s]/)[0]||T),o.showLabel&&(T=`${o.labelText||p[o.sensorType]||""}: ${T}`);const V="center"===M?e+x/2:"right"===M?e+x:e;t.fillText(T,V,h+S/2,x)}else if("clock"===b.type){const o=b.config,n=new Date,c="12h"===o.format?n.getHours()%12||12:n.getHours(),u=String(n.getMinutes()).padStart(2,"0"),p=String(n.getSeconds()).padStart(2,"0"),v="12h"===o.format?n.getHours()>=12?" PM":" AM":"",f=o.bold?"bold":"normal",g=o.italic?"italic":"normal",$=Wd(o.fontFamily,"monospace");t.font=`${g} ${f} ${Math.round((o.fontSize||32)*s)}px ${$}`,t.fillStyle=o.color||"#ffffff",t.textBaseline="middle";const M=o.align||"left";t.textAlign=M;const T=`${c}:${u}${o.showSeconds?":"+p:""}${v}`,V="center"===M?e+x/2:"right"===M?e+x:e;t.fillText(T,V,h+S/2,x)}else if("image"===b.type){const o=b.config;if(t.globalAlpha=null!=(v=o.opacity)?v:1,o.src){let n=Ov.get(o.src);(null==n?void 0:n.complete)&&n.naturalWidth>0?Kd(t,n,e,h,x,S,o.fit||"cover"):(t.fillStyle="#222222",t.fillRect(e,h,x,S),n||(n=new Image,n.crossOrigin="anonymous",n.onload=()=>{Ov.set(o.src,n),u?u():c&&(c.needsUpdate=!0)},n.src=o.src,Ov.set(o.src,n)))}else t.fillStyle="#222222",t.fillRect(e,h,x,S);t.globalAlpha=1}else if("video"===b.type){const o=b.config;if(t.globalAlpha=null!=(f=o.opacity)?f:1,t.fillStyle="#1a1a2e",t.fillRect(e,h,x,S),"camera"===o.srcType&&o.cameraId){const n=Rv.get(o.cameraId);(null==n?void 0:n.video)&&n.video.readyState>=2&&n.video.videoWidth>0&&Kd(t,n.video,e,h,x,S,o.fit||"cover")}else if(o.src){const n=_v.get(o.src);n&&n.readyState>=2&&n.videoWidth>0&&Kd(t,n,e,h,x,S,o.fit||"cover")}t.globalAlpha=1}else if("divider"===b.type){const o=b.config,n=Math.max(1,Math.round((o.thickness||2)*s));t.fillStyle=o.color||"#555555";const c=(o.rotation||0)*Math.PI/180;c?(t.save(),t.translate(e+x/2,h+S/2),t.rotate(c),t.fillRect(-x/2,-n/2,x,n),t.restore()):t.fillRect(e,h+S/2-n/2,x,n)}else if("chart"===b.type){const o=o6(b.id);o?t.drawImage(o,e,h,x,S):(t.fillStyle="#8b949e",t.font=`${Math.round(14*s)}px sans-serif`,t.textAlign="center",t.textBaseline="middle",t.fillText("Loading chart...",e+x/2,h+S/2),n6(b.id)||t6(b.id,b.config,Math.round(x),Math.round(S)).then(()=>{u?u():c&&(c.needsUpdate=!0)}))}else"sensorCard"===b.type?jk(t,e,h,x,S,b.config,s):"socketStatus"===b.type?Nk(t,e,h,x,S,b.config,s):"lightStatus"===b.type?Hk(t,e,h,x,S,b.config,s):"blowerStatus"===b.type?Gk(t,e,h,x,S,b.config,s):"powerSummary"===b.type?Kk(t,e,h,x,S,b.config,s):"eventLog"===b.type&&qk(t,e,h,x,S,b.config,s)}}async function hv(e,t){var o,n,s,c,u,p,v,f;if(!t.polygon||!(null==(o=t.elements)?void 0:o.length))return void zv.createTextPanel(e.group,{id:t.id,polygon:t.polygon,config:{...zv.DEFAULT_TEXT_PANEL_CONFIG,previewText:(null==(n=t.elements)?void 0:n.length)?"":"Display Zone"}});await Gm(t),await async function(e){var t;const o=new Set;for(const n of e.elements||[])"image"===n.type&&(null==(t=n.config)?void 0:t.src)&&o.add(n.config.src);0!==o.size&&await Promise.all([...o].map(e=>{const t=Ov.get(e);return(null==t?void 0:t.complete)&&t.naturalWidth>0?Promise.resolve():new Promise(t=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{Ov.set(e,o),t()},o.onerror=()=>{t()},o.src=e,Ov.set(e,o)})}))}(t);const g=(void 0).createElement("canvas");let b=t.polygonWidth,h=t.polygonHeight;if(!b||!h||b<=0||h<=0)if((null==(c=null==(s=t.polygon)?void 0:s.vertices)?void 0:c.length)>=3){const o=Ym(t.polygon,e.group);b=o.w,h=o.h,t.polygonWidth=b,t.polygonHeight=h}else b=1,h=1;const x=t.contentRotation||0;let S=Math.round(2048*b),$=Math.round(2048*h);S=Math.max(256,Math.min(4096,S)),$=Math.max(256,Math.min(4096,$)),g.width=S,g.height=$;const M=90===x||270===x?$:S,T=90===x||270===x?S:$,V=T/1e3,O=g.getContext("2d");0!==x&&(O.translate(S/2,$/2),O.rotate(x*Math.PI/180),O.translate(-M/2,-T/2)),O.fillStyle=t.backgroundColor||"#111111",O.globalAlpha=null!=(u=t.backgroundOpacity)?u:.9,O.fillRect(0,0,M,T),O.globalAlpha=1;const I=new Ue.CanvasTexture(g);I.minFilter=Ue.LinearMipmapLinearFilter,I.magFilter=Ue.LinearFilter,I.anisotropy=(null==(f=null==(v=null==(p=Ct())?void 0:p.capabilities)?void 0:v.getMaxAnisotropy)?void 0:f.call(v))||4,I.needsUpdate=!0,Qm(t,O,M,T,V,I,()=>{_m(t,g),I.needsUpdate=!0});const j=zv.createTextPanel(e.group,{id:t.id,polygon:t.polygon,config:{...zv.DEFAULT_TEXT_PANEL_CONFIG,previewText:"",backgroundTransparent:!1,backgroundColor:"#000000",backgroundOpacity:1}});(null==j?void 0:j.bgMesh)&&(j.bgMesh.userData.isDisplayZone=!0,function(e,t,o,n){const s=e.geometry,c=s.getAttribute("position"),u=s.getAttribute("uv");if(!c||!u)return;n.updateMatrixWorld(!0),t.updateMatrixWorld(!0);const{verts:p,avgN:v}=qm(o,n),{normal:f,center:g}=z0(p);let b=f;b.x*v.x+b.y*v.y+b.z*v.z<0&&(b={x:-b.x,y:-b.y,z:-b.z});const{bU:h,bV:x}=Km(b),S=new Ue.Vector3,$=[],M=[];for(let e=0;e<c.count;e++){S.set(c.getX(e),c.getY(e),c.getZ(e)),t.localToWorld(S);const o=S.x-g.x,n=S.y-g.y,s=S.z-g.z;$.push(o*h.x+n*h.y+s*h.z),M.push(o*x.x+n*x.y+s*x.z)}let T=1/0,V=-1/0,O=1/0,I=-1/0;for(let e=0;e<$.length;e++)$[e]<T&&(T=$[e]),$[e]>V&&(V=$[e]),M[e]<O&&(O=M[e]),M[e]>I&&(I=M[e]);const j=V-T||1,F=I-O||1;for(let e=0;e<u.count;e++)u.setX(e,($[e]-T)/j),u.setY(e,(M[e]-O)/F);u.needsUpdate=!0}(j.bgMesh,j.visualGroup,t.polygon,e.group),j.bgMesh.material=new Ue.MeshStandardMaterial({map:I,emissive:new Ue.Color(16777215),emissiveMap:I,emissiveIntensity:.6,roughness:.7,metalness:0,transparent:!0,side:Ue.DoubleSide,depthWrite:!1,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),j.bgMesh.renderOrder=0),(null==j?void 0:j.textMesh)&&(j.textMesh.visible=!1)}function _m(e,t){var o;const n=t.width,s=t.height,c=e.contentRotation||0,u=90===c||270===c?s:n,p=90===c||270===c?n:s,v=p/1e3,f=t.getContext("2d");f&&(f.clearRect(0,0,n,s),f.save(),0!==c&&(f.translate(n/2,s/2),f.rotate(c*Math.PI/180),f.translate(-u/2,-p/2)),f.fillStyle=e.backgroundColor||"#111111",f.globalAlpha=null!=(o=e.backgroundOpacity)?o:.9,f.fillRect(0,0,u,p),f.globalAlpha=1,Qm(e,f,u,p,v),f.restore())}let Ev=null,Wv=[];function ey(){var e,t,o;Wv=[];for(const n of Ne)if("screen"===(null==(e=n.behavior)?void 0:e.type)&&(null==(t=n.behavior.config)?void 0:t.displayZones))for(const e of n.behavior.config.displayZones)(null==(o=e.elements)?void 0:o.length)&&e.elements.some(e=>{var t;return"sensor"===e.type||"clock"===e.type||"sensorCard"===e.type||"socketStatus"===e.type||"lightStatus"===e.type||"blowerStatus"===e.type||"powerSummary"===e.type||"eventLog"===e.type||"chart"===e.type||"video"===e.type&&"camera"===(null==(t=e.config)?void 0:t.srcType)})&&Wv.push({zone:e,zoneId:e.id})}function v6(){ty(),Jm(),ey(),0!==Wv.length&&(Math.max(200,Math.round(2e3/Wv.length)),Ev=Xt())}function ty(){yv(),function(){for(const[,e]of Vv)e.chart.destroy();Vv.clear(),Pv=0,Wm()}(),vv=!1,nv=!1,dv=!1,gv&&(clearInterval(gv),gv=null),cv&&(clearInterval(cv),cv=null),Ev&&(clearInterval(Ev),Ev=null),Wv=[],Ov.clear()}function g6(e){var t,o,n;if("screen"===(null==(t=e.behavior)?void 0:t.type)&&(null==(o=e.behavior.config)?void 0:o.displayZones)){for(const t of e.behavior.config.displayZones)(null==(n=t.elements)?void 0:n.length)>0&&hv(e,t);Ev&&ey()}}function p6(){var e,t,o;for(const n of Ne)if("screen"===(null==(e=n.behavior)?void 0:e.type)&&(null==(t=n.behavior.config)?void 0:t.displayZones))for(const e of n.behavior.config.displayZones)(null==(o=e.elements)?void 0:o.length)>0&&hv(n,e)}let Nv=!1,Hv="off",Kv=null,ef=null,tf=null,af=null,nf=null,lf=null,sf=null,rf=null;const df=new Ue.MeshBasicMaterial({color:0,side:Ue.DoubleSide});let cf=0,uf=.35,pf=1,vf=1;const ff=2,gf=2;let bf=!0;function xp(e){return"high"===e?1024:512}function wp(e){null==Kv||Kv.dispose(),null==ef||ef.dispose(),Kv=new Ue.WebGLRenderTarget(e,e,{format:Ue.RGBAFormat,type:Ue.UnsignedByteType}),ef=new Ue.WebGLRenderTarget(e,e,{format:Ue.RGBAFormat,type:Ue.UnsignedByteType})}function S6(){const e=Ct(),t=St();if(!(e&&t&&Kv&&tf))return;const o=t.background,n=t.overrideMaterial,s=e.getRenderTarget(),c=new Ue.Color,u=e.getClearAlpha();e.getClearColor(c);const p=[];t.traverse(e=>{var t;(e===nf||"__contactShadows"===e.name||"__bgSphere"===e.name||"__dustParticles"===e.name||(null==(t=e.userData)?void 0:t.skipContactShadow))&&e.visible&&(p.push({obj:e,vis:!0}),e.visible=!1)}),t.background=null,t.overrideMaterial=df,e.setClearColor(16777215,1),e.setRenderTarget(Kv),e.clear(),e.render(t,tf),t.overrideMaterial=n,t.background=o;for(const{obj:e,vis:t}of p)e.visible=t;(function(e){if(!(lf&&sf&&rf&&Kv&&ef))return;const t=Kv.width,o=new Ue.Scene,n=new Ue.OrthographicCamera(-1,1,1,-1,0,1);sf.uniforms.tDiffuse.value=Kv.texture,sf.uniforms.h.value=ff/t,lf.material=sf,o.add(lf),e.setRenderTarget(ef),e.clear(),e.render(o,n),rf.uniforms.tDiffuse.value=ef.texture,rf.uniforms.v.value=gf/t,lf.material=rf,e.setRenderTarget(Kv),e.clear(),e.render(o,n),o.remove(lf)})(e),e.setRenderTarget(s),e.setClearColor(c,u)}function T6(){return{initContactShadows(e,t,o){if(cf=e,Hv=o,"off"===Hv)return;pf=.55*t.size.x,vf=.55*t.size.z;wp(xp(Hv)),function(e){tf=new Ue.OrthographicCamera(-pf,pf,vf,-vf,.1,e.size.y+20),tf.position.set(e.center.x,cf+e.size.y+10,e.center.z),tf.lookAt(e.center.x,cf,e.center.z),tf.updateMatrixWorld(!0)}(t),function(e){af&&(af.geometry.dispose(),af.material.dispose()),nf&&nf.removeFromParent();const t=2*pf,o=2*vf,n=new Ue.PlaneGeometry(t,o);n.rotateX(-Math.PI/2);const s=new Ue.ShaderMaterial({uniforms:{tShadow:{value:Kv.texture},darkness:{value:uf}},vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nuniform sampler2D tShadow;\nuniform float darkness;\nvarying vec2 vUv;\nvoid main() {\n  float shadowVal = texture2D(tShadow, vUv).r;\n  // RT has white background (1.0) and black objects (0.0)\n  // Invert: black â†’ high shadow alpha, white â†’ no shadow\n  float shadowAlpha = (1.0 - shadowVal) * darkness;\n  gl_FragColor = vec4(0.0, 0.0, 0.0, shadowAlpha);\n}\n",transparent:!0,depthWrite:!1});af=new Ue.Mesh(n,s),af.position.set(e.center.x,cf+.02,e.center.z),af.renderOrder=-1,nf=new Ue.Group,nf.name="__contactShadows",nf.add(af);const c=St();c&&c.add(nf)}(t),function(){null==sf||sf.dispose(),null==rf||rf.dispose(),sf=new Ue.ShaderMaterial({uniforms:Ue.UniformsUtils.clone(Ca.uniforms),vertexShader:Ca.vertexShader,fragmentShader:Ca.fragmentShader}),rf=new Ue.ShaderMaterial({uniforms:Ue.UniformsUtils.clone($a.uniforms),vertexShader:$a.vertexShader,fragmentShader:$a.fragmentShader});const e=new Ue.PlaneGeometry(2,2);lf=new Ue.Mesh(e,sf)}(),bf=!0,Nv=!0},updateContactShadows(){!Nv||"off"===Hv||bf&&(bf=!1,S6())},markDirty(){bf=!0},setQuality(e){if(e===Hv)return;if(Hv=e,"off"===e)return void(nf&&(nf.visible=!1));nf&&(nf.visible=!0);if(wp(xp(e)),af){af.material.uniforms.tShadow.value=Kv.texture}bf=!0},setDarkness(e){if(uf=Math.max(0,Math.min(1,e)),af){af.material.uniforms.darkness.value=uf}},cleanupContactShadows(){var e;nf&&(nf.removeFromParent(),null==af||af.geometry.dispose(),null==(e=null==af?void 0:af.material)||e.dispose(),nf=null,af=null),null==Kv||Kv.dispose(),null==ef||ef.dispose(),Kv=null,ef=null,tf=null,null==sf||sf.dispose(),null==rf||rf.dispose(),sf=null,rf=null,null==lf||lf.geometry.dispose(),lf=null,Nv=!1,Hv="off",bf=!0},get initialized(){return Nv},get quality(){return Hv}}}const mf=.98,hf=.075;let xf=!1;const yf=[];let wf=null,kf=null,Sf=null,Cf=null;const $f=t("idle");let Mf=null,Tf=null,Vf=null,Af=null,Pf=hf;const zf=[];let Df=null,Of=null,Rf=0;function ay(){if(kf)return;const e=function(e=256){if(Sf)return Sf;const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d");o.fillStyle="rgb(128, 128, 255)",o.fillRect(0,0,e,e),o.strokeStyle="rgb(180, 80, 255)",o.lineWidth=5;const n=.08*e;for(let t=-e;t<2*e;t+=10)o.beginPath(),o.moveTo(t,0),o.lineTo(t+n,e),o.stroke();o.strokeStyle="rgb(100, 160, 255)",o.lineWidth=3;for(let t=-e;t<2*e;t+=10)o.beginPath(),o.moveTo(t+5,0),o.lineTo(t+5+n,e),o.stroke();return Sf=new Ue.CanvasTexture(t),Sf.wrapS=Sf.wrapT=Ue.RepeatWrapping,Sf.repeat.set(6,1),Sf.needsUpdate=!0,Sf}(),t=function(e=256){if(Cf)return Cf;const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d");o.fillStyle="rgb(180, 180, 180)",o.fillRect(0,0,e,e);const n=.08*e;o.strokeStyle="rgb(120, 120, 120)",o.lineWidth=5;for(let t=-e;t<2*e;t+=10)o.beginPath(),o.moveTo(t,0),o.lineTo(t+n,e),o.stroke();return Cf=new Ue.CanvasTexture(t),Cf.wrapS=Cf.wrapT=Ue.RepeatWrapping,Cf.repeat.set(6,1),Cf.needsUpdate=!0,Cf}();kf=new Ue.MeshStandardMaterial({color:2763306,roughness:.65,metalness:.15,normalMap:e,normalScale:new Ue.Vector2(2,2),roughnessMap:t,side:Ue.DoubleSide})}function oy(e,t,o,n){const s=e.getAttribute("position"),c=e.getAttribute("normal"),u=e.getAttribute("uv");if(!s||!c||!u)return;const p=t/n,v=Math.max(4,Math.round(33*p)),f=.14*o;for(let e=0;e<s.count;e++){const t=u.getX(e),o=Math.sin(t*v*Math.PI*2)*f,n=c.getX(e),p=c.getY(e),g=c.getZ(e);s.setX(e,s.getX(e)+n*o),s.setY(e,s.getY(e)+p*o),s.setZ(e,s.getZ(e)+g*o)}s.needsUpdate=!0,e.computeVertexNormals()}function O6(e,t,o,n){const s=Math.min(t,.05)/3,c=-9.81*n*s*s,u=e.config.radius*n;for(let t=0;t<3;t++){for(let t=0;t<e.particles.length;t++){if(e.pinMask[t])continue;const o=e.particles[t],n=e.prevPositions[t],s=(o.x-n.x)*mf,u=(o.y-n.y)*mf,p=(o.z-n.z)*mf;n.copy(o),o.x+=s,o.y+=u+c,o.z+=p}for(let t=0;t<3;t++)for(let t=0;t<e.restLengths.length;t++){const o=e.particles[t],n=e.particles[t+1],s=e.restLengths[t],c=n.x-o.x,u=n.y-o.y,p=n.z-o.z,v=Math.sqrt(c*c+u*u+p*p);if(v<1e-4)continue;const f=(v-s)/v,g=e.pinMask[t],b=e.pinMask[t+1];if(!g||!b)if(g)n.x-=c*f,n.y-=u*f,n.z-=p*f;else if(b)o.x+=c*f,o.y+=u*f,o.z+=p*f;else{const e=.5*f;o.x+=c*e,o.y+=u*e,o.z+=p*e,n.x-=c*e,n.y-=u*e,n.z-=p*e}}const t=o+u;for(let o=0;o<e.particles.length;o++)e.pinMask[o]||e.particles[o].y<t&&(e.particles[o].y=t)}}function Cp(e,t){e.mesh&&e.mesh.geometry.dispose(),e.curve=new Ue.CatmullRomCurve3(e.particles,!1,"catmullrom",.5);const o=e.config.radius*t,n=e.curve.getLength(),s=Math.max(4,Math.round(n/t*33)),c=Math.max(3*s,6*e.particles.length,24),u=new Ue.TubeGeometry(e.curve,c,o,8,!1);oy(u,n,o,t),e.mesh?e.mesh.geometry=u:(ay(),e.mesh=new Ue.Mesh(u,kf),e.mesh.name=`__duct_${e.id}`,e.mesh.frustumCulled=!1,e.mesh.userData.skipContactShadow=!0,e.mesh.userData.ductId=e.id,wf&&wf.add(e.mesh))}function Tp(){Df&&(Df.removeFromParent(),Df.geometry.dispose(),Df=null)}function I6(){return{initDucting(){if(xf)return;const e=St();e&&(wf=new Ue.Group,wf.name="__ducting",e.add(wf),xf=!0)},updateDucts(e,t,o){if(xf&&0!==yf.length){for(const n of yf)O6(n,e,t,o);if(Rf++,Rf%2==0)for(const e of yf)Cp(e,o)}},createDuct(e,t,o,n){e.radius>.4&&n>1&&(e.radius=e.radius/n);const s=Math.max(3*e.radius,.15)*n,c=[t.clone()];if(e.startNormal){const o=new Ue.Vector3(e.startNormal.x,e.startNormal.y,e.startNormal.z).normalize();c.push(t.clone().add(o.multiplyScalar(s)))}for(const t of e.anchorPoints)c.push(new Ue.Vector3(t.position.x,t.position.y,t.position.z));if(e.endNormal&&"__freeEnd"!==e.endObjectId){const t=new Ue.Vector3(e.endNormal.x,e.endNormal.y,e.endNormal.z).normalize();c.push(o.clone().add(t.multiplyScalar(s)))}c.push(o.clone());const{particles:u,prevPositions:p,pinMask:v,restLengths:f}=function(e,t){const o=[],n=[];for(let s=0;s<e.length-1;s++){const c=e[s],u=e[s+1],p=s===e.length-2?t+1:t;for(let e=0;e<p;e++){const s=e/t,p=(new Ue.Vector3).lerpVectors(c,u,s);o.push(p),n.push(0===e)}}n.length>0&&(n[n.length-1]=!0);const s=[];for(let e=0;e<o.length-1;e++)s.push(o[e].distanceTo(o[e+1]));const c=o.map(e=>e.clone());return{particles:o,prevPositions:c,pinMask:n,restLengths:s}}(c,e.particlesPerSegment),g={id:e.id,config:e,particles:u,prevPositions:p,pinMask:v,mesh:null,curve:new Ue.CatmullRomCurve3(u),restLengths:f};return yf.push(g),Cp(g,n),g},removeDuct(e){const t=yf.findIndex(t=>t.id===e);if(-1===t)return;const o=yf[t];o.mesh&&(o.mesh.geometry.dispose(),o.mesh.removeFromParent()),yf.splice(t,1)},getDuctIdFromMesh(e){var t;let o=e;for(let e=0;e<4&&o;e++){if(null==(t=o.userData)?void 0:t.ductId)return o.userData.ductId;o=o.parent}return null},updatePins(e,t,o){const n=yf.find(t=>t.id===e);if(n&&(t&&n.particles.length>0&&(n.particles[0].copy(t),n.prevPositions[0].copy(t)),o&&n.particles.length>0)){const e=n.particles.length-1;n.particles[e].copy(o),n.prevPositions[e].copy(o)}},startConnecting(e,t,o,n,s){$f.value="connecting",Mf=e,Tf=t,Vf=o.clone(),Af=s?s.clone():null,Pf=null!=n?n:hf,zf.length=0},addAnchor(e,t){"connecting"===$f.value&&zf.push({position:e.clone(),normal:t.clone()})},completeConnection(e,t,o,n,s){if("connecting"!==$f.value||!Mf||!Tf||!Vf)return this.cancelConnection(),null;if(e===Mf&&t===Tf)return this.cancelConnection(),null;const c={id:`duct-${Date.now()}`,startObjectId:Mf,startPointId:Tf,endObjectId:e,endPointId:t,anchorPoints:zf.map(e=>({position:{x:e.position.x,y:e.position.y,z:e.position.z},normal:{x:e.normal.x,y:e.normal.y,z:e.normal.z}})),radius:Pf,particlesPerSegment:8,startNormal:Af?{x:Af.x,y:Af.y,z:Af.z}:void 0,endNormal:s?{x:s.x,y:s.y,z:s.z}:void 0};return this.createDuct(c,Vf,o,n),this.cancelConnection(),c},completeConnectionFreeEnd(e,t,o){if("connecting"!==$f.value||!Mf||!Tf||!Vf)return this.cancelConnection(),null;if(0===zf.length&&Vf.distanceTo(e)<.2*o)return null;const n={id:`duct-${Date.now()}`,startObjectId:Mf,startPointId:Tf,endObjectId:"__freeEnd",endPointId:`free-${Date.now()}`,anchorPoints:zf.map(e=>({position:{x:e.position.x,y:e.position.y,z:e.position.z},normal:{x:e.normal.x,y:e.normal.y,z:e.normal.z}})),radius:Pf,particlesPerSegment:8,freeEndPos:{x:e.x,y:e.y,z:e.z},startNormal:Af?{x:Af.x,y:Af.y,z:Af.z}:void 0,endNormal:{x:t.x,y:t.y,z:t.z}};return this.createDuct(n,Vf,e,o),this.cancelConnection(),n},cancelConnection(){$f.value="idle",Mf=null,Tf=null,Vf=null,Af=null,Pf=hf,zf.length=0,Tp()},updatePreview(e,t,o){"connecting"!==$f.value||!Vf||function(e,t){const o=St();if(!o||!Vf)return;const n=Math.max(3*Pf,.15)*t,s=[Vf];Af&&s.push(Vf.clone().add(Af.clone().normalize().multiplyScalar(n)));for(const e of zf)s.push(e.position);if(s.push(e),s.length<2||2===s.length&&Vf.distanceTo(e)<.1*t)return;const c=new Ue.CatmullRomCurve3(s,!1,"catmullrom",.5),u=Pf*t,p=c.getLength(),v=Math.max(4,Math.round(p/t*33)),f=Math.max(3*v,6*s.length,24),g=new Ue.TubeGeometry(c,f,u,8,!1);oy(g,p,u,t),Of||(ay(),Of=kf.clone(),Of.transparent=!0,Of.opacity=.6,Of.depthWrite=!1),Df?(Df.geometry.dispose(),Df.geometry=g):(Df=new Ue.Mesh(g,Of),Df.name="__ductPreview",Df.userData.skipContactShadow=!0,Df.frustumCulled=!1,o.add(Df))}(e,t||1)},getAllConfigs:()=>yf.map(e=>({...e.config})),cleanupDucting(){for(const e of yf)e.mesh&&(e.mesh.geometry.dispose(),e.mesh.removeFromParent());yf.length=0,Tp(),null==Of||Of.dispose(),Of=null,wf&&(wf.removeFromParent(),wf=null),null==kf||kf.dispose(),null==Sf||Sf.dispose(),null==Cf||Cf.dispose(),kf=null,Sf=null,Cf=null,xf=!1,$f.value="idle",Mf=null,Tf=null,Vf=null,Af=null,Pf=hf,zf.length=0,Rf=0},get connectionState(){return $f.value},get ducts(){return yf},get initialized(){return xf},get anchorCount(){return zf.length},getLastAnchorPos:()=>0===zf.length?null:zf[zf.length-1].position,getStartPos:()=>Vf,undoLastAnchor:()=>"connecting"===$f.value&&0!==zf.length&&(zf.pop(),!0),editDuct(e,t){const o=yf.findIndex(t=>t.id===e);if(-1===o)return!1;const n=yf[o],s=n.config,c=t(s.startObjectId,s.startPointId);if(!c)return!1;n.mesh&&(n.mesh.geometry.dispose(),n.mesh.removeFromParent()),yf.splice(o,1),$f.value="connecting",Mf=s.startObjectId,Tf=s.startPointId,Vf=c,Af=s.startNormal?new Ue.Vector3(s.startNormal.x,s.startNormal.y,s.startNormal.z):null,Pf=s.radius,zf.length=0;for(const e of s.anchorPoints)zf.push({position:new Ue.Vector3(e.position.x,e.position.y,e.position.z),normal:new Ue.Vector3(e.normal.x,e.normal.y,e.normal.z)});return!0}}}let If=!1,jf=!1,_f=!1,Lf=1,Bf=null,Ef=null,Uf=null,Wf=null,Nf=0;const Hf=-Math.PI/7;let Gf=!1,qf=0;let Kf=null,Yf=null;const Jf=[],Qf=new Ue.Object3D,Xf=new Ue.Color(4491468),eg=new Ue.Color(11193582);let tg=null,ag=-1,og="";const ng=new Ue.Color(9198120),lg=new Ue.Color(4204048),ig=new Ue.Vector3,sg=new Ue.Vector3,rg=new Ue.Vector3(0,-.5,-.87),dg=new Ue.Vector3,cg=new Ue.Vector3,ug=new Ue.Vector3,pg=new Ue.Raycaster,vg=new Ue.Vector2(0,0);function sy(e,t,o=!1){for(const n of Jf)if(!n.alive)return n.alive=!0,n.position.copy(e),n.velocity.copy(t),n.lifetime=0,n.maxLifetime=o?.3:1.5,void(n.isSplash=o)}function wv(e){var t,o;return(null==(t=e.tags)?void 0:t.includes("pot"))||"pot"===(null==(o=e.behavior)?void 0:o.type)||e.assetFile&&/pot|planter|bucket|container/i.test(e.assetFile)}function kv(e){const t=[];return e.traverse(e=>{e.isMesh&&/soil|dirt|earth|substrate/i.test(e.name)&&t.push(e)}),t}function Zn(e){var t,o;return null!=(o=null==(t=e.properties)?void 0:t.moisture)?o:.3}function Sv(e,t){e.properties||(e.properties={}),e.properties.moisture=Math.max(0,Math.min(1,t))}function Cv(e,t){const o=Math.max(0,Math.min(1,t));for(const t of e){const e=t.material;e.color&&(e.color.lerpColors(ng,lg,o),e.roughness=1-.4*o,e.needsUpdate=!0)}}function Y6(e,t,o){const n=.5*t;for(const t of Ne){if(!wv(t))continue;const s=e.x-t.group.position.x,c=e.z-t.group.position.z;if(Math.sqrt(s*s+c*c)<n){Sv(t,Zn(t)+.15*o*3);Cv(kv(t.group),Zn(t));break}}}function Vp(){Bf&&(Bf.removeFromParent(),Bf.visible=!1)}function Q6(e,t,o){if(!Bf)return;if(Gf)return Lf=Math.min(qf,Lf+1*e),Lf>=qf&&(Gf=!1),Nf+=(0-Nf)*Math.min(1,4*e),void(Bf.rotation.x=Nf);if(Nf+=((_f&&Lf>0?Hf:0)-Nf)*Math.min(1,4*e),Bf.rotation.x=Nf,_f&&Lf>0){Lf=Math.max(0,Lf-.06*e);const t=Vt();if(t&&Bf.parent===t){sg.copy(ig),Bf.localToWorld(sg),dg.copy(rg).transformDirection(Bf.matrixWorld).normalize();const e=3+Math.floor(3*Math.random()),t=.08*o*.15,n=Math.PI/12;for(let s=0;s<e;s++){const e=Math.random()*Math.PI*2,s=Math.random()*t,c=new Ue.Vector3(0,1,0),u=(new Ue.Vector3).crossVectors(dg,c).normalize();u.lengthSq()<.01&&u.set(1,0,0);const p=(new Ue.Vector3).crossVectors(dg,u).normalize();ug.copy(sg).addScaledVector(u,Math.cos(e)*s).addScaledVector(p,Math.sin(e)*s);const v=(Math.random()-.5)*n*2,f=(Math.random()-.5)*n*2;cg.copy(dg).addScaledVector(u,Math.sin(v)).addScaledVector(p,Math.sin(f)).normalize().multiplyScalar(1.2*o+.5*Math.random()*o),sy(ug,cg)}}if(tg){const t=Ne.find(e=>e.group===tg.group);if(t){Sv(t,Zn(t)+.15*e),Cv(tg.soilMeshes,Zn(t)),ag=Zn(t)}}}!function(e,t,o){if(!Kf)return;const n=-9.81*o;let s=!1;for(let c=0;c<Jf.length;c++){const u=Jf[c];if(!u.alive)continue;if(u.lifetime+=e,u.lifetime>u.maxLifetime){u.alive=!1,Qf.scale.setScalar(0),Qf.updateMatrix(),Kf.setMatrixAt(c,Qf.matrix),s=!0;continue}if(u.velocity.y+=n*e,u.position.addScaledVector(u.velocity,e),u.position.y<t+.01*o){if(u.position.y=t+.01*o,u.alive=!1,Y6(u.position,o,e),!u.isSplash)for(let e=0;e<2;e++)cg.set(.8*(Math.random()-.5)*o,1.2*Math.random()*o,.8*(Math.random()-.5)*o),sy(u.position,cg,!0);Qf.scale.setScalar(0),Qf.updateMatrix(),Kf.setMatrixAt(c,Qf.matrix),s=!0;continue}const p=u.isSplash?.5+.5*(1-u.lifetime/u.maxLifetime):1;Qf.position.copy(u.position),Qf.scale.setScalar(p*o),Qf.updateMatrix(),Kf.setMatrixAt(c,Qf.matrix);const v=u.isSplash?eg:Xf;Kf.setColorAt(c,v),s=!0}s&&(Kf.instanceMatrix.needsUpdate=!0,Kf.instanceColor&&(Kf.instanceColor.needsUpdate=!0))}(e,t,o)}function _6(e){var t,o;return(null==(t=e.tags)?void 0:t.includes("water_source"))||"water_source"===(null==(o=e.behavior)?void 0:o.type)||e.assetFile&&/tap|faucet|sink|reservoir|barrel/i.test(e.assetFile)}let fg=0;let gg=0;function aS(){return{initWatering(e){If||(Bf=function(e){const t=.15*e,o=new Ue.Group;o.name="__wateringCan",Uf=new Ue.MeshStandardMaterial({color:2981190,roughness:.5,metalness:.3}),Wf=new Ue.MeshStandardMaterial({color:3841368,roughness:.4,metalness:.4});const n=new Ue.CylinderGeometry(.35*t,.5*t,.7*t,12),s=new Ue.Mesh(n,Uf);s.position.y=.35*t,s.castShadow=!1,s.receiveShadow=!1,o.add(s);const c=new Ue.CatmullRomCurve3([new Ue.Vector3(0,.25*t,-.4*t),new Ue.Vector3(0,.15*t,-.8*t),new Ue.Vector3(0,.55*t,-1.1*t)],!1,"catmullrom",.5),u=new Ue.TubeGeometry(c,12,.06*t,8,!1),p=new Ue.Mesh(u,Wf);p.castShadow=!1,o.add(p);const v=new Ue.SphereGeometry(.1*t,8,6,0,2*Math.PI,0,Math.PI/2);Ef=new Ue.Mesh(v,Wf);const f=c.getPoint(1);Ef.position.copy(f),Ef.rotation.x=-Math.PI/4,o.add(Ef),ig.copy(f);const g=new Ue.TorusGeometry(.3*t,.05*t,6,12,Math.PI),b=new Ue.Mesh(g,Uf);return b.position.set(0,.75*t,.1*t),b.rotation.x=Math.PI/2,b.rotation.z=Math.PI,b.castShadow=!1,o.add(b),o.userData.skipContactShadow=!0,o.traverse(e=>{e.frustumCulled=!1}),o}(e),Bf.visible=!1,function(){if(Kf)return;const e=new Ue.SphereGeometry(.008,6,4);Yf=new Ue.MeshStandardMaterial({color:4491468,roughness:.1,transparent:!0,opacity:.7}),Kf=new Ue.InstancedMesh(e,Yf,50),Kf.name="__waterDroplets",Kf.frustumCulled=!1,Kf.userData.skipContactShadow=!0,Qf.scale.setScalar(0),Qf.updateMatrix();for(let e=0;e<50;e++)Kf.setMatrixAt(e,Qf.matrix),Jf.push({alive:!1,position:new Ue.Vector3,velocity:new Ue.Vector3,lifetime:0,maxLifetime:1.5,isSplash:!1});Kf.instanceMatrix.needsUpdate=!0;const t=St();t&&t.add(Kf)}(),fg=performance.now()/1e3,If=!0)},updateWatering(e,t,o){if(!If)return;const n=performance.now()/1e3;if(n-fg>60){(function(e){for(const t of Ne){if(!wv(t))continue;const o=Zn(t);o>0&&(Sv(t,o-.04*e),Cv(kv(t.group),Zn(t)))}})((n-fg)/3600),fg=n}jf&&(++gg%5==0&&function(){const e=Vt();if(!e||!jf)return tg=null,ag=-1,void(og="");pg.setFromCamera(vg,e),pg.far=Math.max(8,8*Ye);let t=1/0,o=null;for(const e of Ne){if(!wv(e))continue;const n=pg.intersectObject(e.group,!0);n.length>0&&n[0].distance<t&&(t=n[0].distance,o=e)}o?(tg={group:o.group,soilMeshes:kv(o.group)},ag=Zn(o),og=o.name||"Pot"):(tg=null,ag=-1,og="")}(),Q6(e,t,o))},activate(){!If||jf||(jf=!0,function(){const e=Vt();!e||!Bf||(Bf.position.set(.35,-.45,-.5),Bf.rotation.set(0,0,0),e.add(Bf),Bf.visible=!0)}())},deactivate(){jf=!1,_f=!1,Gf=!1,Nf=0,Bf&&Bf.rotation.set(0,0,0),Vp()},startPour(){jf&&Lf>0&&!Gf&&(_f=!0)},stopPour(){_f=!1},tryRefill:()=>!!jf&&function(){const e=Vt();if(!e)return!1;pg.setFromCamera(vg,e),pg.far=Math.max(4,4*Ye);for(const e of Ne)if(_6(e)&&pg.intersectObject(e.group,!0).length>0)return Gf=!0,qf=1,!0;return!1}(),getState:()=>({active:jf,pouring:_f,waterLevel:Lf,aimedPotMoisture:ag,aimedPotName:og,refilling:Gf}),cleanupWatering(){Vp(),Bf&&(Bf.traverse(e=>{e.geometry&&e.geometry.dispose()}),Bf=null),null==Uf||Uf.dispose(),null==Wf||Wf.dispose(),Uf=null,Wf=null,Ef=null,Kf&&(Kf.geometry.dispose(),Kf.removeFromParent(),Kf=null),null==Yf||Yf.dispose(),Yf=null,Jf.length=0,jf=!1,_f=!1,Gf=!1,Lf=1,Nf=0,tg=null,ag=-1,og="",If=!1,fg=0,gg=0},get active(){return jf},get pouring(){return _f},get waterLevel(){return Lf},get initialized(){return If}}}let bg=null,mg=null,hg=null,xg=null,yg=!1,wg=!0,kg=null,Sg=null,Cg=null;let $g=!1,Mg=!0,Tg=null,Vg=null,Ag=null;const Pg=new Map;function sS(){Tg=function(e=128){const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d"),n=e/2,s=o.createRadialGradient(n,n,0,n,n,n);s.addColorStop(0,"rgba(255, 255, 255, 1.0)"),s.addColorStop(.15,"rgba(255, 255, 240, 0.8)"),s.addColorStop(.4,"rgba(255, 240, 200, 0.3)"),s.addColorStop(.7,"rgba(255, 220, 150, 0.08)"),s.addColorStop(1,"rgba(255, 200, 100, 0.0)"),o.fillStyle=s,o.fillRect(0,0,e,e);const c=new Ue.CanvasTexture(t);return c.needsUpdate=!0,c}(),Vg=function(e=64){const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d"),n=e/2,s=o.createRadialGradient(n,n,.5*n,n,n,.8*n);s.addColorStop(0,"rgba(200, 220, 255, 0.0)"),s.addColorStop(.4,"rgba(200, 220, 255, 0.05)"),s.addColorStop(.6,"rgba(180, 200, 255, 0.15)"),s.addColorStop(.8,"rgba(150, 180, 255, 0.05)"),s.addColorStop(1,"rgba(150, 180, 255, 0.0)"),o.fillStyle=s,o.fillRect(0,0,e,e);const c=new Ue.CanvasTexture(t);return c.needsUpdate=!0,c}(),Ag=function(e=32){const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d"),n=e/2,s=.7*n;o.beginPath();for(let e=0;e<6;e++){const t=Math.PI/3*e-Math.PI/6,c=n+s*Math.cos(t),u=n+s*Math.sin(t);0===e?o.moveTo(c,u):o.lineTo(c,u)}o.closePath();const c=o.createRadialGradient(n,n,0,n,n,s);c.addColorStop(0,"rgba(180, 200, 255, 0.15)"),c.addColorStop(.6,"rgba(150, 180, 255, 0.08)"),c.addColorStop(1,"rgba(120, 150, 255, 0.0)"),o.fillStyle=c,o.fill();const u=new Ue.CanvasTexture(t);return u.needsUpdate=!0,u}()}function Dp(e){const t=new Pa,o=Math.min(Math.max(e.intensity/5,.3),2),n=e.color;return Tg&&t.addElement(new za(Tg,200*o,0,n)),Vg&&(t.addElement(new za(Vg,300*o,.3)),t.addElement(new za(Vg,150*o,.6))),Ag&&(t.addElement(new za(Ag,60*o,.15)),t.addElement(new za(Ag,90*o,.45)),t.addElement(new za(Ag,40*o,.75))),t}let zg=!1,Dg=!0,Og=1e3,Ig=null,Fg=null,_g=null,Lg=null,Bg=null,Eg=null,Wg=null,Ng=null,Hg=new Ue.Vector3(-10,0,-10),Gg=new Ue.Vector3(10,5,10),qg=0;function Zu(e,t,o){return.3*Math.sin(1.27*e+.63*t+.91*o+.3*qg)+.2*Math.sin(.51*e+1.13*t+.37*o+.5*qg)+.15*Math.sin(.83*e+.41*t+1.59*o+.2*qg)}function Rp(e){Bg=new Float32Array(3*e),Eg=new Float32Array(3*e),Wg=new Float32Array(e),Ng=new Float32Array(e);const t=Gg.x-Hg.x,o=Gg.y-Hg.y,n=Gg.z-Hg.z;for(let s=0;s<e;s++){const e=3*s;Bg[e]=Hg.x+Math.random()*t,Bg[e+1]=Hg.y+Math.random()*o,Bg[e+2]=Hg.z+Math.random()*n,Eg[e]=.02*(Math.random()-.5),Eg[e+1]=.01*(Math.random()-.5),Eg[e+2]=.02*(Math.random()-.5),Wg[s]=.05+.1*Math.random(),Ng[s]=2+4*Math.random()}}function Op(){Lg=function(e=32){const t=(void 0).createElement("canvas");t.width=e,t.height=e;const o=t.getContext("2d"),n=e/2,s=o.createRadialGradient(n,n,0,n,n,n);s.addColorStop(0,"rgba(255, 255, 255, 1.0)"),s.addColorStop(.3,"rgba(255, 255, 240, 0.6)"),s.addColorStop(.6,"rgba(255, 250, 230, 0.2)"),s.addColorStop(1,"rgba(255, 250, 230, 0.0)"),o.fillStyle=s,o.fillRect(0,0,e,e);const c=new Ue.CanvasTexture(t);return c.needsUpdate=!0,c}(),Fg=new Ue.BufferGeometry,Fg.setAttribute("position",new Ue.BufferAttribute(Bg,3)),Fg.setAttribute("aOpacity",new Ue.BufferAttribute(Wg,1)),Fg.setAttribute("aSize",new Ue.BufferAttribute(Ng,1)),_g=new Ue.ShaderMaterial({uniforms:{uTexture:{value:Lg}},vertexShader:"\n  attribute float aOpacity;\n  attribute float aSize;\n  varying float vOpacity;\n\n  void main() {\n    vOpacity = aOpacity;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = aSize * (300.0 / -mvPosition.z);\n    gl_PointSize = clamp(gl_PointSize, 1.0, 20.0);\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  uniform sampler2D uTexture;\n  varying float vOpacity;\n\n  void main() {\n    vec4 texColor = texture2D(uTexture, gl_PointCoord);\n    gl_FragColor = vec4(texColor.rgb, texColor.a * vOpacity);\n    if (gl_FragColor.a < 0.01) discard;\n  }\n",transparent:!0,depthWrite:!1,blending:Ue.AdditiveBlending}),Ig=new Ue.Points(Fg,_g),Ig.name="__dustParticles",Ig.frustumCulled=!1,Ig.renderOrder=10;const e=St();e&&e.add(Ig)}const Kg=new Ue.Vector3;function vS(){const e=ia(),t=sa(),n=ra(),s=Da(),{getSocketDisplayName:c}=la(),u=o(()=>{const o=[];for(let t=1;t<=5;t++){const n=`O${t}`,u=e.states[n];if(!u)continue;const p=s.isSocketAiEnabled(n),v=p?7:u.modeType;o.push({id:n,type:"socket",label:`Socket ${t}`,displayName:c(n,"name-only"),modeType:v,modeName:p?"Trigger":e.getModeName(u.modeType),isOn:u.isOn,canDirectControl:0===u.modeType||p,toggle:()=>e.toggleSocket(n)})}if(!e.isLight1Disabled){const e=t.states.light;e&&o.push({id:"light",type:"light",label:"Light 1",displayName:"Light 1",modeType:e.modeType,modeName:t.getModeName(e.modeType),isOn:e.isOn,canDirectControl:0===e.modeType,toggle:()=>t.toggleLight("light")})}if(!e.isLight2Disabled){const e=t.states.light2;e&&o.push({id:"light2",type:"light",label:"Light 2",displayName:"Light 2",modeType:e.modeType,modeName:t.getModeName(e.modeType),isOn:e.isOn,canDirectControl:0===e.modeType,toggle:()=>t.toggleLight("light2")})}if(n.loaded){const e=s.isBlowerAiEnabled;o.push({id:"blower",type:"blower",label:"Blower",displayName:"Blower",modeType:e?99:n.modeType,modeName:e?"Trigger":0===n.modeType?"Manual":"Scheduled",isOn:n.on,canDirectControl:0===n.modeType||e,toggle:async()=>{n.setPendingOn(!n.on),await n.save()}})}return o});return{channels:u,getChannel:function(e){return u.value.find(t=>t.id===e)},fetchAllStates:async function(){await Promise.all([e.fetchStates(),t.fetchStates(),n.fetchIfNeeded(),s.fetchSocketAiModes(),s.fetchBlowerAiMode()])}}}const Yg=e({__name:"room3d",__ssrInlineRender:!0,setup(e){var h,x;Ue.Cache.enabled=!0;const S=t(!1),$=t(0),M=t(!1),T=t("existing"),V=t(""),O=t(""),j=t(null);t(null);const le=t(!1),Oe=t(!1),Re=t(0),Ie=t(null);t(),t();const je=o(()=>We.filter(e=>e.file).map(e=>({file:e.file,name:e.name,image:e.image,size:e.size||"",source:e.source||"system"})));const Fe=t(!1);function P$1(){Fe.value=!0}async function R(e,t){const o=Math.max(-Math.PI/2,Math.min(Math.PI/2,t.rotation.x));Bt.saveRoomSpawn(e,{x:t.position.x,y:zt,z:t.position.z,yaw:t.rotation.y,pitch:o});try{const o=Ct();if(!o)return;const n=St();if(!n)return;o.render(n,t);const s=o.domElement.toDataURL("image/webp",.8),c=await(await fetch(s)).blob(),u=new File([c],`${e}.webp`,{type:"image/webp"}),p=new FormData;p.append("file",u);const v=We.find(t=>t.id===e);p.append("isAdmin",String("system"===(null==v?void 0:v.source)));const f=No(),g=await $fetch("/api/room3d/room-upload",{method:"POST",body:p,headers:f});(null==g?void 0:g.path)&&v&&(await $fetch("/api/room3d/rooms",{method:"POST",headers:f,body:{id:e,name:v.name,description:v.description,file:v.file,size:v.size,icon:"CubeIcon",image:g.path,source:v.source,update:!0}}),v.image=`${g.path}?t=${Date.now()}`)}catch{}}function H$1(e){var t;null==(t=ea.rotatingObject.value)||t.rotateY(e*Math.PI/24)}function q$1(e){var t;null==(t=ea.rotatingObject.value)||t.rotateX(e*Math.PI/24)}function B$1(e){const t=ea.rotatingObject.value;if(!t)return;t.scale.multiplyScalar(e);const o=Ne.find(e=>e.group===t);o&&(o.scale=t.scale.x)}function K$1(e){"floor"===xa.calibrationStep.value?xa.updateFloorCalibration(e):xa.updateScaleCalibration(e)}function ae(e){const t=po.value;(null==t?void 0:t._inst)&&$a.pressButtonByIndex(t._inst,e)}const _e=t(!1),Le=t(""),tt=t(""),nt=t(!1),lt=t(!1),kt=t(!1),Mt=t(!1),Dt=t(!0),Ot=t(""),Rt=t(""),It=t("");function Y(){var e;if(!wo.value)return;Le.value=wo.value.name,tt.value=wo.value.description,nt.value=wo.value.animated||!1,lt.value=wo.value.hidden||!1;const t=Xo.getSettings(wo.value.id);Mt.value=t.isPublic||!1,Dt.value=null==(e=t.inviteOnly)||e,Ot.value=t.password||"",Rt.value=t.publicName||"",It.value=t.publicDescription||"",_e.value=!0}const Ft=o(()=>wo.value&&Bt.roomHiddenMeshes.value[wo.value.id]||[]);function gt(){if(!wo.value)return;const e=ya.confirmEdit();Bt.saveRoomHiddenMeshes(wo.value.id,e.hidden),Bt.saveRoomMeshSimplifications(wo.value.id,e.ratios),dt()}function st(){ya.cancelEdit();const e=qe();(null==e?void 0:e.isLocked)&&e.unlock(),Ge.value=!1,Y()}const _t=Zt(),Lt={calibratingCharacter:gr,calibratingCharacterFile:br,characterCalibration:mr,calAppliedAll:hr,setRemotePlayerManager:d8,loadCharacterCalibration:um,startCharacterCalibration:f8,updateCalibrationPreview:v8,closeCharacterCalibration:g8,cancelCharacterCalibration:vm,applyCalibrationToAll:u8,updateCalibrationMixer:p8},Bt=Bc(),ea={setPlacementCallbacks:$8,placingAsset:Xr,ghostValid:ad,showScaleSaved:od,locked:Ge,rotatingObject:Pd,radialTarget:jd,radialTargetName:Fd,getGhostRotation:X8,setGhostRotation:J8,getGhostTilt:Q8,setGhostTilt:_8,getGhostRoll:e4,setGhostRoll:t4,getGhostObject:a4,isMovingObject:l4,startPlacing:O8,cancelPlacing:sv,placeObject:z8,undoLastPlaced:I8,redoLastPlaced:F8,canUndo:o4,canRedo:n4,historyCanUndo:zr.canUndo,historyCanRedo:zr.canRedo,updateGhostPosition:H8,scaleGhostUp:G8,scaleGhostDown:K8,saveCurrentScale:rv,nudgeGhostArrow:q8,nudgeGhostDepth:Y8,resetGhostNudge:Z8,deleteTargeted:E8,rotateTargeted:L8,confirmRotation:B8,cancelRotation:j8,moveTargeted:U8,duplicateTargeted:N8,toggleLockTargeted:W8,clearRadialTarget:xm},aa={moveState:Ld,nearbyObject:wc,nearbyName:kc,tryMove:Tm,isBlocked:Rr,getTargetedObject:Mm,updateProximity:M4,clearProximity:$4,updateMovement:A4,jump:V4,setTouchMoveInput:s4,getCameraTilt:P4,startFootsteps:Cm,stopFootsteps:uv,cleanupPhysics:D4,setRemotePlayerPositions:y4,buildOctree:x4,initPlayerCollider:w4,markOctreeDirty:h4,initDynamicGround:km,recalcStandHeight:m4},oa={playSfx:f2,playFile:v2,playFileReversed:g2,playHaptic:p2,setSfxVolume:b2,getSfxVolume:m2,cleanupAudio:y2},na={showRadial:mu,radialHover:hu,radialCharacterPicker:xu,radialRoomPicker:yu,radialDoorOptions:wu,showInventory:ku,showHelp:Su,showAddChannelModal:Cu},ia=ub(),sa={TV_CHANNELS:[],TV_CATEGORIES:[],tvScreens:[],tvWidgetDefs:$u,get tvInteractScreen(){return null},get tvConfigModeScreen(){return null},get tvHoverArea(){return null},get tvBrowseCategory(){return 0},get tvBrowsePage(){return 0},get tvUserOverrides(){return{added:[],removed:[],favorites:[],favoritesOnly:!1}},get shuffledChannelOrder(){return[]},isTVAsset:()=>!1,loadTVChannels:async()=>{},attachTVScreen:()=>{},detachTVScreen:()=>{},cleanupAllTVScreens:()=>{},rerenderTV:()=>{},toggleTvWidgetOnScreen:()=>{},updateTVChannelFrames:()=>{},tvClickHitTest:()=>null,renderBtnOverlay:()=>{},updateTVInteraction:()=>{},updateTVButtonScales:()=>{},setSaveRoomStateCallback:()=>{},setIsGuestRef:()=>{},getFilteredChannels:()=>[],getPageChannels:()=>[],getTotalPages:()=>1,setTvBrowseCategory:()=>{},setTvBrowsePage:()=>{},setTvConfigModeScreen:()=>{},setTvInteractScreen:()=>{},setTvHoverArea:()=>{},syncTVChannel:()=>{},saveTVUserOverrides:()=>{},generateShuffledOrder:()=>{},stopTVChannel:()=>{},purgeBrokenChannel:()=>{},setMobile:()=>{},startDistanceCheck:()=>{},stopDistanceCheck:()=>{},showVolumePanel:()=>{},hideVolumePanel:()=>{},get tvVolumeExpandedScreen(){return null},onFullscreenChange:()=>{},compensateExposure:()=>{}},ra=qt(),da=Kt(),va={isTouchDevice:t(!1),leftStick:{active:!1,x:0,y:0,magnitude:0,touchId:null,cx:0,cy:0,dx:0,dy:0},rightStick:{active:!1,x:0,y:0,magnitude:0,touchId:null,cx:0,cy:0,dx:0,dy:0},touchJump:t(!1),touchSprint:t(!1),isLandscape:t(!0),pinchScale:t(1),twoFingerRotation:t(0),tapPosition:t(null),attach:e=>{},detach:()=>{},updateTouchCamera:(e,t)=>{},requestLandscape:async()=>{},setPlacingMode:e=>{},consumeTap:()=>null,syncLeftHanded:()=>{},triggerJump:()=>{},toggleSprint:()=>{}},fa=h0(),ga=is(),ma=vS(),ha=Xb(),xa={calibratingRoom:Tu,calibrationStep:Au,calibSnapped:zu,calibFloorDisplay:Du,calibScaleDisplay:Ou,setRoomCalibrationCallbacks:Y4,startRoomCalibration:Z4,updateFloorCalibration:J4,confirmFloor:Q4,updateScaleCalibration:_4,confirmScale:ek,cancelCalibration:tk,cleanupCalibration:ak},ya={editingRoomMeshes:Qu,hoveredMeshIdx:Xu,hoveredMeshName:ep,hoveredMeshTris:ap,hiddenCount:tp,setMeshEditorOctreeCallback:lk,startMeshEditor:rk,updateHover:dk,handleClick:ck,handleWheel:ik,confirmEdit:uk,cancelEdit:zm,applyHiddenMeshes:fk,applyPerMeshSimplifications:sk,getMeshName:vk,restoreSingleMesh:gk,cleanupMeshEditor:pk},wa=j0(),ka=U0(),Ca={ensureCanvasFont:Hm,resolveFont:Wd,preloadZoneFonts:Gm,computeDisplayPolygonDims:Ym,renderDisplayZoneOn3D:hv,drawDisplayCanvas:_m,drawImageFit:Kd,startDisplayRefreshTimer:v6,stopDisplayRefreshTimer:ty,attachDisplayZones:g6,renderAllDisplayZones:p6,rebuildCameraStreams:()=>{yv(),Jm()},setDisplayZoneMobile:d6,clearImageCache:()=>Ov.clear()},$a=H0(),Pa={toggle:Sk,isActive:Mk,active:$p,setMode:Ck,getMode:Tk,toggleWireframe:Lm,isWireframe:$k,frameBegin:wk,frameEnd:kk,markBegin:hk,markEnd:xk,cleanup:Pk},za=T6(),Da={initPostProcessing(e,t,o,n,s,c=.95){kg=e,Sg=t,Cg=o,wg=n;const u=e.getSize(new Ue.Vector2);bg=new Ma(e),bg.setPixelRatio(e.getPixelRatio()),bg.setSize(u.x,u.y),mg=new Ta(t,o),bg.addPass(mg);const p=new Ue.Vector2(u.x,u.y);hg=new Va(p,s,.4,c),hg.enabled=n,bg.addPass(hg),xg=new Aa,bg.addPass(xg),yg=!0},render(){yg&&bg?bg.render():kg&&Sg&&Cg&&kg.render(Sg,Cg)},setSize(e,t){bg&&bg.setSize(e,t),hg&&hg.resolution.set(e,t)},setPixelRatio(e){null==bg||bg.setPixelRatio(e)},setBloomEnabled(e){wg=e,hg&&(hg.enabled=e)},setBloomParams(e,t,o){hg&&(null!=e&&(hg.strength=e),null!=t&&(hg.radius=t),null!=o&&(hg.threshold=o))},setEnabled(e){yg=e},setCamera(e){Cg=e,mg&&(mg.camera=e)},cleanupPostProcessing(){bg&&(bg.passes.forEach(e=>{"dispose"in e&&"function"==typeof e.dispose&&e.dispose()}),bg.dispose()),bg=null,mg=null,hg=null,xg=null,kg=null,Sg=null,Cg=null,yg=!1},get enabled(){return yg},get bloomEnabled(){return wg},get composer(){return bg}},Ra={initLensflare(){$g||(sS(),$g=!0)},attachFlareToLight(e){if(!$g||!Mg||Pg.has(e))return;const t=Dp(e);e.add(t),Pg.set(e,t)},removeFlareFromLight(e){const t=Pg.get(e);t&&(e.remove(t),t.dispose(),Pg.delete(e))},updateFlares(e){if(!$g)return;if(!Mg)return Pg.forEach((e,t)=>{t.remove(e),e.dispose()}),void Pg.clear();const t=new Set;e.forEach(e=>{if((e instanceof Ue.PointLight||e instanceof Ue.SpotLight)&&(t.add(e),!Pg.has(e))){const t=Dp(e);e.add(t),Pg.set(e,t)}});const o=[];Pg.forEach((e,n)=>{t.has(n)||(n.remove(e),e.dispose(),o.push(n))}),o.forEach(e=>Pg.delete(e))},setEnabled(e){Mg=e,Pg.forEach(t=>{t.visible=e})},cleanupLensflare(){Pg.forEach((e,t)=>{t.remove(e),e.dispose()}),Pg.clear(),null==Tg||Tg.dispose(),null==Vg||Vg.dispose(),null==Ag||Ag.dispose(),Tg=null,Vg=null,Ag=null,$g=!1,Mg=!0},get initialized(){return $g},get enabled(){return Mg},get flareLights(){return Pg}},Ia={initParticles(e,t,o){zg||(Hg.copy(e.min),Gg.copy(e.max),Og=t,Dg=o,Dg&&(Rp(Og),Op(),zg=!0))},updateParticles(e,t,o){if(!(zg&&Dg&&Bg&&Eg&&Wg&&Fg))return;const n=Math.min(e,.1);qg+=n;const s=[];o.forEach(e=>{(e instanceof Ue.PointLight||e instanceof Ue.SpotLight)&&s.push({pos:e.getWorldPosition(new Ue.Vector3),intensity:e.intensity})});const c=Fg.getAttribute("position"),u=Fg.getAttribute("aOpacity");for(let e=0;e<Og;e++){const o=3*e,c=Bg[o],u=Bg[o+1],p=Bg[o+2],v=Zu(.5*c,.5*u,.5*p),f=Zu(.5*c+100,.5*u+100,.5*p+100),g=Zu(.5*c+200,.5*u+200,.5*p+200);let b=Eg[o]+.003*v*n,h=Eg[o+1]+.002*f*n+.001*n,x=Eg[o+2]+.003*g*n;h-=5e-4*n,b*=.995,h*=.995,x*=.995,Eg[o]=b,Eg[o+1]=h,Eg[o+2]=x,Bg[o]=Bg[o]+b,Bg[o+1]=Bg[o+1]+h,Bg[o+2]=Bg[o+2]+x,Bg[o]<Hg.x?Bg[o]=Gg.x:Bg[o]>Gg.x&&(Bg[o]=Hg.x),Bg[o+1]<Hg.y?Bg[o+1]=Gg.y:Bg[o+1]>Gg.y&&(Bg[o+1]=Hg.y),Bg[o+2]<Hg.z?Bg[o+2]=Gg.z:Bg[o+2]>Gg.z&&(Bg[o+2]=Hg.z);let S=s.length>0?.03:.08;for(const e of s){Kg.set(Bg[o]-e.pos.x,Bg[o+1]-e.pos.y,Bg[o+2]-e.pos.z);const t=Kg.length();S+=.5*e.intensity/(1+t*t*.1)}Kg.set(Bg[o]-t.x,Bg[o+1]-t.y,Bg[o+2]-t.z);const $=Kg.length(),M=$<1?$:$>15?.02:1-($-1)/14*.98;Wg[e]=Math.min(.5,S)*M}c.needsUpdate=!0,u.needsUpdate=!0},setParticleCount(e){zg&&(Og=e,Ig&&(Ig.removeFromParent(),null==Fg||Fg.dispose(),null==_g||_g.dispose()),Rp(Og),Op())},setEnabled(e){Dg=e,Ig&&(Ig.visible=e)},cleanupParticles(){Ig&&Ig.removeFromParent(),null==Fg||Fg.dispose(),null==_g||_g.dispose(),null==Lg||Lg.dispose(),Ig=null,Fg=null,_g=null,Lg=null,Bg=null,Eg=null,Wg=null,Ng=null,zg=!1,Dg=!0,qg=0},get initialized(){return zg},get enabled(){return Dg}},ja=Yw(),_a=I6(),La=aS(),Ea=t(La.getState()),Ua=o(()=>La.active?"watering":"connecting"===_a.connectionState?"ducting":"none"),Na=o(()=>({waterLevel:Ea.value.waterLevel,anchorCount:_a.anchorCount})),Ha=t(!1);function rl(e){"off"===e?Pa.isActive()&&Pa.toggle():(Pa.setMode("simple"===e?"simple":"full"),Pa.isActive()||Pa.toggle())}const Ga=Oc(),qa=Y0(),Ka=nm(),Ya=im(),{fetchSocketNames:Za}=la();Sa();const{showRadial:Qa,radialHover:Xa,radialCharacterPicker:eo,radialRoomPicker:to,radialDoorOptions:ao,showInventory:oo,showHelp:no,showAddChannelModal:lo}=na,{showEnvironmentEditor:io}=ia,so=t(null),ro=t(!1),co=t({});let uo=null;function uy(){ro.value=!ro.value,ro.value?uo||(uo=Xt()):uo&&(clearInterval(uo),uo=null)}const po=n(null),vo=n(null),fo=t(null),go=t(),bo=t(!1),mo=t(!1),ho=t(0),xo=t(""),yo=t(""),wo=t(null),ko=t(!1),So=t(!1),Co=t(""),$o=t(!1);s(So,e=>{e&&c(()=>{var e;null==(e=(void 0).querySelector("[data-pw-prompt]"))||e.focus()})});let Mo,To=!1,Vo=null,Ao=[],zo=new Map;const Do={v:null};let Oo=[],Ro=null;const Io=t(""),jo=t(""),Fo=t("General"),Lo=t(!1),Bo=t(null),Eo=["News","Music","Movies","Sports","Kids","Entertainment","Comedy","Documentary","Lifestyle","Science","Culture","General"];function gy(){}function py(){}const{authenticated:Uo,getAuthHeaders:No}=Gt();o(()=>!Uo.value);const Ho=t(!1),Ko=o(()=>Uo.value&&!Ho.value),Yo=o(()=>!Ko.value),Qo=new Set,Xo=Oa();Yt();const an=t({}),on=t(null);let nn=null;const ln=ca(),sn=t(ln.query.invite||"");let dn=null;Bt.setAttachTVScreenCallback((e,t,o)=>sa.attachTVScreen(e,t,o)),Bt.setDetachTVScreenCallback(e=>sa.detachTVScreen(e)),Bt.setIsGuestRef(Yo),Bt.setMarkOctreeDirtyCallback(()=>aa.markOctreeDirty()),ya.setMeshEditorOctreeCallback(()=>aa.markOctreeDirty()),Bt.setAttachKeypadCallback((e,t,o)=>$a.attachKeypad(e,t,o)),Bt.setDetachKeypadCallback(e=>$a.detachKeypad(e)),Bt.setAttachTextPanelsCallback((e,t)=>{for(const o of t)ka.createTextPanel(e,o)}),Bt.setDetachTextPanelsCallback(e=>ka.removeAllPanelsForObject(e)),Bt.setBuildProceduralCallback(e=>{var t,o,n;if("procedural://grow-tent"===e.assetFile){const s=(null==(o=null==(t=e.behavior)?void 0:t.config)?void 0:o._tentConfig)||(null==(n=e.properties)?void 0:n._tentConfig);if(!s){const e=ja.migrateConfig({width:1.2,depth:1.2,height:2,ventDiameter:.15,vents:[{wall:"back",position:"top"}]}),t=ja.buildGrowTent(e,Ye);return{group:t.group,clips:[t.doorAnimClip]}}const c="string"==typeof s?JSON.parse(s):s,u=ja.migrateConfig(c),p=ja.buildGrowTent(u,Ye);return{group:p.group,clips:[p.doorAnimClip]}}return null}),$a.setOnKeypadUnlockCallback((e,t)=>{xt()}),$a.setLocalPlayerId((null==(h=ra.localPeerId)?void 0:h.value)||"local"),ha.setLocalPlayerId((null==(x=ra.localPeerId)?void 0:x.value)||"local"),$a.setOnKeypadActionCallback((e,t,o)=>{if(e.targetId){if("animation"===e.type){const t=Ne.find(t=>hi(t)===e.targetId);t&&ga.remoteToggle(t.group,o)}xt()}});const cn=o(()=>{var e,t;const o=ha.bindTargetGroup.value,n=[];for(const s of Ne){if(o&&s.group===o||!ga.isAnimatedAsset(s.assetFile))continue;const c=s.group.position,u=`${s.assetFile}|${He(c.x)},${He(c.y)},${He(c.z)}`,p=null!=(e=ga.getToggleState(s.group))&&e,v=s.name||(null==(t=s.assetFile.split("/").pop())?void 0:t.replace(".glb","").replace(/[-_]/g," "))||"Object";n.push({id:u,name:v,isOn:p,assetFile:s.assetFile})}return n}),un=t([]),pn=t([]),vn=o(()=>{var e,t;const o=ha.bindTargetGroup.value,n=[];for(const s of Ne){if(o&&s.group===o||!Bt.isDoorCandidate(s.assetFile)||!ga.isAnimatedAsset(s.assetFile))continue;const c=s.group.position,u=`${s.assetFile}|${He(c.x)},${He(c.y)},${He(c.z)}`,p=s.name||(null==(e=s.assetFile.split("/").pop())?void 0:e.replace(".glb","").replace(/[-_]/g," "))||"Door",v=(null==(t=s.doorTarget)?void 0:t.envId)||"";n.push({id:u,name:p,envId:v})}return n}),fn=t(!1),gn=t(!1);function Jr(e){const t=ia.getLightingConfig();if(!t)return;const o=t.presets.find(e=>e.id===t.activePresetId);if(o){for(const t of o.lights)void 0!==e[t.id]&&(t.enabled=e[t.id]);ia.applyActivePreset()}}function xt(){var e,t;Bt.saveRoomState(null!=(t=null==(e=wo.value)?void 0:e.id)?t:null),Ao=Ne.filter(e=>e.doorTarget),zo=new Map;for(const e of Ao){const t=[];e.group.traverse(e=>{var o;if(!e.isMesh)return;const n=Array.isArray(e.material)?e.material:[e.material];for(const e of n)e.emissive&&t.push({mat:e,origColor:e.emissive.clone(),origIntensity:null!=(o=e.emissiveIntensity)?o:0})}),t.length>0&&zo.set(e.group,t)}}ha.setRoomTransitionCallback(async(e,t)=>{if(gn.value)return;const o=We.find(t=>t.id===e);o&&(gn.value=!0,fn.value=!0,await new Promise(e=>setTimeout(e,500)),await wi(o),await new Promise(e=>setTimeout(e,100)),fn.value=!1,gn.value=!1)}),ha.setToggleEnvLightCallback(e=>{const t=ia.getLightingConfig();if(!t)return;const o=t.presets.find(e=>e.id===t.activePresetId);if(!o)return;const n=o.lights.find(t=>t.id===e);n&&(n.enabled=!n.enabled,ia.applyActivePreset())}),ha.setSetEnvLightStateCallback(e=>{Jr(e)}),ia.setOnPresetTransitionCallback((e,t)=>{var o,n;for(const s of Ne){const c=null==(o=s.deviceBinding)?void 0:o.presetTriggers;if(null==c?void 0:c.length)for(const o of c)if(o.presetId===e&&o.timing===t){const e="on"===o.action;if(null==(n=s.deviceBinding)?void 0:n.ambientLightStates){Jr(e?s.deviceBinding.ambientLightStates.onState:s.deviceBinding.ambientLightStates.offState)}ga.remoteToggle(s.group,e)}}}),sa.setSaveRoomStateCallback(xt),sa.setIsGuestRef(Yo),sa.setMobile(va.isTouchDevice.value),ia.setMobile(va.isTouchDevice.value),Ga.setMobile(va.isTouchDevice.value),Ca.setDisplayZoneMobile(va.isTouchDevice.value),va.isTouchDevice.value&&s(()=>va.tapPosition.value,e=>{!e||!Ge.value||(va.consumeTap(),Uv())}),ea.setPlacementCallbacks({saveRoomState:xt,attachTVScreen:(e,t,o)=>sa.attachTVScreen(e,t,o),detachTVScreen:e=>sa.detachTVScreen(e),attachAnimation:(e,t,o)=>ga.attachAnimation(e,t,o),detachAnimation:e=>ga.detachAnimation(e),computeAssetScale:Bt.computeAssetScale,extractUserMultiplier:Bt.extractUserMultiplier,saveAssetScale:Bt.saveAssetScale,saveAssetRotation:Bt.saveAssetRotation,sendObjectDelta:e=>ra.sendObjectDelta(e),markOctreeDirty:()=>aa.markOctreeDirty(),attachDisplayZones:e=>Ca.attachDisplayZones(e)});let mn=null,hn=null,xn=0,yn=null;const wn=t(!1),kn=n(null),Sn=t(!1);function Qr(e){var t;return null==(t=Ne.find(t=>t.group===e.group))?void 0:t.systemId}let Cn=null;const $n=o(()=>{var e,t;const o=kn.value;return(null==(e=null==o?void 0:o.config)?void 0:e.channelUrl)?(null==(t=sa.TV_CHANNELS.find(e=>e.url===o.config.channelUrl))?void 0:t.name)||"Unknown":""}),Mn=o(()=>{var e;const t=kn.value;return!!(null==(e=null==t?void 0:t.config)?void 0:e.channelUrl)&&sa.tvUserOverrides.favorites.includes(t.config.channelUrl)}),Tn=o(()=>{var e,t,o;return null!=(o=null==(t=null==(e=kn.value)?void 0:e.video)?void 0:t.muted)&&o}),Vn=n(null),An=t(1),Pn=o(()=>{const e=An.value;if(0===e)return sa.TV_CHANNELS.filter(e=>sa.tvUserOverrides.favorites.includes(e.url));if(1===e)return sa.TV_CHANNELS;const t=sa.TV_CATEGORIES[e];return sa.TV_CHANNELS.filter(e=>e.category===t)});function Ty(){lo.value=!1,Lo.value=!1,Bo.value=null,dt()}function My(){const e=Io.value.trim(),t=jo.value.trim();if(!e||!t)return;const o=["#4ade80","#fb923c","#60a5fa","#f59e0b","#a78bfa","#818cf8","#ef4444","#3b82f6","#06b6d4","#facc15","#22d3ee","#f472b6"],n=o[sa.TV_CHANNELS.length%o.length];sa.tvUserOverrides.added.push({name:t,url:e,category:Fo.value,color:n}),sa.TV_CHANNELS.push({name:t,url:e,color:n,category:Fo.value}),sa.TV_CATEGORIES.includes(Fo.value)||sa.TV_CATEGORIES.push(Fo.value);const s=sa.TV_CHANNELS.length-1,c=Math.floor(Math.random()*(sa.shuffledChannelOrder.length+1));sa.shuffledChannelOrder.splice(c,0,s),sa.saveTVUserOverrides(),lo.value=!1,dt()}function $y(){const e=Io.value.trim();if(!e)return;Lo.value=!0,Bo.value=null;const t=(void 0).createElement("video");t.crossOrigin="anonymous",t.muted=!0;let o=null;const n=setTimeout(()=>{A(),Bo.value="fail",Lo.value=!1},8e3);function A(){clearTimeout(n),o&&(o.destroy(),o=null),t.pause(),t.src="",t.load()}pa.isSupported()?(o=new pa({maxBufferLength:4,maxMaxBufferLength:8}),o.loadSource(e),o.attachMedia(t),o.on(pa.Events.MANIFEST_PARSED,()=>{A(),Bo.value="success",Lo.value=!1}),o.on(pa.Events.ERROR,(e,t)=>{t.fatal&&(A(),Bo.value="fail",Lo.value=!1)})):t.canPlayType("application/vnd.apple.mpegurl")?(t.src=e,t.addEventListener("loadedmetadata",()=>{A(),Bo.value="success",Lo.value=!1}),t.addEventListener("error",()=>{A(),Bo.value="fail",Lo.value=!1})):(Bo.value="fail",Lo.value=!1)}async function Ay(e,t){var o;try{await Xo.updateRoom(e,t,No())}catch{}(null==(o=wo.value)?void 0:o.id)===e&&Bv(e)}async function Bv(e){if(!Uo.value)return;const t=Xo.getSettings(e);if(t.isPublic||t.inviteOnly){nn&&(nn.unpublish(),nn=null);try{const o=Qt();await o.init();const n=We.find(t=>t.id===e),s=await o.publishRoom({envId:e,name:t.publicName||(null==n?void 0:n.name)||e,description:t.publicDescription||"",capacity:8,private:t.inviteOnly&&!t.isPublic});s&&(nn=s)}catch{}}else nn&&(nn.unpublish(),nn=null)}function Vy(e){var t;const o=an.value[e];if(!o)return;const n=on.value,s=`${(null==n?void 0:n.relayUrl)?n.relayUrl.replace(/^wss:/,"https:").replace(/^ws:/,"http:"):(void 0).location.origin}/join/${o}`;try{const e=(void 0).createElement("textarea");e.value=s,e.style.position="fixed",e.style.opacity="0",(void 0).body.appendChild(e),e.select(),(void 0).execCommand("copy"),(void 0).body.removeChild(e)}catch{null==(t=(void 0).clipboard)||t.writeText(s).catch(()=>{})}_t.copiedCode.value=e,setTimeout(()=>{_t.copiedCode.value===e&&(_t.copiedCode.value="")},2e3)}let zn=null;function jv(){zn&&(clearTimeout(zn),zn=null)}function dt(){va.isTouchDevice.value||bo.value||(jv(),zn=setTimeout(()=>{if(zn=null,bo.value)return;const e=qe();if(e&&!e.isLocked&&(void 0).hasFocus())try{e.lock()}catch{}},80))}function Py(e){var t;if("Tab"===e.code){if(e.preventDefault(),e.stopPropagation(),e.repeat)return;if(Qa.value)return void xi();if(oo.value)return void Zv();const t=qe();return void(Ge.value&&(null==t||t.unlock(),du()))}if(!(lo.value||io.value||ha.showBindModal.value||oo.value||M.value||_e.value||Fn.value)){if(Ge.value&&"Escape"!==e.code&&"F11"!==e.code&&"F12"!==e.code&&"F3"!==e.code&&"F4"!==e.code&&(!$a.keypadWizardVisible.value||wa.polygonToolActive.value)&&e.preventDefault(),"Escape"===e.code)return M.value?(M.value=!1,Ie.value=null,T.value="existing",void(wo.value&&dt())):_e.value?(_e.value=!1,void(wo.value&&dt())):wa.polygonToolActive.value?void wa.cancelTracing():Fn.value?(Fn.value=!1,Ge.value=!0,void dt()):Ha.value?(Ha.value=!1,Ge.value=!0,void dt()):$a.keypadWizardVisible.value?($a.closeKeypadWizard(),Ge.value=!0,void dt()):ya.editingRoomMeshes.value?void st():xa.calibratingRoom.value?void xa.cancelCalibration():ia.placingLightId.value?void ia.cancelLightPlacement():da.showVoiceSettings.value?(da.closeVoiceSettings(),void dt()):Lt.calibratingCharacter.value?(Lt.closeCharacterCalibration(),void dt()):ea.rotatingObject.value?void ea.cancelRotation():Qa.value?void xi():Gn.value?void Xv(!1):ea.placingAsset.value?void ea.cancelPlacing():void 0;if("F3"===e.code&&Je.value)return e.preventDefault(),void Pa.toggle();if("F4"===e.code&&Je.value&&Pa.isActive())return e.preventDefault(),void Pa.toggleWireframe();if(ya.editingRoomMeshes.value){if("KeyK"===e.code)return void gt();switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!0;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!0;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!0;break;case"KeyD":case"ArrowRight":aa.moveState.right=!0;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!0;break;case"Space":e.repeat||aa.jump()}return}if("Backspace"===e.code&&wa.polygonToolActive.value)return e.preventDefault(),void wa.undoLastVertex();if((!$a.keypadWizardVisible.value||wa.polygonToolActive.value)&&!Fn.value){if(wa.polygonToolActive.value){switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!0;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!0;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!0;break;case"KeyD":case"ArrowRight":aa.moveState.right=!0;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!0;break;case"Space":e.repeat||aa.jump()}return}if("Enter"===e.code&&xa.calibratingRoom.value)return e.preventDefault(),void("floor"===xa.calibrationStep.value?xa.confirmFloor():xa.confirmScale());if("KeyQ"===e.code){if(ea.placingAsset.value&&ea.getGhostObject())return void ea.nudgeGhostDepth(-1);if(e.repeat||ea.rotatingObject.value||Qa.value)return;return"connecting"===_a.connectionState?void _a.cancelConnection():La.active?(La.deactivate(),void(Ea.value=La.getState())):!Ge.value||ea.placingAsset.value||xa.calibratingRoom.value?void 0:void fu()}if("KeyE"===e.code){if(La.active&&Ge.value&&!e.repeat&&La.tryRefill())return void(Ea.value=La.getState());if(Fe.value&&Ge.value&&wo.value&&!e.repeat){e.preventDefault();const t=Vt();return R(wo.value.id,t),void(Fe.value=!1)}if(ea.placingAsset.value&&ea.getGhostObject())return void ea.nudgeGhostDepth(1);if(Ge.value&&!Qa.value&&!e.repeat){if("connecting"===_a.connectionState)return void Jv();if("idle"===_a.connectionState){const e=Vt();if(e){const t=new Ue.Raycaster;t.setFromCamera(new Ue.Vector2(0,0),e),t.far=Math.max(4,4*Ye);const o=t.intersectObjects(it,!1);let n=!1;for(const e of o){const t=e.object.name||"";if(t.includes("Sock")||t.includes("Vent")||t.includes("vent")){const e=gl(Math.max(4,4*Ye));e&&!nd(e.objectId,e.pointId)&&(_a.startConnecting(e.objectId,e.pointId,e.worldPos,e.radius,e.normal),n=!0);break}break}if(n)return}}if(function(){const e=Vt();if(!e)return!1;const t=new Ue.Raycaster;t.setFromCamera(new Ue.Vector2(0,0),e),t.far=Math.max(3,3*Ye);const o=t.intersectObjects(it,!1);if(0===o.length)return!1;for(const e of o){let t=e.object;for(;t;){const e=Ne.find(e=>e.group===t);if(e){const t=ja.getClothState(I(e.group));if(t){const o=!t.isOpen;ja.setDoorOpen(t,o,Ye),o||oa.playFileReversed("/data/appdata/sound/zipper.mp3",.6),ga.setToggleStateSilent(e.group,o),aa.markOctreeDirty(),e.group.userData.disableCollisionWhenOpen&&(o?(wt(e.group),e.collisionEnabled=!1):(rt(e.group),e.collisionEnabled=!0));const n=Bt.getObjectIdentifier(e);return ra.sendObjectDelta({type:"object:toggled",identifier:n,toggleState:o}),xt(),!0}break}t=t.parent}}return!1}())return;if(Ya.handleBehaviorInteraction())return void xt();if(ha.handleEKey())return void xt();if(ha.handleDoorTravel())return;const e=ga.tryToggleAt(Math.max(3,3*Ye));if(e){xt();const t=Ne.find(t=>t.group===e);if(t){const o=Bt.getObjectIdentifier(t);ra.sendObjectDelta({type:"object:toggled",identifier:o,toggleState:ga.getToggleState(e)})}return}}return}if("KeyR"===e.code&&Ge.value&&ea.placingAsset.value&&ea.getGhostObject())return void ea.setGhostRotation(ea.getGhostRotation()+Math.PI/12);if("KeyX"===e.code&&ea.placingAsset.value)return void ea.cancelPlacing();if("KeyZ"===e.code&&e.ctrlKey&&!e.shiftKey&&ea.canUndo())return void ea.undoLastPlaced();if("KeyZ"===e.code&&e.ctrlKey&&e.shiftKey||"KeyY"===e.code&&e.ctrlKey)return void(ea.canRedo()&&ea.redoLastPlaced());if("KeyH"===e.code)return void(no.value=!no.value);if("KeyO"===e.code&&Ge.value)return da.openVoiceSettings(),void(null==(t=qe())||t.unlock());if("KeyV"===e.code&&Ge.value&&da.voiceEnabled.value&&"ptt"===da.voiceMode.value){if(e.repeat)return;return void da.setPTT(!0)}if("F5"===e.code&&Je.value)return e.preventDefault(),void ea.saveCurrentScale();if(("PageUp"===e.code||"PageDown"===e.code)&&Ge.value&&!ea.placingAsset.value&&Je.value){e.preventDefault();const t=Vt(),o=.1*Ye*(e.shiftKey?5:1);let n=zt;if("PageUp"===e.code?n+=o:n-=o,bt(n),aa.recalcStandHeight(),t.position.y=n,wo.value){const e=Math.max(-Math.PI/2,Math.min(Math.PI/2,t.rotation.x));Bt.saveRoomSpawn(wo.value.id,{x:t.position.x,y:n,z:t.position.z,yaw:t.rotation.y,pitch:e})}return}if("Escape"===e.code&&Fe.value)return void(Fe.value=!1);if(("NumpadMultiply"===e.code||"*"===e.key)&&Ge.value&&wo.value&&Je.value){e.preventDefault();const t=Vt();return void R(wo.value.id,t)}if(Je.value&&ea.placingAsset.value&&ea.getGhostObject()){const t=Math.PI/12,o=Qe(ea.placingAsset.value.file),n={...Bt.assetRotations.value[o]||{x:0,y:0,z:0}};let s=!1;if("Numpad4"===e.code&&(n.y-=t,s=!0),"Numpad6"===e.code&&(n.y+=t,s=!0),"Numpad8"===e.code&&(n.x-=t,s=!0),"Numpad2"===e.code&&(n.x+=t,s=!0),"Numpad7"===e.code&&(n.z-=t,s=!0),"Numpad9"===e.code&&(n.z+=t,s=!0),s)return e.preventDefault(),Bt.assetRotations.value[o]=n,ea.setGhostRotation(n.y),ea.setGhostTilt(n.x),ea.setGhostRoll(n.z),void Bt.saveAssetRotation(o,n)}if(ea.placingAsset.value&&ea.getGhostObject()&&Je.value){if("Equal"===e.code||"NumpadAdd"===e.code)return void ea.scaleGhostUp();if("Minus"===e.code||"NumpadSubtract"===e.code)return void ea.scaleGhostDown()}if("Space"===e.code&&Ge.value)return e.preventDefault(),void(!Qa.value&&!oo.value&&!io.value&&aa.jump());if(ea.placingAsset.value&&ea.getGhostObject()){if("ArrowUp"===e.code)return void ea.nudgeGhostArrow("up");if("ArrowDown"===e.code)return void ea.nudgeGhostArrow("down");if("ArrowLeft"===e.code)return void ea.nudgeGhostArrow("left");if("ArrowRight"===e.code)return void ea.nudgeGhostArrow("right")}switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!0;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!0;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!0;break;case"KeyD":case"ArrowRight":aa.moveState.right=!0;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!0;break;case"ControlLeft":case"ControlRight":!ea.placingAsset.value&&!ea.rotatingObject.value&&!Lt.calibratingCharacter.value&&(aa.moveState.crouch=!0)}}}}function Dy(e){if("KeyV"===e.code&&da.voiceEnabled.value)da.setPTT(!1);else if(ya.editingRoomMeshes.value)switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!1;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!1;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!1;break;case"KeyD":case"ArrowRight":aa.moveState.right=!1;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!1}else if(wa.polygonToolActive.value)switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!1;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!1;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!1;break;case"KeyD":case"ArrowRight":aa.moveState.right=!1;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!1}else if(!(lo.value||io.value||ha.showBindModal.value||oo.value||M.value||_e.value||$a.keypadWizardVisible.value||Fn.value||Ha.value)){if("KeyQ"===e.code&&Qa.value)return void(Xa.value>=0?Qv(Xa.value):xi());if(!ea.placingAsset.value||"ArrowUp"!==e.code&&"ArrowDown"!==e.code&&"ArrowLeft"!==e.code&&"ArrowRight"!==e.code)switch(e.code){case"KeyW":case"ArrowUp":aa.moveState.forward=!1;break;case"KeyS":case"ArrowDown":aa.moveState.backward=!1;break;case"KeyA":case"ArrowLeft":aa.moveState.left=!1;break;case"KeyD":case"ArrowRight":aa.moveState.right=!1;break;case"ShiftLeft":case"ShiftRight":aa.moveState.sprint=!1;break;case"ControlLeft":case"ControlRight":aa.moveState.crouch=!1}}}function Ry(e){if(!Ge.value||oo.value||Dn.value||_e.value||M.value||Fn.value||lo.value||io.value||ha.showBindModal.value||da.showVoiceSettings.value||$a.keypadWizardVisible.value||So.value||Ha.value)return;if(e.preventDefault(),ya.editingRoomMeshes.value)return void ya.handleWheel(e.deltaY);if(xa.calibratingRoom.value){const t=e.deltaY>0?1:-1;return void("floor"===xa.calibrationStep.value?xa.updateFloorCalibration(t):xa.updateScaleCalibration(t))}if(ia.placingLightId.value)return void ia.scrollLightDistance(e.deltaY);if(Lt.calibratingCharacter.value){const t=e.deltaY>0?-1:1;return e.ctrlKey?Lt.characterCalibration.scaleMultiplier=Math.max(.1,Math.min(5,Lt.characterCalibration.scaleMultiplier*(t>0?1.05:.95))):e.shiftKey?Lt.characterCalibration.yOffset+=.05*t:e.altKey&&(Lt.characterCalibration.labelOffset+=.05*t),void Lt.updateCalibrationPreview()}if(!(e.ctrlKey||e.shiftKey||ea.placingAsset.value||ea.rotatingObject.value)){const t=Math.max(10,10*Ye),o=aa.getTargetedObject(t),n=o?sa.tvScreens.find(e=>e.group===o&&e.channelActive):null;if(n)return e.preventDefault(),void function(e,t){if(!(null==e?void 0:e.channelActive))return;const o=sa.tvUserOverrides.favoritesOnly?sa.shuffledChannelOrder.filter(e=>{var t;return sa.tvUserOverrides.favorites.includes(null==(t=sa.TV_CHANNELS[e])?void 0:t.url)}):sa.shuffledChannelOrder;if(0===o.length)return;if(null==e.shuffleIndex){const t=sa.TV_CHANNELS.findIndex(t=>t.url===e.config.channelUrl),n=o.indexOf(t);e.shuffleIndex=n>=0?n:0}else e.shuffleIndex>=o.length&&(e.shuffleIndex=0);e.shuffleIndex=(e.shuffleIndex+t+o.length)%o.length;const n=sa.TV_CHANNELS[o[e.shuffleIndex]];if(!n)return;sa.stopTVChannel(e),e.config.channelUrl=n.url,e.bannerShowTime=performance.now();const s=Ne.find(t=>t.group===e.group);s&&(s.tvConfig={...e.config,widgets:[...e.config.widgets]}),sa.syncTVChannel(e),sa.rerenderTV(e),Cn&&clearTimeout(Cn),Cn=setTimeout(()=>{Cn=null,xt()},1e3);const c=Qr(e);c&&ra.sendTVChanged(c,n.url)}(n,e.deltaY>0?1:-1)}const t=(e.deltaY>0?1:-1)*(Math.PI/24);if(ea.rotatingObject.value)if(e.preventDefault(),e.ctrlKey){const t=e.deltaY>0?.9:1.1;ea.rotatingObject.value.scale.multiplyScalar(t);const o=Ne.find(e=>e.group===ea.rotatingObject.value);o&&(o.scale=ea.rotatingObject.value.scale.x)}else e.shiftKey?ea.rotatingObject.value.rotateX(t):ea.rotatingObject.value.rotateY(t);else{if(ea.placingAsset.value&&ea.getGhostObject()){e.preventDefault();const o=ea.getGhostObject();return void(e.ctrlKey?o.scale.multiplyScalar(e.deltaY>0?.9:1.1):e.shiftKey?ea.setGhostTilt(ea.getGhostTilt()+t):ea.setGhostRotation(ea.getGhostRotation()+t))}if(e.ctrlKey){e.preventDefault();const t=aa.getTargetedObject(Math.max(10,10*Ye));if(t){const o=Ne.find(e=>e.group===t);if((null==o?void 0:o.locked)&&!Je.value)return;const n=e.deltaY>0?.9:1.1;t.scale.multiplyScalar(n),o&&(o.scale=t.scale.x),xt()}}}}function Uv(e){var t,o,n,s;if(Qa.value||!Ge.value||!va.isTouchDevice.value&&!(null==(t=qe())?void 0:t.isLocked))return;if("connecting"===_a.connectionState){if((null==e?void 0:e.button)&&0!==e.button)return;const t=Vt();if(t){const e=new Ue.Raycaster;e.setFromCamera(new Ue.Vector2(0,0),t),e.far=Math.max(20,20*Ye);const o=e.intersectObjects(it,!1);if(o.length>0&&o[0].face){const e=o[0].point,t=.15*Ye,n=_a.getLastAnchorPos(),s=_a.getStartPos(),c=n||s;c&&e.distanceTo(c)<t?Jv():_a.addAnchor(e,o[0].face.normal)}}return}if(ya.editingRoomMeshes.value)return void ya.handleClick(null!=(o=null==e?void 0:e.button)?o:0);if(wa.polygonToolActive.value)return void wa.handleTracingClick();if($a.handleKeypadCrosshairClick(Math.max(6,6*Ye))||xa.calibratingRoom.value||Lt.calibratingCharacter.value)return;if(ia.placingLightId.value)return void ia.confirmLightPlacement();const u=sa.tvClickHitTest();if(u){const{screen:e,hoverArea:t}=u;if("gear"===t){if(sa.tvConfigModeScreen===e)sa.setTvConfigModeScreen(null);else{if(sa.tvConfigModeScreen){const e=sa.tvConfigModeScreen;sa.setTvConfigModeScreen(null),sa.rerenderTV(e)}sa.setTvConfigModeScreen(e)}return void sa.rerenderTV(e)}if(sa.tvConfigModeScreen===e){if("back"===t)return sa.setTvConfigModeScreen(null),void sa.rerenderTV(e);if("number"==typeof t)return void sa.toggleTvWidgetOnScreen(sa.tvWidgetDefs[t].type,e)}else{if("channels"===t){sa.stopTVChannel(e),e.config.channelUrl=void 0;const t=Ne.find(t=>t.group===e.group);t&&(t.tvConfig={...e.config}),sa.rerenderTV(e),xt();const o=Qr(e);return void(o&&ra.sendTVChanged(o,null))}if("mute"===t)return sa.tvVolumeExpandedScreen===e&&e.video&&(e.video.muted=!e.video.muted),sa.showVolumePanel(e),void sa.renderBtnOverlay(e);if("vol-up"===t)return e.video&&(e.video.muted=!1,e.video.volume=Math.min(1,e.video.volume+.1)),sa.showVolumePanel(e),void sa.renderBtnOverlay(e);if("vol-down"===t)return e.video&&(e.video.volume=Math.max(0,e.video.volume-.1)),sa.showVolumePanel(e),void sa.renderBtnOverlay(e);if("favorite"===t){const t=e.config.channelUrl;if(t){const o=sa.tvUserOverrides.favorites.indexOf(t);o>=0?sa.tvUserOverrides.favorites.splice(o,1):sa.tvUserOverrides.favorites.push(t),sa.saveTVUserOverrides(),sa.renderBtnOverlay(e)}return}if("delete"===t){const t=e.config.channelUrl;if(t){if(sa.stopTVChannel(e),sa.purgeBrokenChannel(t),sa.shuffledChannelOrder.length>0){(null==e.shuffleIndex||e.shuffleIndex>=sa.shuffledChannelOrder.length)&&(e.shuffleIndex=0);const t=sa.TV_CHANNELS[sa.shuffledChannelOrder[e.shuffleIndex]];t?(e.config.channelUrl=t.url,e.bannerShowTime=performance.now(),sa.syncTVChannel(e)):e.config.channelUrl=void 0}else e.config.channelUrl=void 0;const o=Ne.find(t=>t.group===e.group);o&&(o.tvConfig={...e.config,widgets:[...e.config.widgets]}),sa.rerenderTV(e),xt();const n=Qr(e);n&&ra.sendTVChanged(n,e.config.channelUrl||null)}return}if("number"==typeof t&&e.config.widgets.includes("tv_channel")&&!e.channelActive){if(t>=100&&t<200)return sa.setTvBrowseCategory(t-100),sa.setTvBrowsePage(0),void sa.rerenderTV(e);if(200===t)return sa.setTvBrowsePage(Math.max(0,sa.tvBrowsePage-1)),void sa.rerenderTV(e);if(201===t)return sa.setTvBrowsePage(Math.min(sa.getTotalPages()-1,sa.tvBrowsePage+1)),void sa.rerenderTV(e);if(202===t)return sa.tvUserOverrides.favoritesOnly=!sa.tvUserOverrides.favoritesOnly,sa.saveTVUserOverrides(),void sa.rerenderTV(e);if(203===t)return void function(){var e;lo.value=!0,Io.value="",jo.value="",Fo.value="General",Lo.value=!1,Bo.value=null,null==(e=qe())||e.unlock()}();const o=sa.getPageChannels()[t];if(o){e.config.channelUrl=o.url,e.bannerShowTime=performance.now();const t=sa.TV_CHANNELS.indexOf(o),n=sa.shuffledChannelOrder.indexOf(t);e.shuffleIndex=n>=0?n:0;const s=Ne.find(t=>t.group===e.group);s&&(s.tvConfig={...e.config,widgets:[...e.config.widgets]}),sa.syncTVChannel(e),sa.rerenderTV(e),xt();const c=Qr(e);c&&ra.sendTVChanged(c,o.url)}return}}}if(ea.rotatingObject.value){const e=ea.rotatingObject.value,t=Ne.find(t=>t.group===e);if(ea.confirmRotation(),xt(),t){const o=Bt.getObjectIdentifier(t);ra.sendObjectDelta({type:"object:moved",identifier:o,position:{x:He(e.position.x),y:He(e.position.y),z:He(e.position.z)},quaternion:{x:He(e.quaternion.x),y:He(e.quaternion.y),z:He(e.quaternion.z),w:He(e.quaternion.w)},scale:He(e.scale.x)})}return}if(ea.placingAsset.value&&ea.getGhostObject()&&ea.ghostValid.value){if(Gn.value){const e=ea.getGhostObject(),t=Qe(ea.placingAsset.value.file),o=Xe.get(ea.placingAsset.value.file);return o&&Bt.extractUserMultiplier&&Bt.saveAssetScale(t,Bt.extractUserMultiplier(o,e.scale.x)),Bt.saveAssetRotation(t,{x:He(ea.getGhostTilt()),y:He(ea.getGhostRotation()),z:He(ea.getGhostRoll())}),void Xv(!0)}const e=null!=(s=null==(n=ea.placingAsset.value)?void 0:n.file)?s:null,t=ea.isMovingObject();if(ea.placeObject(),ea.cancelPlacing(),za.markDirty(),"procedural://grow-tent"===e&&qn){const e=Ne[Ne.length-1];e&&(e.properties={...e.properties||{},_tentConfig:JSON.stringify(qn)},xt()),qn=null}if(Yo.value){const e=Ne[Ne.length-1];e&&Qo.add(e.group)}if(!t&&e&&"toggle"===ga.isAnimatedAsset(e)){const t=Ne[Ne.length-1];if(t&&t.assetFile===e){const o=e.split("/").pop()||"",n=Bt.getAssetBindingDefault(o);n?(t.deviceBinding={...n},ha.syncSingleBinding(t),xt()):c(()=>{Gv(t)})}}}}function Oy(e){if(!ya.editingRoomMeshes.value){if(0===e.button&&La.active&&Ge.value)return void La.startPour();if(2===e.button)return e.preventDefault(),"connecting"===_a.connectionState?void _a.undoLastAnchor():ea.rotatingObject.value?void ea.cancelRotation():Qa.value?void xi():ea.placingAsset.value?void ea.cancelPlacing():void 0;if(1===e.button){if(e.preventDefault(),Qa.value)return;if(Ge.value&&!ea.placingAsset.value&&!ea.rotatingObject.value)return void fu()}}}function zy(e){0===e.button&&La.active&&La.stopPour(),1===e.button&&Qa.value&&xi()}const Dn=t(!1),On=t("full"),Rn=t(0),In=t(100),jn=n(null),Fn=t(!1),Ln=t(0),Bn=t([]),En=t("single");function Gv(e){var t,o,n,s,c,u,p,v;jn.value=e,ha.openBindModal(e.group);const f=ga.getInstanceRange(e.group);On.value=e.animRange||(null==f?void 0:f.animRange)||"full",Rn.value=Math.round(100*(null!=(o=null!=(t=e.animRangeStart)?t:null==f?void 0:f.animRangeStart)?o:0)),In.value=Math.round(100*(null!=(s=null!=(n=e.animRangeEnd)?n:null==f?void 0:f.animRangeEnd)?s:1));const g=ia.getLightingConfig();g?(un.value=(null!=(u=null==(c=g.presets.find(e=>e.id===g.activePresetId))?void 0:c.lights)?u:[]).map(e=>({id:e.id,name:e.name,type:e.type,color:e.color,enabled:e.enabled})),pn.value=g.presets.map(e=>({presetId:e.id,presetName:e.name,lights:e.lights.map(e=>({id:e.id,name:e.name,type:e.type,color:e.color,enabled:e.enabled}))})),Bn.value=g.presets.map(e=>({id:e.id,name:e.name})),En.value=null!=(p=g.mode)?p:"single"):(un.value=[],pn.value=[],Bn.value=[],En.value="single"),Dn.value=!0,null==(v=qe())||v.unlock()}function Iy(){Dn.value=!1,ha.closeBindModal(),jn.value=null,dt()}function Fy(e){var t,o,n,s,c,u,p,v,f;if(null==(t=e.editedName)?void 0:t.startsWith("__preview__:")){const t=e.editedName.substring(e.editedName.indexOf(":",e.editedName.indexOf(":")+1)+1);try{Jr(JSON.parse(t)),setTimeout(()=>{ia.applyActivePreset()},3e3)}catch{}return}if(("switch"===(null==(o=e.behavior)?void 0:o.type)||!e.behavior&&(null==(n=jn.value)?void 0:n.deviceBinding))&&(ha.saveBinding(e.binding),"default"===e.applyScope)){const t=ha.getTargetAssetFilename();t&&Bt.saveAssetBindingDefault(t,null!=(s=e.binding)?s:null)}if(jn.value){const t=jn.value;if("full"===e.animRange?(delete t.animRange,delete t.animRangeStart,delete t.animRangeEnd,ga.updateInstanceRange(t.group,{})):(t.animRange=e.animRange,t.animRangeStart=e.animStart/100,t.animRangeEnd=e.animEnd/100,ga.updateInstanceRange(t.group,{animRange:e.animRange,animRangeStart:e.animStart/100,animRangeEnd:e.animEnd/100})),void 0!==e.behavior){const o=(null==(u=null==(c=t.behavior)?void 0:c.config)?void 0:u.displayZones)||[],n=(null==(v=null==(p=e.behavior)?void 0:p.config)?void 0:v.displayZones)||[],s=new Set(n.map(e=>e.id));for(const e of o)s.has(e.id)||ka.removeTextPanel(e.id);for(const e of n)ka.removeTextPanel(e.id),Ca.renderDisplayZoneOn3D(t,e);t.behavior=null!=(f=e.behavior)?f:void 0,(o.length||n.length)&&Ca.rebuildCameraStreams()}void 0!==e.tags&&(t.tags=e.tags&&e.tags.length>0?e.tags:void 0),void 0!==e.locked&&(t.locked=e.locked),void 0!==e.editedName&&(t.name=e.editedName||"")}Dn.value=!1,ha.closeBindModal(),jn.value=null,xt(),dt()}function su(){const e=jn.value;e&&(Dn.value=!1,ha.closeBindModal(),Ge.value=!0,dt(),wa.startTracing(e.group,"text",t=>{var o;e.behavior||(e.behavior={type:"screen",config:{displayZones:[]}}),e.behavior.config.displayZones||(e.behavior.config.displayZones=[]);const n=Ca.computeDisplayPolygonDims(t,e.group);e.behavior.config.displayZones.push({id:t.id,polygon:t,elements:[],polygonWidth:n.w,polygonHeight:n.h}),ka.createTextPanel(e.group,{id:t.id,polygon:t,config:{...ka.DEFAULT_TEXT_PANEL_CONFIG,previewText:"Display Zone"}}),xt(),null==(o=qe())||o.unlock(),Ge.value=!1;const s=e.behavior.config.displayZones.length-1;Ln.value=s,c(()=>{Fn.value=!0})},()=>{var e;null==(e=qe())||e.unlock(),jn.value=null}))}function Ey(e){var t;Dn.value=!1,null==(t=qe())||t.unlock(),Ge.value=!1,Ln.value=e,Fn.value=!0}function Ly(e){var t,o;const n=jn.value;if(!(null==(o=null==(t=null==n?void 0:n.behavior)?void 0:t.config)?void 0:o.displayZones))return;const s=n.behavior.config.displayZones,c=Ln.value;if(c>=0&&c<s.length){s[c]=e;const t=e.id;ka.removeTextPanel(t),Ca.renderDisplayZoneOn3D(n,e),Ca.rebuildCameraStreams(),xt()}Fn.value=!1,Ge.value=!0,dt()}function By(){Fn.value=!1,Ge.value=!0,dt()}function hi(e){const t=e.group.position,m=e=>Math.round(1e4*e)/1e4;return`${e.assetFile}|${m(t.x)},${m(t.y)},${m(t.z)}`}const Un=o(()=>Ne.filter(e=>"toggle"===ga.isAnimatedAsset(e.assetFile)).map(e=>{var t;return{id:hi(e),name:e.name||(null==(t=e.assetFile.split("/").pop())?void 0:t.replace(".glb",""))||"Object",type:"animation"}})),Wn=o(()=>$a.keypadWizardVisible.value?($a.keypadWizardStep.value,Ne.filter(e=>Bt.isDoorCandidate(e.assetFile)).map(e=>{var t;const o=e.name||(null==(t=e.assetFile.split("/").pop())?void 0:t.replace(".glb",""))||"Door",n=e.doorTarget?`${o} â†’ ${e.doorTarget.envId}`:o;return{id:hi(e),name:n,type:"door"}})):[]);function Ny(){wa.polygonToolActive.value&&wa.cancelTracing(),wa.clearVertexSelectionHighlights();const e=$a.keypadWizardTarget.value,t=e?Ne.find(t=>t.group===e):null;ed(),e&&ka.removeAllPanelsForObject(e),$a.closeKeypadWizard(),(null==t?void 0:t.keypadData)&&e&&($a.detachKeypad(e),$a.attachKeypad(e,t.keypadData,!1)),Ge.value=!0,dt()}function Wy(e){var t;wa.clearVertexSelectionHighlights(),ed();const o=$a.keypadWizardTarget.value,n=o?Ne.find(e=>e.group===o):null;o&&ka.removeAllPanelsForObject(o);const s=$a.saveKeypadFromWizard(e);if(s&&"default"===e&&n){const e=n.assetFile.split("/").pop()||n.assetFile,t={...s.data,logic:{...s.data.logic,action:{type:"none"}}};Bt.saveAssetMeta(e,{keypadDefaults:t})}if("door"===(null==(t=null==s?void 0:s.data.logic.action)?void 0:t.type)&&s.data.logic.action.targetId&&n){const e=hi(n),t=Ne.find(e=>hi(e)===s.data.logic.action.targetId);t&&(t.keypadLock=e,t.keypadLockMode=s.data.logic.action.doorAccessMode||"everyone")}xt(),Ge.value=!0,dt()}function Hy(){const e=$a.keypadWizardTarget.value;if(!e)return;const t=Ne.find(t=>t.group===e);$a.detachKeypad(e),ka.removeAllPanelsForObject(e),ed(),t&&(t.keypadData=void 0,t.textPanels=void 0),$a.closeKeypadWizard(),xt(),Ge.value=!0,dt()}function Gy(e){var t;const o=$a.keypadWizardTarget.value,n=$a.keypadWizardDisplay.value;o&&(null==(t=null==n?void 0:n.polygon)?void 0:t.vertices)?wa.showVertexSelectionHighlights(o,n.polygon.vertices,e):wa.clearVertexSelectionHighlights()}function Ky(e,t){var o;const n=$a.keypadWizardTarget.value,s=$a.keypadWizardButtons.value.find(t=>t.id===e);n&&(null==(o=null==s?void 0:s.polygon)?void 0:o.vertices)?wa.showVertexSelectionHighlights(n,s.polygon.vertices,t):wa.clearVertexSelectionHighlights()}function qy(){const e=$a.keypadWizardTarget.value;e&&ka.removeAllPanelsForObject(e),$a.keypadWizardDisplay.value=null}function Yy(){const e=$a.keypadWizardTarget.value;e&&(Ge.value=!0,dt(),wa.startTracing(e,"keypad-display",t=>{var o;null==(o=qe())||o.unlock();const n={id:t.id,polygon:t,config:{...ka.DEFAULT_TEXT_PANEL_CONFIG}};$a.keypadWizardDisplay.value=n,ka.removeAllPanelsForObject(e),ka.createTextPanel(e,n)},()=>{var e;null==(e=qe())||e.unlock()}))}const Nn=new Map,Hn=new Map;function Zy(){const e=$a.keypadWizardTarget.value;e&&(Ge.value=!0,dt(),wa.startTracing(e,"keypad-button",t=>{var o;null==(o=qe())||o.unlock();const n=t.id;$a.keypadWizardButtons.value.push({id:n,polygon:t,type:"character",value:"",label:"",labelConfig:{...vi},areaColor:"#06b6d4",areaTransparent:!1,areaOpacity:.5});const s=wa.createPolygonVisual(e,t,440020,.5);Nn.set(n,s)},()=>{var e;null==(e=qe())||e.unlock()}))}function Xy(){const e=$a.keypadWizardTarget.value;e&&(Ge.value=!0,dt(),wa.startTracing(e,"keypad-display",t=>{var o;null==(o=qe())||o.unlock();const n=$a.keypadWizardDisplay.value,s=(null==n?void 0:n.config)?{...n.config}:{...ka.DEFAULT_TEXT_PANEL_CONFIG},c={id:t.id,polygon:t,config:s};$a.keypadWizardDisplay.value=c,ka.removeAllPanelsForObject(e),ka.createTextPanel(e,c)},()=>{var e;null==(e=qe())||e.unlock()}))}function Jy(e){const t=$a.keypadWizardTarget.value;if(!t)return;const o=$a.keypadWizardButtons.value.find(t=>t.id===e);o&&(Ge.value=!0,dt(),wa.startTracing(t,"keypad-button",n=>{var s;null==(s=qe())||s.unlock(),o.polygon=n,ru(e,o,t),td(e,o,t)},()=>{var e;null==(e=qe())||e.unlock()}))}function Qy(e,t){$a.keypadWizardTarget.value;for(const o of $a.keypadWizardButtons.value)qv(o.id,e,t)}function ed(){for(const[,e]of Nn)wa.disposePolygonVisual(e);Nn.clear();for(const[,e]of Hn)ka.removeTextPanel(e);Hn.clear()}function _y(e,t){const o=$a.keypadWizardDisplay.value;if(!o)return;const n=$a.keypadWizardTarget.value;o.config[e]=t,$a.keypadWizardDisplay.value={...o},n&&(ka.removeTextPanel(o.id),ka.createTextPanel(n,o))}function qv(e,t,o){const n=$a.keypadWizardButtons.value.find(t=>t.id===e);if(!n)return;if(t.startsWith("labelConfig.")){const e=t.slice(12);n.labelConfig||(n.labelConfig={...vi}),n.labelConfig[e]=o}else n[t]=o;const s=$a.keypadWizardTarget.value;s&&(("areaColor"===t||"areaOpacity"===t||"areaTransparent"===t||"labelConfig.surfaceType"===t||"labelConfig.roughness"===t||"labelConfig.metalness"===t||"labelConfig.grainIntensity"===t)&&ru(e,n,s),("label"===t||t.startsWith("labelConfig."))&&td(e,n,s))}function ru(e,t,o){var n,s,c;const u=Nn.get(e);if(u&&(wa.disposePolygonVisual(u),Nn.delete(e)),!t.areaTransparent){const u=t.labelConfig||vi,p=wa.createPolygonVisual(o,t.polygon,new Ue.Color(t.areaColor).getHex(),t.areaOpacity,u.surfaceType||"flat",null!=(n=u.roughness)?n:.5,null!=(s=u.metalness)?s:0,null!=(c=u.grainIntensity)?c:0);Nn.set(e,p)}}function td(e,t,o){var n,s,c,u,p,v,f,g,b,h,x,S,$;const M=Hn.get(e);if(M&&(ka.removeTextPanel(M),Hn.delete(e)),t.label){const M=$a.keypadWizardDisplay.value,T=t.labelConfig||vi,V=`${e}_label_preview`,O={id:V,polygon:t.polygon,config:{fontFamily:T.fontFamily||(null==(n=null==M?void 0:M.config)?void 0:n.fontFamily)||"",fontSize:null!=(s=T.fontSize)?s:.4,textColor:T.textColor||"#ffffff",backgroundColor:T.backgroundColor||"#000000",backgroundOpacity:null!=(c=T.backgroundOpacity)?c:0,backgroundTransparent:null==(u=T.backgroundTransparent)||u,surfaceType:T.surfaceType||"flat",roughness:null!=(p=T.roughness)?p:.5,metalness:null!=(v=T.metalness)?v:0,textAlign:T.textAlign||"center",uppercase:null!=(f=T.uppercase)&&f,maxChars:null!=(g=T.maxChars)?g:0,padding:null!=(b=T.padding)?b:0,letterSpacing:null!=(h=T.letterSpacing)?h:0,lineHeight:null!=(x=T.lineHeight)?x:1.2,wrapMode:T.wrapMode||"nowrap",mode:"static",previewText:t.label,verticalOffset:null!=(S=T.verticalOffset)?S:0,grainIntensity:null!=($=T.grainIntensity)?$:0}};ka.createTextPanel(o,O),Hn.set(e,V)}}function eh(e){const t=Nn.get(e);t&&(wa.disposePolygonVisual(t),Nn.delete(e));const o=Hn.get(e);o&&(ka.removeTextPanel(o),Hn.delete(e)),$a.keypadWizardButtons.value=$a.keypadWizardButtons.value.filter(t=>t.id!==e)}function th(e){const t=$a.keypadWizardButtons.value.find(t=>t.id===e);if(!t)return;const o=$a.keypadWizardTarget.value,n=$a.cloneButton(t,.02,0);if($a.keypadWizardButtons.value.push(n),o){const e=wa.createPolygonVisual(o,n.polygon,440020,.5);Nn.set(n.id,e)}}function ah(e,t,o){if(0===$a.keypadWizardButtons.value.length)return;const n=$a.keypadWizardTarget.value,s=$a.keypadWizardButtons.value[0],c=$a.generateButtonGrid(s,e,t,.002,o);if(ed(),$a.keypadWizardButtons.value=c,n)for(const e of c){const t=wa.createPolygonVisual(n,e.polygon,440020,.5);Nn.set(e.id,t)}}function oh(e,t){if($a.keypadWizardData.value.logic[e]=t,"action"===e&&"door"===(null==t?void 0:t.type)&&!t.targetId){const e=$a.keypadWizardTarget.value;if(e){const t=e.position,o=Wn.value;if(o.length>0){let e=o[0],n=1/0;for(const s of o){const o=Ne.find(e=>hi(e)===s.id);if(!o)continue;const c=o.group.position.x-t.x,u=o.group.position.y-t.y,p=o.group.position.z-t.z,v=c*c+u*u+p*p;v<n&&(n=v,e=s)}const s=$a.keypadWizardData.value.logic;s.action={...s.action,targetId:e.id}}}}}function nh(e){ka.loadAvailableFonts()}function lh(e,t){const o=$a.keypadWizardDisplay.value;if(!o)return;const n=$a.keypadWizardTarget.value;if(!n)return;Yv(o.polygon,e,t),$a.keypadWizardDisplay.value={...o},ka.removeTextPanel(o.id),ka.createTextPanel(n,o)}function ih(e,t,o){const n=$a.keypadWizardButtons.value.find(t=>t.id===e);if(!n)return;Yv(n.polygon,t,o);const s=$a.keypadWizardTarget.value;s&&(ru(e,n,s),td(e,n,s))}function Yv(e,t,o){const n=e.vertices.map(e=>({x:e.x,y:e.y,z:e.z})),s=el(n),{u:c,v:u}=function(e){const t={x:0,y:1,z:0};if(Math.abs(_n(e,t))>.99){const t={x:1,y:0,z:0};return{u:t,v:lr(Rd(e,t))}}const o=lr(Rd(t,e));return{u:o,v:lr(Rd(e,o))}}(s.planeNormal);switch(t){case"nudge":{const{axis:t,amount:s,selected:p}=o,v=p,f=v&&v.size>0,g=Vb(n,"u"===t?s:0,"v"===t?s:0,c,u);for(let t=0;t<e.vertices.length;t++)f&&!v.has(t)||(e.vertices[t].x=g[t].x,e.vertices[t].y=g[t].y,e.vertices[t].z=g[t].z);break}case"updateOffset":e.normalOffset=o.value;break;case"updateVertex":{const{index:t,axis:n,value:s}=o;e.vertices[t][n]=s;break}case"alignH":{const t=function(e,t,o,n,s){if(t.length<2)return e;const c=e.map(e=>({...e}));let u=0;for(const n of t)u+=_n(Qi(e[n],o),s);u/=t.length;for(const p of t){const t=_n(Qi(e[p],o),n);c[p]=qo(o,qo(Po(n,t),Po(s,u)))}return c}(n,Array.from(o.indices),s.planeCenter,c,u);for(let o=0;o<e.vertices.length;o++)e.vertices[o].x=t[o].x,e.vertices[o].y=t[o].y,e.vertices[o].z=t[o].z;break}case"alignV":{const t=function(e,t,o,n,s){if(t.length<2)return e;const c=e.map(e=>({...e}));let u=0;for(const s of t)u+=_n(Qi(e[s],o),n);u/=t.length;for(const p of t){const t=_n(Qi(e[p],o),s);c[p]=qo(o,qo(Po(n,u),Po(s,t)))}return c}(n,Array.from(o.indices),s.planeCenter,c,u);for(let o=0;o<e.vertices.length;o++)e.vertices[o].x=t[o].x,e.vertices[o].y=t[o].y,e.vertices[o].z=t[o].z;break}case"snapRect":{const t=function(e,t,o,n){if(4!==e.length)return e;const s=jc(e,t,o,n),c=I0(s),u=[{x:c.minU,y:c.minV},{x:c.maxU,y:c.minV},{x:c.maxU,y:c.maxV},{x:c.minU,y:c.maxV}],p=new Set,v=new Array(4);for(const e of u){let c=-1,u=1/0;for(let t=0;t<4;t++){if(p.has(t))continue;const o=s[t].x-e.x,n=s[t].y-e.y,v=o*o+n*n;v<u&&(u=v,c=t)}p.add(c),v[c]=qo(t,qo(Po(o,e.x),Po(n,e.y)))}return v}(n,s.planeCenter,c,u);for(let o=0;o<e.vertices.length;o++)e.vertices[o].x=t[o].x,e.vertices[o].y=t[o].y,e.vertices[o].z=t[o].z;break}}}async function sh(e){await Bt.generateThumbnail(e.file)}function du(){oo.value=!0}function Zv(){oo.value=!1,dt()}async function rh(e){oo.value=!1,await ea.startPlacing(e,Bt.assetRotations.value),Bt.generateAndCacheThumbnail(e.file),dt()}const Gn=t(!1);function dh(e){Gn.value=!0,oo.value=!1,ea.startPlacing(e,Bt.assetRotations.value),dt()}function Xv(e){var t;Gn.value=!1,e||ea.cancelPlacing(),du(),null==(t=qe())||t.unlock()}async function ch(e){await Bt.deleteAsset(e,Je.value)&&za.markDirty()}function uh(){Ha.value=!1,Ge.value=!0,dt()}function fh(e){Ha.value=!1;const t=ja.buildGrowTent(e,Ye);ga.cacheAnimationClips("procedural://grow-tent",[t.doorAnimClip]);const o={file:"procedural://grow-tent",name:ja.getDisplayName(e),thumb:""};ea.startPlacing(o,Bt.assetRotations.value,t.group),qn={...e,vents:[...e.vents]}}let qn=null;function nd(e,t){return _a.getAllConfigs().some(o=>o.startObjectId===e&&o.startPointId===t||o.endObjectId===e&&o.endPointId===t)}function gl(e){var t;const o=Vt();if(!o)return null;const n=o.position,s=new Ue.Vector3(0,0,-1).applyQuaternion(o.quaternion);let c=null;for(const o of Ne){const u=null==(t=o.group.userData)?void 0:t.connectionPoints;if(!u)continue;const p=o.systemId||Bt.getObjectIdentifier(o);for(const t of u){if("vent"!==t.type)continue;const u=new Ue.Vector3(t.position.x,t.position.y,t.position.z).applyMatrix4(o.group.matrixWorld),v=n.distanceTo(u);if(v>e)continue;const f=u.clone().sub(n).normalize(),g=s.dot(f);if(g<.7)continue;const b=v*(2-g);if(!c||b<c.score){const e=new Ue.Vector3(t.normal.x,t.normal.y,t.normal.z).transformDirection(o.group.matrixWorld).normalize();c={objectId:p,pointId:t.id,worldPos:u,normal:e,radius:t.radius||.075,score:b}}}}return c}function cu(e,t){var o;for(const n of Ne){if((n.systemId||Bt.getObjectIdentifier(n))!==e)continue;const s=null==(o=n.group.userData)?void 0:o.connectionPoints;if(!s)return null;const c=s.find(e=>e.id===t);return c?new Ue.Vector3(c.position.x,c.position.y,c.position.z).applyMatrix4(n.group.matrixWorld):null}return null}function ld(){if(!wo.value)return;const e=_a.getAllConfigs();Bt.saveDuctConnections(wo.value.id,e)}function Jv(){const e=Math.max(4,4*Ye);if("idle"===_a.connectionState){const t=gl(e);return!!t&&(_a.startConnecting(t.objectId,t.pointId,t.worldPos,t.radius,t.normal),!0)}if("connecting"===_a.connectionState){const t=gl(e);if(t)return _a.completeConnection(t.objectId,t.pointId,t.worldPos,Ye,t.normal)&&(ld(),za.markDirty()),!0;const o=_a.getLastAnchorPos();if(o){const e=new Ue.Vector3(0,1,0);_a.undoLastAnchor(),_a.completeConnectionFreeEnd(o,e,Ye)&&(ld(),za.markDirty())}else _a.cancelConnection();return!0}return!1}const Kn=o(()=>{var e,t,o,n,s,c,p,v,f,g,b,h,x;if(eo.value&&Je.value)return _t.availableCharacters.value.map(e=>({id:`char-${e}`,label:_t.charDisplayName(e),icon:u(se),color:"text-teal-400",bg:"bg-teal-500/20 border-teal-500/50",action:()=>{eo.value=!1,Lt.startCharacterCalibration(e);const t=qe();(null==t?void 0:t.isLocked)&&t.unlock()}}));if(to.value&&Je.value){const e=We.filter(e=>{var t;return e.id!==(null==(t=wo.value)?void 0:t.id)}),t=Ne.find(e=>e.group===ea.radialTarget.value),o=e.map(e=>{var o,n;return{id:`room-${e.id}`,label:e.name,icon:u(re),color:(null==(o=null==t?void 0:t.doorTarget)?void 0:o.envId)===e.id?"text-green-400":"text-sky-400",bg:(null==(n=null==t?void 0:t.doorTarget)?void 0:n.envId)===e.id?"bg-green-500/20 border-green-500/50":"bg-sky-500/20 border-sky-500/50",action:()=>{to.value=!1;const t=Ne.find(e=>e.group===ea.radialTarget.value);t&&(t.doorTarget={envId:e.id},xt())}}});return(null==t?void 0:t.doorTarget)&&o.unshift({id:"unlink-room",label:"Unlink",icon:u(de),color:"text-red-400",bg:"bg-red-500/20 border-red-500/50",action:()=>{to.value=!1;const e=Ne.find(e=>e.group===ea.radialTarget.value);e&&(delete e.doorTarget,xt())}}),o}if(so.value){const e=so.value;return[{id:"edit-duct",label:"Edit Duct",icon:u(ce),color:"text-amber-400",bg:"bg-amber-500/20 border-amber-500/50",action:()=>{_a.editDuct(e,cu),so.value=null,ld()}},{id:"delete-duct",label:"Delete Duct",icon:u(ue),color:"text-red-400",bg:"bg-red-500/20 border-red-500/50",action:()=>{_a.removeDuct(e),so.value=null,ld(),za.markDirty()}}]}if(ea.placingAsset.value)return[{id:"cancel",label:"Cancel",icon:u(de),color:"text-red-400",bg:"bg-red-500/20 border-red-500/50",action:ea.cancelPlacing}];if(ea.radialTarget.value){const S=Ne.find(e=>e.group===ea.radialTarget.value),$=!0===(null==S?void 0:S.locked);S&&ga.isAnimatedAsset(S.assetFile),S&&ga.isAnimatedAsset(S.assetFile);const M=!0===(null==(e=null==S?void 0:S.deviceBinding)?void 0:e.configLocked),T=!S||M&&!Je.value?null:{id:"configure",label:"Configure",icon:u(ce),color:"text-amber-400",bg:"bg-amber-500/20 border-amber-500/50",action:()=>Gv(S)};if(Je.value){const e=[{id:"move",label:"Move",icon:u(pe),color:"text-cyan-400",bg:"bg-cyan-500/20 border-cyan-500/50",action:()=>ea.moveTargeted(Bt.assets.value)},{id:"rotate",label:"Rotate",icon:u(ve),color:"text-purple-400",bg:"bg-purple-500/20 border-purple-500/50",action:ea.rotateTargeted},{id:"copy",label:"Copy",icon:u(fe),color:"text-emerald-400",bg:"bg-emerald-500/20 border-emerald-500/50",action:()=>ea.duplicateTargeted(Bt.assets.value)},{id:"delete",label:"Delete",icon:u(ue),color:"text-red-400",bg:"bg-red-500/20 border-red-500/50",action:ea.deleteTargeted},{id:"lock",label:$?"Unlock":"Lock",icon:u($?ge:be),color:$?"text-yellow-400":"text-amber-400",bg:$?"bg-yellow-500/20 border-yellow-500/50":"bg-amber-500/20 border-amber-500/50",action:ea.toggleLockTargeted}];if(T&&e.push(T),"screen"===(null==(t=null==S?void 0:S.behavior)?void 0:t.type)){const t=(null==(n=null==(o=S.behavior.config)?void 0:o.displayZones)?void 0:n.length)>0;e.push({id:"edit-screen",label:t?"Edit Screen":"Trace Screen",icon:u(he),color:"text-sky-400",bg:"bg-sky-500/20 border-sky-500/50",action:()=>{var e;jn.value=S,t?(null==(e=qe())||e.unlock(),Ge.value=!1,Ln.value=0,Fn.value=!0):su()}})}if(S&&("screen"!==(null==(s=S.behavior)?void 0:s.type)||!(null==(p=null==(c=S.behavior.config)?void 0:c.displayZones)?void 0:p.length))){const t=S.keypadData,o=t&&(!t.buttons||0===t.buttons.length);e.push({id:"add-keypad",label:t?o?"Edit Text":"Edit Keypad":"Text / Code",icon:u(o||!t?xe:ye),color:o?"text-cyan-400":"text-rose-400",bg:o?"bg-cyan-500/20 border-cyan-500/50":"bg-rose-500/20 border-rose-500/50",action:()=>{!function(e){var t,o,n,s;const c=e.group,u=!!e.keypadData;if($a.openKeypadWizard(c),null==(t=qe())||t.unlock(),u){$a.detachKeypad(c),ka.removeAllPanelsForObject(c);const e=$a.keypadWizardButtons.value;for(const t of e){if(!t.areaTransparent){const e=t.labelConfig||vi,u=wa.createPolygonVisual(c,t.polygon,new Ue.Color(t.areaColor).getHex(),t.areaOpacity,e.surfaceType||"flat",null!=(o=e.roughness)?o:.5,null!=(n=e.metalness)?n:0,null!=(s=e.grainIntensity)?s:0);Nn.set(t.id,u)}t.label&&td(t.id,t,c)}const t=$a.keypadWizardDisplay.value;t&&ka.createTextPanel(c,t)}}(S)}})}return e}const V=Yo.value&&S&&!Qo.has(S.group);if($)return!V&&S&&(S.behavior||Bt.isDoorCandidate(S.assetFile))?[T].filter(Boolean):[];if(V)return[];const O=[{id:"move",label:"Move",icon:u(pe),color:"text-cyan-400",bg:"bg-cyan-500/20 border-cyan-500/50",action:()=>ea.moveTargeted(Bt.assets.value)},{id:"rotate",label:"Rotate",icon:u(ve),color:"text-purple-400",bg:"bg-purple-500/20 border-purple-500/50",action:ea.rotateTargeted},{id:"copy",label:"Copy",icon:u(fe),color:"text-emerald-400",bg:"bg-emerald-500/20 border-emerald-500/50",action:()=>ea.duplicateTargeted(Bt.assets.value)},{id:"delete",label:"Delete",icon:u(ue),color:"text-red-400",bg:"bg-red-500/20 border-red-500/50",action:ea.deleteTargeted}];if(T&&O.push(T),"screen"===(null==(v=null==S?void 0:S.behavior)?void 0:v.type)&&!M){const e=(null==(g=null==(f=S.behavior.config)?void 0:f.displayZones)?void 0:g.length)>0;O.push({id:"edit-screen",label:e?"Edit Screen":"Trace Screen",icon:u(he),color:"text-sky-400",bg:"bg-sky-500/20 border-sky-500/50",action:()=>{var t;jn.value=S,e?(null==(t=qe())||t.unlock(),Ge.value=!1,Ln.value=0,Fn.value=!0):su()}})}if(S&&!M&&("screen"!==(null==(b=S.behavior)?void 0:b.type)||!(null==(x=null==(h=S.behavior.config)?void 0:h.displayZones)?void 0:x.length))){const e=S.keypadData,t=e&&(!e.buttons||0===e.buttons.length);O.push({id:"add-keypad",label:e?t?"Edit Text":"Edit Keypad":"Text / Code",icon:u(t||!e?xe:ye),color:t?"text-cyan-400":"text-rose-400",bg:t?"bg-cyan-500/20 border-cyan-500/50":"bg-rose-500/20 border-rose-500/50",action:()=>{var e;$a.openKeypadWizard(S.group),null==(e=qe())||e.unlock()}})}return O}const S=[{id:"inventory",label:"Inventory",icon:u(we),color:"text-spider-green-400",bg:"bg-green-500/20 border-green-500/50",action:()=>{du()}},{id:"build-tent",label:"Build Tent",icon:u(ke),color:"text-green-400",bg:"bg-green-500/20 border-green-500/50",action:()=>{var e;Ha.value=!0,null==(e=qe())||e.unlock()}},{id:"connect-duct",label:"Connect Duct",icon:u(Se),color:"text-teal-400",bg:"bg-teal-500/20 border-teal-500/50",action:()=>{const e=gl(Math.max(6,6*Ye));e&&_a.startConnecting(e.objectId,e.pointId,e.worldPos,e.radius,e.normal)}},{id:"watering-can",label:La.active?"Stow Water":"Water",icon:u(Ce),color:La.active?"text-blue-300":"text-blue-400",bg:La.active?"bg-blue-400/30 border-blue-400/60":"bg-blue-500/20 border-blue-500/50",action:()=>{La.active?La.deactivate():La.activate(),Ea.value=La.getState()}},{id:"environment",label:"Ambient",icon:u($e),color:"text-amber-400",bg:"bg-amber-500/20 border-amber-500/50",action:ia.openEnvironmentEditor},{id:"settings",label:"Settings",icon:u(Me),color:"text-gray-300",bg:"bg-gray-500/20 border-gray-400/50",action:()=>{da.openVoiceSettings()}},{id:"help",label:"Help",icon:u(Te),color:"text-yellow-400",bg:"bg-yellow-500/20 border-yellow-500/50",action:()=>{no.value=!no.value}}];return Ko.value&&(S.push({id:"room-config",label:"Room Config",icon:u(Ve),color:"text-orange-400",bg:"bg-orange-500/20 border-orange-500/50",action:Y}),S.push({id:"set-spawn",label:"Set Spawn",icon:u(Pe),color:"text-amber-400",bg:"bg-amber-500/20 border-amber-500/50",action:P$1}),S.push({id:"create-room",label:"Create Room",icon:u(ze),color:"text-sky-400",bg:"bg-sky-500/20 border-sky-500/50",action:()=>{M.value=!0}}),S.push({id:"calibrate-room",label:"Calibrate Room",icon:u(ce),color:"text-indigo-400",bg:"bg-indigo-500/20 border-indigo-500/50",action:()=>xa.startRoomCalibration()})),Je.value&&S.push({id:"character",label:"Character",icon:u(se),color:"text-teal-400",bg:"bg-teal-500/20 border-teal-500/50",action:()=>{eo.value=!0}}),ea.canUndo()&&S.push({id:"undo",label:"Undo",icon:u(De),color:"text-orange-400",bg:"bg-orange-500/20 border-orange-500/50",action:ea.undoLastPlaced}),S});let Yn=[];function fu(){var e;if(no.value=!1,Xa.value=-1,so.value=null,"connecting"===_a.connectionState&&_a.cancelConnection(),ea.clearRadialTarget(),!ea.placingAsset.value){const e=Math.max(3,3*Ye),t=aa.getTargetedObject(e);if(t){const e=Ne.find(e=>e.group===t);!Je.value&&(null==e?void 0:e.locked)||Yo.value&&e&&!Qo.has(e.group)||(ea.radialTarget.value=t,ea.radialTargetName.value=(null==e?void 0:e.name)||"",Yn=$t(t,Ut,Et))}if(!ea.radialTarget.value&&_a.ducts.length>0){const t=Vt();if(t){const o=new Ue.Raycaster;o.setFromCamera(new Ue.Vector2(0,0),t),o.far=e;const n=_a.ducts.filter(e=>e.mesh).map(e=>e.mesh),s=o.intersectObjects(n,!1);if(s.length>0){const e=_a.getDuctIdFromMesh(s[0].object);e&&(so.value=e)}}}}aa.clearProximity(),Qa.value=!0,null==(e=qe())||e.unlock()}function Qv(e){var t;const o=e>=0&&e<Kn.value.length?Kn.value[e]:null,n=null!=(t=null==o?void 0:o.action)?t:null;if(La.active&&"watering-can"!==(null==o?void 0:o.id)&&(La.deactivate(),Ea.value=La.getState()),"connecting"===_a.connectionState&&"connect-duct"!==(null==o?void 0:o.id)&&_a.cancelConnection(),Qa.value=!1,Xa.value=-1,Yn.length>0&&et(Yn),Yn=[],n&&n(),eo.value||to.value||ao.value)return Qa.value=!0,void(eo.value&&(ea.radialTarget.value=null,ea.radialTargetName.value=""));ea.radialTarget.value=null,ea.radialTargetName.value="",!(io.value||oo.value||da.showVoiceSettings.value||ha.showBindModal.value||M.value||_e.value||Dn.value||$a.keypadWizardVisible.value||Fn.value||Ha.value)&&dt()}function xi(){Qa.value=!1,Xa.value=-1,eo.value=!1,to.value=!1,ao.value=!1,Yn.length>0&&et(Yn),Yn=[],ea.radialTarget.value=null,ea.radialTargetName.value="",dt()}let Jn=null,Xn=null,tl=0,al=0;const ol=new Ue.Raycaster,nl=new Ue.Vector2(0,0),ll=new Ue.Vector3,il=[],dl=new Ue.Quaternion,cl=new Ue.Quaternion,ul=new Ue.Vector3(0,0,1),pl=new Ue.Vector3;let vl,fl=0,bl=0,ml=null,hl=0,xl=0,yl=0;function bu(e){var t,o;if(Mo=requestAnimationFrame(bu),!wo.value)return void(tl=e);const n=performance.now();Pa.frameBegin();const s=Math.min((e-tl)/1e3,.1);tl=e;const c=Vt(),u=va.isTouchDevice.value;if(dn&&aa.setRemotePlayerPositions(dn.getPlayerPositions()),va.isTouchDevice.value&&Ge.value&&c){va.updateTouchCamera(c,s);const e=va.leftStick;if(aa.setTouchMoveInput(e.x,e.y,e.active),va.setPlacingMode(!!ea.placingAsset.value),ea.placingAsset.value&&ea.getGhostObject()){const e=ea.getGhostObject();if(e&&1!==va.pinchScale.value){const t=Math.max(.1,Math.min(5,va.pinchScale.value));e.scale.setScalar(t)}0!==va.twoFingerRotation.value&&ea.setGhostRotation(va.twoFingerRotation.value)}va.touchJump.value&&aa.jump(),aa.moveState.sprint=va.touchSprint.value}performance.now(),Ge.value&&(Pa.markBegin("Physics"),aa.updateMovement(s,!0),Pa.markEnd("Physics")),performance.now(),ea.placingAsset.value&&ea.updateGhostPosition(),wa.polygonToolActive.value&&wa.updateTracingHover(),ya.editingRoomMeshes.value&&ya.updateHover();if(++al%(u?10:5)===0){Pa.markBegin("Prox"),aa.updateProximity({showRadial:Qa.value,rotatingObject:!!ea.rotatingObject.value,placingAsset:!!ea.placingAsset.value}),ha.updateProximityHUD({showRadial:Qa.value,placingAsset:!!ea.placingAsset.value,showModal:ha.showBindModal.value||oo.value||da.showVoiceSettings.value||io.value});const e=Qa.value||ea.placingAsset.value?null:$a.getNearbyKeypad(Math.max(4,4*Ye));po.value=e?{isUnlocked:e.isUnlocked,buttons:e.data.buttons.map(e=>({label:e.label,type:e.type})),_inst:e}:null;const n=Ya.getBehaviorProximityHUD({showRadial:Qa.value,placingAsset:!!ea.placingAsset.value,showModal:Dn.value||oo.value||da.showVoiceSettings.value||io.value});if(vo.value=n,Qa.value||ea.placingAsset.value||"idle"!==_a.connectionState)fo.value=null;else{let e=null;const n=Vt();if(n){const s=new Ue.Raycaster;s.setFromCamera(new Ue.Vector2(0,0),n),s.far=Math.max(3,3*Ye);const c=s.intersectObjects(it,!1);for(const o of c){const n=o.object.name||"",s=n.includes("Sock")||n.includes("Vent")||n.includes("vent");let c=null,u=o.object;for(;u;){if(null==(t=u.userData)?void 0:t.isTent){c=u;break}u=u.parent}if(c){if(s){const t=gl(Math.max(2,2*Ye));if(t&&!nd(t.objectId,t.pointId))e="connect-duct";else{const t=ja.getClothState(I(c));e=t?t.isOpen?"close-tent":"open-tent":null}}else{const t=ja.getClothState(I(c));e=t?t.isOpen?"close-tent":"open-tent":null}break}if(s){const t=gl(Math.max(2,2*Ye));t&&!nd(t.objectId,t.pointId)&&(e="connect-duct");break}break}if(null===e&&c.length>0){let t=!1;for(const e of c){let n=e.object;for(;n;){if(null==(o=n.userData)?void 0:o.isTent){t=!0;break}n=n.parent}if(t)break}if(!t){const t=gl(Math.max(3,3*Ye));t&&!nd(t.objectId,t.pointId)&&(e="connect-duct")}}}fo.value=e}Pa.markEnd("Prox")}if(ia.isLightingCycleActive()&&ia.updateLightingCycle(s),ia.placingLightId.value&&ia.updateLightPlacement(),!u&&Ao.length>0&&al%10==0&&c){const e=c.position,t=4,o=2;for(const n of Ao){const s=zo.get(n.group);if(!s)continue;const c=e.distanceTo(n.group.position),u=c<t?Math.min(1,(t-c)/o):0;for(const e of s)u>.01?(e.mat.emissive.set(8965290),e.mat.emissiveIntensity=e.origIntensity+.12*u):(e.mat.emissive.copy(e.origColor),e.mat.emissiveIntensity=e.origIntensity)}}const p=u?5:3;if(sa.tvScreens.length>0&&c&&++fl%p===0){bl=0,ml=null;const e=Math.max(4,4*Ye);ol.setFromCamera(nl,c),ol.far=e;for(const t of sa.tvScreens){if(t.plane.getWorldPosition(ll),ll.distanceToSquared(c.position)>e*e||(il.length=0,ol.intersectObject(t.plane,!1,il),0===il.length||!il[0].uv))continue;if(u&&t.channelActive){const e=Math.max(6,6*Ye);ll.distanceToSquared(c.position)<=e*e&&(ml=t)}const o=1280*(1-il[0].uv.y);if(t===sa.tvConfigModeScreen||t.config.widgets.includes("tv_channel")&&!t.config.channelUrl&&!t.channelActive||o<=110){bl=1,t.config.widgets.includes("tv_channel");break}}}const v=1-Math.exp(-5*s);if(xn+=(bl-xn)*v,u&&fl%p===0&&(wn.value=bl>.5,kn.value!==ml&&(kn.value=ml,ml||(Sn.value=!1))),function(){if(!mn||!hn)return;const e=Vt();if(e)if(xn>.01){const t="sensor"===yn?.16:.22,o="sensor"===yn?-.26:-.18,n=("sensor"===yn?.04:0)-.15-.4*(1-xn);pl.set(t,n,o),pl.applyQuaternion(e.quaternion),mn.position.copy(e.position).add(pl),mn.quaternion.copy(e.quaternion),mn.visible=!0}else mn.visible=!1,yn&&(hn.clear(),yn=null)}(),sa.tvScreens.length>0&&(++hl%3==0&&sa.updateTVInteraction({placingAsset:ea.placingAsset,showRadial:Qa,rotatingObject:ea.rotatingObject}),sa.updateTVButtonScales(s),hl%(u?4:2)==0&&sa.updateTVChannelFrames(),hl%10==0)){const e=Ct();e&&sa.compensateExposure(e.toneMappingExposure)}if(performance.now(),Pa.markBegin("Anims"),ga.updateAnimations(s),Do.v&&Do.v.update(s),Pa.markEnd("Anims"),performance.now(),dn){for(const[e,t]of ra.remotePlayers.value)dn.hasPlayer(e)||(dn.addPlayer(e,t.displayName,t.color,t.characterModel),dn.pushInitialPosition(e,t.position,t.rotationY,t.animation),da.voiceEnabled.value&&da.connectToPeer(e));if(dn.removeStale(ra.remotePlayers.value),Pa.markBegin("MP"),dn.updateAll(s),Pa.markEnd("MP"),ra.connected.value&&c&&++xl%3==0){const{forward:e,backward:t,left:o,right:n,sprint:s}=aa.moveState;let u="idle";if(va.isTouchDevice.value&&va.leftStick.active&&va.leftStick.magnitude>.01){const e=va.leftStick.x,t=va.leftStick.y,o=s?"run":"walk",n=t>.3,c=t<-.3,p=e<-.3,v=e>.3;n&&p?u=`${o}-fl`:n&&v?u=`${o}-fr`:c&&p?u=`${o}-bl`:c&&v?u=`${o}-br`:n?u=`${o}-f`:c?u=`${o}-b`:p?u=`${o}-l`:v&&(u=`${o}-r`)}else if(Ge.value&&(e||t||o||n)){const c=s?"run":"walk";e&&o?u=`${c}-fl`:e&&n?u=`${c}-fr`:t&&o?u=`${c}-bl`:t&&n?u=`${c}-br`:e?u=`${c}-f`:t?u=`${c}-b`:o?u=`${c}-l`:n&&(u=`${c}-r`)}ra.sendLocalState({x:c.position.x,y:c.position.y,z:c.position.z},At(),u)}}if(da.voiceEnabled.value&&dn){const e=Vt();e&&da.updateSpatialPositions(e,dn)}Lt.updateCalibrationMixer(s),_a.updateDucts(s,Pt,Ye);for(const e of Ne){if("procedural://grow-tent"!==e.assetFile)continue;let t=ja.getClothState(I(e.group));t||(t=ja.initClothForGroup(I(e.group)),t&&!0===ga.getToggleState(e.group)&&(ja.setDoorOpen(t,!0,Ye),e.group.userData.disableCollisionWhenOpen&&(wt(e.group),e.collisionEnabled=!1))),t&&ja.updateDoorCloth(t,s,Ye)}La.updateWatering(s,Pt,Ye),La.active&&(Ea.value=La.getState());const f=Ct(),g=St();if(f&&g&&c){if(za.updateContactShadows(),Ia.updateParticles(s,c.position,ia.getSceneLightRefs()),"connecting"===_a.connectionState){ol.setFromCamera(nl,c),ol.far=Math.max(20,20*Ye);const e=ol.intersectObjects(it,!1);_a.updatePreview(e.length>0?e[0].point:ol.ray.at(5*Ye,ll),Ye,Pt)}Pa.markBegin("Render"),performance.now();const e=aa.getCameraTilt();Math.abs(e)>.001?(dl.copy(c.quaternion),cl.setFromAxisAngle(ul,e),c.quaternion.multiply(cl),Da.render(),c.quaternion.copy(dl)):Da.render();const t=performance.now();Pa.markEnd("Render"),Pa.frameEnd(),t-n>50&&performance.now()-yl>2e3&&(yl=performance.now(),f.info)}}function rd(){return va.isTouchDevice.value?Math.min((void 0).devicePixelRatio,1.5):Math.min((void 0).devicePixelRatio,2)}async function wi(e,t){var o,n;jv(),_t.disposeLobbyScene(),Bt.resetRoomLoadFlag(),wo.value=e,bo.value=!0,ho.value=0,xo.value="Initializing...",yo.value="";const u=[];let p=performance.now();const A=(e,t)=>{const o=performance.now();u.length>0&&(u[u.length-1][1]=o-p),u.push([e,0]),p=o,xo.value=e,yo.value=t||""};try{await(null==(n=(o=(void 0).documentElement).requestFullscreen)?void 0:n.call(o))}catch{}if(va.isTouchDevice.value)try{await va.requestLandscape()}catch{}await c(),function(){if(To||!go.value)return;To=!0;const e=go.value,t=e.clientWidth||(void 0).innerWidth||960,o=e.clientHeight||(void 0).innerHeight||540,n=new Ue.Scene;n.background=new Ue.Color(1118481);const c=va.isTouchDevice.value?.1:.05,u=new Ue.PerspectiveCamera(fa.settings.fov,t/o,c,500);u.position.set(0,1.7,0);const p=new Ue.WebGLRenderer({antialias:!va.isTouchDevice.value,powerPreference:"high-performance",logarithmicDepthBuffer:!va.isTouchDevice.value});p.setSize(t,o),p.setPixelRatio(rd()),p.toneMapping=va.isTouchDevice.value?Ue.AgXToneMapping:Ue.ACESFilmicToneMapping,p.toneMappingExposure=1;const v=fa.settings.shadowQuality;p.shadowMap.enabled="off"!==v,p.shadowMap.type="high"===v?Ue.PCFSoftShadowMap:Ue.PCFShadowMap,e.appendChild(p.domElement),p.domElement.addEventListener("webglcontextlost",e=>{e.preventDefault(),Mo&&(cancelAnimationFrame(Mo),Mo=0)}),p.domElement.addEventListener("webglcontextrestored",()=>{const t=Ct();if(t){const o=e.clientWidth||(void 0).innerWidth,n=e.clientHeight||(void 0).innerHeight;t.setPixelRatio(rd()),t.setSize(o,n)}tl=performance.now(),Mo=requestAnimationFrame(bu)});const f=new ua(u,p.domElement);f.pointerSpeed=.5*fa.settings.mouseSensitivity,f.addEventListener("lock",()=>{ko.value=!0,Ge.value=!0}),f.addEventListener("unlock",()=>{ko.value=!1,aa.stopFootsteps()}),(void 0).addEventListener("pointerlockerror",()=>{Ge.value&&f.isLocked}),s(()=>fa.settings.mouseSensitivity,e=>{const t=qe();t&&(t.pointerSpeed=.5*e)}),s(()=>fa.settings.fov,e=>{const t=Vt();t&&(t.fov=e,t.updateProjectionMatrix())}),s(()=>fa.settings.shadowQuality,e=>{const t=Ct();t&&(t.shadowMap.enabled="off"!==e,t.shadowMap.type="high"===e?Ue.PCFSoftShadowMap:Ue.PCFShadowMap,t.shadowMap.needsUpdate=!0)}),oa.setSfxVolume(fa.settings.sfxVolume),s(()=>fa.settings.sfxVolume,e=>{oa.setSfxVolume(e)}),p.domElement.addEventListener("click",()=>{if(!va.isTouchDevice.value&&!f.isLocked&&Ge.value&&!oo.value&&!ha.showBindModal.value&&!lo.value&&!io.value&&!da.showVoiceSettings.value&&!Qa.value&&(!$a.keypadWizardVisible.value||wa.polygonToolActive.value)&&!Dn.value&&!Fn.value&&!Lt.calibratingCharacter.value&&!Ha.value)try{f.lock()}catch{}}),Wt(n),Nt(u),Ht(p),Tt(f),Da.initPostProcessing(p,n,u,fa.settings.bloom,fa.settings.bloomIntensity,fa.settings.bloomThreshold),va.isTouchDevice.value&&va.attach(p.domElement),mn=new Ue.Group,mn.visible=!1;const g=new Ue.PointLight(16777215,.4,4);g.position.set(0,.3,.3),mn.add(g),hn=new Ue.Group,mn.add(hn),n.add(mn),(void 0).addEventListener("keydown",Py),(void 0).addEventListener("keyup",Dy),(void 0).addEventListener("click",Uv),(void 0).addEventListener("wheel",Ry,{passive:!1}),(void 0).addEventListener("mousedown",Oy),(void 0).addEventListener("mouseup",zy);let b=null,h=0,x=0;Jn=()=>{if(!e||!u||!p)return;const t=e.clientWidth||(void 0).innerWidth,o=e.clientHeight||(void 0).innerHeight;t===h&&o===x||(h=t,x=o,u.aspect=t/o,u.updateProjectionMatrix(),p.setPixelRatio(rd()),p.setSize(t,o),Da.setSize(t,o),Da.setPixelRatio(rd()),b&&clearTimeout(b),b=setTimeout(()=>{b=null;for(const e of sa.tvScreens)e.channelActive||sa.rerenderTV(e),sa.renderBtnOverlay(e)},200))},(void 0).addEventListener("resize",Jn),Xn=()=>{null==Jn||Jn(),sa.onFullscreenChange()},(void 0).addEventListener("fullscreenchange",Xn),tl=performance.now(),Mo=requestAnimationFrame(bu)}();const v=St(),f=Vt(),g=Ct();ra.leaveRoom(),null==dn||dn.dispose(),dn=null;const b=[];v.traverse(e=>{var t;e===mn||e.parent===mn||e.parent===f||("Group"===e.type||"Mesh"===e.type||(null==(t=e.userData)?void 0:t.managedLight))&&b.push(e)});for(const e of b)v.remove(e),ut(e);for(const[,e]of Xe)ut(e);Xe.clear(),ia.cleanupLighting(),za.cleanupContactShadows(),Ra.cleanupLensflare(),Ia.cleanupParticles(),ja.cleanup(),_a.cleanupDucting(),La.cleanupWatering(),g&&(g.domElement.style.filter="",g.domElement.style.transform=""),Ca.stopDisplayRefreshTimer(),sa.cleanupAllTVScreens(),$a.disposeAllKeypads(),ka.disposeAllTextPanels(),wa.cancelTracing(),ya.cleanupMeshEditor(),ga.disposeAll(),Do.v&&(Do.v.stopAllAction(),Do.v=null),Oo=[],Ro=null,hn&&hn.clear(),mn&&(mn.visible=!1),yn=null,xn=0,qa.clear(),Ka.clear(),Ya.clear(),vt.length=0,it.length=0,Ne.length=0,Bt.placedCount.value=0,ea.cancelPlacing(),ea.clearRadialTarget(),ea.confirmRotation(),aa.cleanupPhysics(),await Bt.loadRoomSpawns(),await Bt.loadRoomCalibrations(),await Bt.loadRoomHiddenMeshes(),await Bt.loadRoomMeshSimplifications();try{A("Downloading room...",e.name);const o=await fetch(e.file);if(!o.ok)throw new Error(`Failed to load ${e.file}: ${o.status}`);const n=o.headers.get("content-length");let s=n?parseInt(n,10):0;if(!s){const t=e.size.match(/([\d.]+)\s*MB/i);t&&(s=Math.round(1024*parseFloat(t[1])*1024))}const c=o.body.getReader(),u=[];let p=0;for(;;){const{done:e,value:t}=await c.read();if(e)break;u.push(t),p+=t.length,s>0&&(ho.value=Math.min(30,Math.round(p/s*30)))}const g=new Uint8Array(p);let b=0;for(const e of u)g.set(e,b),b+=e.length;A("Parsing model..."),ho.value=31;const h=e.file.substring(0,e.file.lastIndexOf("/")+1),x=await new Promise((e,t)=>{(new ta).parse(g.buffer,h,e,t)}),S=x.scene;ho.value=34,A("Optimizing meshes..."),await Ga.processRoomEnvironment(S,e.name||e.id);const $=(new Ue.Box3).setFromObject(S),M=$.getCenter(new Ue.Vector3),T=$.getSize(new Ue.Vector3);let V=$.min.y;const O=Math.max(T.x,T.z),I=.03*O,j=[];S.traverse(e=>{e.isMesh&&j.push(e)}),f.far=Math.max(2e3,20*O),f.updateProjectionMatrix(),ho.value=37,A("Loading skybox...");try{const e=new Ue.TextureLoader,t=await new Promise((t,o)=>{e.load("/data/appdata/images/equirectangular/rogland_clear_night_2k.jpg",t,void 0,o)});t.mapping=Ue.EquirectangularReflectionMapping,t.colorSpace=Ue.SRGBColorSpace,t.wrapS=Ue.RepeatWrapping,t.wrapT=Ue.ClampToEdgeWrapping,t.generateMipmaps=!1,t.minFilter=Ue.LinearFilter,t.magFilter=Ue.LinearFilter,ia.createBackgroundSphere(t)}catch{}if(ho.value=40,A("Setting up scene..."),v.add(S),S.updateMatrixWorld(!0),Ro=S,Oo=x.animations||[],Do.v&&(Do.v.stopAllAction(),Do.v=null),e.animated&&Oo.length>0){Do.v=new Ue.AnimationMixer(S);for(const e of x.animations){const t=Do.v.clipAction(e);t.setLoop(Ue.LoopRepeat,1/0),t.play()}Do.v.update(0)}A("Building collision...",`${j.length} meshes`),ho.value=42;for(let e=0;e<j.length;e++){const t=j[e],o=(new Ue.Box3).setFromObject(t).getSize(new Ue.Vector3);(o.x>I||o.z>I)&&(pt(t),vt.push(t)),it.push(t),e%8==7&&(ho.value=42+Math.round((e+1)/j.length*6),await new Promise(e=>setTimeout(e,0)))}ho.value=48;const F=Bt.roomCalibrations.value[e.id],_=F&&F.unitPerMeter>0?F:null;let E;if(_)V=_.floorY,E=_.unitPerMeter;else{const e=new Ue.Raycaster(new Ue.Vector3(M.x,$.max.y+1,M.z),new Ue.Vector3(0,-1,0));e.far=T.y+2;const t=e.intersectObjects(j,!1);if(t.length>0){const e=M.y-.1*T.y;let o=t[0];for(const n of t)Math.abs(n.point.y-e)<Math.abs(o.point.y-e)&&(o=n);V=o.point.y}E=0}ft(V);const U=Bt.roomSpawns.value[e.id];let N;if(U){if(N=U.y,f.position.set(U.x,U.y,U.z),null!=U.yaw&&null!=U.pitch){f.rotation.order="YXZ";const e=Math.max(-Math.PI/2,Math.min(Math.PI/2,U.pitch));f.rotation.set(e,U.yaw,0)}}else _?(N=V+1.6*E,f.position.set(M.x,N,M.z)):(N=V+.4*T.y,f.position.set(M.x,N,M.z));_||(E=(N-V)/1.7),bt(N),mt(.25*O),ht(Math.max(.25,.015*O)),yt(E),aa.initDynamicGround(),aa.initPlayerCollider(),xa.setRoomCalibrationCallbacks({envId:e.id,maxDim:O,persistSave:(e,t,o)=>Bt.saveRoomCalibration(e,t,o),physicsInit:()=>{aa.initDynamicGround(),aa.initPlayerCollider(),dn&&dn.updateRoomScale(V,N)},saveSpawn:(e,t)=>Bt.saveRoomSpawn(e,t),rescaleObjects:(e,t)=>{const o=t/e;for(const e of Ne){const t=e.group.scale.x*o;e.group.scale.setScalar(t),e.scale=t}xt()}}),A("Loading metadata..."),ho.value=48,ia.setRoomGeometryCache({center:M.clone(),size:T.clone(),floorY:V,maxDim:O}),await ia.loadRoomLighting(e.id);const J={center:M.clone(),size:T.clone()};za.initContactShadows(V,J,fa.settings.contactShadows),Ia.initParticles({min:new Ue.Vector3(M.x-.5*T.x,V,M.z-.5*T.z),max:new Ue.Vector3(M.x+.5*T.x,V+T.y,M.z+.5*T.z)},fa.settings.dustParticleCount,fa.settings.dustParticles),await ka.initTextPanels(),ho.value=50,await Bt.loadAssetScales(),await Bt.loadAssetRotations(),await Bt.loadAssetAnimMeta(),ho.value=51,await Bt.loadAssetMeta(),await Bt.loadAssetThumbOffsets(),await Bt.loadAssetBindingDefaults(),ho.value=53,ga.loadAnimMetaBulk(Bt.assetAnimMeta.value),ga.setGetAssetMetaCallback(e=>Bt.getAssetMeta(e)),ga.setOnToggleCompleteCallback((e,t)=>{var o,n;aa.markOctreeDirty();const s=Ne.find(t=>t.group===e);s&&(((null==(n="door"===(null==(o=s.behavior)?void 0:o.type)?s.behavior.config:null)?void 0:n.disableCollisionWhenOpen)||e.userData.disableCollisionWhenOpen)&&(t?(wt(e),s.collisionEnabled=!1):(rt(e),s.collisionEnabled=!0),aa.markOctreeDirty()),s.systemId&&qa.emit("object:animation-end",{objectId:s.systemId,clipName:""}))}),Ka.setAnimateCallback((e,t,o)=>{var n,s,c;const u=Ne.find(t=>t.systemId===e);if(u)if(o){if("full"!==o.range){const e="half"===o.range?0:(null!=(n=o.rangeStart)?n:0)/100,t="half"===o.range?.5:(null!=(s=o.rangeEnd)?s:100)/100;ga.updateInstanceRange(u.group,{animRange:"half"===o.range?"half":"custom",animRangeStart:e,animRangeEnd:t})}if("forward"===o.direction)ga.remoteToggle(u.group,!0);else if("reverse"===o.direction)ga.remoteToggle(u.group,!1);else{const e=null!=(c=ga.getToggleState(u.group))&&c;ga.remoteToggle(u.group,!e)}}else ga.remoteToggle(u.group,t)}),Ka.setTravelCallback((e,t)=>{const o=We.find(t=>t.id===e);o&&wi(o)}),Ka.setToggleCollisionCallback((e,t)=>{const o=Ne.find(t=>t.systemId===e);o&&(t?(rt(o.group),o.collisionEnabled=!0):(wt(o.group),o.collisionEnabled=!1),aa.markOctreeDirty())}),Ka.setPropertyCallback((e,t,o)=>{const n=Ne.find(t=>t.systemId===e);n&&(n.properties||(n.properties={}),n.properties[t]=o)}),Ka.setToggleVisibilityCallback((e,t)=>{const o=Ne.find(t=>t.systemId===e);o&&(o.group.visible=t)}),Ya.setRoomTransitionCallback((e,t)=>{const o=We.find(t=>t.id===e);o&&wi(o)}),Ya.setToggleEnvLightCallback(e=>{const t=ia.getLightingConfig();if(!t)return;const o=t.presets.find(e=>e.id===t.activePresetId);if(!o)return;const n=o.lights.find(t=>t.id===e);n&&(n.enabled=!n.enabled,ia.applyActivePreset())}),Ya.setEnvLightStateCallback(e=>{Jr(e)}),Ya.setPlayClickSoundCallback(()=>{oa.playSfx("click"),oa.playHaptic(20)}),Ya.setKeypadCallbacks(e=>{var t;return!0===(null==(t=Ne.find(t=>(t.systemId||"")===e))?void 0:t.keypadUnlocked)},(e,t)=>{var o;return!0===(null==(o=Ne.find(t=>(t.systemId||"")===e))?void 0:o.keypadUnlocked)}),Ya.setLocalPlayerId("local"),Bt.loadAssetCatalog(),A("Loading objects..."),await Bt.loadRoomState(e.id,(e,t,o)=>{ho.value=53+Math.round(e/Math.max(t,1)*32),yo.value=`${o} (${e+1}/${t})`}),ho.value=85,_a.initDucting();const Z=await Bt.loadDuctConnections(e.id);Z.length>0&&function(e){for(const t of e){const e=cu(t.startObjectId,t.startPointId);if(!e)continue;let o=null;o="__freeEnd"===t.endObjectId&&t.freeEndPos?new Ue.Vector3(t.freeEndPos.x,t.freeEndPos.y,t.freeEndPos.z):cu(t.endObjectId,t.endPointId),o&&_a.createDuct(t,e,o,Ye)}}(Z),La.initWatering(Ye);const X=Bt.roomMeshSimplifications.value[e.id]||{};Object.keys(X).length>0&&ya.applyPerMeshSimplifications(X);const ee=Bt.roomHiddenMeshes.value[e.id]||[];ee.length>0&&ya.applyHiddenMeshes(ee),A("Building collision octree..."),vt.length>0&&aa.buildOctree(),ho.value=86,A("Connecting devices..."),ha.init(ma),ma.fetchAllStates().catch(()=>{}),Za().catch(()=>{}),ha.startPolling(5e3),A("Connecting multiplayer...",_t.selectedCharacter.value),ho.value=87,await Lt.loadCharacterCalibration(_t.selectedCharacter.value),dn=new l8(v,V,N,`/data/appdata/models/characters/${encodeURIComponent(_t.selectedCharacter.value)}`),dn.setCalibration(Lt.characterCalibration),Lt.setRemotePlayerManager(dn);try{const e=await $fetch("/api/room3d/character-calibration");e&&Object.keys(e).length>0&&dn.setCalibrationMap(e)}catch{}try{await dn.preloadModel()}catch{}ho.value=92,ra.onPlayerMoved((e,t,o,n,s)=>{null==dn||dn.pushPlayerState(e,{position:t,rotationY:o,animation:n,seq:s})}),ra.onPlayersInit(e=>{if(dn)for(const t of e)dn.hasPlayer(t.peerId)||(dn.addPlayer(t.peerId,t.displayName,t.color,t.characterModel),dn.pushInitialPosition(t.peerId,t.position,t.rotationY,t.animation),da.voiceEnabled.value&&da.connectToPeer(t.peerId))}),ra.onRoomStateChanged(null),ra.onObjectDelta(e=>{if(wo.value)if("object:placed"===e.type&&e.object)Bt.spawnSavedObject(e.object,e.systemId,e.locked),za.markDirty();else if("object:deleted"===e.type&&e.identifier)Bt.removeObjectByIdentifier(e.identifier),za.markDirty();else if("object:moved"===e.type&&e.identifier&&e.position&&e.quaternion)Bt.moveObjectByIdentifier(e.identifier,e.position,e.quaternion,e.scale),za.markDirty();else if("object:toggled"===e.type&&null!=e.identifier){const t=Ne.find(t=>Bt.getObjectIdentifier(t)===e.identifier);t&&ga.remoteToggle(t.group,e.toggleState)}}),ra.onTVChanged((e,t,o)=>{const n=sa.tvScreens.find(e=>{var o;return(null==(o=Ne.find(t=>t.group===e.group))?void 0:o.systemId)===t});if(!n)return;sa.stopTVChannel(n),n.config.channelUrl=o||void 0;const s=Ne.find(e=>e.group===n.group);s&&(s.tvConfig={...n.config,widgets:[...n.config.widgets]}),o&&sa.syncTVChannel(n),sa.rerenderTV(n)}),ra.onPlayerLeft(e=>{da.disconnectPeer(e),null==dn||dn.setSpeaking(e,!1)}),da.onPeerSpeakingChanged((e,t)=>{null==dn||dn.setSpeaking(e,t)}),ra.joinRoom(e.id,t||(Ko.value?"Owner":void 0),{x:f.position.x,y:f.position.y,z:f.position.z},_t.selectedCharacter.value,vl),vl=void 0;const oe=Xo.getSettings(e.id);Ko.value&&(oe.isPublic||oe.inviteOnly)&&Bv(e.id);const ne=(N-V)/1.7;da.autoJoinVoice.value?da.initVoice(ra,ne).then(()=>{for(const e of ra.remotePlayers.value.keys())da.connectToPeer(e)}).catch(e=>{}):da.setMultiplayerRef(ra,ne)}catch{}A("Compiling shaders..."),ho.value=93;const h=Ct();if(h&&f&&v){try{await h.compileAsync(v,f)}catch{h.compile(v,f)}ho.value=95,A("Uploading textures...");const e=new Map,t=new Map;v.traverse(o=>{o.visible||(t.set(o,!1),o.visible=!0),o.frustumCulled&&(e.set(o,!0),o.frustumCulled=!1)}),h.render(v,f);for(const[e,o]of t)e.visible=o;for(const[t]of e)t.frustumCulled=!0;h.info.reset()}ho.value=98,Ca.renderAllDisplayZones(),Ca.startDisplayRefreshTimer(),A("Ready!"),ho.value=100;const x=u[u.length-1];x&&(x[1]=performance.now()-p);for(const[e,t]of u);Ge.value=!0,bo.value=!1,Vo&&clearInterval(Vo),Vo=Xt(),sa.startDistanceCheck(),Bt.generateCachedThumbnails().then(()=>{setTimeout(()=>Bt.generateMissingThumbnailsBackground(),5e3)}),dt(),rl(fa.settings.debugOverlay)}function yh(e,t){Ho.value=!1,wi(e,t)}function hh(e){const t=We.find(t=>t.id===e.envId);if(t){if(Ho.value=!0,vl=e.password||void 0,e.password)try{const t=JSON.parse(localStorage.getItem("sf_room3d_room_passwords")||"{}");t[e.envId]=e.password,localStorage.setItem("sf_room3d_room_passwords",JSON.stringify(t))}catch{}wi(t,_t.displayName.value||"Visitor")}}async function xh(e){try{const t=Qt();if(await t.init(),!t.isReady.value)return;const o=t.parseInviteToken(e);if(!o)return;const n=We.find(e=>e.id===o.envId);if(!n)return;Ho.value=!0,wi(n,_t.displayName.value||"Visitor")}catch{}}return(e,t,o,n)=>{var s,c,u,h,x,I,se,re,de;const ce=Fa,ue=Ba,pe=Wa,ve=Wo,fe=Jt,ge=Go,be=Zo,he=en,xe=rn,ye=wl,ke=Ts,Se=Rs,Ce=Ws,$e=sr,Me=cr;t(`<div${F(p({class:["w-full h-full relative bg-black isolate",{"touch-immersive":v(va).isTouchDevice.value}]},n))} data-v-6f91a0ba>`),v(Je)&&v(Ge)&&!v(va).isTouchDevice.value?t('<div class="absolute top-4 left-4 z-40 pointer-events-none" data-v-6f91a0ba><div class="bg-amber-500/15 border border-amber-500/30 rounded-full px-3 py-1" data-v-6f91a0ba><span class="text-amber-400 text-base font-bold" data-v-6f91a0ba>EDIT MODE</span></div></div>'):t("\x3c!----\x3e"),t(_(ce,{"invite-code":v(sn),onDismiss:gy},null,o)),t(_(ue,{"ws-connected":v(ra).wsConnected.value,onDismiss:py},null,o)),t(_(pe,{"show-add-channel-modal":v(lo),"add-channel-url":v(Io),"onUpdate:addChannelUrl":e=>f(Io)?Io.value=e:null,"add-channel-name":v(jo),"onUpdate:addChannelName":e=>f(jo)?jo.value=e:null,"add-channel-category":v(Fo),"onUpdate:addChannelCategory":e=>f(Fo)?Fo.value=e:null,"add-channel-testing":v(Lo),"add-channel-test-result":v(Bo),categories:Eo,onCancel:Ty,onSave:My,onTest:$y},null,o)),t(_(ve,{"current-room-id":null==(s=v(wo))?void 0:s.id,onSave:e=>{var t,o;return v(ia).saveEnvironmentEditor(null!=(o=null==(t=v(wo))?void 0:t.id)?o:null)},onReset:e=>{var t,o;return v(ia).resetEnvironmentDefaults(null!=(o=null==(t=v(wo))?void 0:t.id)?o:null)}},null,o)),E(t,e=>{v(M)?(e(`<div class="fixed inset-0 z-[200] flex items-center justify-center bg-black/70 backdrop-blur-sm" data-v-6f91a0ba><div class="bg-gray-900 border border-white/10 rounded-2xl w-full max-w-lg mx-4 p-6 shadow-2xl max-h-[85vh] overflow-y-auto" data-v-6f91a0ba><h2 class="text-xl font-bold text-white mb-4" data-v-6f91a0ba>Create Room</h2><div class="flex items-center bg-gray-800/60 rounded-xl p-0.5 border border-white/10 mb-4" data-v-6f91a0ba><button class="${U(["existing"===v(T)?"bg-white/[0.12] text-white":"text-white/40 hover:text-white/60","flex-1 px-3 py-1.5 rounded-lg text-base font-bold transition-all"])}" data-v-6f91a0ba> Existing Models </button><button class="${U(["upload"===v(T)?"bg-white/[0.12] text-white":"text-white/40 hover:text-white/60","flex-1 px-3 py-1.5 rounded-lg text-base font-bold transition-all"])}" data-v-6f91a0ba> Upload New </button></div>`),"existing"===v(T)?(e("\x3c!--[--\x3e"),0===v(je).length?e('<div class="text-center py-6 text-white/30 text-base" data-v-6f91a0ba> No room models available </div>'):(e('<div class="grid grid-cols-2 gap-2 mb-4 max-h-64 overflow-y-auto pr-1" data-v-6f91a0ba>\x3c!--[--\x3e'),N(v(je),t=>{var o,n;e(`<button class="${U([(null==(o=v(Ie))?void 0:o.file)===t.file?"border-emerald-500 ring-1 ring-emerald-500/40":"border-white/10 hover:border-white/25","relative rounded-xl overflow-hidden border transition-all text-left"])}" data-v-6f91a0ba><div class="h-20 bg-gray-800 overflow-hidden" data-v-6f91a0ba>`),t.image?e(`<img${J("src",t.image)}${J("alt",t.name)} class="w-full h-full object-cover" data-v-6f91a0ba>`):e('<div class="w-full h-full flex items-center justify-center text-white/10" data-v-6f91a0ba><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" data-v-6f91a0ba></path></svg></div>'),e(`</div><div class="px-2 py-1.5" data-v-6f91a0ba><div class="text-base text-white font-medium truncate" data-v-6f91a0ba>${Z(t.name)}</div><div class="text-base text-white/30" data-v-6f91a0ba>${Z(t.size)} Â· ${Z(t.source)}</div></div>`),(null==(n=v(Ie))?void 0:n.file)===t.file?e('<div class="absolute top-1 right-1 w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center" data-v-6f91a0ba><svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" data-v-6f91a0ba></path></svg></div>'):e("\x3c!----\x3e"),e("</button>")}),e("\x3c!--]--\x3e</div>")),e("\x3c!--]--\x3e")):e("\x3c!----\x3e"),"upload"===v(T)?e('\x3c!--[--\x3e<label class="block mb-3" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Room model (.glb)</span><input type="file" accept=".glb" class="w-full text-base text-white/60 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:bg-emerald-500/20 file:text-emerald-400 file:font-bold file:cursor-pointer hover:file:bg-emerald-500/30" data-v-6f91a0ba></label><label class="block mb-4" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Preview image (optional)</span><input type="file" accept=".webp,.jpg,.jpeg,.png" class="w-full text-base text-white/60 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:bg-gray-700 file:text-white/60 file:font-bold file:cursor-pointer hover:file:bg-gray-600" data-v-6f91a0ba></label>\x3c!--]--\x3e'):e("\x3c!----\x3e"),e(`<label class="block mb-3" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Room Name</span><input${J("value",v(V))} type="text" maxlength="100" placeholder="My Room" class="w-full bg-gray-800 border border-white/10 rounded-xl px-4 py-2.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba></label><label class="block mb-3" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Description</span><input${J("value",v(O))} type="text" maxlength="500" placeholder="Optional description" class="w-full bg-gray-800 border border-white/10 rounded-xl px-4 py-2.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba></label>`),v(Ze)?e(`<div class="flex items-center gap-3 mb-5" data-v-6f91a0ba><label class="relative inline-flex items-center cursor-pointer" data-v-6f91a0ba><input type="checkbox"${X(Array.isArray(v(le))?ee(v(le),null):v(le))?" checked":""} class="sr-only peer" data-v-6f91a0ba><div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-amber-500 peer-checked:after:translate-x-full after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all" data-v-6f91a0ba></div></label><span class="text-base text-white/50" data-v-6f91a0ba>System room (admin)</span></div>`):e("\x3c!----\x3e"),v(Oe)?e(`<div class="mb-4" data-v-6f91a0ba><div class="h-2 bg-gray-800 rounded-full overflow-hidden" data-v-6f91a0ba><div class="h-full bg-emerald-500 transition-all duration-300 rounded-full" style="${oe({width:v(Re)+"%"})}" data-v-6f91a0ba></div></div><p class="text-base text-white/40 mt-1" data-v-6f91a0ba>${Z("upload"===v(T)?"Uploading...":"Creating...")}</p></div>`):e("\x3c!----\x3e"),e(`<div class="flex justify-end gap-3" data-v-6f91a0ba><button class="px-4 py-2 rounded-xl text-base text-white/50 hover:text-white/80 transition-colors" data-v-6f91a0ba>Cancel</button><button${X(!v(V).trim()||"upload"===v(T)&&!v(j)||"existing"===v(T)&&!v(Ie)||v(Oe))?" disabled":""} class="px-6 py-2 rounded-xl text-base font-bold text-white bg-emerald-600 hover:bg-emerald-500 disabled:opacity-30 disabled:cursor-not-allowed transition-colors" data-v-6f91a0ba> Create &amp; Enter </button></div></div></div>`)):e("\x3c!----\x3e")},"body",!1,o),E(t,e=>{v(_e)?(e(`<div class="fixed inset-0 z-[200] flex items-center justify-center bg-black/70 backdrop-blur-sm" data-v-6f91a0ba><div class="bg-gray-900 border border-white/10 rounded-2xl w-full max-w-lg mx-4 p-6 shadow-2xl max-h-[85vh] overflow-y-auto" data-v-6f91a0ba><h2 class="text-xl font-bold text-white mb-5" data-v-6f91a0ba>Room Configuration</h2><label class="block mb-3" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Name</span><input${J("value",v(Le))} type="text" maxlength="100" class="w-full bg-gray-800 border border-white/10 rounded-xl px-4 py-2.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba></label><label class="block mb-4" data-v-6f91a0ba><span class="text-base text-white/50 mb-1 block" data-v-6f91a0ba>Description</span><input${J("value",v(tt))} type="text" maxlength="500" class="w-full bg-gray-800 border border-white/10 rounded-xl px-4 py-2.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba></label><div class="flex items-center gap-3 mb-3" data-v-6f91a0ba><label class="relative inline-flex items-center cursor-pointer" data-v-6f91a0ba><input type="checkbox"${X(Array.isArray(v(nt))?ee(v(nt),null):v(nt))?" checked":""} class="sr-only peer" data-v-6f91a0ba><div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-full after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all" data-v-6f91a0ba></div></label><span class="text-base text-white/50" data-v-6f91a0ba>Animated room (loop)</span></div><div class="flex items-center gap-3 mb-4" data-v-6f91a0ba><label class="relative inline-flex items-center cursor-pointer" data-v-6f91a0ba><input type="checkbox"${X(Array.isArray(v(lt))?ee(v(lt),null):v(lt))?" checked":""} class="sr-only peer" data-v-6f91a0ba><div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-amber-500 peer-checked:after:translate-x-full after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all" data-v-6f91a0ba></div></label><span class="text-base text-white/50" data-v-6f91a0ba>Hidden from guests</span></div>`),v(Uo)?(e(`<div class="mb-4 pt-3" style="${oe({"border-top":"1px solid rgba(255,255,255,0.06)"})}" data-v-6f91a0ba><span class="text-base text-white/40 uppercase tracking-wide block mb-2" data-v-6f91a0ba>Sharing</span><div class="flex items-center gap-3 mb-2" data-v-6f91a0ba><label class="relative inline-flex items-center cursor-pointer" data-v-6f91a0ba><input type="checkbox"${X(Array.isArray(v(Mt))?ee(v(Mt),null):v(Mt))?" checked":""} class="sr-only peer" data-v-6f91a0ba><div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-emerald-500 peer-checked:after:translate-x-full after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all" data-v-6f91a0ba></div></label><span class="${U([v(Mt)?"text-emerald-400/80":"text-white/35","text-base"])}" data-v-6f91a0ba>${Z(v(Mt)?"Public visible":"Not public")}</span></div><div class="flex items-center gap-3 mb-2" data-v-6f91a0ba><label class="relative inline-flex items-center cursor-pointer" data-v-6f91a0ba><input type="checkbox"${X(!v(Dt))?" checked":""} class="sr-only peer" data-v-6f91a0ba><div class="w-9 h-5 bg-gray-700 rounded-full peer peer-checked:bg-sky-500 peer-checked:after:translate-x-full after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all" data-v-6f91a0ba></div></label><span class="${U([v(Dt)?"text-white/35":"text-sky-400/80","text-base"])}" data-v-6f91a0ba>${Z(v(Dt)?"Invite only":"Open to all")}</span></div><div class="flex items-center gap-2 mb-2" data-v-6f91a0ba><span class="text-base text-white/40 shrink-0 w-20" data-v-6f91a0ba>Password</span><input type="text"${J("value",v(Ot))} maxlength="32" placeholder="(none)" class="flex-1 bg-gray-800 border border-white/10 rounded-lg px-3 py-1.5 text-white text-base placeholder-white/20 focus:border-amber-500/50 focus:outline-none" data-v-6f91a0ba></div>`),v(Mt)?e(`<div class="space-y-1.5" data-v-6f91a0ba><input type="text"${J("value",v(Rt))} maxlength="60"${J("placeholder",v(Le)||"Public name")} class="w-full bg-gray-800 border border-white/10 rounded-lg px-3 py-1.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba><input type="text"${J("value",v(It))} maxlength="200" placeholder="Public description..." class="w-full bg-gray-800 border border-white/10 rounded-lg px-3 py-1.5 text-white text-base placeholder-white/20 focus:border-emerald-500/50 focus:outline-none" data-v-6f91a0ba></div>`):e("\x3c!----\x3e"),e("</div>")):e("\x3c!----\x3e"),v(Je)?(e(`<div class="mb-4" data-v-6f91a0ba><div class="flex items-center justify-between mb-2" data-v-6f91a0ba><span class="text-base text-white/50" data-v-6f91a0ba>Hidden Room Meshes</span><span class="text-base text-white/30" data-v-6f91a0ba>${Z(v(Ft).length)}</span></div>`),v(Ft).length>0?(e('<div class="max-h-32 overflow-y-auto mb-2 space-y-1" data-v-6f91a0ba>\x3c!--[--\x3e'),N(v(Ft),t=>{e(`<div class="flex items-center justify-between px-3 py-1.5 bg-gray-800/50 rounded-lg" data-v-6f91a0ba><span class="text-base text-white/70 truncate" data-v-6f91a0ba>${Z(v(ya).getMeshName(t))}</span><button class="text-base text-emerald-400 hover:text-emerald-300 ml-2 shrink-0" data-v-6f91a0ba> Restore </button></div>`)}),e("\x3c!--]--\x3e</div>")):e("\x3c!----\x3e"),e('<button class="w-full py-2 rounded-lg border border-white/10 bg-gray-800/50 text-base text-white/70 hover:bg-gray-700/50 hover:text-white transition-colors" data-v-6f91a0ba> Edit Room Meshes </button></div>')):e("\x3c!----\x3e"),v(wo)?e(`<div class="mb-5 text-base text-white/30 space-y-1" data-v-6f91a0ba><p data-v-6f91a0ba>ID: <span class="text-white/50 font-mono" data-v-6f91a0ba>${Z(v(wo).id)}</span></p><p data-v-6f91a0ba>File: <span class="text-white/50 font-mono" data-v-6f91a0ba>${Z(v(wo).file)}</span></p><p data-v-6f91a0ba>Source: <span class="text-white/50" data-v-6f91a0ba>${Z(v(wo).source||"system")}</span></p></div>`):e("\x3c!----\x3e"),e(`<div class="flex items-center gap-3" data-v-6f91a0ba><button class="px-4 py-2 rounded-xl text-base font-bold text-red-400 hover:bg-red-500/10 transition-colors" data-v-6f91a0ba>Delete Room</button><div class="flex-1" data-v-6f91a0ba></div><button class="px-4 py-2 rounded-xl text-base text-white/50 hover:text-white/80 transition-colors" data-v-6f91a0ba>Cancel</button><button${X(v(kt))?" disabled":""} class="px-6 py-2 rounded-xl text-base font-bold text-white bg-emerald-600 hover:bg-emerald-500 disabled:opacity-30 disabled:cursor-not-allowed transition-colors" data-v-6f91a0ba> Save </button></div></div></div>`)):e("\x3c!----\x3e")},"body",!1,o),v(mo)&&!v(wo)?t('<div class="absolute inset-0 z-20 flex flex-col items-center justify-center bg-gray-950" data-v-6f91a0ba><div class="w-10 h-10 border-2 border-white/5 border-t-emerald-400 rounded-full animate-spin mb-4" data-v-6f91a0ba></div><p class="text-white/40 text-base" data-v-6f91a0ba>Connecting to room...</p></div>'):t("\x3c!----\x3e"),v(wo)||!v(S)||v(mo)?t("\x3c!----\x3e"):t(_(fe,{key:v($),environments:v(We),"available-characters":v(_t).availableCharacters.value,"selected-character":v(_t).selectedCharacter.value,"carousel-selected-idx":v(_t).carouselSelectedIdx.value,"lobby-char-loading":v(_t).lobbyCharLoading.value,"display-name":v(_t).displayName.value,"is-dev":v(Ze),"edit-mode":v(Je),authenticated:v(Uo),"room-settings":v(Xo).roomSettings.value,"invite-tokens":v(an),"copied-token":v(_t).copiedCode.value,"active-room-idx":v(_t).activeRoomIdx.value,onSelectEnvironment:yh,onPrevChar:v(_t).lobbyPrevChar,onNextChar:v(_t).lobbyNextChar,onLobbyWheel:v(_t).onLobbyWheel,onUpdateRoomSettings:Ay,onCopyLink:Vy,"onUpdate:displayName":e=>v(_t).displayName.value=e,"onUpdate:editMode":e=>Je.value=e,onSaveDisplayName:v(_t).saveDisplayName,onRoomScroll:v(_t).onRoomScroll,onJoinPublicRoom:hh,onJoinByToken:xh},null,o)),v(va).isTouchDevice.value&&v(Je)&&!v(bo)?(t(`<div class="absolute top-16 left-3 z-50 flex flex-col gap-2" style="${oe({"padding-left":"env(safe-area-inset-left, 0px)"})}" data-v-6f91a0ba><button class="${U([v(Pa).active.value?"bg-gradient-to-br from-amber-500/50 to-amber-500/25 border-amber-500/60 text-amber-300 shadow-[0_0_24px_rgba(245,158,11,0.35)]":"bg-gradient-to-br from-amber-500/20 to-amber-500/8 border-amber-500/35 text-amber-300/70 shadow-[0_0_12px_rgba(245,158,11,0.1)]","w-14 h-14 rounded-2xl flex items-center justify-center border-2 backdrop-blur-sm transition-all"])}" data-v-6f91a0ba><span class="text-base font-bold leading-none" data-v-6f91a0ba>F3</span></button>`),v(Pa).active.value?t('<button class="w-14 h-14 rounded-2xl flex items-center justify-center border-2 backdrop-blur-sm bg-gradient-to-br from-amber-500/20 to-amber-500/8 border-amber-500/35 text-amber-300/70 shadow-[0_0_12px_rgba(245,158,11,0.1)]" data-v-6f91a0ba><span class="text-base font-bold leading-none" data-v-6f91a0ba>F4</span></button>'):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),E(t,e=>{v(So)?(e('<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm" data-v-6f91a0ba><div class="bg-gray-900 border border-white/10 rounded-2xl p-6 w-full max-w-sm mx-4 shadow-2xl" data-v-6f91a0ba><h3 class="text-white text-lg font-bold mb-1" data-v-6f91a0ba>Room Password</h3>'),v($o)?e('<p class="text-red-400 text-base mb-3" data-v-6f91a0ba>Wrong password. Try again.</p>'):e('<p class="text-white/40 text-base mb-3" data-v-6f91a0ba>This room requires a password to join.</p>'),e(`<input data-pw-prompt${J("value",v(Co))} type="password" placeholder="Enter password" maxlength="32" class="w-full bg-black/60 border border-white/20 rounded-xl px-3 py-2.5 text-white text-base placeholder-white/30 focus:border-amber-500/50 focus:outline-none transition-colors mb-4" data-v-6f91a0ba><div class="flex gap-2" data-v-6f91a0ba><button class="flex-1 py-2 rounded-xl bg-white/5 text-white/50 text-base font-medium hover:bg-white/10 transition-colors" data-v-6f91a0ba> Cancel </button><button${X(!v(Co))?" disabled":""} class="flex-1 py-2 rounded-xl bg-amber-500/20 text-amber-300 text-base font-medium hover:bg-amber-500/30 transition-colors disabled:opacity-30" data-v-6f91a0ba> Join </button></div></div></div>`)):e("\x3c!----\x3e")},"body",!1,o),v(wo)&&v(bo)?(t('<div class="absolute inset-0 z-20 flex flex-col items-center justify-center bg-gray-950" data-v-6f91a0ba><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] rounded-full bg-emerald-500/[0.04] blur-[100px] pointer-events-none" data-v-6f91a0ba></div><div class="relative z-10 flex flex-col items-center w-full max-w-sm px-6" data-v-6f91a0ba><div class="w-16 h-16 rounded-2xl bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center mb-5" data-v-6f91a0ba>'),ne(t,g(b(v(wo).icon),{class:"w-8 h-8 text-emerald-400"},null),o),t(`</div><h2 class="text-white text-xl sm:text-2xl font-bold mb-1 text-center" data-v-6f91a0ba>${Z(v(wo).name)}</h2><p class="text-gray-500 text-base mb-8 text-center line-clamp-2" data-v-6f91a0ba>${Z(v(wo).description)}</p><div class="w-full relative" data-v-6f91a0ba><div class="h-2.5 rounded-full bg-gray-800/80 overflow-hidden border border-gray-700/30" data-v-6f91a0ba><div class="h-full rounded-full relative transition-[width] duration-300 ease-out loading-bar-fill" style="${oe({width:v(ho)+"%"})}" data-v-6f91a0ba><div class="absolute inset-0 loading-bar-shimmer" data-v-6f91a0ba></div></div></div><div class="absolute top-1 left-0 h-3 rounded-full blur-md transition-[width] duration-300 ease-out opacity-40 loading-bar-fill" style="${oe({width:v(ho)+"%"})}" data-v-6f91a0ba></div></div><div class="w-full mt-3" data-v-6f91a0ba><div class="flex items-center justify-between" data-v-6f91a0ba><p class="text-gray-400 text-base" data-v-6f91a0ba>${Z(v(xo))}</p><p class="text-emerald-400 text-base font-mono font-bold" data-v-6f91a0ba>${Z(v(ho))}%</p></div>`),v(yo)?t(`<p class="text-gray-600 text-base mt-1 truncate font-mono" data-v-6f91a0ba>${Z(v(yo))}</p>`):t("\x3c!----\x3e"),t("</div></div></div>")):t("\x3c!----\x3e"),!v(wo)||v(bo)||v(ko)&&!v(va).isTouchDevice.value?t("\x3c!----\x3e"):(t(`<div class="${U([v(Qa)?"z-40":"z-20","absolute top-3 right-3 flex items-center gap-2"])}" \x3c!-- Voice quick mute (mobile only, when voice active) -- data-v-6f91a0ba>`),v(va).isTouchDevice.value&&v(da).voiceEnabled.value?(t(`<button class="${U([v(da).localMuted.value?"border-red-500/40":"border-gray-700/50","w-10 h-10 rounded-full bg-black/60 backdrop-blur-sm border flex items-center justify-center transition-all"])}" data-v-6f91a0ba>`),v(da).localMuted.value?t('<svg class="w-5 h-5 text-red-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M19 19L5 5m14 0l-3.5 3.5M12 18.75a6 6 0 01-5.82-4.55M12 18.75V21m0-2.25a6 6 0 005.82-4.55M12 2.25a3 3 0 00-3 3v4.5m0 0L5.25 5.25" data-v-6f91a0ba></path></svg>'):t('<svg class="w-5 h-5 text-teal-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5V22.5m-3.75-.75h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z" data-v-6f91a0ba></path></svg>'),t("</button>")):t("\x3c!----\x3e"),v(va).isTouchDevice.value&&v(Bt).placedCount.value>0?(t('<div class="flex items-center gap-1.5 bg-black/60 backdrop-blur-sm rounded-full px-2.5 py-1.5 border border-gray-700/30" data-v-6f91a0ba>'),t(_(v(we),{class:"w-3.5 h-3.5 text-emerald-400"},null,o)),t(`<span class="text-emerald-400 font-bold text-base" data-v-6f91a0ba>${Z(v(Bt).placedCount.value)}</span></div>`)):t("\x3c!----\x3e"),v(Qa)||v(va).isTouchDevice.value?t(`<button class="${U([v(va).isTouchDevice.value?"px-2.5 py-1.5 text-base":"px-3 py-1.5 text-base","rounded-xl bg-black/60 backdrop-blur-sm border border-gray-700/50 text-gray-400 hover:text-white hover:border-gray-500 transition-all"])}" data-v-6f91a0ba>${Z(v(va).isTouchDevice.value?v(sn)?"Back":"Exit":v(sn)?"Edit Character":"Exit to Lobby")}</button>`):t("\x3c!----\x3e"),t("</div>")),v(va).isTouchDevice.value&&v(kn)&&v(Ge)&&!v(bo)&&!v(Qa)?(t('<div class="absolute top-0 left-0 right-0 z-30 flex items-center justify-center pt-2 pb-1 pointer-events-none" data-v-6f91a0ba>'),v(Sn)?(t(`<div class="flex items-center gap-2 bg-black/70 backdrop-blur-md rounded-2xl px-3 py-2 pointer-events-auto" style="${oe({border:"1px solid rgba(16,185,129,0.25)","box-shadow":"0 4px 20px rgba(0,0,0,0.5), 0 0 15px rgba(16,185,129,0.08)"})}" data-v-6f91a0ba><button class="mobile-tv-btn" title="Collapse" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" data-v-6f91a0ba></path></svg></button><div class="w-px h-7 mx-0.5" style="${oe({background:"rgba(16,185,129,0.2)"})}" data-v-6f91a0ba></div><button class="mobile-tv-btn" title="Channels" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" data-v-6f91a0ba></path></svg></button><button class="mobile-tv-btn" title="Previous" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" data-v-6f91a0ba></path></svg></button><span class="text-emerald-300 text-base font-bold px-2 min-w-[60px] text-center truncate max-w-[120px] drop-shadow-lg" data-v-6f91a0ba>${Z(v($n))}</span><button class="mobile-tv-btn" title="Next" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" data-v-6f91a0ba></path></svg></button><div class="w-px h-7 mx-0.5" style="${oe({background:"rgba(16,185,129,0.2)"})}" data-v-6f91a0ba></div><button class="mobile-tv-btn" title="Volume Down" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" data-v-6f91a0ba></path></svg></button><button class="${U([v(Tn)?"mobile-tv-btn--active-red":"","mobile-tv-btn"])}"${J("title",v(Tn)?"Unmute":"Mute")} data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M17.25 9.75L19.5 12m0 0l2.25 2.25M19.5 12l2.25-2.25M19.5 12l-2.25 2.25m-10.5-6l4.72-4.72a.75.75 0 011.28.53v15.88a.75.75 0 01-1.28.53l-4.72-4.72H4.51c-.88 0-1.76-.724-1.76-1.58v-5.3c0-.856.88-1.58 1.76-1.58h2.24" data-v-6f91a0ba></path></svg></button><button class="mobile-tv-btn" title="Volume Up" data-v-6f91a0ba><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" data-v-6f91a0ba></path></svg></button>`),v(Ko)?t(`\x3c!--[--\x3e<div class="w-px h-7 mx-0.5" style="${oe({background:"rgba(16,185,129,0.2)"})}" data-v-6f91a0ba></div><button class="${U([v(Mn)?"mobile-tv-btn--active-yellow":"","mobile-tv-btn"])}" title="Favorite" data-v-6f91a0ba><svg class="w-5 h-5"${J("fill",v(Mn)?"currentColor":"none")} viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" data-v-6f91a0ba></path></svg></button>\x3c!--]--\x3e`):t("\x3c!----\x3e"),t("</div>")):t(`<button class="pointer-events-auto mobile-tv-btn" style="${oe({background:"rgba(0,0,0,0.7)","backdrop-filter":"blur(8px)",border:"1px solid rgba(16,185,129,0.3)","box-shadow":"0 2px 12px rgba(0,0,0,0.5)"})}" data-v-6f91a0ba><svg class="w-6 h-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M6 20.25h12m-7.5-3v3m3-3v3m-10.125-3h17.25c.621 0 1.125-.504 1.125-1.125V4.875c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125z" data-v-6f91a0ba></path></svg></button>`),t("</div>")):t("\x3c!----\x3e"),v(Vn)?(t('<div class="absolute inset-0 z-40 flex flex-col bg-black/85 backdrop-blur-sm" data-v-6f91a0ba><div class="flex items-center justify-between px-4 pt-3 pb-2 border-b border-gray-700/40" data-v-6f91a0ba><h2 class="text-white text-lg font-bold" data-v-6f91a0ba>Channels</h2><button class="p-2 text-white/60 active:text-white" data-v-6f91a0ba><svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-v-6f91a0ba></path></svg></button></div><div class="flex gap-1.5 px-3 py-2 overflow-x-auto flex-shrink-0 scrollbar-hide" data-v-6f91a0ba>\x3c!--[--\x3e'),N(v(sa).TV_CATEGORIES,(e,o)=>{t(`<button class="${U([v(An)===o?"bg-emerald-500/30 text-emerald-300 border border-emerald-500/40":"bg-white/5 text-white/50 border border-white/10","px-3 py-1.5 rounded-full text-base font-medium whitespace-nowrap transition-colors"])}" data-v-6f91a0ba>${Z(e)}</button>`)}),t('\x3c!--]--\x3e</div><div class="flex-1 overflow-y-auto px-3 pb-4" data-v-6f91a0ba><div class="grid grid-cols-2 gap-2 mt-1" data-v-6f91a0ba>\x3c!--[--\x3e'),N(v(Pn),e=>{t(`<button class="flex items-center gap-2.5 p-3 rounded-xl bg-white/5 border border-white/10 active:bg-emerald-500/20 active:border-emerald-500/40 transition-colors" data-v-6f91a0ba><div class="w-3 h-3 rounded-full flex-shrink-0" style="${oe({backgroundColor:e.color||"#10b981"})}" data-v-6f91a0ba></div><span class="text-white text-base truncate" data-v-6f91a0ba>${Z(e.name)}</span></button>`)}),t("\x3c!--]--\x3e</div>"),0===v(Pn).length?t('<p class="text-white/30 text-base text-center mt-8" data-v-6f91a0ba>No channels in this category</p>'):t("\x3c!----\x3e"),t("</div></div>")):t("\x3c!----\x3e"),v(ya).editingRoomMeshes.value&&!v(bo)?(t('<div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-30 bg-black/80 backdrop-blur-sm border border-white/10 rounded-xl px-6 py-3 flex flex-col items-center gap-1 pointer-events-none" data-v-6f91a0ba><p class="text-base text-white" data-v-6f91a0ba><span class="text-emerald-400 font-bold" data-v-6f91a0ba>LEFT CLICK</span> hide <span class="mx-2 text-white/30" data-v-6f91a0ba>|</span><span class="text-amber-400 font-bold" data-v-6f91a0ba>RIGHT CLICK</span> show <span class="mx-2 text-white/30" data-v-6f91a0ba>|</span><span class="text-violet-400 font-bold" data-v-6f91a0ba>SCROLL</span> simplify <span class="mx-2 text-white/30" data-v-6f91a0ba>|</span><span class="text-cyan-400 font-bold" data-v-6f91a0ba>K</span> finish <span class="mx-2 text-white/30" data-v-6f91a0ba>|</span><span class="text-red-400 font-bold" data-v-6f91a0ba>ESC</span> cancel </p>'),v(ya).hoveredMeshName.value?(t(`<p class="text-base text-white/50 font-mono" data-v-6f91a0ba>${Z(v(ya).hoveredMeshName.value)} `),v(ya).hoveredMeshTris.value?t(`<span class="text-white/40 ml-2" data-v-6f91a0ba>${Z(v(ya).hoveredMeshTris.value)}</span>`):t("\x3c!----\x3e"),t("</p>")):t("\x3c!----\x3e"),v(ya).hiddenCount.value>0?t(`<p class="text-base text-white/30" data-v-6f91a0ba>${Z(v(ya).hiddenCount.value)} mesh(es) hidden </p>`):t("\x3c!----\x3e"),t("</div>")):t("\x3c!----\x3e"),t(_(ge,{"selected-env":v(wo),loading:v(bo),locked:v(Ge),"edit-mode":v(Je),"placing-asset":v(ea).placingAsset.value,"rotating-object":v(ea).rotatingObject.value,"ghost-valid":v(ea).ghostValid.value,"placed-count":v(Bt).placedCount.value,"can-undo":v(ea).canUndo(),"can-redo":v(ea).canRedo(),"show-radial":v(Qa),"show-inventory":v(oo),"show-help":v(no),"show-environment-editor":v(ia).showEnvironmentEditor.value,"player-count":v(ra).playerCount.value,"calibrating-character":v(Lt).calibratingCharacter.value,"calibrating-character-file":v(Lt).calibratingCharacterFile.value,"character-calibration":v(Lt).characterCalibration,"cal-applied-all":v(Lt).calAppliedAll.value,"show-scale-saved":v(Bt).showScaleSaved.value,"show-rotation-saved":v(Bt).showRotationSaved.value,"show-spawn-saved":v(Bt).showSpawnSaved.value,"setting-spawn":v(Fe),"show-edit-saved":v(Bt).showEditSaved.value,"voice-enabled":v(da).voiceEnabled.value,"voice-mode":v(da).voiceMode.value,"local-muted":v(da).localMuted.value,"local-speaking":v(da).localSpeaking.value,"ptt-active":v(da).pttActive.value,"placing-light-id":v(ia).placingLightId.value,"is-touch-device":v(va).isTouchDevice.value,"aiming-at-clickable":v(wn),"aiming-at-keypad":!!v(po),"keypad-buttons":null!=(u=null==(c=v(po))?void 0:c.buttons)?u:[],"polygon-tool-active":v(wa).polygonToolActive.value,"calibrating-room":v(xa).calibratingRoom.value,"calibration-step":v(xa).calibrationStep.value,"calib-snapped":v(xa).calibSnapped.value,"calib-floor-display":v(xa).calibFloorDisplay.value,"calib-scale-display":v(xa).calibScaleDisplay.value,"editing-room-meshes":v(ya).editingRoomMeshes.value,"active-tool":v(Ua),"active-tool-data":v(Na),onUndo:v(ea).undoLastPlaced,onRedo:v(ea).redoLastPlaced,onApplyCalibrationAll:e=>v(Lt).applyCalibrationToAll(v(_t).availableCharacters.value),onCloseCalibration:e=>{v(Lt).closeCharacterCalibration(),dt()},onToggleMute:e=>v(da).toggleMute(),onToggleVoiceMode:e=>v(da).setVoiceMode("ptt"===v(da).voiceMode.value?"vad":"ptt"),onMobileRotate:H$1,onMobileTilt:q$1,onMobileScale:B$1,onMobileCalib:K$1,onMobileCalibConfirm:e=>{"floor"===xa.calibrationStep.value?xa.confirmFloor():xa.confirmScale()},onMobileCalibCancel:e=>v(xa).cancelCalibration(),onMobileLightDist:e=>v(ia).scrollLightDistance(120*e),onMobileLightConfirm:e=>v(ia).confirmLightPlacement(),onMobileLightCancel:e=>v(ia).cancelLightPlacement(),onMobileMeshSimplify:e=>v(ya).handleWheel(-120*e),onMobileMeshFinish:e=>gt(),onMobileMeshCancel:e=>st(),onMobilePolygonUndo:e=>v(wa).undoLastVertex(),onMobilePolygonCancel:e=>v(wa).cancelTracing(),onMobileKeypadPress:ae},null,o)),t(_(be,{"show-radial":v(Qa),"radial-hover":v(Xa),"radial-target-name":v(ea).radialTargetName.value,"radial-options":v(Kn),"is-touch-device":v(va).isTouchDevice.value,onExecute:Qv,onCancel:xi,"onUpdate:radialHover":e=>Xa.value=e},null,o)),v(va).isTouchDevice.value?t(_(he,{"left-stick":v(va).leftStick,"right-stick":v(va).rightStick,locked:v(Ge),"is-landscape":v(va).isLandscape.value,"placing-asset":!!v(ea).placingAsset.value,"left-handed":v(fa).settings.leftHanded,"voice-enabled":v(da).voiceEnabled.value,"voice-mode":v(da).voiceMode.value,"ptt-active":v(da).pttActive.value,"edit-mode":v(Je),"perf-active":v(Pa).active.value,"rotating-object":!!v(ea).rotatingObject.value,onOpenRadial:e=>fu(),onPlace:e=>v(ea).ghostValid.value&&v(ea).placeObject(),onRotateCw:e=>{var t,o;return v(ea).setGhostRotation(((null==(o=(t=v(ea)).getGhostRotation)?void 0:o.call(t))||0)+Math.PI/12)},onCancelPlace:e=>v(ea).cancelPlacing(),onPttStart:e=>v(da).setPTT(!0),onPttEnd:e=>v(da).setPTT(!1),onTogglePerf:e=>v(Pa).toggle(),onToggleWireframe:e=>v(Pa).toggleWireframe(),onRotationConfirm:e=>function(){const e=ea.rotatingObject.value;if(!e)return;const t=Ne.find(t=>t.group===e);ea.confirmRotation(),xt(),t&&ra.sendObjectDelta({type:"object:moved",identifier:Bt.getObjectIdentifier(t),position:{x:He(e.position.x),y:He(e.position.y),z:He(e.position.z)},quaternion:{x:He(e.quaternion.x),y:He(e.quaternion.y),z:He(e.quaternion.z),w:He(e.quaternion.w)},scale:He(e.scale.x)})}(),onRotationCancel:e=>v(ea).cancelRotation(),onSysSizeUp:e=>{var t,o;return null==(o=(t=v(ea)).scaleGhostUp)?void 0:o.call(t)},onSysSizeDown:e=>{var t,o;return null==(o=(t=v(ea)).scaleGhostDown)?void 0:o.call(t)}},null,o)):t("\x3c!----\x3e"),t(_(xe,{show:v(da).showVoiceSettings.value,"voice-enabled":v(da).voiceEnabled.value,"voice-mode":v(da).voiceMode.value,"local-muted":v(da).localMuted.value,"local-speaking":v(da).localSpeaking.value,"master-volume":v(da).masterVolume.value,"spatial-enabled":v(da).spatialEnabled.value,"auto-join":v(da).autoJoinVoice.value,"voice-debug":v(ro),onClose:e=>{v(da).closeVoiceSettings(),dt()},onConnectVoice:e=>{da.initVoice().then(()=>{for(const e of ra.remotePlayers.value.keys())da.connectToPeer(e)}).catch(e=>{})},onToggleMute:e=>v(da).toggleMute(),onSetMode:e=>v(da).setVoiceMode(e),onSetVolume:e=>v(da).setMasterVolume(e),onSetSpatial:e=>v(da).setSpatialAudio(e),onSetAutoJoin:e=>v(da).setAutoJoin(e),onDebugOverlayChange:rl,onToggleVoiceDebug:uy},null,o)),t(_(ye,{"show-inventory":v(oo),assets:v(Bt).assets.value,"asset-scales":v(Bt).assetScales.value,"edit-mode":v(Je),"asset-thumb-offsets":v(Bt).assetThumbOffsets.value,onClose:Zv,onSelect:rh,onUpdateThumbOffset:(e,t)=>v(Bt).saveAssetThumbOffset(e,t),onRegenerateThumbnail:sh,onDeleteAsset:ch,onEditPosition:dh},null,o)),t(_(ke,{show:v(Dn),"target-object":v(jn),"current-binding":v(ha).getCurrentBinding(),channels:v(ma).channels.value,"edit-mode":v(Je),"asset-name":null!=(h=v(ha).getTargetAssetName())?h:"","scene-objects":v(cn),"env-lights":v(un),"all-preset-lights":v(pn),doors:v(vn),"anim-range":v(On),"anim-start":v(Rn),"anim-end":v(In),"lighting-presets":v(Bn),"lighting-mode":v(En),onClose:Iy,onSave:Fy,onTraceScreen:su,onOpenDisplayEditor:Ey},null,o)),v(Fn)&&(null==(re=null==(se=null==(I=null==(x=v(jn))?void 0:x.behavior)?void 0:I.config)?void 0:se.displayZones)?void 0:re[v(Ln)])?t(_(Se,{zone:v(jn).behavior.config.displayZones[v(Ln)],onSave:Ly,onClose:By},null,o)):t("\x3c!----\x3e"),t(_(Ce,{visible:v($a).keypadWizardVisible.value&&!v(wa).polygonToolActive.value,step:v($a).keypadWizardStep.value,"tracing-active":v(wa).polygonToolActive.value,"display-data":v($a).keypadWizardDisplay.value,"display-config":(null==(de=v($a).keypadWizardDisplay.value)?void 0:de.config)||v(ka).DEFAULT_TEXT_PANEL_CONFIG,buttons:v($a).keypadWizardButtons.value,logic:v($a).keypadWizardData.value.logic||{},fonts:v(ka).availableFonts.value,"is-editing":!!v($a).keypadWizardData.value.id,"animation-targets":v(Un),"door-targets":v(Wn),onNext:e=>v($a).wizardNextStep(),onPrev:e=>v($a).wizardPrevStep(),onGoStep:e=>v($a).wizardGoStep(e),onClose:Ny,onDelete:Hy,onSave:Wy,onStartDisplayTrace:Yy,onStartButtonTrace:Zy,onResetDisplay:qy,onUpdateDisplayConfig:_y,onUpdateButton:qv,onDeleteButton:eh,onCloneButton:th,onGenerateGrid:ah,onUpdateLogic:oh,onFontUploaded:nh,onUpdateDisplayPolygon:lh,onUpdateButtonPolygon:ih,onDisplaySelectionChanged:Gy,onButtonSelectionChanged:Ky,onRetraceDisplay:Xy,onRetraceButton:Jy,onUpdateAllButtons:Qy},null,o)),t(_($e,{visible:v(Ha),onClose:uh,onPlace:fh},null,o)),t(_(Me,{state:v(Ea)},null,o)),v(wa).polygonToolActive.value?t(`<div class="absolute z-10 pointer-events-none inset-x-0 bottom-8 flex justify-center" data-v-6f91a0ba><div class="flex items-center gap-3 px-5 py-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.65)","backdrop-filter":"blur(8px)",border:"1px solid rgba(6,182,212,0.3)"})}" data-v-6f91a0ba><span class="text-cyan-300 text-base font-bold" data-v-6f91a0ba>Tracing</span><span class="text-gray-400 text-base" data-v-6f91a0ba>${Z(v(wa).vertexCount.value)} pts</span><span class="text-gray-500 text-base" data-v-6f91a0ba>Click = add point</span><span class="text-gray-500 text-base" data-v-6f91a0ba>Backspace = undo</span><span class="text-gray-500 text-base" data-v-6f91a0ba>Right-click = undo</span><span class="text-gray-500 text-base" data-v-6f91a0ba>Q = cancel</span></div></div>`):t("\x3c!----\x3e"),v(fo)&&v(Ge)&&!v(Qa)&&"idle"===v(_a).connectionState?(t(`<div class="absolute z-10 inset-0 flex items-center justify-center pointer-events-none" data-v-6f91a0ba><div class="flex flex-col items-center gap-2 mt-16" data-v-6f91a0ba><div class="w-14 h-14 rounded-full flex items-center justify-center" style="${oe("connect-duct"===v(fo)?"background: rgba(6,182,212,0.25); border: 2px solid rgba(6,182,212,0.6); box-shadow: 0 0 20px rgba(6,182,212,0.2);":"background: rgba(16,185,129,0.25); border: 2px solid rgba(16,185,129,0.6); box-shadow: 0 0 20px rgba(16,185,129,0.2);")}" data-v-6f91a0ba>`),v(va).isTouchDevice.value?t("\x3c!----\x3e"):t('<span class="text-white text-xl font-black" data-v-6f91a0ba>E</span>'),t(`</div><div class="px-5 py-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.55)","backdrop-filter":"blur(8px)"})}" data-v-6f91a0ba><span class="${U(["connect-duct"===v(fo)?"text-cyan-400":"text-emerald-400","text-base font-bold"])}" data-v-6f91a0ba>${Z("connect-duct"===v(fo)?"Connect Duct":"open-tent"===v(fo)?"Open Tent":"Close Tent")}</span></div></div></div>`)):t("\x3c!----\x3e"),!v(vo)||v(fo)||!v(Ge)||v(Qa)||v(ha).showBindModal.value||v(po)||v(ha).nearbyDevice.value?t("\x3c!----\x3e"):(t(`<div class="${U([v(va).isTouchDevice.value?"pointer-events-auto":"pointer-events-none","absolute z-10 inset-0 flex items-center justify-center"])}" data-v-6f91a0ba><div class="flex flex-col items-center gap-2 mt-16" data-v-6f91a0ba>`),v(vo).canControl?(t(`<div class="w-14 h-14 rounded-full flex items-center justify-center" style="${oe({background:"rgba(16,185,129,0.25)",border:"2px solid rgba(16,185,129,0.6)","box-shadow":"0 0 20px rgba(16,185,129,0.2)"})}" data-v-6f91a0ba>`),v(va).isTouchDevice.value?t('<svg class="w-7 h-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59" data-v-6f91a0ba></path></svg>'):t('<span class="text-white text-xl font-black" data-v-6f91a0ba>E</span>'),t("</div>")):t("\x3c!----\x3e"),t(`<div class="px-5 py-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.55)","backdrop-filter":"blur(8px)"})}" data-v-6f91a0ba><span class="${U([v(vo).canControl?"text-emerald-400":"text-amber-400","text-base font-bold"])}" data-v-6f91a0ba>${Z(v(vo).displayName)}</span></div></div></div>`)),!v(ha).nearbyDevice.value||!v(Ge)||v(Qa)||v(ha).showBindModal.value||v(po)?t("\x3c!----\x3e"):(t(`<div class="${U([v(va).isTouchDevice.value?"pointer-events-auto":"pointer-events-none","absolute z-10 inset-0 flex items-center justify-center"])}" data-v-6f91a0ba>`),"__door__"===v(ha).nearbyDevice.value.deviceId?(t('<div class="flex flex-col items-center gap-2 mt-16" data-v-6f91a0ba>'),v(ha).nearbyDevice.value.canControl?(t(`<div class="w-14 h-14 rounded-full flex items-center justify-center" style="${oe({background:"rgba(16,185,129,0.25)",border:"2px solid rgba(16,185,129,0.6)","box-shadow":"0 0 20px rgba(16,185,129,0.2)"})}" data-v-6f91a0ba>`),v(va).isTouchDevice.value?t('<svg class="w-7 h-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59" data-v-6f91a0ba></path></svg>'):t('<span class="text-white text-xl font-black" data-v-6f91a0ba>E</span>'),t("</div>")):t("\x3c!----\x3e"),t(`<div class="px-5 py-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.55)","backdrop-filter":"blur(8px)"})}" data-v-6f91a0ba><span class="${U([v(ha).nearbyDevice.value.canControl?"text-emerald-400":"text-amber-400","text-base font-bold"])}" data-v-6f91a0ba>${Z(v(ha).nearbyDevice.value.displayName)}</span></div></div>`)):(t(`<div class="flex flex-col items-center gap-2 mt-16" data-v-6f91a0ba><div class="w-14 h-14 rounded-full flex items-center justify-center" style="${oe({background:"rgba(16,185,129,0.25)",border:"2px solid rgba(16,185,129,0.6)","box-shadow":"0 0 20px rgba(16,185,129,0.2)"})}" data-v-6f91a0ba>`),v(va).isTouchDevice.value?t('<svg class="w-7 h-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" data-v-6f91a0ba><path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59" data-v-6f91a0ba></path></svg>'):t('<span class="text-white text-xl font-black" data-v-6f91a0ba>E</span>'),t(`</div><div class="flex flex-col items-center gap-0.5 px-5 py-2 rounded-xl" style="${oe({background:"rgba(0,0,0,0.55)","backdrop-filter":"blur(8px)"})}" data-v-6f91a0ba><span class="text-white text-base font-bold" data-v-6f91a0ba>${Z(v(ha).nearbyDevice.value.displayName)}</span>`),v(ha).nearbyDevice.value.canControl?t(`<span class="${U([v(ha).nearbyDevice.value.isOn?"text-red-400":"text-emerald-400","text-base font-bold"])}" data-v-6f91a0ba>${Z(v(va).isTouchDevice.value?"Tap to toggle":v(ha).nearbyDevice.value.isOn?"Turn OFF":"Turn ON")}</span>`):t(`<span class="text-amber-400/70 text-base font-bold" data-v-6f91a0ba>${Z(v(ha).nearbyDevice.value.isOn?"ON":"OFF")} (auto)</span>`),t("</div></div>")),t("</div>")),v(ro)?(t('<div class="absolute bottom-2 left-2 z-50 bg-black/80 backdrop-blur-sm border border-yellow-500/40 rounded-lg px-3 py-2 font-mono text-base text-yellow-300 max-w-xs select-none pointer-events-none leading-relaxed" data-v-6f91a0ba><div class="text-yellow-500 font-bold mb-1" data-v-6f91a0ba>VOICE DEBUG</div>\x3c!--[--\x3e'),N(v(co),(e,o)=>{t(`<div data-v-6f91a0ba><span class="text-gray-500" data-v-6f91a0ba>${Z(o)}:</span> <span class="${U("boolean"==typeof e?e?"text-green-400":"text-red-400":"text-yellow-200")}" data-v-6f91a0ba>${Z(e)}</span></div>`)}),t("\x3c!--]--\x3e</div>")):t("\x3c!----\x3e"),t('<div class="w-full h-full" data-v-6f91a0ba></div>'),v(fn)?t('<div class="absolute inset-0 z-[100] bg-black pointer-events-none" data-v-6f91a0ba></div>'):t("\x3c!----\x3e"),t("</div>")}}}),Jg=Yg.setup;Yg.setup=(e,t)=>{const o=j();return(o.modules||(o.modules=new Set)).add("pages/room3d.vue"),Jg?Jg(e,t):void 0};const Zg=Le(Yg,[["__scopeId","data-v-6f91a0ba"]]);export{Zg as default};
