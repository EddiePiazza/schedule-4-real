import{N as e,M as t,g as o,y as r}from"./useMultiplayer-BejIYzgz.mjs";import{defineComponent as s,ref as a,unref as i,mergeProps as n,useSSRContext as l}from"vue";import{ssrRenderAttrs as m,ssrRenderComponent as u}from"vue/server-renderer";import{e as p,n as c}from"./server.mjs";import"@heroicons/vue/24/solid";import"./_plugin-vue_export-helper-DlAUqK2U.mjs";import"@heroicons/vue/24/outline";import"three";import"three/addons/loaders/GLTFLoader.js";import"./useImmersiveMode-DuEjIo9R.mjs";import"three-mesh-bvh";import"../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../routes/renderer.mjs";import"vue-bundle-renderer/runtime";import"unhead/server";import"devalue";import"unhead/utils";import"pinia";import"vue-router";const d="sf_room3d_guest_char",v="sf_room3d_guest_name",h=s({__name:"[...slug]",__ssrInlineRender:!0,setup(s){const l=p(),h=Array.isArray(l.params.slug)?l.params.slug:[l.params.slug],f=h.length>=2&&"join"===h[0],g=f?h.slice(1).join("/"):"",b=1===h.length?String(h[0]||""):"",y=b.startsWith("sfr:")||b.startsWith("sfr%3A"),x=f?g:y?decodeURIComponent(b).slice(4):"",j=f||y?"":b.toUpperCase();!f&&!y&&!/^[A-Z0-9]{4}$/.test(j)&&c("/",{replace:!0});const C=e(),{lobbyCharLoading:I,availableCharacters:_,selectedCharacter:S,carouselSelectedIdx:L,loadAvailableCharacters:k,initLobbyScene:w,disposeLobbyScene:A,initCarouselPositions:M,lobbyPrevChar:N,lobbyNextChar:U,onLobbyWheel:R}=r(),z=a(!1),D=a(!1);a("");const J=a("");function q(){const e=J.value.trim();e&&localStorage.setItem(v,e)}async function G(){if(!J.value.trim()||!D.value)return;localStorage.setItem(d,S.value),localStorage.setItem(v,J.value.trim());const e=o();e.autoJoinVoice.value&&await e.requestMicrophone(),c(x?{path:"/room3d",query:{sfr:x,name:J.value.trim(),char:S.value}}:{path:"/room3d",query:{invite:j,name:J.value.trim(),char:S.value}})}async function W(e){const t=e.startsWith("sfr:")?e.slice(4):e;localStorage.setItem(d,S.value);const r=J.value.trim()||"Guest";localStorage.setItem(v,r);const s=o();s.autoJoinVoice.value&&await s.requestMicrophone(),c({path:"/room3d",query:{sfr:t,name:r,char:S.value}})}return(e,o,r,s)=>{const a=t;i(z)?o(`<div${m(n({class:"w-full h-full flex items-center justify-center bg-gray-950"},s))}><div class="text-center"><p class="text-red-400 text-lg font-bold mb-2">Invalid Link</p><p class="text-white/40 text-base">The link you followed is not valid or has expired.</p></div></div>`):o(u(a,n({"guest-mode":"","guest-ready":!!i(J).trim()&&i(D),"guest-online-count":i(C).playerCount.value,"guest-connected":i(C).connected.value,environments:[],"available-characters":i(_),"selected-character":i(S),"carousel-selected-idx":i(L),"lobby-char-loading":i(I),"display-name":i(J),"is-dev":!1,"edit-mode":!1,authenticated:!1,"room-settings":{},"invite-tokens":{},"copied-token":"","active-room-idx":0,"hide-token-paste":!!i(x),onPrevChar:i(N),onNextChar:i(U),onLobbyWheel:i(R),"onUpdate:displayName":e=>J.value=e,onSaveDisplayName:q,onEnterRoom:G,onJoinByToken:W},s),null,r))}}}),f=h.setup;h.setup=(e,t)=>{const o=l();return(o.modules||(o.modules=new Set)).add("pages/[...slug].vue"),f?f(e,t):void 0};export{h as default};
