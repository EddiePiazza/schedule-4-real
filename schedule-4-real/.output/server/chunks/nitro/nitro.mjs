import e from"node:process";globalThis._importMeta_=globalThis._importMeta_||{url:"file:///_entry.js",env:e.env};import t,{Server as s}from"node:http";import a,{Server as d}from"node:https";import l,{createHash as c}from"node:crypto";import u from"stream";import h from"events";import m from"http";import f from"crypto";import g from"buffer";import _ from"zlib";import x from"https";import j from"net";import S from"tls";import k from"url";import{EventEmitter as E}from"node:events";import{Buffer as C}from"node:buffer";import{promises as R,existsSync as T}from"node:fs";import{resolve as z,dirname as O,join as P}from"node:path";import{existsSync as N,readFileSync as B}from"fs";import{resolve as H,join as I}from"path";import{readFile as L,mkdir as U,writeFile as D,readdir as M,rm as q}from"fs/promises";import{fileURLToPath as W}from"node:url";l.webcrypto;const randomUUID=()=>l.randomUUID(),$=Symbol.for("nodejs.util.inspect.custom");function toBufferLike(e){if(null==e)return"";const t=typeof e;return"string"===t?e:"number"===t||"boolean"===t||"bigint"===t?e.toString():"function"===t||"symbol"===t?"{}":e instanceof Uint8Array||e instanceof ArrayBuffer?e:function(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);if(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t))return!1;if(Symbol.iterator in e)return!1;if(Symbol.toStringTag in e)return"[object Module]"===Object.prototype.toString.call(e);return!0}(e)?JSON.stringify(e):e}class Message{event;peer;rawData;#e;#t;#r;#s;#o;#n;constructor(e,t,s){this.rawData=e||"",this.peer=t,this.event=s}get id(){return this.#e||(this.#e=randomUUID()),this.#e}uint8Array(){const e=this.#t;if(e)return e;const t=this.rawData;if(t instanceof Uint8Array)return this.#t=t;if(t instanceof ArrayBuffer||t instanceof SharedArrayBuffer)return this.#r=t,this.#t=new Uint8Array(t);if("string"==typeof t)return this.#o=t,this.#t=(new TextEncoder).encode(this.#o);if(Symbol.iterator in t)return this.#t=new Uint8Array(t);if("number"==typeof t?.length)return this.#t=new Uint8Array(t);if(t instanceof DataView)return this.#t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new TypeError(`Unsupported message type: ${Object.prototype.toString.call(t)}`)}arrayBuffer(){const e=this.#r;if(e)return e;const t=this.rawData;return t instanceof ArrayBuffer||t instanceof SharedArrayBuffer?this.#r=t:this.#r=this.uint8Array().buffer}blob(){const e=this.#s;if(e)return e;const t=this.rawData;return t instanceof Blob?this.#s=t:this.#s=new Blob([this.uint8Array()])}text(){const e=this.#o;if(e)return e;const t=this.rawData;return this.#o="string"==typeof t?t:(new TextDecoder).decode(this.uint8Array())}json(){const e=this.#n;return e||(this.#n=JSON.parse(this.text()))}get data(){switch(this.peer?.websocket?.binaryType){case"arraybuffer":return this.arrayBuffer();case"blob":return this.blob();case"nodebuffer":return globalThis.Buffer?Buffer.from(this.uint8Array()):this.uint8Array();case"uint8array":return this.uint8Array();case"text":return this.text();default:return this.rawData}}toString(){return this.text()}[Symbol.toPrimitive](){return this.text()}[$](){return{data:this.rawData}}}class Peer{_internal;_topics;_id;#a;constructor(e){this._topics=new Set,this._internal=e}get context(){return this._internal.context??={}}get id(){return this._id||(this._id=randomUUID()),this._id}get remoteAddress(){}get request(){return this._internal.request}get websocket(){if(!this.#a){const t=this._internal.ws,s=this._internal.request;this.#a=s?(e=s,new Proxy(t,{get:(t,s)=>{const a=Reflect.get(t,s);if(!a)switch(s){case"protocol":return e?.headers?.get("sec-websocket-protocol")||"";case"extensions":return e?.headers?.get("sec-websocket-extensions")||"";case"url":return e?.url?.replace(/^http/,"ws")||void 0}return a}})):t}var e;return this.#a}get peers(){return this._internal.peers||new Set}get topics(){return this._topics}terminate(){this.close()}subscribe(e){this._topics.add(e)}unsubscribe(e){this._topics.delete(e)}toString(){return this.id}[Symbol.toPrimitive](){return this.id}[Symbol.toStringTag](){return"WebSocket"}[$](){return Object.fromEntries([["id",this.id],["remoteAddress",this.remoteAddress],["peers",this.peers],["webSocket",this.websocket]].filter(e=>e[1]))}}class AdapterHookable{options;constructor(e){this.options=e||{}}callHook(e,t,s){const a=this.options.hooks?.[e],d=a?.(t,s),l=this.options.resolve?.(t);if(!l)return d;const c=l instanceof Promise?l.then(t=>t?.[e]):l?.[e];return Promise.all([d,c]).then(([e,a])=>{const d=a?.(t,s);return d instanceof Promise?d.then(t=>t||e):d||e})}async upgrade(e){let t=e.context;t||(t={},Object.defineProperty(e,"context",{enumerable:!0,value:t}));try{const s=await this.callHook("upgrade",e);if(!s)return{context:t};if(!1===s.ok)return{context:t,endResponse:s};if(s.headers)return{context:t,upgradeHeaders:s.headers}}catch(e){const s=e.response||e;if(s instanceof Response)return{context:t,endResponse:s};throw e}return{context:t}}}function adapterUtils(e){return{peers:e,publish(t,s,a){let d;for(const s of e)if(s.topics.has(t)){d=s;break}d&&(d.send(s,a),d.publish(t,s,a))}}}class WSError extends Error{constructor(...e){super(...e),this.name="WSError"}}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var F,Z,K,V,G,Q,Y,J={exports:{}};function requireConstants(){if(Z)return F;Z=1;const e=["nodebuffer","arraybuffer","fragments"],t="undefined"!=typeof Blob;return t&&e.push("blob"),F={BINARY_TYPES:e,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}function requireBufferUtil(){if(K)return J.exports;K=1;const{EMPTY_BUFFER:t}=requireConstants(),s=Buffer[Symbol.species];function _mask(e,t,s,a,d){for(let l=0;l<d;l++)s[a+l]=e[l]^t[3&l]}function _unmask(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}if(J.exports={concat:function(e,a){if(0===e.length)return t;if(1===e.length)return e[0];const d=Buffer.allocUnsafe(a);let l=0;for(let t=0;t<e.length;t++){const s=e[t];d.set(s,l),l+=s.length}return l<a?new s(d.buffer,d.byteOffset,l):d},mask:_mask,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function toBuffer(e){if(toBuffer.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=new s(e):ArrayBuffer.isView(e)?t=new s(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),toBuffer.readOnly=!1),t},unmask:_unmask},!e.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");J.exports.mask=function(t,s,a,d,l){l<48?_mask(t,s,a,d,l):e.mask(t,s,a,d,l)},J.exports.unmask=function(t,s){t.length<32?_unmask(t,s):e.unmask(t,s)}}catch(e){}return J.exports}function requirePermessageDeflate(){if(Y)return Q;Y=1;const e=_,t=requireBufferUtil(),s=function(){if(G)return V;G=1;const e=Symbol("kDone"),t=Symbol("kRun");return V=class{constructor(s){this[e]=()=>{this.pending--,this[t]()},this.concurrency=s||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){const t=this.jobs.shift();this.pending++,t(this[e])}}}}(),{kStatusCode:a}=requireConstants(),d=Buffer[Symbol.species],l=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),u=Symbol("total-length"),h=Symbol("callback"),m=Symbol("buffers"),f=Symbol("error");let g;function deflateOnData(e){this[m].push(e),this[u]+=e.length}function inflateOnData(e){this[u]+=e.length,this[c]._maxPayload<1||this[u]<=this[c]._maxPayload?this[m].push(e):(this[f]=new RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",inflateOnData),this.reset())}function inflateOnError(e){this[c]._inflate=null,this[f]?this[h](this[f]):(e[a]=1007,this[h](e))}return Q=class{constructor(e,t,a){if(this._maxPayload=0|a,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!g){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;g=new s(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,s=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s})}),e}decompress(e,t,s){g.add(a=>{this._decompress(e,t,(e,t)=>{a(),s(e,t)})})}compress(e,t,s){g.add(a=>{this._compress(e,t,(e,t)=>{a(),s(e,t)})})}_decompress(s,a,d){const g=this._isServer?"client":"server";if(!this._inflate){const t=`${g}_max_window_bits`,s="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:s}),this._inflate[c]=this,this._inflate[u]=0,this._inflate[m]=[],this._inflate.on("error",inflateOnError),this._inflate.on("data",inflateOnData)}this._inflate[h]=d,this._inflate.write(s),a&&this._inflate.write(l),this._inflate.flush(()=>{const e=this._inflate[f];if(e)return this._inflate.close(),this._inflate=null,void d(e);const s=t.concat(this._inflate[m],this._inflate[u]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[u]=0,this._inflate[m]=[],a&&this.params[`${g}_no_context_takeover`]&&this._inflate.reset()),d(null,s)})}_compress(s,a,l){const c=this._isServer?"server":"client";if(!this._deflate){const t=`${c}_max_window_bits`,s="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:s}),this._deflate[u]=0,this._deflate[m]=[],this._deflate.on("data",deflateOnData)}this._deflate[h]=l,this._deflate.write(s),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=t.concat(this._deflate[m],this._deflate[u]);a&&(e=new d(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[u]=0,this._deflate[m]=[],a&&this.params[`${c}_no_context_takeover`]&&this._deflate.reset(),l(null,e)})}},Q}var X,ee,te,re,se,oe,ne,ae,ie,de,le,ce,ue,he,pe,me,fe,ye={exports:{}};function requireValidation(){if(X)return ye.exports;X=1;const{isUtf8:t}=g,{hasBlob:s}=requireConstants();function _isValidUTF8(e){const t=e.length;let s=0;for(;s<t;)if(128&e[s])if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}else s++;return!0}if(ye.exports={isBlob:function(e){return s&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:_isValidUTF8,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},t)ye.exports.isValidUTF8=function(e){return e.length<24?_isValidUTF8(e):t(e)};else if(!e.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");ye.exports.isValidUTF8=function(t){return t.length<32?_isValidUTF8(t):e(t)}}catch(e){}return ye.exports}function requireReceiver(){if(te)return ee;te=1;const{Writable:e}=u,t=requirePermessageDeflate(),{BINARY_TYPES:s,EMPTY_BUFFER:a,kStatusCode:d,kWebSocket:l}=requireConstants(),{concat:c,toArrayBuffer:h,unmask:m}=requireBufferUtil(),{isValidStatusCode:f,isValidUTF8:g}=requireValidation(),_=Buffer[Symbol.species];return ee=class extends e{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||s[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new _(t.buffer,t.byteOffset+e,t.length-e),new _(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0],a=t.length-e;e>=s.length?t.set(this._buffers.shift(),a):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),a),this._buffers[0]=new _(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const s=this.consume(2);if(48&s[0]){return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"))}const a=!(64&~s[0]);if(a&&!this._extensions[t.extensionName]){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._fin=!(128&~s[0]),this._opcode=15&s[0],this._payloadLength=127&s[1],0===this._opcode){if(a){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(!this._fragmented){return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"))}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}this._compressed=a}else{if(!(this._opcode>7&&this._opcode<11)){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}if(!this._fin){return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"))}if(a){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~s[1]),this._isServer){if(!this._masked){return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}}else if(this._masked){return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"))}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),s=t.readUInt32BE(0);if(s>Math.pow(2,21)-1){return void e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"))}this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){return void e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"))}this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=a;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&m(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,s){this._extensions[t.extensionName].decompress(e,this._fin,(e,t)=>{if(e)return s(e);if(t.length){if(this._messageLength+=t.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void s(e)}this._fragments.push(t)}this.dataMessage(s),0===this._state&&this.startLoop(s)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let a;a="nodebuffer"===this._binaryType?c(s,t):"arraybuffer"===this._binaryType?h(c(s,t)):"blob"===this._binaryType?new Blob(s):s,this._allowSynchronousEvents?(this.emit("message",a,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",a,!0),this._state=0,this.startLoop(e)}))}else{const a=c(s,t);if(!this._skipUTF8Validation&&!g(a)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",a,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",a,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,a),this.end();else{const s=e.readUInt16BE(0);if(!f(s)){const e=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const a=new _(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!g(a)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",s,a),this.end()}this._state=0}}createError(e,t,s,a,l){this._loop=!1,this._errored=!0;const c=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(c,this.createError),c.code=l,c[d]=a,c}}}function requireSender(){if(se)return re;se=1;const{Duplex:t}=u,{randomFillSync:s}=f,a=requirePermessageDeflate(),{EMPTY_BUFFER:d,kWebSocket:l,NOOP:c}=requireConstants(),{isBlob:h,isValidStatusCode:m}=requireValidation(),{mask:g,toBuffer:_}=requireBufferUtil(),x=Symbol("kByteLength"),j=Buffer.alloc(4),S=8192;let k,E=S;class Sender{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[l]=void 0}static frame(e,t){let a,d,l=!1,c=2,u=!1;t.mask&&(a=t.maskBuffer||j,t.generateMask?t.generateMask(a):(E===S&&(void 0===k&&(k=Buffer.alloc(S)),s(k,0,S),E=0),a[0]=k[E++],a[1]=k[E++],a[2]=k[E++],a[3]=k[E++]),u=0===(a[0]|a[1]|a[2]|a[3]),c=6),"string"==typeof e?d=t.mask&&!u||void 0===t[x]?(e=Buffer.from(e)).length:t[x]:(d=e.length,l=t.mask&&t.readOnly&&!u);let h=d;d>=65536?(c+=8,h=127):d>125&&(c+=2,h=126);const m=Buffer.allocUnsafe(l?d+c:c);return m[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(m[0]|=64),m[1]=h,126===h?m.writeUInt16BE(d,2):127===h&&(m[2]=m[3]=0,m.writeUIntBE(d,4,6)),t.mask?(m[1]|=128,m[c-4]=a[0],m[c-3]=a[1],m[c-2]=a[2],m[c-1]=a[3],u?[m,e]:l?(g(e,a,m,c,d),[m]):(g(e,a,e,0,d),[m,e])):[m,e]}close(e,t,s,a){let l;if(void 0===e)l=d;else{if("number"!=typeof e||!m(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const s=Buffer.byteLength(t);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");l=Buffer.allocUnsafe(2+s),l.writeUInt16BE(e,0),"string"==typeof t?l.write(t,2):l.set(t,2)}else l=Buffer.allocUnsafe(2),l.writeUInt16BE(e,0)}const c={[x]:l.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,l,!1,c,a]):this.sendFrame(Sender.frame(l,c),a)}ping(e,t,s){let a,d;if("string"==typeof e?(a=Buffer.byteLength(e),d=!1):h(e)?(a=e.size,d=!1):(a=(e=_(e)).length,d=_.readOnly),a>125)throw new RangeError("The data size must not be greater than 125 bytes");const l={[x]:a,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:d,rsv1:!1};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,l,s]):this.getBlobData(e,!1,l,s):0!==this._state?this.enqueue([this.dispatch,e,!1,l,s]):this.sendFrame(Sender.frame(e,l),s)}pong(e,t,s){let a,d;if("string"==typeof e?(a=Buffer.byteLength(e),d=!1):h(e)?(a=e.size,d=!1):(a=(e=_(e)).length,d=_.readOnly),a>125)throw new RangeError("The data size must not be greater than 125 bytes");const l={[x]:a,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:d,rsv1:!1};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,l,s]):this.getBlobData(e,!1,l,s):0!==this._state?this.enqueue([this.dispatch,e,!1,l,s]):this.sendFrame(Sender.frame(e,l),s)}send(e,t,s){const d=this._extensions[a.extensionName];let l,c,u=t.binary?2:1,m=t.compress;"string"==typeof e?(l=Buffer.byteLength(e),c=!1):h(e)?(l=e.size,c=!1):(l=(e=_(e)).length,c=_.readOnly),this._firstFragment?(this._firstFragment=!1,m&&d&&d.params[d._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(m=l>=d._threshold),this._compress=m):(m=!1,u=0),t.fin&&(this._firstFragment=!0);const f={[x]:l,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:u,readOnly:c,rsv1:m};h(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,f,s]):this.getBlobData(e,this._compress,f,s):0!==this._state?this.enqueue([this.dispatch,e,this._compress,f,s]):this.dispatch(e,this._compress,f,s)}getBlobData(t,s,a,d){this._bufferedBytes+=a[x],this._state=2,t.arrayBuffer().then(t=>{if(this._socket.destroyed){const t=new Error("The socket was closed while the blob was being read");return void e.nextTick(callCallbacks,this,t,d)}this._bufferedBytes-=a[x];const l=_(t);s?this.dispatch(l,s,a,d):(this._state=0,this.sendFrame(Sender.frame(l,a),d),this.dequeue())}).catch(t=>{e.nextTick(onError,this,t,d)})}dispatch(e,t,s,d){if(!t)return void this.sendFrame(Sender.frame(e,s),d);const l=this._extensions[a.extensionName];this._bufferedBytes+=s[x],this._state=1,l.compress(e,s.fin,(e,t)=>{if(this._socket.destroyed){return void callCallbacks(this,new Error("The socket was closed while data was being compressed"),d)}this._bufferedBytes-=s[x],this._state=0,s.readOnly=!1,this.sendFrame(Sender.frame(t,s),d),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][x],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][x],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function callCallbacks(e,t,s){"function"==typeof s&&s(t);for(let s=0;s<e._queue.length;s++){const a=e._queue[s],d=a[a.length-1];"function"==typeof d&&d(t)}}function onError(e,t,s){callCallbacks(e,t,s),e.onerror(t)}return re=Sender}function requireExtension(){if(ie)return ae;ie=1;const{tokenChars:e}=requireValidation();function push(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}return ae={format:function(e){return Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>[t].concat(Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(t){const s=Object.create(null);let a,d,l=Object.create(null),c=!1,u=!1,h=!1,m=-1,f=-1,g=-1,_=0;for(;_<t.length;_++)if(f=t.charCodeAt(_),void 0===a)if(-1===g&&1===e[f])-1===m&&(m=_);else if(0===_||32!==f&&9!==f){if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${_}`);{if(-1===m)throw new SyntaxError(`Unexpected character at index ${_}`);-1===g&&(g=_);const e=t.slice(m,g);44===f?(push(s,e,l),l=Object.create(null)):a=e,m=g=-1}}else-1===g&&-1!==m&&(g=_);else if(void 0===d)if(-1===g&&1===e[f])-1===m&&(m=_);else if(32===f||9===f)-1===g&&-1!==m&&(g=_);else if(59===f||44===f){if(-1===m)throw new SyntaxError(`Unexpected character at index ${_}`);-1===g&&(g=_),push(l,t.slice(m,g),!0),44===f&&(push(s,a,l),l=Object.create(null),a=void 0),m=g=-1}else{if(61!==f||-1===m||-1!==g)throw new SyntaxError(`Unexpected character at index ${_}`);d=t.slice(m,_),m=g=-1}else if(u){if(1!==e[f])throw new SyntaxError(`Unexpected character at index ${_}`);-1===m?m=_:c||(c=!0),u=!1}else if(h)if(1===e[f])-1===m&&(m=_);else if(34===f&&-1!==m)h=!1,g=_;else{if(92!==f)throw new SyntaxError(`Unexpected character at index ${_}`);u=!0}else if(34===f&&61===t.charCodeAt(_-1))h=!0;else if(-1===g&&1===e[f])-1===m&&(m=_);else if(-1===m||32!==f&&9!==f){if(59!==f&&44!==f)throw new SyntaxError(`Unexpected character at index ${_}`);{if(-1===m)throw new SyntaxError(`Unexpected character at index ${_}`);-1===g&&(g=_);let e=t.slice(m,g);c&&(e=e.replace(/\\/g,""),c=!1),push(l,d,e),44===f&&(push(s,a,l),l=Object.create(null),a=void 0),d=void 0,m=g=-1}}else-1===g&&(g=_);if(-1===m||h||32===f||9===f)throw new SyntaxError("Unexpected end of input");-1===g&&(g=_);const x=t.slice(m,g);return void 0===a?push(s,x,l):(void 0===d?push(l,x,!0):push(l,d,c?x.replace(/\\/g,""):x),push(s,a,l)),s}},ae}function requireWebsocket(){if(le)return de;le=1;const t=h,s=x,a=m,d=j,l=S,{randomBytes:c,createHash:g}=f,{Duplex:_,Readable:E}=u,{URL:C}=k,R=requirePermessageDeflate(),T=requireReceiver(),z=requireSender(),{isBlob:O}=requireValidation(),{BINARY_TYPES:P,EMPTY_BUFFER:N,GUID:B,kForOnEventAttribute:H,kListener:I,kStatusCode:L,kWebSocket:U,NOOP:D}=requireConstants(),{EventTarget:{addEventListener:M,removeEventListener:q}}=function(){if(ne)return oe;ne=1;const{kForOnEventAttribute:e,kListener:t}=requireConstants(),s=Symbol("kCode"),a=Symbol("kData"),d=Symbol("kError"),l=Symbol("kMessage"),c=Symbol("kReason"),u=Symbol("kTarget"),h=Symbol("kType"),m=Symbol("kWasClean");class Event{constructor(e){this[u]=null,this[h]=e}get target(){return this[u]}get type(){return this[h]}}Object.defineProperty(Event.prototype,"target",{enumerable:!0}),Object.defineProperty(Event.prototype,"type",{enumerable:!0});class CloseEvent extends Event{constructor(e,t={}){super(e),this[s]=void 0===t.code?0:t.code,this[c]=void 0===t.reason?"":t.reason,this[m]=void 0!==t.wasClean&&t.wasClean}get code(){return this[s]}get reason(){return this[c]}get wasClean(){return this[m]}}Object.defineProperty(CloseEvent.prototype,"code",{enumerable:!0}),Object.defineProperty(CloseEvent.prototype,"reason",{enumerable:!0}),Object.defineProperty(CloseEvent.prototype,"wasClean",{enumerable:!0});class ErrorEvent extends Event{constructor(e,t={}){super(e),this[d]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[d]}get message(){return this[l]}}Object.defineProperty(ErrorEvent.prototype,"error",{enumerable:!0}),Object.defineProperty(ErrorEvent.prototype,"message",{enumerable:!0});class MessageEvent extends Event{constructor(e,t={}){super(e),this[a]=void 0===t.data?null:t.data}get data(){return this[a]}}Object.defineProperty(MessageEvent.prototype,"data",{enumerable:!0});const f={addEventListener(s,a,d={}){for(const l of this.listeners(s))if(!d[e]&&l[t]===a&&!l[e])return;let l;if("message"===s)l=function(e,t){const s=new MessageEvent("message",{data:t?e:e.toString()});s[u]=this,callListener(a,this,s)};else if("close"===s)l=function(e,t){const s=new CloseEvent("close",{code:e,reason:t.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[u]=this,callListener(a,this,s)};else if("error"===s)l=function(e){const t=new ErrorEvent("error",{error:e,message:e.message});t[u]=this,callListener(a,this,t)};else{if("open"!==s)return;l=function(){const e=new Event("open");e[u]=this,callListener(a,this,e)}}l[e]=!!d[e],l[t]=a,d.once?this.once(s,l):this.on(s,l)},removeEventListener(s,a){for(const d of this.listeners(s))if(d[t]===a&&!d[e]){this.removeListener(s,d);break}}};function callListener(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}return oe={CloseEvent:CloseEvent,ErrorEvent:ErrorEvent,Event:Event,EventTarget:f,MessageEvent:MessageEvent}}(),{format:W,parse:$}=requireExtension(),{toBuffer:F}=requireBufferUtil(),Z=Symbol("kAborted"),K=[8,13],V=["CONNECTING","OPEN","CLOSING","CLOSED"],G=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class WebSocket extends t{constructor(e,t,s){super(),this._binaryType=P[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=N,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=WebSocket.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),initAsClient(this,e,t,s)):(this._autoPong=s.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){P.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){const a=new T({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),d=new z(e,this._extensions,s.generateMask);this._receiver=a,this._sender=d,this._socket=e,a[U]=this,d[U]=this,e[U]=this,a.on("conclude",receiverOnConclude),a.on("drain",receiverOnDrain),a.on("error",receiverOnError),a.on("message",receiverOnMessage),a.on("ping",receiverOnPing),a.on("pong",receiverOnPong),d.onerror=senderOnError,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",socketOnClose),e.on("data",socketOnData),e.on("end",socketOnEnd),e.on("error",socketOnError),this._readyState=WebSocket.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=WebSocket.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[R.extensionName]&&this._extensions[R.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=WebSocket.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==WebSocket.CLOSED){if(this.readyState===WebSocket.CONNECTING){const e="WebSocket was closed before the connection was established";return void abortHandshake(this,this._req,e)}this.readyState!==WebSocket.CLOSING?(this._readyState=WebSocket.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),setCloseTimer(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==WebSocket.CONNECTING&&this.readyState!==WebSocket.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===WebSocket.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===WebSocket.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||N,t,s)):sendAfterClose(this,e,s)}pong(e,t,s){if(this.readyState===WebSocket.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===WebSocket.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||N,t,s)):sendAfterClose(this,e,s)}resume(){this.readyState!==WebSocket.CONNECTING&&this.readyState!==WebSocket.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===WebSocket.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==WebSocket.OPEN)return void sendAfterClose(this,e,s);const a={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[R.extensionName]||(a.compress=!1),this._sender.send(e||N,a,s)}terminate(){if(this.readyState!==WebSocket.CLOSED){if(this.readyState===WebSocket.CONNECTING){const e="WebSocket was closed before the connection was established";return void abortHandshake(this,this._req,e)}this._socket&&(this._readyState=WebSocket.CLOSING,this._socket.destroy())}}}function initAsClient(e,t,d,l){const u={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:K[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...l,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=u.autoPong,!K.includes(u.protocolVersion))throw new RangeError(`Unsupported protocol version: ${u.protocolVersion} (supported versions: ${K.join(", ")})`);let h;if(t instanceof C)h=t;else try{h=new C(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===h.protocol?h.protocol="ws:":"https:"===h.protocol&&(h.protocol="wss:"),e._url=h.href;const m="wss:"===h.protocol,f="ws+unix:"===h.protocol;let _;if("ws:"===h.protocol||m||f?f&&!h.pathname?_="The URL's pathname is empty":h.hash&&(_="The URL contains a fragment identifier"):_='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',_){const t=new SyntaxError(_);if(0===e._redirects)throw t;return void emitErrorAndClose(e,t)}const x=m?443:80,j=c(16).toString("base64"),S=m?s.request:a.request,k=new Set;let E,T;if(u.createConnection=u.createConnection||(m?tlsConnect:netConnect),u.defaultPort=u.defaultPort||x,u.port=h.port||x,u.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,u.headers={...u.headers,"Sec-WebSocket-Version":u.protocolVersion,"Sec-WebSocket-Key":j,Connection:"Upgrade",Upgrade:"websocket"},u.path=h.pathname+h.search,u.timeout=u.handshakeTimeout,u.perMessageDeflate&&(E=new R(!0!==u.perMessageDeflate?u.perMessageDeflate:{},!1,u.maxPayload),u.headers["Sec-WebSocket-Extensions"]=W({[R.extensionName]:E.offer()})),d.length){for(const e of d){if("string"!=typeof e||!G.test(e)||k.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");k.add(e)}u.headers["Sec-WebSocket-Protocol"]=d.join(",")}if(u.origin&&(u.protocolVersion<13?u.headers["Sec-WebSocket-Origin"]=u.origin:u.headers.Origin=u.origin),(h.username||h.password)&&(u.auth=`${h.username}:${h.password}`),f){const e=u.path.split(":");u.socketPath=e[0],u.path=e[1]}if(u.followRedirects){if(0===e._redirects){e._originalIpc=f,e._originalSecure=m,e._originalHostOrSocketPath=f?u.socketPath:h.host;const t=l&&l.headers;if(l={...l,headers:{}},t)for(const[e,s]of Object.entries(t))l.headers[e.toLowerCase()]=s}else if(0===e.listenerCount("redirect")){const t=f?!!e._originalIpc&&u.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&h.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!m)&&(delete u.headers.authorization,delete u.headers.cookie,t||delete u.headers.host,u.auth=void 0)}u.auth&&!l.headers.authorization&&(l.headers.authorization="Basic "+Buffer.from(u.auth).toString("base64")),T=e._req=S(u),e._redirects&&e.emit("redirect",e.url,T)}else T=e._req=S(u);u.timeout&&T.on("timeout",()=>{abortHandshake(e,T,"Opening handshake has timed out")}),T.on("error",t=>{null===T||T[Z]||(T=e._req=null,emitErrorAndClose(e,t))}),T.on("response",s=>{const a=s.headers.location,c=s.statusCode;if(a&&u.followRedirects&&c>=300&&c<400){if(++e._redirects>u.maxRedirects)return void abortHandshake(e,T,"Maximum redirects exceeded");let s;T.abort();try{s=new C(a,t)}catch(t){const s=new SyntaxError(`Invalid URL: ${a}`);return void emitErrorAndClose(e,s)}initAsClient(e,s,d,l)}else e.emit("unexpected-response",T,s)||abortHandshake(e,T,`Unexpected server response: ${s.statusCode}`)}),T.on("upgrade",(t,s,a)=>{if(e.emit("upgrade",t),e.readyState!==WebSocket.CONNECTING)return;T=e._req=null;const d=t.headers.upgrade;if(void 0===d||"websocket"!==d.toLowerCase())return void abortHandshake(e,s,"Invalid Upgrade header");const l=g("sha1").update(j+B).digest("base64");if(t.headers["sec-websocket-accept"]!==l)return void abortHandshake(e,s,"Invalid Sec-WebSocket-Accept header");const c=t.headers["sec-websocket-protocol"];let h;if(void 0!==c?k.size?k.has(c)||(h="Server sent an invalid subprotocol"):h="Server sent a subprotocol but none was requested":k.size&&(h="Server sent no subprotocol"),h)return void abortHandshake(e,s,h);c&&(e._protocol=c);const m=t.headers["sec-websocket-extensions"];if(void 0!==m){if(!E){return void abortHandshake(e,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=$(m)}catch(t){return void abortHandshake(e,s,"Invalid Sec-WebSocket-Extensions header")}const a=Object.keys(t);if(1!==a.length||a[0]!==R.extensionName){return void abortHandshake(e,s,"Server indicated an extension that was not requested")}try{E.accept(t[R.extensionName])}catch(t){return void abortHandshake(e,s,"Invalid Sec-WebSocket-Extensions header")}e._extensions[R.extensionName]=E}e.setSocket(s,a,{allowSynchronousEvents:u.allowSynchronousEvents,generateMask:u.generateMask,maxPayload:u.maxPayload,skipUTF8Validation:u.skipUTF8Validation})}),u.finishRequest?u.finishRequest(T,e):T.end()}function emitErrorAndClose(e,t){e._readyState=WebSocket.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function netConnect(e){return e.path=e.socketPath,d.connect(e)}function tlsConnect(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=d.isIP(e.host)?"":e.host),l.connect(e)}function abortHandshake(t,s,a){t._readyState=WebSocket.CLOSING;const d=new Error(a);Error.captureStackTrace(d,abortHandshake),s.setHeader?(s[Z]=!0,s.abort(),s.socket&&!s.socket.destroyed&&s.socket.destroy(),e.nextTick(emitErrorAndClose,t,d)):(s.destroy(d),s.once("error",t.emit.bind(t,"error")),s.once("close",t.emitClose.bind(t)))}function sendAfterClose(t,s,a){if(s){const e=O(s)?s.size:F(s).length;t._socket?t._sender._bufferedBytes+=e:t._bufferedAmount+=e}if(a){const s=new Error(`WebSocket is not open: readyState ${t.readyState} (${V[t.readyState]})`);e.nextTick(a,s)}}function receiverOnConclude(t,s){const a=this[U];a._closeFrameReceived=!0,a._closeMessage=s,a._closeCode=t,void 0!==a._socket[U]&&(a._socket.removeListener("data",socketOnData),e.nextTick(resume,a._socket),1005===t?a.close():a.close(t,s))}function receiverOnDrain(){const e=this[U];e.isPaused||e._socket.resume()}function receiverOnError(t){const s=this[U];void 0!==s._socket[U]&&(s._socket.removeListener("data",socketOnData),e.nextTick(resume,s._socket),s.close(t[L])),s._errorEmitted||(s._errorEmitted=!0,s.emit("error",t))}function receiverOnFinish(){this[U].emitClose()}function receiverOnMessage(e,t){this[U].emit("message",e,t)}function receiverOnPing(e){const t=this[U];t._autoPong&&t.pong(e,!this._isServer,D),t.emit("ping",e)}function receiverOnPong(e){this[U].emit("pong",e)}function resume(e){e.resume()}function senderOnError(e){const t=this[U];t.readyState!==WebSocket.CLOSED&&(t.readyState===WebSocket.OPEN&&(t._readyState=WebSocket.CLOSING,setCloseTimer(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function setCloseTimer(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function socketOnClose(){const e=this[U];let t;this.removeListener("close",socketOnClose),this.removeListener("data",socketOnData),this.removeListener("end",socketOnEnd),e._readyState=WebSocket.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[U]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",receiverOnFinish),e._receiver.on("finish",receiverOnFinish))}function socketOnData(e){this[U]._receiver.write(e)||this.pause()}function socketOnEnd(){const e=this[U];e._readyState=WebSocket.CLOSING,e._receiver.end(),this.end()}function socketOnError(){const e=this[U];this.removeListener("error",socketOnError),this.on("error",D),e&&(e._readyState=WebSocket.CLOSING,this.destroy())}return Object.defineProperty(WebSocket,"CONNECTING",{enumerable:!0,value:V.indexOf("CONNECTING")}),Object.defineProperty(WebSocket.prototype,"CONNECTING",{enumerable:!0,value:V.indexOf("CONNECTING")}),Object.defineProperty(WebSocket,"OPEN",{enumerable:!0,value:V.indexOf("OPEN")}),Object.defineProperty(WebSocket.prototype,"OPEN",{enumerable:!0,value:V.indexOf("OPEN")}),Object.defineProperty(WebSocket,"CLOSING",{enumerable:!0,value:V.indexOf("CLOSING")}),Object.defineProperty(WebSocket.prototype,"CLOSING",{enumerable:!0,value:V.indexOf("CLOSING")}),Object.defineProperty(WebSocket,"CLOSED",{enumerable:!0,value:V.indexOf("CLOSED")}),Object.defineProperty(WebSocket.prototype,"CLOSED",{enumerable:!0,value:V.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(WebSocket.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(WebSocket.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[H])return t[I];return null},set(t){for(const t of this.listeners(e))if(t[H]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[H]:!0})}})}),WebSocket.prototype.addEventListener=M,WebSocket.prototype.removeEventListener=q,de=WebSocket}function requireSubprotocol(){if(pe)return he;pe=1;const{tokenChars:e}=requireValidation();return he={parse:function(t){const s=new Set;let a=-1,d=-1,l=0;for(;l<t.length;l++){const c=t.charCodeAt(l);if(-1===d&&1===e[c])-1===a&&(a=l);else if(0===l||32!==c&&9!==c){if(44!==c)throw new SyntaxError(`Unexpected character at index ${l}`);{if(-1===a)throw new SyntaxError(`Unexpected character at index ${l}`);-1===d&&(d=l);const e=t.slice(a,d);if(s.has(e))throw new SyntaxError(`The "${e}" subprotocol is duplicated`);s.add(e),a=d=-1}}else-1===d&&-1!==a&&(d=l)}if(-1===a||-1!==d)throw new SyntaxError("Unexpected end of input");const c=t.slice(a,l);if(s.has(c))throw new SyntaxError(`The "${c}" subprotocol is duplicated`);return s.add(c),s}},he}!function(){if(ue)return ce;ue=1,requireWebsocket();const{Duplex:t}=u;function emitClose(e){e.emit("close")}function duplexOnEnd(){!this.destroyed&&this._writableState.finished&&this.destroy()}function duplexOnError(e){this.removeListener("error",duplexOnError),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}ce=function(s,a){let d=!0;const l=new t({...a,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(e,t){const a=!t&&l._readableState.objectMode?e.toString():e;l.push(a)||s.pause()}),s.once("error",function(e){l.destroyed||(d=!1,l.destroy(e))}),s.once("close",function(){l.destroyed||l.push(null)}),l._destroy=function(t,a){if(s.readyState===s.CLOSED)return a(t),void e.nextTick(emitClose,l);let c=!1;s.once("error",function(e){c=!0,a(e)}),s.once("close",function(){c||a(t),e.nextTick(emitClose,l)}),d&&s.terminate()},l._final=function(e){s.readyState!==s.CONNECTING?null!==s._socket&&(s._socket._writableState.finished?(e(),l._readableState.endEmitted&&l.destroy()):(s._socket.once("finish",function(){e()}),s.close())):s.once("open",function(){l._final(e)})},l._read=function(){s.isPaused&&s.resume()},l._write=function(e,t,a){s.readyState!==s.CONNECTING?s.send(e,a):s.once("open",function(){l._write(e,t,a)})},l.on("end",duplexOnEnd),l.on("error",duplexOnError),l}}(),requireReceiver(),requireSender(),requireWebsocket();var ge=function(){if(fe)return me;fe=1;const t=h,s=m,{Duplex:a}=u,{createHash:d}=f,l=requireExtension(),c=requirePermessageDeflate(),g=requireSubprotocol(),_=requireWebsocket(),{GUID:x,kWebSocket:j}=requireConstants(),S=/^[+/0-9A-Za-z]{22}==$/;function emitClose(e){e._state=2,e.emit("close")}function socketOnError(){this.destroy()}function abortHandshake(e,t,a,d){a=a||s.STATUS_CODES[t],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(a),...d},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${s.STATUS_CODES[t]}\r\n`+Object.keys(d).map(e=>`${e}: ${d[e]}`).join("\r\n")+"\r\n\r\n"+a)}function abortHandshakeOrEmitwsClientError(e,t,s,a,d){if(e.listenerCount("wsClientError")){const a=new Error(d);Error.captureStackTrace(a,abortHandshakeOrEmitwsClientError),e.emit("wsClientError",a,s,t)}else abortHandshake(s,a,d)}return me=class extends t{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:_,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=s.createServer((e,t)=>{const a=s.STATUS_CODES[426];t.writeHead(426,{"Content-Length":a.length,"Content-Type":"text/plain"}),t.end(a)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const s of Object.keys(t))e.on(s,t[s]);return function(){for(const s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,s,a)=>{this.handleUpgrade(t,s,a,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(2===this._state)return t&&this.once("close",()=>{t(new Error("The server is not running"))}),void e.nextTick(emitClose,this);if(t&&this.once("close",t),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:e.nextTick(emitClose,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{emitClose(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,a){t.on("error",socketOnError);const d=e.headers["sec-websocket-key"],u=e.headers.upgrade,h=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void abortHandshakeOrEmitwsClientError(this,e,t,405,"Invalid HTTP method")}if(void 0===u||"websocket"!==u.toLowerCase()){return void abortHandshakeOrEmitwsClientError(this,e,t,400,"Invalid Upgrade header")}if(void 0===d||!S.test(d)){return void abortHandshakeOrEmitwsClientError(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(8!==h&&13!==h){return void abortHandshakeOrEmitwsClientError(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header")}if(!this.shouldHandle(e))return void abortHandshake(t,400);const m=e.headers["sec-websocket-protocol"];let f=new Set;if(void 0!==m)try{f=g.parse(m)}catch(s){return void abortHandshakeOrEmitwsClientError(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const _=e.headers["sec-websocket-extensions"],x={};if(this.options.perMessageDeflate&&void 0!==_){const s=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=l.parse(_);e[c.extensionName]&&(s.accept(e[c.extensionName]),x[c.extensionName]=s)}catch(s){return void abortHandshakeOrEmitwsClientError(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const l={origin:e.headers[""+(8===h?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(l,(l,c,u,h)=>{if(!l)return abortHandshake(t,c||401,u,h);this.completeUpgrade(x,d,f,e,t,s,a)});if(!this.options.verifyClient(l))return abortHandshake(t,401)}this.completeUpgrade(x,d,f,e,t,s,a)}completeUpgrade(t,s,a,u,h,m,f){if(!h.readable||!h.writable)return h.destroy();if(h[j])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return abortHandshake(h,503);const g=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${d("sha1").update(s+x).digest("base64")}`],_=new this.options.WebSocket(null,void 0,this.options);if(a.size){const e=this.options.handleProtocols?this.options.handleProtocols(a,u):a.values().next().value;e&&(g.push(`Sec-WebSocket-Protocol: ${e}`),_._protocol=e)}if(t[c.extensionName]){const e=t[c.extensionName].params,s=l.format({[c.extensionName]:[e]});g.push(`Sec-WebSocket-Extensions: ${s}`),_._extensions=t}this.emit("headers",g,u),h.write(g.concat("\r\n").join("\r\n")),h.removeListener("error",socketOnError),_.setSocket(h,m,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(_),_.on("close",()=>{this.clients.delete(_),this._shouldEmitClose&&!this.clients.size&&e.nextTick(emitClose,this)})),f(_,u)}},me}();const _e=getDefaultExportFromCjs(ge),nodeAdapter=(e={})=>{const t=new AdapterHookable(e),s=new Set,a=e.wss||new _e({noServer:!0,...e.serverOptions});return a.on("connection",(e,a)=>{const d=new NodeReqProxy(a),l=new NodePeer({ws:e,request:d,peers:s,nodeReq:a});s.add(l),t.callHook("open",l),e.on("message",e=>{Array.isArray(e)&&(e=Buffer.concat(e)),t.callHook("message",l,new Message(e,l))}),e.on("error",e=>{s.delete(l),t.callHook("error",l,new WSError(e))}),e.on("close",(e,a)=>{s.delete(l),t.callHook("close",l,{code:e,reason:a?.toString()})})}),a.on("headers",(e,t)=>{const s=t._upgradeHeaders;if(s)for(const[t,a]of new Headers(s))e.push(`${t}: ${a}`)}),{...adapterUtils(s),handleUpgrade:async(e,s,d)=>{const l=new NodeReqProxy(e),{upgradeHeaders:c,endResponse:u,context:h}=await t.upgrade(l);if(u)return async function(e,t){const s=[`HTTP/1.1 ${t.status||200} ${t.statusText||""}`,...[...t.headers.entries()].map(([e,t])=>`${encodeURIComponent(e)}: ${encodeURIComponent(t)}`)];if(e.write(s.join("\r\n")+"\r\n\r\n"),t.body)for await(const s of t.body)e.write(s);return new Promise(t=>{e.end(()=>{e.destroy(),t()})})}(s,u);e._request=l,e._upgradeHeaders=c,e._context=h,a.handleUpgrade(e,s,d,t=>{a.emit("connection",t,e)})},closeAll:(e,t,s)=>{for(const d of a.clients)s?d.terminate():d.close(e,t)}}};class NodePeer extends Peer{get remoteAddress(){return this._internal.nodeReq.socket?.remoteAddress}get context(){return this._internal.nodeReq._context}send(e,t){const s=toBufferLike(e),a="string"!=typeof s;return this._internal.ws.send(s,{compress:t?.compress,binary:a,...t}),0}publish(e,t,s){const a=toBufferLike(t),d="string"!=typeof t,l={compress:s?.compress,binary:d,...s};for(const t of this._internal.peers)t!==this&&t._topics.has(e)&&t._internal.ws.send(a,l)}close(e,t){this._internal.ws.close(e,t)}terminate(){this._internal.ws.terminate()}}class NodeReqProxy{_req;_headers;_url;constructor(e){this._req=e}get url(){if(!this._url){const e=this._req,t=e.headers.host||"localhost",s=e.socket?.encrypted??"https"===e.headers["x-forwarded-proto"];this._url=`${s?"https":"http"}://${t}${e.url}`}return this._url}get headers(){return this._headers||(this._headers=new Headers(this._req.headers)),this._headers}}const be=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,we=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,ve=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function jsonParseTransform(e,t){if(!("__proto__"===e||"constructor"===e&&t&&"object"==typeof t&&"prototype"in t))return t;!function(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}(e)}function destr(e,t={}){if("string"!=typeof e)return e;if('"'===e[0]&&'"'===e[e.length-1]&&-1===e.indexOf("\\"))return e.slice(1,-1);const s=e.trim();if(s.length<=9)switch(s.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!ve.test(e)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(be.test(e)||we.test(e)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,jsonParseTransform)}return JSON.parse(e)}catch(s){if(t.strict)throw s;return e}}const xe=/#/g,je=/&/g,Se=/\//g,ke=/=/g,Ee=/\+/g,Ce=/%5e/gi,Re=/%60/gi,Te=/%7c/gi,ze=/%20/gi,Oe=/%2f/gi;function encodeQueryValue(e){return(t="string"==typeof e?e:JSON.stringify(e),encodeURI(""+t).replace(Te,"|")).replace(Ee,"%2B").replace(ze,"+").replace(xe,"%23").replace(je,"%26").replace(Re,"`").replace(Ce,"^").replace(Se,"%2F");var t}function encodeQueryKey(e){return encodeQueryValue(e).replace(ke,"%3D")}function decode(e=""){try{return decodeURIComponent(""+e)}catch{return""+e}}function decodePath(e){return decode(e.replace(Oe,"%252F"))}function decodeQueryKey(e){return decode(e.replace(Ee," "))}function decodeQueryValue(e){return decode(e.replace(Ee," "))}function parseQuery(e=""){const t=Object.create(null);"?"===e[0]&&(e=e.slice(1));for(const s of e.split("&")){const e=s.match(/([^=]+)=?(.*)/)||[];if(e.length<2)continue;const a=decodeQueryKey(e[1]);if("__proto__"===a||"constructor"===a)continue;const d=decodeQueryValue(e[2]||"");void 0===t[a]?t[a]=d:Array.isArray(t[a])?t[a].push(d):t[a]=[t[a],d]}return t}function stringifyQuery(e){return Object.keys(e).filter(t=>void 0!==e[t]).map(t=>function(e,t){return"number"!=typeof t&&"boolean"!=typeof t||(t=String(t)),t?Array.isArray(t)?t.map(t=>`${encodeQueryKey(e)}=${encodeQueryValue(t)}`).join("&"):`${encodeQueryKey(e)}=${encodeQueryValue(t)}`:encodeQueryKey(e)}(t,e[t])).filter(Boolean).join("&")}const Ae=/^[\s\w\0+.-]{2,}:([/\\]{1,2})/,Pe=/^[\s\w\0+.-]{2,}:([/\\]{2})?/,Ne=/^([/\\]\s*){2,}[^/\\]/,Be=/^[\s\0]*(blob|data|javascript|vbscript):$/i,He=/\/$|\/\?|\/#/,Ie=/^\.?\//;function hasProtocol(e,t={}){return"boolean"==typeof t&&(t={acceptRelative:t}),t.strict?Ae.test(e):Pe.test(e)||!!t.acceptRelative&&Ne.test(e)}function isScriptProtocol(e){return!!e&&Be.test(e)}function hasTrailingSlash(e="",t){return t?He.test(e):e.endsWith("/")}function withoutTrailingSlash(e="",t){if(!t)return(hasTrailingSlash(e)?e.slice(0,-1):e)||"/";if(!hasTrailingSlash(e,!0))return e||"/";let s=e,a="";const d=e.indexOf("#");-1!==d&&(s=e.slice(0,d),a=e.slice(d));const[l,...c]=s.split("?");return((l.endsWith("/")?l.slice(0,-1):l)||"/")+(c.length>0?`?${c.join("?")}`:"")+a}function withTrailingSlash(e="",t){if(!t)return e.endsWith("/")?e:e+"/";if(hasTrailingSlash(e,!0))return e||"/";let s=e,a="";const d=e.indexOf("#");if(-1!==d&&(s=e.slice(0,d),a=e.slice(d),!s))return a;const[l,...c]=s.split("?");return l+"/"+(c.length>0?`?${c.join("?")}`:"")+a}function withLeadingSlash(e=""){return function(e=""){return e.startsWith("/")}(e)?e:"/"+e}function withoutBase(e,t){if(isEmptyURL(t))return e;const s=withoutTrailingSlash(t);if(!e.startsWith(s))return e;const a=e[s.length];if(a&&"/"!==a&&"?"!==a)return e;const d=e.slice(s.length);return"/"===d[0]?d:"/"+d}function withQuery(e,t){const s=parseURL(e),a={...parseQuery(s.search),...t};return s.search=stringifyQuery(a),function(e){const t=e.pathname||"",s=e.search?(e.search.startsWith("?")?"":"?")+e.search:"",a=e.hash||"",d=e.auth?e.auth+"@":"",l=e.host||"",c=e.protocol||e[Le]?(e.protocol||"")+"//":"";return c+d+l+t+s+a}(s)}function getQuery$1(e){return parseQuery(parseURL(e).search)}function isEmptyURL(e){return!e||"/"===e}function joinURL(e,...t){let s=e||"";for(const e of t.filter(e=>function(e){return e&&"/"!==e}(e)))if(s){const t=e.replace(Ie,"");s=withTrailingSlash(s)+t}else s=e;return s}function joinRelativeURL(...e){const t=/\/(?!\/)/,s=e.filter(Boolean),a=[];let d=0;for(const e of s)if(e&&"/"!==e)for(const[s,l]of e.split(t).entries())if(l&&"."!==l)if(".."!==l)1===s&&a[a.length-1]?.endsWith(":/")?a[a.length-1]+="/"+l:(a.push(l),d++);else{if(1===a.length&&hasProtocol(a[0]))continue;a.pop(),d--}let l=a.join("/");return d>=0?s[0]?.startsWith("/")&&!l.startsWith("/")?l="/"+l:s[0]?.startsWith("./")&&!l.startsWith("./")&&(l="./"+l):l="../".repeat(-1*d)+l,s[s.length-1]?.endsWith("/")&&!l.endsWith("/")&&(l+="/"),l}const Le=Symbol.for("ufo:protocolRelative");function parseURL(e="",t){const s=e.match(/^[\s\0]*(blob:|data:|javascript:|vbscript:)(.*)/i);if(s){const[,e,t=""]=s;return{protocol:e.toLowerCase(),pathname:t,href:e+t,auth:"",host:"",search:"",hash:""}}if(!hasProtocol(e,{acceptRelative:!0}))return parsePath(e);const[,a="",d,l=""]=e.replace(/\\/g,"/").match(/^[\s\0]*([\w+.-]{2,}:)?\/\/([^/@]+@)?(.*)/)||[];let[,c="",u=""]=l.match(/([^#/?]*)(.*)?/)||[];"file:"===a&&(u=u.replace(/\/(?=[A-Za-z]:)/,""));const{pathname:h,search:m,hash:f}=parsePath(u);return{protocol:a.toLowerCase(),auth:d?d.slice(0,Math.max(0,d.length-1)):"",host:c,pathname:h,search:m,hash:f,[Le]:!a}}function parsePath(e=""){const[t="",s="",a=""]=(e.match(/([^#?]*)(\?[^#]*)?(#.*)?/)||[]).splice(1);return{pathname:t,search:s,hash:a}}const Ue=0,De=1,Me=2;function createRouter$1(e={}){const t={options:e,rootNode:createRadixNode(),staticRoutesMap:{}},normalizeTrailingSlash=t=>e.strictTrailingSlash?t:t.replace(/\/$/,"")||"/";if(e.routes)for(const s in e.routes)insert(t,normalizeTrailingSlash(s),e.routes[s]);return{ctx:t,lookup:e=>function(e,t){const s=e.staticRoutesMap[t];if(s)return s.data;const a=t.split("/"),d={};let l=!1,c=null,u=e.rootNode,h=null;for(let e=0;e<a.length;e++){const t=a[e];null!==u.wildcardChildNode&&(c=u.wildcardChildNode,h=a.slice(e).join("/"));const s=u.children.get(t);if(void 0===s){if(u&&u.placeholderChildren.length>1){const t=a.length-e;u=u.placeholderChildren.find(e=>e.maxDepth===t)||null}else u=u.placeholderChildren[0]||null;if(!u)break;u.paramName&&(d[u.paramName]=t),l=!0}else u=s}null!==u&&null!==u.data||null===c||(u=c,d[u.paramName||"_"]=h,l=!0);if(!u)return null;if(l)return{...u.data,params:l?d:void 0};return u.data}(t,normalizeTrailingSlash(e)),insert:(e,s)=>insert(t,normalizeTrailingSlash(e),s),remove:e=>function(e,t){let s=!1;const a=t.split("/");let d=e.rootNode;for(const e of a)if(d=d.children.get(e),!d)return s;if(d.data){const e=a.at(-1)||"";d.data=null,0===Object.keys(d.children).length&&d.parent&&(d.parent.children.delete(e),d.parent.wildcardChildNode=null,d.parent.placeholderChildren=[]),s=!0}return s}(t,normalizeTrailingSlash(e))}}function insert(e,t,s){let a=!0;const d=t.split("/");let l=e.rootNode,c=0;const u=[l];for(const e of d){let t;if(t=l.children.get(e))l=t;else{const s=getNodeType(e);t=createRadixNode({type:s,parent:l}),l.children.set(e,t),s===Me?(t.paramName="*"===e?"_"+c++:e.slice(1),l.placeholderChildren.push(t),a=!1):s===De&&(l.wildcardChildNode=t,t.paramName=e.slice(3)||"_",a=!1),u.push(t),l=t}}for(const[e,t]of u.entries())t.maxDepth=Math.max(u.length-e,t.maxDepth||0);return l.data=s,!0===a&&(e.staticRoutesMap[t]=l),l}function createRadixNode(e={}){return{type:e.type||Ue,maxDepth:0,parent:e.parent||null,children:new Map,data:e.data||null,paramName:e.paramName||null,wildcardChildNode:null,placeholderChildren:[]}}function getNodeType(e){return e.startsWith("**")?De:":"===e[0]||"*"===e?Me:Ue}function toRouteMatcher(e){return function(e,t){return{ctx:{table:e},matchAll:s=>_matchRoutes(s,e,t)}}(_routerNodeToTable("",e.ctx.rootNode),e.ctx.options.strictTrailingSlash)}function _matchRoutes(e,t,s){!0!==s&&e.endsWith("/")&&(e=e.slice(0,-1)||"/");const a=[];for(const[s,d]of _sortRoutesMap(t.wildcard))(e===s||e.startsWith(s+"/"))&&a.push(d);for(const[s,d]of _sortRoutesMap(t.dynamic))if(e.startsWith(s+"/")){const t="/"+e.slice(s.length).split("/").splice(2).join("/");a.push(..._matchRoutes(t,d))}const d=t.static.get(e);return d&&a.push(d),a.filter(Boolean)}function _sortRoutesMap(e){return[...e.entries()].sort((e,t)=>e[0].length-t[0].length)}function _routerNodeToTable(e,t){const s={static:new Map,wildcard:new Map,dynamic:new Map};return function _addNode(e,t){if(e)if(t.type!==Ue||e.includes("*")||e.includes(":")){if(t.type===De)s.wildcard.set(e.replace("/**",""),t.data);else if(t.type===Me){const a=_routerNodeToTable("",t);return t.data&&a.static.set("/",t.data),void s.dynamic.set(e.replace(/\/\*|\/:\w+/,""),a)}}else t.data&&s.static.set(e,t.data);for(const[s,a]of t.children.entries())_addNode(`${e}/${s}`.replace("//","/"),a)}(e,t),s}function isPlainObject(e){if(null===e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&(!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e)))}function _defu(e,t,s=".",a){if(!isPlainObject(t))return _defu(e,{},s,a);const d=Object.assign({},t);for(const t in e){if("__proto__"===t||"constructor"===t)continue;const l=e[t];null!=l&&(a&&a(d,t,l,s)||(Array.isArray(l)&&Array.isArray(d[t])?d[t]=[...l,...d[t]]:isPlainObject(l)&&isPlainObject(d[t])?d[t]=_defu(l,d[t],(s?`${s}.`:"")+t.toString(),a):d[t]=l))}return d}function createDefu(e){return(...t)=>t.reduce((t,s)=>_defu(t,s,"",e),{})}const qe=createDefu(),We=createDefu((e,t,s)=>{if(void 0!==e[t]&&"function"==typeof s)return e[t]=s(e[t]),!0});function o(e){throw new Error(`${e} is not implemented yet!`)}let $e=class i extends E{__unenv__={};readableEncoding=null;readableEnded=!0;readableFlowing=!1;readableHighWaterMark=0;readableLength=0;readableObjectMode=!1;readableAborted=!1;readableDidRead=!1;closed=!1;errored=null;readable=!1;destroyed=!1;static from(e,t){return new i(t)}constructor(e){super()}_read(e){}read(e){}setEncoding(e){return this}pause(){return this}resume(){return this}isPaused(){return!0}unpipe(e){return this}unshift(e,t){}wrap(e){return this}push(e,t){return!1}_destroy(e,t){this.removeAllListeners()}destroy(e){return this.destroyed=!0,this._destroy(e),this}pipe(e,t){return{}}compose(e,t){throw new Error("Method not implemented.")}[Symbol.asyncDispose](){return this.destroy(),Promise.resolve()}async*[Symbol.asyncIterator](){throw o("Readable.asyncIterator")}iterator(e){throw o("Readable.iterator")}map(e,t){throw o("Readable.map")}filter(e,t){throw o("Readable.filter")}forEach(e,t){throw o("Readable.forEach")}reduce(e,t,s){throw o("Readable.reduce")}find(e,t){throw o("Readable.find")}findIndex(e,t){throw o("Readable.findIndex")}some(e,t){throw o("Readable.some")}toArray(e){throw o("Readable.toArray")}every(e,t){throw o("Readable.every")}flatMap(e,t){throw o("Readable.flatMap")}drop(e,t){throw o("Readable.drop")}take(e,t){throw o("Readable.take")}asIndexedPairs(e){throw o("Readable.asIndexedPairs")}},Fe=class extends E{__unenv__={};writable=!0;writableEnded=!1;writableFinished=!1;writableHighWaterMark=0;writableLength=0;writableObjectMode=!1;writableCorked=0;closed=!1;errored=null;writableNeedDrain=!1;writableAborted=!1;destroyed=!1;_data;_encoding="utf8";constructor(e){super()}pipe(e,t){return{}}_write(e,t,s){if(this.writableEnded)s&&s();else{if(void 0===this._data)this._data=e;else{const s="string"==typeof this._data?C.from(this._data,this._encoding||t||"utf8"):this._data,a="string"==typeof e?C.from(e,t||this._encoding||"utf8"):e;this._data=C.concat([s,a])}this._encoding=t,s&&s()}}_writev(e,t){}_destroy(e,t){}_final(e){}write(e,t,s){const a="string"==typeof t?this._encoding:"utf8",d="function"==typeof t?t:"function"==typeof s?s:void 0;return this._write(e,a,d),!0}setDefaultEncoding(e){return this}end(e,t,s){const a="function"==typeof e?e:"function"==typeof t?t:"function"==typeof s?s:void 0;if(this.writableEnded)return a&&a(),this;const d=e===a?void 0:e;if(d){const e=t===a?void 0:t;this.write(d,e,a)}return this.writableEnded=!0,this.writableFinished=!0,this.emit("close"),this.emit("finish"),this}cork(){}uncork(){}destroy(e){return this.destroyed=!0,delete this._data,this.removeAllListeners(),this}compose(e,t){throw new Error("Method not implemented.")}[Symbol.asyncDispose](){return Promise.resolve()}};const Ze=class{allowHalfOpen=!0;_destroy;constructor(e=new $e,t=new Fe){Object.assign(this,e),Object.assign(this,t),this._destroy=function(...e){return function(...t){for(const s of e)s(...t)}}(e._destroy,t._destroy)}};const Ke=(Object.assign(Ze.prototype,$e.prototype),Object.assign(Ze.prototype,Fe.prototype),Ze);class A extends Ke{__unenv__={};bufferSize=0;bytesRead=0;bytesWritten=0;connecting=!1;destroyed=!1;pending=!1;localAddress="";localPort=0;remoteAddress="";remoteFamily="";remotePort=0;autoSelectFamilyAttemptedAddresses=[];readyState="readOnly";constructor(e){super()}write(e,t,s){return!1}connect(e,t,s){return this}end(e,t,s){return this}setEncoding(e){return this}pause(){return this}resume(){return this}setTimeout(e,t){return this}setNoDelay(e){return this}setKeepAlive(e,t){return this}address(){return{}}unref(){return this}ref(){return this}destroySoon(){this.destroy()}resetAndDestroy(){const e=new Error("ERR_SOCKET_CLOSED");return e.code="ERR_SOCKET_CLOSED",this.destroy(e),this}}class y extends $e{aborted=!1;httpVersion="1.1";httpVersionMajor=1;httpVersionMinor=1;complete=!0;connection;socket;headers={};trailers={};method="GET";url="/";statusCode=200;statusMessage="";closed=!1;errored=null;readable=!1;constructor(e){super(),this.socket=this.connection=e||new A}get rawHeaders(){const e=this.headers,t=[];for(const s in e)if(Array.isArray(e[s]))for(const a of e[s])t.push(s,a);else t.push(s,e[s]);return t}get rawTrailers(){return[]}setTimeout(e,t){return this}get headersDistinct(){return p(this.headers)}get trailersDistinct(){return p(this.trailers)}}function p(e){const t={};for(const[s,a]of Object.entries(e))s&&(t[s]=(Array.isArray(a)?a:[a]).filter(Boolean));return t}class w extends Fe{statusCode=200;statusMessage="";upgrading=!1;chunkedEncoding=!1;shouldKeepAlive=!1;useChunkedEncodingByDefault=!1;sendDate=!1;finished=!1;headersSent=!1;strictContentLength=!1;connection=null;socket=null;req;_headers={};constructor(e){super(),this.req=e}assignSocket(e){e._httpMessage=this,this.socket=e,this.connection=e,this.emit("socket",e),this._flush()}_flush(){this.flushHeaders()}detachSocket(e){}writeContinue(e){}writeHead(e,t,s){e&&(this.statusCode=e),"string"==typeof t&&(this.statusMessage=t,t=void 0);const a=s||t;if(a&&!Array.isArray(a))for(const e in a)this.setHeader(e,a[e]);return this.headersSent=!0,this}writeProcessing(){}setTimeout(e,t){return this}appendHeader(e,t){e=e.toLowerCase();const s=this._headers[e],a=[...Array.isArray(s)?s:[s],...Array.isArray(t)?t:[t]].filter(Boolean);return this._headers[e]=a.length>1?a:a[0],this}setHeader(e,t){return this._headers[e.toLowerCase()]=t,this}setHeaders(e){for(const[t,s]of Object.entries(e))this.setHeader(t,s);return this}getHeader(e){return this._headers[e.toLowerCase()]}getHeaders(){return this._headers}getHeaderNames(){return Object.keys(this._headers)}hasHeader(e){return e.toLowerCase()in this._headers}removeHeader(e){delete this._headers[e.toLowerCase()]}addTrailers(e){}flushHeaders(){}writeEarlyHints(e,t){"function"==typeof t&&t()}}const Ve=(()=>{const n=function(){};return n.prototype=Object.create(null),n})();function v(e={}){if(e instanceof Headers)return e;const t=new Headers;for(const[s,a]of Object.entries(e))if(void 0!==a){if(Array.isArray(a)){for(const e of a)t.append(s,String(e));continue}t.set(s,String(a))}return t}const Ge=new Set([101,204,205,304]);async function b(e,t){const s=new y,a=new w(s);let d;if(s.url=t.url?.toString()||"/",!s.url.startsWith("/")){const e=new URL(s.url);d=e.host,s.url=e.pathname+e.search+e.hash}s.method=t.method||"GET",s.headers=function(e={}){const t=new Ve,s=Array.isArray(e)||function(e){return"function"==typeof e?.entries}(e)?e:Object.entries(e);for(const[e,a]of s)if(a){if(void 0===t[e]){t[e]=a;continue}t[e]=[...Array.isArray(t[e])?t[e]:[t[e]],...Array.isArray(a)?a:[a]]}return t}(t.headers||{}),s.headers.host||(s.headers.host=t.host||d||"localhost"),s.connection.encrypted=s.connection.encrypted||"https"===t.protocol,s.body=t.body||null,s.__unenv__=t.context,await e(s,a);let l=a._data;(Ge.has(a.statusCode)||"HEAD"===s.method.toUpperCase())&&(l=null,delete a._headers["content-length"]);const c={status:a.statusCode,statusText:a.statusMessage,headers:a._headers,body:l};return s.destroy(),a.destroy(),c}function hasProp(e,t){try{return t in e}catch{return!1}}class H3Error extends Error{static __h3_error__=!0;statusCode=500;fatal=!1;unhandled=!1;statusMessage;data;cause;constructor(e,t={}){super(e,t),t.cause&&!this.cause&&(this.cause=t.cause)}toJSON(){const e={message:this.message,statusCode:sanitizeStatusCode(this.statusCode,500)};return this.statusMessage&&(e.statusMessage=sanitizeStatusMessage(this.statusMessage)),void 0!==this.data&&(e.data=this.data),e}}function createError$1(e){if("string"==typeof e)return new H3Error(e);if(isError(e))return e;const t=new H3Error(e.message??e.statusMessage??"",{cause:e.cause||e});if(hasProp(e,"stack"))try{Object.defineProperty(t,"stack",{get:()=>e.stack})}catch{try{t.stack=e.stack}catch{}}if(e.data&&(t.data=e.data),e.statusCode?t.statusCode=sanitizeStatusCode(e.statusCode,t.statusCode):e.status&&(t.statusCode=sanitizeStatusCode(e.status,t.statusCode)),e.statusMessage?t.statusMessage=e.statusMessage:e.statusText&&(t.statusMessage=e.statusText),t.statusMessage){const e=t.statusMessage;sanitizeStatusMessage(t.statusMessage)!==e&&console.warn("[h3] Please prefer using `message` for longer error messages instead of `statusMessage`. In the future, `statusMessage` will be sanitized by default.")}return void 0!==e.fatal&&(t.fatal=e.fatal),void 0!==e.unhandled&&(t.unhandled=e.unhandled),t}function isError(e){return!0===e?.constructor?.__h3_error__}function process$1(e,t){const s={},a=t.find(e=>"content-disposition"===e[0])?.[1]||"";for(const e of a.split(";")){const t=e.split("=");if(2!==t.length)continue;const a=(t[0]||"").trim();if("name"===a||"filename"===a){const e=(t[1]||"").trim().replace(/"/g,"");s[a]=Buffer.from(e,"latin1").toString("utf8")}}const d=t.find(e=>"content-type"===e[0])?.[1]||"";return d&&(s.type=d),s.data=Buffer.from(e),s}function getQuery(e){return getQuery$1(e.path||"")}function getRouterParam(e,t,s={}){const a=function(e,t={}){let s=e.context.params||{};if(t.decode){s={...s};for(const e in s)s[e]=decode(s[e])}return s}(e,s);return a[t]}function getRequestHeaders(e){const t={};for(const s in e.node.req.headers){const a=e.node.req.headers[s];t[s]=Array.isArray(a)?a.filter(Boolean).join(", "):a}return t}function getRequestHeader(e,t){return getRequestHeaders(e)[t.toLowerCase()]}const Qe=getRequestHeader;function getRequestURL(e,t={}){const s=function(e,t={}){if(t.xForwardedHost){const t=e.node.req.headers["x-forwarded-host"],s=(t||"").split(",").shift()?.trim();if(s)return s}return e.node.req.headers.host||"localhost"}(e,t),a=function(e,t={}){return!1!==t.xForwardedProto&&"https"===e.node.req.headers["x-forwarded-proto"]||e.node.req.connection?.encrypted?"https":"http"}(e,t),d=(e.node.req.originalUrl||e.path).replace(/^[/\\]+/g,"/");return new URL(d,`${a}://${s}`)}const Ye=Symbol.for("h3RawBody"),Je=Symbol.for("h3ParsedBody"),Xe=["PATCH","POST","PUT","DELETE"];function readRawBody(e,t="utf8"){!function(e,t){if(!function(e,t){if("string"==typeof t){if(e.method===t)return!0}else if(t.includes(e.method))return!0;return!1}(e,t))throw createError$1({statusCode:405,statusMessage:"HTTP method is not allowed."})}(e,Xe);const s=e._requestBody||e.web?.request?.body||e.node.req[Ye]||e.node.req.rawBody||e.node.req.body;if(s){const e=Promise.resolve(s).then(e=>Buffer.isBuffer(e)?e:"function"==typeof e.pipeTo?new Promise((t,s)=>{const a=[];e.pipeTo(new WritableStream({write(e){a.push(e)},close(){t(Buffer.concat(a))},abort(e){s(e)}})).catch(s)}):"function"==typeof e.pipe?new Promise((t,s)=>{const a=[];e.on("data",e=>{a.push(e)}).on("end",()=>{t(Buffer.concat(a))}).on("error",s)}):e.constructor===Object?Buffer.from(JSON.stringify(e)):e instanceof URLSearchParams?Buffer.from(e.toString()):e instanceof FormData?new Response(e).bytes().then(e=>Buffer.from(e)):Buffer.from(e));return t?e.then(e=>e.toString(t)):e}if(!Number.parseInt(e.node.req.headers["content-length"]||"")&&!/\bchunked\b/i.test(String(e.node.req.headers["transfer-encoding"]??"")))return Promise.resolve(void 0);const a=e.node.req[Ye]=new Promise((t,s)=>{const a=[];e.node.req.on("error",e=>{s(e)}).on("data",e=>{a.push(e)}).on("end",()=>{t(Buffer.concat(a))})});return t?a.then(e=>e.toString(t)):a}async function readBody(e,t={}){const s=e.node.req;if(hasProp(s,Je))return s[Je];const a=s.headers["content-type"]||"",d=await readRawBody(e);let l;return l="application/json"===a?_parseJSON(d,t.strict??!0):a.startsWith("application/x-www-form-urlencoded")?function(e){const t=new URLSearchParams(e),s=Object.create(null);for(const[e,a]of t.entries())hasProp(s,e)?(Array.isArray(s[e])||(s[e]=[s[e]]),s[e].push(a)):s[e]=a;return s}(d):a.startsWith("text/")?d:_parseJSON(d,t.strict??!1),s[Je]=l,l}async function readMultipartFormData(e){const t=getRequestHeader(e,"content-type");if(!t||!t.startsWith("multipart/form-data"))return;const s=t.match(/boundary=([^;]*)(;|$)/i)?.[1];if(!s)return;const a=await readRawBody(e,!1);return a?function(e,t){let s="",a=0,d=[];const l=[];let c=[];for(let u=0;u<e.length;u++){const h=u>0?e[u-1]:null,m=e[u];10===m||13===m||(s+=String.fromCodePoint(m));const f=10===m&&13===h;if(0===a&&f)"--"+t===s&&(a=1),s="";else if(1===a&&f){if(s.length>0){const e=s.indexOf(":");if(e>0){const t=s.slice(0,e).toLowerCase(),a=s.slice(e+1).trim();c.push([t,a])}}else a=2,d=[];s=""}else if(2===a){if(s.length>t.length+4&&(s=""),"--"+t===s){const e=d.length-s.length,t=d.slice(0,e-1);l.push(process$1(t,c)),d=[],c=[],s="",a=3}else d.push(m);f&&(s="")}else 3===a&&f&&(a=1)}return l}(a,s):void 0}function _parseJSON(e="",t){if(e)try{return destr(e,{strict:t})}catch{throw createError$1({statusCode:400,statusMessage:"Bad Request",message:"Invalid JSON body"})}}function handleCacheHeaders(e,t){const s=["public",...t.cacheControls||[]];let a=!1;if(void 0!==t.maxAge&&s.push("max-age="+ +t.maxAge,"s-maxage="+ +t.maxAge),t.modifiedTime){const s=new Date(t.modifiedTime),d=e.node.req.headers["if-modified-since"];e.node.res.setHeader("last-modified",s.toUTCString()),d&&new Date(d)>=s&&(a=!0)}if(t.etag){e.node.res.setHeader("etag",t.etag);e.node.req.headers["if-none-match"]===t.etag&&(a=!0)}return e.node.res.setHeader("cache-control",s.join(", ")),!!a&&(e.node.res.statusCode=304,e.handled||e.node.res.end(),!0)}const et={html:"text/html",json:"application/json"},tt=/[^\u0009\u0020-\u007E]/g;function sanitizeStatusMessage(e=""){return e.replace(tt,"")}function sanitizeStatusCode(e,t=200){return e?("string"==typeof e&&(e=Number.parseInt(e,10)),e<100||e>999?t:e):t}function splitCookiesString(e){if(Array.isArray(e))return e.flatMap(e=>splitCookiesString(e));if("string"!=typeof e)return[];const t=[];let s,a,d,l,c,u=0;const skipWhitespace=()=>{for(;u<e.length&&/\s/.test(e.charAt(u));)u+=1;return u<e.length},notSpecialChar=()=>(a=e.charAt(u),"="!==a&&";"!==a&&","!==a);for(;u<e.length;){for(s=u,c=!1;skipWhitespace();)if(a=e.charAt(u),","===a){for(d=u,u+=1,skipWhitespace(),l=u;u<e.length&&notSpecialChar();)u+=1;u<e.length&&"="===e.charAt(u)?(c=!0,u=l,t.push(e.slice(s,d)),s=u):u=d+1}else u+=1;(!c||u>=e.length)&&t.push(e.slice(s))}return t}const rt="undefined"==typeof setImmediate?e=>e():setImmediate;function send(e,t,s){return s&&function(e,t){t&&304!==e.node.res.statusCode&&!e.node.res.getHeader("content-type")&&e.node.res.setHeader("content-type",t)}(e,s),new Promise(s=>{rt(()=>{e.handled||e.node.res.end(t),s()})})}function setResponseStatus(e,t,s){t&&(e.node.res.statusCode=sanitizeStatusCode(t,e.node.res.statusCode)),s&&(e.node.res.statusMessage=sanitizeStatusMessage(s))}function getResponseStatus(e){return e.node.res.statusCode}function getResponseStatusText(e){return e.node.res.statusMessage}function getResponseHeader(e,t){return e.node.res.getHeader(t)}function setResponseHeaders(e,t){for(const[s,a]of Object.entries(t))e.node.res.setHeader(s,a)}const st=setResponseHeaders;function setResponseHeader(e,t,s){e.node.res.setHeader(t,s)}const ot=setResponseHeader;function appendResponseHeader(e,t,s){let a=e.node.res.getHeader(t);a?(Array.isArray(a)||(a=[a.toString()]),e.node.res.setHeader(t,[...a,s])):e.node.res.setHeader(t,s)}function sendStream(e,t){if(!t||"object"!=typeof t)throw new Error("[h3] Invalid stream provided.");if(e.node.res._data=t,!e.node.res.socket)return e._handled=!0,Promise.resolve();if(hasProp(t,"pipeTo")&&"function"==typeof t.pipeTo)return t.pipeTo(new WritableStream({write(t){e.node.res.write(t)}})).then(()=>{e.node.res.end()});if(hasProp(t,"pipe")&&"function"==typeof t.pipe)return new Promise((s,a)=>{t.pipe(e.node.res),t.on&&(t.on("end",()=>{e.node.res.end(),s()}),t.on("error",e=>{a(e)})),e.node.res.on("close",()=>{t.abort&&t.abort()})});throw new Error("[h3] Invalid or incompatible stream provided.")}function sendWebResponse(e,t){for(const[s,a]of t.headers)"set-cookie"===s?e.node.res.appendHeader(s,splitCookiesString(a)):e.node.res.setHeader(s,a);if(t.status&&(e.node.res.statusCode=sanitizeStatusCode(t.status,e.node.res.statusCode)),t.statusText&&(e.node.res.statusMessage=sanitizeStatusMessage(t.statusText)),t.redirected&&e.node.res.setHeader("location",t.url),t.body)return sendStream(e,t.body);e.node.res.end()}const nt=new Set(["PATCH","POST","PUT","DELETE"]),at=new Set(["transfer-encoding","accept-encoding","connection","keep-alive","upgrade","expect","host","accept"]);async function proxyRequest(e,t,s={}){let a,d;nt.has(e.method)&&(s.streamRequest?(a=function(e){if(!Xe.includes(e.method))return;const t=e.web?.request?.body||e._requestBody;return t||(Ye in e.node.req||"rawBody"in e.node.req||"body"in e.node.req||"__unenv__"in e.node.req?new ReadableStream({async start(t){const s=await readRawBody(e,!1);s&&t.enqueue(s),t.close()}}):new ReadableStream({start:t=>{e.node.req.on("data",e=>{t.enqueue(e)}),e.node.req.on("end",()=>{t.close()}),e.node.req.on("error",e=>{t.error(e)})}}))}(e),d="half"):a=await readRawBody(e,!1).catch(()=>{}));const l=s.fetchOptions?.method||e.method,c=function(e,...t){const s=t.filter(Boolean);if(0===s.length)return e;const a=new Headers(e);for(const e of s){const t=Array.isArray(e)?e:"function"==typeof e.entries?e.entries():Object.entries(e);for(const[e,s]of t)void 0!==s&&a.set(e,s)}return a}(getProxyRequestHeaders(e,{host:t.startsWith("/")}),s.fetchOptions?.headers,s.headers);return async function(e,t,s={}){let a;try{a=await _getFetch(s.fetch)(t,{headers:s.headers,ignoreResponseError:!0,...s.fetchOptions})}catch(e){throw createError$1({status:502,statusMessage:"Bad Gateway",cause:e})}e.node.res.statusCode=sanitizeStatusCode(a.status,e.node.res.statusCode),e.node.res.statusMessage=sanitizeStatusMessage(a.statusText);const d=[];for(const[t,s]of a.headers.entries())"content-encoding"!==t&&"content-length"!==t&&("set-cookie"!==t?e.node.res.setHeader(t,s):d.push(...splitCookiesString(s)));d.length>0&&e.node.res.setHeader("set-cookie",d.map(e=>(s.cookieDomainRewrite&&(e=rewriteCookieProperty(e,s.cookieDomainRewrite,"domain")),s.cookiePathRewrite&&(e=rewriteCookieProperty(e,s.cookiePathRewrite,"path")),e)));s.onResponse&&await s.onResponse(e,a);if(void 0!==a._data)return a._data;if(e.handled)return;if(!1===s.sendStream){const t=new Uint8Array(await a.arrayBuffer());return e.node.res.end(t)}if(a.body)for await(const t of a.body)e.node.res.write(t);return e.node.res.end()}(e,t,{...s,fetchOptions:{method:l,body:a,duplex:d,...s.fetchOptions,headers:c}})}function getProxyRequestHeaders(e,t){const s=Object.create(null),a=getRequestHeaders(e);for(const e in a)(!at.has(e)||"host"===e&&t?.host)&&(s[e]=a[e]);return s}function fetchWithEvent(e,t,s,a){return _getFetch(a?.fetch)(t,{...s,context:s?.context||e.context,headers:{...getProxyRequestHeaders(e,{host:"string"==typeof t&&t.startsWith("/")}),...s?.headers}})}function _getFetch(e){if(e)return e;if(globalThis.fetch)return globalThis.fetch;throw new Error("fetch is not available. Try importing `node-fetch-native/polyfill` for Node.js.")}function rewriteCookieProperty(e,t,s){const a="string"==typeof t?{"*":t}:t;return e.replace(new RegExp(`(;\\s*${s}=)([^;]+)`,"gi"),(e,t,s)=>{let d;if(s in a)d=a[s];else{if(!("*"in a))return e;d=a["*"]}return d?t+d:""})}function defineWebSocketHandler(e){return defineEventHandler({handler(){throw createError$1({statusCode:426,statusMessage:"Upgrade Required"})},websocket:e})}class H3Event{__is_event__=!0;node;web;context={};_method;_path;_headers;_requestBody;_handled=!1;_onBeforeResponseCalled;_onAfterResponseCalled;constructor(e,t){this.node={req:e,res:t}}get method(){return this._method||(this._method=(this.node.req.method||"GET").toUpperCase()),this._method}get path(){return this._path||this.node.req.url||"/"}get headers(){return this._headers||(this._headers=function(e){const t=new Headers;for(const[s,a]of Object.entries(e))if(Array.isArray(a))for(const e of a)t.append(s,e);else a&&t.set(s,a);return t}(this.node.req.headers)),this._headers}get handled(){return this._handled||this.node.res.writableEnded||this.node.res.headersSent}respondWith(e){return Promise.resolve(e).then(e=>sendWebResponse(this,e))}toString(){return`[${this.method}] ${this.path}`}toJSON(){return this.toString()}get req(){return this.node.req}get res(){return this.node.res}}function isEvent(e){return hasProp(e,"__is_event__")}function createEvent(e,t){return new H3Event(e,t)}function defineEventHandler(e){if("function"==typeof e)return e.__is_handler__=!0,e;const t={onRequest:_normalizeArray(e.onRequest),onBeforeResponse:_normalizeArray(e.onBeforeResponse)},_handler=s=>async function(e,t,s){if(s.onRequest)for(const t of s.onRequest)if(await t(e),e.handled)return;const a=await t(e),d={body:a};if(s.onBeforeResponse)for(const t of s.onBeforeResponse)await t(e,d);return d.body}(s,e.handler,t);return _handler.__is_handler__=!0,_handler.__resolve__=e.handler.__resolve__,_handler.__websocket__=e.websocket,_handler}function _normalizeArray(e){return e?Array.isArray(e)?e:[e]:void 0}const it=defineEventHandler;function isEventHandler(e){return hasProp(e,"__is_handler__")}function toEventHandler(e,t,s){return isEventHandler(e)||console.warn("[h3] Implicit event handler conversion is deprecated. Use `eventHandler()` or `fromNodeMiddleware()` to define event handlers.",s&&"/"!==s?`\n     Route: ${s}`:"",`\n     Handler: ${e}`),e}const lazyEventHandler=function(e){let t,s;const resolveHandler=()=>s?Promise.resolve(s):(t||(t=Promise.resolve(e()).then(e=>{const t=e.default||e;if("function"!=typeof t)throw new TypeError("Invalid lazy handler result. It should be a function:",t);return s={handler:toEventHandler(e.default||e)},s})),t),a=it(e=>s?s.handler(e):resolveHandler().then(t=>t.handler(e)));return a.__resolve__=resolveHandler,a};function createApp(e={}){const t=[],s=function(e,t){const s=t.debug?2:void 0;return it(async a=>{a.node.req.originalUrl=a.node.req.originalUrl||a.node.req.url||"/";const d=a._path||a.node.req.url||"/";let l;t.onRequest&&await t.onRequest(a);for(const c of e){if(c.route.length>1){if(!d.startsWith(c.route))continue;l=d.slice(c.route.length)||"/"}else l=d;if(c.match&&!c.match(l,a))continue;a._path=l,a.node.req.url=l;const e=await c.handler(a),u=void 0===e?void 0:await e;if(void 0!==u){const e={body:u};return t.onBeforeResponse&&(a._onBeforeResponseCalled=!0,await t.onBeforeResponse(a,e)),await handleHandlerResponse(a,e.body,s),void(t.onAfterResponse&&(a._onAfterResponseCalled=!0,await t.onAfterResponse(a,e)))}if(a.handled)return void(t.onAfterResponse&&(a._onAfterResponseCalled=!0,await t.onAfterResponse(a,void 0)))}if(!a.handled)throw createError$1({statusCode:404,statusMessage:`Cannot find any path matching ${a.path||"/"}.`});t.onAfterResponse&&(a._onAfterResponseCalled=!0,await t.onAfterResponse(a,void 0))})}(t,e),a=function(e){return async t=>{let s;for(const a of e){if("/"===a.route&&!a.handler.__resolve__)continue;if(!t.startsWith(a.route))continue;if(s=t.slice(a.route.length)||"/",a.match&&!a.match(s,void 0))continue;let e={route:a.route,handler:a.handler};if(e.handler.__resolve__){const t=await e.handler.__resolve__(s);if(!t)continue;e={...e,...t,route:joinURL(e.route||"/",t.route||"/")}}return e}}}(t);s.__resolve__=a;const d=function(e){let t;return()=>(t||(t=e()),t)}(()=>{return t=a,{...e.websocket,async resolve(e){const s=e.request?.url||e.url||"/",{pathname:a}="string"==typeof s?parseURL(s):s,d=await t(a);return d?.handler?.__websocket__||{}}};var t}),l={use:(e,t,s)=>use(l,e,t,s),resolve:a,handler:s,stack:t,options:e,get websocket(){return d()}};return l}function use(e,t,s,a){if(Array.isArray(t))for(const d of t)use(e,d,s,a);else if(Array.isArray(s))for(const d of s)use(e,t,d,a);else"string"==typeof t?e.stack.push(normalizeLayer({...a,route:t,handler:s})):"function"==typeof t?e.stack.push(normalizeLayer({...s,handler:t})):e.stack.push(normalizeLayer({...t}));return e}function normalizeLayer(e){let t=e.handler;return t.handler&&(t=t.handler),e.lazy?t=lazyEventHandler(t):isEventHandler(t)||(t=toEventHandler(t,0,e.route)),{route:withoutTrailingSlash(e.route),match:e.match,handler:t}}function handleHandlerResponse(e,t,s){if(null===t)return function(e,t){if(e.handled)return;t||200===e.node.res.statusCode||(t=e.node.res.statusCode);const s=sanitizeStatusCode(t,204);204===s&&e.node.res.removeHeader("content-length"),e.node.res.writeHead(s),e.node.res.end()}(e);if(t){if(a=t,"undefined"!=typeof Response&&a instanceof Response)return sendWebResponse(e,t);if(function(e){if(!e||"object"!=typeof e)return!1;if("function"==typeof e.pipe){if("function"==typeof e._read)return!0;if("function"==typeof e.abort)return!0}return"function"==typeof e.pipeTo}(t))return sendStream(e,t);if(t.buffer)return send(e,t);if(t.arrayBuffer&&"function"==typeof t.arrayBuffer)return t.arrayBuffer().then(s=>send(e,Buffer.from(s),t.type));if(t instanceof Error)throw createError$1(t);if("function"==typeof t.end)return!0}var a;const d=typeof t;if("string"===d)return send(e,t,et.html);if("object"===d||"boolean"===d||"number"===d)return send(e,JSON.stringify(t,void 0,s),et.json);if("bigint"===d)return send(e,t.toString(),et.json);throw createError$1({statusCode:500,statusMessage:`[h3] Cannot send ${d} as response.`})}const dt=["connect","delete","get","head","options","post","put","trace","patch"];function toNodeListener(e){return async function(t,s){const a=createEvent(t,s);try{await e.handler(a)}catch(t){const s=createError$1(t);if(isError(t)||(s.unhandled=!0),setResponseStatus(a,s.statusCode,s.statusMessage),e.options.onError&&await e.options.onError(s,a),a.handled)return;(s.unhandled||s.fatal)&&console.error("[h3]",s.fatal?"[fatal]":"[unhandled]",s),e.options.onBeforeResponse&&!a._onBeforeResponseCalled&&await e.options.onBeforeResponse(a,{body:s}),await function(e,t,s){if(e.handled)return;const a=isError(t)?t:createError$1(t),d={statusCode:a.statusCode,statusMessage:a.statusMessage,stack:[],data:a.data};if(s&&(d.stack=(a.stack||"").split("\n").map(e=>e.trim())),e.handled)return;setResponseStatus(e,Number.parseInt(a.statusCode),a.statusMessage),e.node.res.setHeader("content-type",et.json),e.node.res.end(JSON.stringify(d,void 0,2))}(a,s,!!e.options.debug),e.options.onAfterResponse&&!a._onAfterResponseCalled&&await e.options.onAfterResponse(a,{body:s})}}}function flatHooks(e,t={},s){for(const a in e){const d=e[a],l=s?`${s}:${a}`:a;"object"==typeof d&&null!==d?flatHooks(d,t,l):"function"==typeof d&&(t[l]=d)}return t}const lt={run:e=>e()},ct=void 0!==console.createTask?console.createTask:()=>lt;function serialTaskCaller(e,t){const s=t.shift(),a=ct(s);return e.reduce((e,s)=>e.then(()=>a.run(()=>s(...t))),Promise.resolve())}function parallelTaskCaller(e,t){const s=t.shift(),a=ct(s);return Promise.all(e.map(e=>a.run(()=>e(...t))))}function callEachWith(e,t){for(const s of[...e])s(t)}class Hookable{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(e,t,s={}){if(!e||"function"!=typeof t)return()=>{};const a=e;let d;for(;this._deprecatedHooks[e];)d=this._deprecatedHooks[e],e=d.to;if(d&&!s.allowDeprecated){let e=d.message;e||(e=`${a} hook has been deprecated`+(d.to?`, please use ${d.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(e)||(console.warn(e),this._deprecatedMessages.add(e))}if(!t.name)try{Object.defineProperty(t,"name",{get:()=>"_"+e.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[e]=this._hooks[e]||[],this._hooks[e].push(t),()=>{t&&(this.removeHook(e,t),t=void 0)}}hookOnce(e,t){let s,_function=(...e)=>("function"==typeof s&&s(),s=void 0,_function=void 0,t(...e));return s=this.hook(e,_function),s}removeHook(e,t){if(this._hooks[e]){const s=this._hooks[e].indexOf(t);-1!==s&&this._hooks[e].splice(s,1),0===this._hooks[e].length&&delete this._hooks[e]}}deprecateHook(e,t){this._deprecatedHooks[e]="string"==typeof t?{to:t}:t;const s=this._hooks[e]||[];delete this._hooks[e];for(const t of s)this.hook(e,t)}deprecateHooks(e){Object.assign(this._deprecatedHooks,e);for(const t in e)this.deprecateHook(t,e[t])}addHooks(e){const t=flatHooks(e),s=Object.keys(t).map(e=>this.hook(e,t[e]));return()=>{for(const e of s.splice(0,s.length))e()}}removeHooks(e){const t=flatHooks(e);for(const e in t)this.removeHook(e,t[e])}removeAllHooks(){for(const e in this._hooks)delete this._hooks[e]}callHook(e,...t){return t.unshift(e),this.callHookWith(serialTaskCaller,e,...t)}callHookParallel(e,...t){return t.unshift(e),this.callHookWith(parallelTaskCaller,e,...t)}callHookWith(e,t,...s){const a=this._before||this._after?{name:t,args:s,context:{}}:void 0;this._before&&callEachWith(this._before,a);const d=e(t in this._hooks?[...this._hooks[t]]:[],s);return d instanceof Promise?d.finally(()=>{this._after&&a&&callEachWith(this._after,a)}):(this._after&&a&&callEachWith(this._after,a),d)}beforeEach(e){return this._before=this._before||[],this._before.push(e),()=>{if(void 0!==this._before){const t=this._before.indexOf(e);-1!==t&&this._before.splice(t,1)}}}afterEach(e){return this._after=this._after||[],this._after.push(e),()=>{if(void 0!==this._after){const t=this._after.indexOf(e);-1!==t&&this._after.splice(t,1)}}}}function createHooks(){return new Hookable}const ut=globalThis.Headers,ht=globalThis.AbortController,pt=globalThis.fetch||(()=>{throw new Error("[node-fetch-native] Failed to fetch: `globalThis.fetch` is not available!")});class FetchError extends Error{constructor(e,t){super(e,t),this.name="FetchError",t?.cause&&!this.cause&&(this.cause=t.cause)}}const mt=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function isPayloadMethod(e="GET"){return mt.has(e.toUpperCase())}const ft=new Set(["image/svg","application/xml","application/xhtml","application/html"]),yt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function resolveFetchOptions(e,t,s,a){const d=function(e,t,s){if(!t)return new s(e);const a=new s(t);if(e)for(const[t,d]of Symbol.iterator in e||Array.isArray(e)?e:new s(e))a.set(t,d);return a}(t?.headers??e?.headers,s?.headers,a);let l;return(s?.query||s?.params||t?.params||t?.query)&&(l={...s?.params,...s?.query,...t?.params,...t?.query}),{...s,...t,query:l,params:l,headers:d}}async function callHooks(e,t){if(t)if(Array.isArray(t))for(const s of t)await s(e);else await t(e)}const gt=new Set([408,409,425,429,500,502,503,504]),_t=new Set([101,204,205,304]);function createFetch(e={}){const{fetch:t=globalThis.fetch,Headers:s=globalThis.Headers,AbortController:a=globalThis.AbortController}=e;async function onError(e){const t=e.error&&"AbortError"===e.error.name&&!e.options.timeout||!1;if(!1!==e.options.retry&&!t){let t;t="number"==typeof e.options.retry?e.options.retry:isPayloadMethod(e.options.method)?0:1;const s=e.response&&e.response.status||500;if(t>0&&(Array.isArray(e.options.retryStatusCodes)?e.options.retryStatusCodes.includes(s):gt.has(s))){const s="function"==typeof e.options.retryDelay?e.options.retryDelay(e):e.options.retryDelay||0;return s>0&&await new Promise(e=>setTimeout(e,s)),$fetchRaw(e.request,{...e.options,retry:t-1})}}const s=function(e){const t=e.error?.message||e.error?.toString()||"",s=e.request?.method||e.options?.method||"GET",a=e.request?.url||String(e.request)||"/",d=`[${s}] ${JSON.stringify(a)}`,l=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",c=new FetchError(`${d}: ${l}${t?` ${t}`:""}`,e.error?{cause:e.error}:void 0);for(const t of["request","options","response"])Object.defineProperty(c,t,{get:()=>e[t]});for(const[t,s]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(c,t,{get:()=>e.response&&e.response[s]});return c}(e);throw Error.captureStackTrace&&Error.captureStackTrace(s,$fetchRaw),s}const $fetchRaw=async function(d,l={}){const c={request:d,options:resolveFetchOptions(d,l,e.defaults,s),response:void 0,error:void 0};if(c.options.method&&(c.options.method=c.options.method.toUpperCase()),c.options.onRequest&&(await callHooks(c,c.options.onRequest),c.options.headers instanceof s||(c.options.headers=new s(c.options.headers||{}))),"string"==typeof c.request&&(c.options.baseURL&&(c.request=function(e,t){if(isEmptyURL(t)||hasProtocol(e))return e;const s=withoutTrailingSlash(t);if(e.startsWith(s)){const t=e[s.length];if(!t||"/"===t||"?"===t)return e}return joinURL(s,e)}(c.request,c.options.baseURL)),c.options.query&&(c.request=withQuery(c.request,c.options.query),delete c.options.query),"query"in c.options&&delete c.options.query,"params"in c.options&&delete c.options.params),c.options.body&&isPayloadMethod(c.options.method))if(function(e){if(void 0===e)return!1;const t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&!(e instanceof FormData||e instanceof URLSearchParams)&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}(c.options.body)){const e=c.options.headers.get("content-type");"string"!=typeof c.options.body&&(c.options.body="application/x-www-form-urlencoded"===e?new URLSearchParams(c.options.body).toString():JSON.stringify(c.options.body)),e||c.options.headers.set("content-type","application/json"),c.options.headers.has("accept")||c.options.headers.set("accept","application/json")}else("pipeTo"in c.options.body&&"function"==typeof c.options.body.pipeTo||"function"==typeof c.options.body.pipe)&&("duplex"in c.options||(c.options.duplex="half"));let u;if(!c.options.signal&&c.options.timeout){const e=new a;u=setTimeout(()=>{const t=new Error("[TimeoutError]: The operation was aborted due to timeout");t.name="TimeoutError",t.code=23,e.abort(t)},c.options.timeout),c.options.signal=e.signal}try{c.response=await t(c.request,c.options)}catch(e){return c.error=e,c.options.onRequestError&&await callHooks(c,c.options.onRequestError),await onError(c)}finally{u&&clearTimeout(u)}if((c.response.body||c.response._bodyInit)&&!_t.has(c.response.status)&&"HEAD"!==c.options.method){const e=(c.options.parseResponse?"json":c.options.responseType)||function(e=""){if(!e)return"json";const t=e.split(";").shift()||"";return yt.test(t)?"json":"text/event-stream"===t?"stream":ft.has(t)||t.startsWith("text/")?"text":"blob"}(c.response.headers.get("content-type")||"");switch(e){case"json":{const e=await c.response.text(),t=c.options.parseResponse||destr;c.response._data=t(e);break}case"stream":c.response._data=c.response.body||c.response._bodyInit;break;default:c.response._data=await c.response[e]()}}return c.options.onResponse&&await callHooks(c,c.options.onResponse),!c.options.ignoreResponseError&&c.response.status>=400&&c.response.status<600?(c.options.onResponseError&&await callHooks(c,c.options.onResponseError),await onError(c)):c.response},$fetch=async function(e,t){return(await $fetchRaw(e,t))._data};return $fetch.raw=$fetchRaw,$fetch.native=(...e)=>t(...e),$fetch.create=(t={},s={})=>createFetch({...e,...s,defaults:{...e.defaults,...s.defaults,...t}}),$fetch}const bt=globalThis.fetch?(...e)=>globalThis.fetch(...e):function(){if(!JSON.parse(e.env.FETCH_KEEP_ALIVE||"false"))return pt;const s={keepAlive:!0},d=new t.Agent(s),l=new a.Agent(s),c={agent:e=>"http:"===e.protocol?d:l};return function(e,t){return pt(e,{...c,...t})}}(),wt=globalThis.Headers||ut,vt=globalThis.AbortController||ht,xt=createFetch({fetch:bt,Headers:wt,AbortController:vt});function asyncCall(e,...t){try{return(s=e(...t))&&"function"==typeof s.then?s:Promise.resolve(s)}catch(e){return Promise.reject(e)}var s}function stringify(e){if(function(e){const t=typeof e;return null===e||"object"!==t&&"function"!==t}(e))return String(e);if(function(e){const t=Object.getPrototypeOf(e);return!t||t.isPrototypeOf(Object)}(e)||Array.isArray(e))return JSON.stringify(e);if("function"==typeof e.toJSON)return stringify(e.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const jt="base64:";function serializeRaw(e){return"string"==typeof e?e:jt+function(e){if(globalThis.Buffer)return Buffer.from(e).toString("base64");return globalThis.btoa(String.fromCodePoint(...e))}(e)}function deserializeRaw(e){return"string"!=typeof e?e:e.startsWith(jt)?function(e){if(globalThis.Buffer)return Buffer.from(e,"base64");return Uint8Array.from(globalThis.atob(e),e=>e.codePointAt(0))}(e.slice(7)):e}const St=["has","hasItem","get","getItem","getItemRaw","set","setItem","setItemRaw","del","remove","removeItem","getMeta","setMeta","removeMeta","getKeys","clear","mount","unmount"];function normalizeKey$1(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function joinKeys(...e){return normalizeKey$1(e.join(":"))}function normalizeBaseKey(e){return(e=normalizeKey$1(e))?e+":":""}const memory=()=>{const e=new Map;return{name:"memory",getInstance:()=>e,hasItem:t=>e.has(t),getItem:t=>e.get(t)??null,getItemRaw:t=>e.get(t)??null,setItem(t,s){e.set(t,s)},setItemRaw(t,s){e.set(t,s)},removeItem(t){e.delete(t)},getKeys:()=>[...e.keys()],clear(){e.clear()},dispose(){e.clear()}}};function watch(e,t,s){return e.watch?e.watch((e,a)=>t(e,s+a)):()=>{}}async function dispose(e){"function"==typeof e.dispose&&await asyncCall(e.dispose)}const kt={},normalizeKey=function(e){return e&&e.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""},Et={getKeys:()=>Promise.resolve(Object.keys(kt)),hasItem:e=>(e=normalizeKey(e),Promise.resolve(e in kt)),getItem:e=>(e=normalizeKey(e),Promise.resolve(kt[e]?kt[e].import():null)),getMeta:e=>(e=normalizeKey(e),Promise.resolve(kt[e]?kt[e].meta:{}))};function createError(e,t,s){const a=new Error(`[unstorage] [${e}] ${t}`,s);return Error.captureStackTrace&&Error.captureStackTrace(a,createError),a}function ignoreNotfound(e){return"ENOENT"===e.code||"EISDIR"===e.code?null:e}function ignoreExists(e){return"EEXIST"===e.code?null:e}async function writeFile(e,t,s){return await ensuredir(O(e)),R.writeFile(e,t,s)}function readFile(e,t){return R.readFile(e,t).catch(ignoreNotfound)}function readdir(e){return R.readdir(e,{withFileTypes:!0}).catch(ignoreNotfound).then(e=>e||[])}async function ensuredir(e){T(e)||(await ensuredir(O(e)).catch(ignoreExists),await R.mkdir(e).catch(ignoreExists))}async function readdirRecursive(e,t,s){if(t&&t(e))return[];const a=await readdir(e),d=[];return await Promise.all(a.map(async a=>{const l=z(e,a.name);if(a.isDirectory()){if(void 0===s||s>0){const e=await readdirRecursive(l,t,void 0===s?void 0:s-1);d.push(...e.map(e=>a.name+"/"+e))}}else t&&t(a.name)||d.push(a.name)})),d}async function rmRecursive(e){const t=await readdir(e);await Promise.all(t.map(t=>{const s=z(e,t.name);return t.isDirectory()?rmRecursive(s).then(()=>R.rmdir(s)):R.unlink(s)}))}const Ct=/\.\.:|\.\.$/,Rt="fs-lite",unstorage_47drivers_47fs_45lite=(e={})=>{if(!e.base)throw t=Rt,s="base",Array.isArray(s)?createError(t,`Missing some of the required options ${s.map(e=>"`"+e+"`").join(", ")}`):createError(t,`Missing required option \`${s}\`.`);var t,s;e.base=z(e.base);const r=t=>{if(Ct.test(t))throw createError(Rt,`Invalid key: ${JSON.stringify(t)}. It should not contain .. segments`);return P(e.base,t.replace(/:/g,"/"))};return{name:Rt,options:e,flags:{maxDepth:!0},hasItem:e=>T(r(e)),getItem:e=>readFile(r(e),"utf8"),getItemRaw:e=>readFile(r(e)),async getMeta(e){const{atime:t,mtime:s,size:a,birthtime:d,ctime:l}=await R.stat(r(e)).catch(()=>({}));return{atime:t,mtime:s,size:a,birthtime:d,ctime:l}},setItem(t,s){if(!e.readOnly)return writeFile(r(t),s,"utf8")},setItemRaw(t,s){if(!e.readOnly)return writeFile(r(t),s)},removeItem(t){if(!e.readOnly)return function(e){return R.unlink(e).catch(ignoreNotfound)}(r(t))},getKeys:(t,s)=>readdirRecursive(r("."),e.ignore,s?.maxDepth),async clear(){e.readOnly||e.noClear||await rmRecursive(r("."))}}},Tt=function(e={}){const t={mounts:{"":e.driver||memory()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},getMount=e=>{for(const s of t.mountpoints)if(e.startsWith(s))return{base:s,relativeKey:e.slice(s.length),driver:t.mounts[s]};return{base:"",relativeKey:e,driver:t.mounts[""]}},getMounts=(e,s)=>t.mountpoints.filter(t=>t.startsWith(e)||s&&e.startsWith(t)).map(s=>({relativeBase:e.length>s.length?e.slice(s.length):void 0,mountpoint:s,driver:t.mounts[s]})),onChange=(e,s)=>{if(t.watching){s=normalizeKey$1(s);for(const a of t.watchListeners)a(e,s)}},stopWatch=async()=>{if(t.watching){for(const e in t.unwatch)await t.unwatch[e]();t.unwatch={},t.watching=!1}},runBatch=(e,t,s)=>{const a=new Map,getBatch=e=>{let t=a.get(e.base);return t||(t={driver:e.driver,base:e.base,items:[]},a.set(e.base,t)),t};for(const s of e){const e="string"==typeof s,a=normalizeKey$1(e?s:s.key),d=e?void 0:s.value,l=e||!s.options?t:{...t,...s.options},c=getMount(a);getBatch(c).items.push({key:a,value:d,relativeKey:c.relativeKey,options:l})}return Promise.all([...a.values()].map(e=>s(e))).then(e=>e.flat())},s={hasItem(e,t={}){e=normalizeKey$1(e);const{relativeKey:s,driver:a}=getMount(e);return asyncCall(a.hasItem,s,t)},getItem(e,t={}){e=normalizeKey$1(e);const{relativeKey:s,driver:a}=getMount(e);return asyncCall(a.getItem,s,t).then(e=>destr(e))},getItems:(e,t={})=>runBatch(e,t,e=>e.driver.getItems?asyncCall(e.driver.getItems,e.items.map(e=>({key:e.relativeKey,options:e.options})),t).then(t=>t.map(t=>({key:joinKeys(e.base,t.key),value:destr(t.value)}))):Promise.all(e.items.map(t=>asyncCall(e.driver.getItem,t.relativeKey,t.options).then(e=>({key:t.key,value:destr(e)}))))),getItemRaw(e,t={}){e=normalizeKey$1(e);const{relativeKey:s,driver:a}=getMount(e);return a.getItemRaw?asyncCall(a.getItemRaw,s,t):asyncCall(a.getItem,s,t).then(e=>deserializeRaw(e))},async setItem(e,t,a={}){if(void 0===t)return s.removeItem(e);e=normalizeKey$1(e);const{relativeKey:d,driver:l}=getMount(e);l.setItem&&(await asyncCall(l.setItem,d,stringify(t),a),l.watch||onChange("update",e))},async setItems(e,t){await runBatch(e,t,async e=>{if(e.driver.setItems)return asyncCall(e.driver.setItems,e.items.map(e=>({key:e.relativeKey,value:stringify(e.value),options:e.options})),t);e.driver.setItem&&await Promise.all(e.items.map(t=>asyncCall(e.driver.setItem,t.relativeKey,stringify(t.value),t.options)))})},async setItemRaw(e,t,a={}){if(void 0===t)return s.removeItem(e,a);e=normalizeKey$1(e);const{relativeKey:d,driver:l}=getMount(e);if(l.setItemRaw)await asyncCall(l.setItemRaw,d,t,a);else{if(!l.setItem)return;await asyncCall(l.setItem,d,serializeRaw(t),a)}l.watch||onChange("update",e)},async removeItem(e,t={}){"boolean"==typeof t&&(t={removeMeta:t}),e=normalizeKey$1(e);const{relativeKey:s,driver:a}=getMount(e);a.removeItem&&(await asyncCall(a.removeItem,s,t),(t.removeMeta||t.removeMata)&&await asyncCall(a.removeItem,s+"$",t),a.watch||onChange("remove",e))},async getMeta(e,t={}){"boolean"==typeof t&&(t={nativeOnly:t}),e=normalizeKey$1(e);const{relativeKey:s,driver:a}=getMount(e),d=Object.create(null);if(a.getMeta&&Object.assign(d,await asyncCall(a.getMeta,s,t)),!t.nativeOnly){const e=await asyncCall(a.getItem,s+"$",t).then(e=>destr(e));e&&"object"==typeof e&&("string"==typeof e.atime&&(e.atime=new Date(e.atime)),"string"==typeof e.mtime&&(e.mtime=new Date(e.mtime)),Object.assign(d,e))}return d},setMeta(e,t,s={}){return this.setItem(e+"$",t,s)},removeMeta(e,t={}){return this.removeItem(e+"$",t)},async getKeys(e,t={}){e=normalizeBaseKey(e);const s=getMounts(e,!0);let a=[];const d=[];let l=!0;for(const e of s){e.driver.flags?.maxDepth||(l=!1);const s=await asyncCall(e.driver.getKeys,e.relativeBase,t);for(const t of s){const s=e.mountpoint+normalizeKey$1(t);a.some(e=>s.startsWith(e))||d.push(s)}a=[e.mountpoint,...a.filter(t=>!t.startsWith(e.mountpoint))]}const c=void 0!==t.maxDepth&&!l;return d.filter(s=>(!c||function(e,t){if(void 0===t)return!0;let s=0,a=e.indexOf(":");for(;a>-1;)s++,a=e.indexOf(":",a+1);return s<=t}(s,t.maxDepth))&&function(e,t){return t?e.startsWith(t)&&"$"!==e[e.length-1]:"$"!==e[e.length-1]}(s,e))},async clear(e,t={}){e=normalizeBaseKey(e),await Promise.all(getMounts(e,!1).map(async e=>{if(e.driver.clear)return asyncCall(e.driver.clear,e.relativeBase,t);if(e.driver.removeItem){const s=await e.driver.getKeys(e.relativeBase||"",t);return Promise.all(s.map(s=>e.driver.removeItem(s,t)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(e=>dispose(e)))},watch:async e=>(await(async()=>{if(!t.watching){t.watching=!0;for(const e in t.mounts)t.unwatch[e]=await watch(t.mounts[e],onChange,e)}})(),t.watchListeners.push(e),async()=>{t.watchListeners=t.watchListeners.filter(t=>t!==e),0===t.watchListeners.length&&await stopWatch()}),async unwatch(){t.watchListeners=[],await stopWatch()},mount(e,a){if((e=normalizeBaseKey(e))&&t.mounts[e])throw new Error(`already mounted at ${e}`);return e&&(t.mountpoints.push(e),t.mountpoints.sort((e,t)=>t.length-e.length)),t.mounts[e]=a,t.watching&&Promise.resolve(watch(a,onChange,e)).then(s=>{t.unwatch[e]=s}).catch(console.error),s},async unmount(e,s=!0){(e=normalizeBaseKey(e))&&t.mounts[e]&&(t.watching&&e in t.unwatch&&(t.unwatch[e]?.(),delete t.unwatch[e]),s&&await dispose(t.mounts[e]),t.mountpoints=t.mountpoints.filter(t=>t!==e),delete t.mounts[e])},getMount(e=""){e=normalizeKey$1(e)+":";const t=getMount(e);return{driver:t.driver,base:t.base}},getMounts(e="",t={}){e=normalizeKey$1(e);return getMounts(e,t.parents).map(e=>({driver:e.driver,base:e.mountpoint}))},keys:(e,t={})=>s.getKeys(e,t),get:(e,t={})=>s.getItem(e,t),set:(e,t,a={})=>s.setItem(e,t,a),has:(e,t={})=>s.hasItem(e,t),del:(e,t={})=>s.removeItem(e,t),remove:(e,t={})=>s.removeItem(e,t)};return s}({});function useStorage(e=""){return e?function(e,t){if(!(t=normalizeBaseKey(t)))return e;const s={...e};for(const a of St)s[a]=(s="",...d)=>e[a](t+s,...d);return s.getKeys=(s="",...a)=>e.getKeys(t+s,...a).then(e=>e.map(e=>e.slice(t.length))),s.keys=s.getKeys,s.getItems=async(s,a)=>{const d=s.map(e=>"string"==typeof e?t+e:{...e,key:t+e.key});return(await e.getItems(d,a)).map(e=>({key:e.key.slice(t.length),value:e.value}))},s.setItems=async(s,a)=>{const d=s.map(e=>({key:t+e.key,value:e.value,options:e.options}));return e.setItems(d,a)},s}(Tt,e):Tt}Tt.mount("/assets",Et),Tt.mount("data",unstorage_47drivers_47fs_45lite({driver:"fsLite",base:"./.data/kv"}));const zt=globalThis.process?.getBuiltinModule?.("crypto")?.hash,Ot="sha256",At="base64url";const Pt=(()=>{class Hasher2{buff="";#i=new Map;write(e){this.buff+=e}dispatch(e){return this[null===e?"null":typeof e](e)}object(e){if(e&&"function"==typeof e.toJSON)return this.object(e.toJSON());const t=Object.prototype.toString.call(e);let s="";const a=t.length;s=a<10?"unknown:["+t+"]":t.slice(8,a-1),s=s.toLowerCase();let d=null;if(void 0!==(d=this.#i.get(e)))return this.dispatch("[CIRCULAR:"+d+"]");if(this.#i.set(e,this.#i.size),"undefined"!=typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e))return this.write("buffer:"),this.write(e.toString("utf8"));if("object"!==s&&"function"!==s&&"asyncfunction"!==s)this[s]?this[s](e):this.unknown(e,s);else{const t=Object.keys(e).sort(),s=[];this.write("object:"+(t.length+s.length)+":");const dispatchForKey=t=>{this.dispatch(t),this.write(":"),this.dispatch(e[t]),this.write(",")};for(const e of t)dispatchForKey(e);for(const e of s)dispatchForKey(e)}}array(e,t){if(t=void 0!==t&&t,this.write("array:"+e.length+":"),!t||e.length<=1){for(const t of e)this.dispatch(t);return}const s=new Map,a=e.map(e=>{const t=new Hasher2;t.dispatch(e);for(const[e,a]of t.#i)s.set(e,a);return t.toString()});return this.#i=s,a.sort(),this.array(a,!1)}date(e){return this.write("date:"+e.toJSON())}symbol(e){return this.write("symbol:"+e.toString())}unknown(e,t){if(this.write(t),e)return this.write(":"),e&&"function"==typeof e.entries?this.array([...e.entries()],!0):void 0}error(e){return this.write("error:"+e.toString())}boolean(e){return this.write("bool:"+e)}string(e){this.write("string:"+e.length+":"),this.write(e)}function(e){this.write("fn:"),!function(e){if("function"!=typeof e)return!1;return"[native code] }"===Function.prototype.toString.call(e).slice(-15)}(e)?this.dispatch(e.toString()):this.dispatch("[native]")}number(e){return this.write("number:"+e)}null(){return this.write("Null")}undefined(){return this.write("Undefined")}regexp(e){return this.write("regex:"+e.toString())}arraybuffer(e){return this.write("arraybuffer:"),this.dispatch(new Uint8Array(e))}url(e){return this.write("url:"+e.toString())}map(e){this.write("map:");const t=[...e];return this.array(t,!1)}set(e){this.write("set:");const t=[...e];return this.array(t,!1)}bigint(e){return this.write("bigint:"+e.toString())}}for(const e of["uint8array","uint8clampedarray","unt8array","uint16array","unt16array","uint32array","unt32array","float32array","float64array"])Hasher2.prototype[e]=function(t){return this.write(e+":"),this.array([...t],!1)};return Hasher2})();function hash(e){return function(e){if(zt)return zt(Ot,e,At);const t=c(Ot).update(e);return globalThis.process?.versions?.webcontainer?t.digest().toString(At):t.digest(At)}("string"==typeof e?e:function(e){const t=new Pt;return t.dispatch(e),t.buff}(e)).replace(/[-_]/g,"").slice(0,10)}function defineCachedFunction(e,t={}){t={name:"_",base:"/cache",swr:!0,maxAge:1,...t};const s={},a=t.group||"nitro/functions",d=t.name||e.name||"_",l=t.integrity||hash([e,t]),c=t.validate||(e=>void 0!==e.value);return async(...u)=>{if(await(t.shouldBypassCache?.(...u)))return e(...u);const h=await(t.getKey||getKey)(...u),m=await(t.shouldInvalidateCache?.(...u)),f=await async function(e,u,h,m){const f=[t.base,a,d,e+".json"].filter(Boolean).join(":").replace(/:\/$/,":index");let g=await useStorage().getItem(f).catch(e=>{console.error("[cache] Cache read error.",e),useNitroApp().captureError(e,{event:m,tags:["cache"]})})||{};if("object"!=typeof g){g={};const e=new Error("Malformed data read from cache.");console.error("[cache]",e),useNitroApp().captureError(e,{event:m,tags:["cache"]})}const _=1e3*(t.maxAge??0);_&&(g.expires=Date.now()+_);const x=h||g.integrity!==l||_&&Date.now()-(g.mtime||0)>_||!1===c(g),j=x?(async()=>{const a=s[e];a||(void 0!==g.value&&(t.staleMaxAge||0)>=0&&!1===t.swr&&(g.value=void 0,g.integrity=void 0,g.mtime=void 0,g.expires=void 0),s[e]=Promise.resolve(u()));try{g.value=await s[e]}catch(t){throw a||delete s[e],t}if(!a&&(g.mtime=Date.now(),g.integrity=l,delete s[e],!1!==c(g))){let e;t.maxAge&&!t.swr&&(e={ttl:t.maxAge});const s=useStorage().setItem(f,g,e).catch(e=>{console.error("[cache] Cache write error.",e),useNitroApp().captureError(e,{event:m,tags:["cache"]})});m?.waitUntil&&m.waitUntil(s)}})():Promise.resolve();return void 0===g.value?await j:x&&m&&m.waitUntil&&m.waitUntil(j),t.swr&&!1!==c(g)?(j.catch(e=>{console.error("[cache] SWR handler error.",e),useNitroApp().captureError(e,{event:m,tags:["cache"]})}),g):j.then(()=>g)}(h,()=>e(...u),m,u[0]&&isEvent(u[0])?u[0]:void 0);let g=f.value;return t.transform&&(g=await t.transform(f,...u)||g),g}}function getKey(...e){return e.length>0?hash(e):""}function escapeKey(e){return String(e).replace(/\W/g,"")}function cloneWithProxy(e,t){return new Proxy(e,{get:(e,s,a)=>s in t?t[s]:Reflect.get(e,s,a),set:(e,s,a,d)=>s in t?(t[s]=a,!0):Reflect.set(e,s,a,d)})}const cachedEventHandler=function(e,t={name:"_",base:"/cache",swr:!0,maxAge:1}){const s=(t.varies||[]).filter(Boolean).map(e=>e.toLowerCase()).sort(),a={...t,getKey:async e=>{const a=await(t.getKey?.(e));if(a)return escapeKey(a);const d=e.node.req.originalUrl||e.node.req.url||e.path;let l;try{l=escapeKey(decodeURI(parseURL(d).pathname)).slice(0,16)||"index"}catch{l="-"}return[`${l}.${hash(d)}`,...s.map(t=>[t,e.node.req.headers[t]]).map(([e,t])=>`${escapeKey(e)}.${hash(t)}`)].join(":")},validate:e=>!!e.value&&(!(e.value.code>=400)&&(void 0!==e.value.body&&("undefined"!==e.value.headers.etag&&"undefined"!==e.value.headers["last-modified"]))),group:t.group||"nitro/handlers",integrity:t.integrity||hash([e,t])},d=function(e,t={}){return defineCachedFunction(e,t)}(async d=>{const l={};for(const e of s){const t=d.node.req.headers[e];void 0!==t&&(l[e]=t)}const c=cloneWithProxy(d.node.req,{headers:l}),u={};let h;const m=createEvent(c,cloneWithProxy(d.node.res,{statusCode:200,writableEnded:!1,writableFinished:!1,headersSent:!1,closed:!1,getHeader:e=>u[e],setHeader(e,t){return u[e]=t,this},getHeaderNames:()=>Object.keys(u),hasHeader:e=>e in u,removeHeader(e){delete u[e]},getHeaders:()=>u,end(e,t,s){return"string"==typeof e&&(h=e),"function"==typeof t&&t(),"function"==typeof s&&s(),this},write:(e,t,s)=>("string"==typeof e&&(h=e),"function"==typeof t&&t(void 0),"function"==typeof s&&s(),!0),writeHead(e,t){if(this.statusCode=e,t){if(Array.isArray(t)||"string"==typeof t)throw new TypeError("Raw headers  is not supported.");for(const e in t){const s=t[e];void 0!==s&&this.setHeader(e,s)}}return this}}));m.fetch=(e,t)=>fetchWithEvent(m,e,t,{fetch:useNitroApp().localFetch}),m.$fetch=(e,t)=>fetchWithEvent(m,e,t,{fetch:globalThis.$fetch}),m.waitUntil=d.waitUntil,m.context=d.context,m.context.cache={options:a};const f=await e(m)||h,g=m.node.res.getHeaders();g.etag=String(g.Etag||g.etag||`W/"${hash(f)}"`),g["last-modified"]=String(g["Last-Modified"]||g["last-modified"]||(new Date).toUTCString());const _=[];t.swr?(t.maxAge&&_.push(`s-maxage=${t.maxAge}`),t.staleMaxAge?_.push(`stale-while-revalidate=${t.staleMaxAge}`):_.push("stale-while-revalidate")):t.maxAge&&_.push(`max-age=${t.maxAge}`),_.length>0&&(g["cache-control"]=_.join(", "));return{code:m.node.res.statusCode,headers:g,body:f}},a);return defineEventHandler(async s=>{if(t.headersOnly){if(handleCacheHeaders(s,{maxAge:t.maxAge}))return;return e(s)}const a=await d(s);if(s.node.res.headersSent||s.node.res.writableEnded)return a.body;if(!handleCacheHeaders(s,{modifiedTime:new Date(a.headers["last-modified"]),etag:a.headers.etag,maxAge:t.maxAge})){s.node.res.statusCode=a.code;for(const e in a.headers){const t=a.headers[e];"set-cookie"===e?s.node.res.appendHeader(e,splitCookiesString(t)):void 0!==t&&s.node.res.setHeader(e,t)}return a.body}})};function klona(e){if("object"!=typeof e)return e;var t,s,a=Object.prototype.toString.call(e);if("[object Object]"===a){if(e.constructor!==Object&&"function"==typeof e.constructor)for(t in s=new e.constructor,e)e.hasOwnProperty(t)&&s[t]!==e[t]&&(s[t]=klona(e[t]));else for(t in s={},e)"__proto__"===t?Object.defineProperty(s,t,{value:klona(e[t]),configurable:!0,enumerable:!0,writable:!0}):s[t]=klona(e[t]);return s}if("[object Array]"===a){for(t=e.length,s=Array(t);t--;)s[t]=klona(e[t]);return s}return"[object Set]"===a?(s=new Set,e.forEach(function(e){s.add(klona(e))}),s):"[object Map]"===a?(s=new Map,e.forEach(function(e,t){s.set(klona(t),klona(e))}),s):"[object Date]"===a?new Date(+e):"[object RegExp]"===a?((s=new RegExp(e.source,e.flags)).lastIndex=e.lastIndex,s):"[object DataView]"===a?new e.constructor(klona(e.buffer)):"[object ArrayBuffer]"===a?e.slice(0):"Array]"===a.slice(-6)?new e.constructor(e):e}const Nt=We({nuxt:{}}),Bt=/\d/,Ht=["-","_","/","."];function isUppercase(e=""){if(!Bt.test(e))return e!==e.toLowerCase()}function kebabCase(e,t){return e?(Array.isArray(e)?e:function(e){const t=Ht,s=[];if(!e||"string"!=typeof e)return s;let a,d,l="";for(const c of e){const e=t.includes(c);if(!0===e){s.push(l),l="",a=void 0;continue}const u=isUppercase(c);if(!1===d){if(!1===a&&!0===u){s.push(l),l=c,a=u;continue}if(!0===a&&!1===u&&l.length>1){const e=l.at(-1);s.push(l.slice(0,Math.max(0,l.length-1))),l=e+c,a=u;continue}}l+=c,a=u,d=e}return s.push(l),s}(e)).map(e=>e.toLowerCase()).join(t):""}function getEnv(t,s){const a=(d=t,kebabCase(d||"","_")).toUpperCase();var d;return destr(e.env[s.prefix+a]??e.env[s.altPrefix+a])}function _isObject(e){return"object"==typeof e&&!Array.isArray(e)}function applyEnv(e,t,s=""){for(const a in e){const d=s?`${s}_${a}`:a,l=getEnv(d,t);_isObject(e[a])?_isObject(l)?(e[a]={...e[a],...l},applyEnv(e[a],t,d)):void 0===l?applyEnv(e[a],t,d):e[a]=l??e[a]:e[a]=l??e[a],t.envExpansion&&"string"==typeof e[a]&&(e[a]=_expandFromEnv(e[a]))}return e}const It=/\{\{([^{}]*)\}\}/g;function _expandFromEnv(t){return t.replace(It,(t,s)=>e.env[s]||t)}const Lt={app:{baseURL:"/",buildId:"20d036bd-5a69-4f49-b1a5-7c63da88e8ad",buildAssetsDir:"/_nuxt/",cdnURL:""},nitro:{envPrefix:"NUXT_",routeRules:{"/__nuxt_error":{cache:!1},"/room3d":{ssr:!1},"/sw.js":{headers:{"Cache-Control":"no-cache, no-store, must-revalidate"}},"/_nuxt/builds/meta/**":{headers:{"cache-control":"public, max-age=31536000, immutable"}},"/_nuxt/builds/**":{headers:{"cache-control":"public, max-age=1, immutable"}},"/_nuxt/**":{headers:{"cache-control":"public, max-age=31536000, immutable"}}}},public:{wsUrl:"",onionRelayA:"",onionRelayB:"",onionTracker:"",inviteBaseUrl:"",inviteBaseUrlFallback:""},appPassword:"",questdbHost:"",questdbPort:"",mqttHost:"",mqttPort:""},Ut={prefix:"NITRO_",altPrefix:Lt.nitro.envPrefix??e.env.NITRO_ENV_PREFIX??"_",envExpansion:Lt.nitro.envExpansion??e.env.NITRO_ENV_EXPANSION??!1},Dt=_deepFreeze(applyEnv(klona(Lt),Ut));function useRuntimeConfig(e){if(!e)return Dt;if(e.context.nitro.runtimeConfig)return e.context.nitro.runtimeConfig;const t=klona(Lt);return applyEnv(t,Ut),e.context.nitro.runtimeConfig=t,t}function _deepFreeze(e){const t=Object.getOwnPropertyNames(e);for(const s of t){const t=e[s];t&&"object"==typeof t&&_deepFreeze(t)}return Object.freeze(e)}_deepFreeze(klona(Nt)),new Proxy(Object.create(null),{get:(e,t)=>{console.warn("Please use `useRuntimeConfig()` instead of accessing config directly.");const s=useRuntimeConfig();if(t in s)return s[t]}});const Mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{},qt="__unctx__",Wt=Mt[qt]||(Mt[qt]=function(e={}){const t={};return{get:(s,a={})=>(t[s]||(t[s]=function(e={}){let t,s=!1;const checkConflict=e=>{if(t&&t!==e)throw new Error("Context conflict")};let a;if(e.asyncContext){const t=e.AsyncLocalStorage||globalThis.AsyncLocalStorage;t?a=new t:console.warn("[unctx] `AsyncLocalStorage` is not provided.")}const _getCurrentInstance=()=>{if(a){const e=a.getStore();if(void 0!==e)return e}return t};return{use:()=>{const e=_getCurrentInstance();if(void 0===e)throw new Error("Context is not available");return e},tryUse:()=>_getCurrentInstance(),set:(e,a)=>{a||checkConflict(e),t=e,s=!0},unset:()=>{t=void 0,s=!1},call:(e,d)=>{checkConflict(e),t=e;try{return a?a.run(e,d):d()}finally{s||(t=void 0)}},async callAsync(e,d){t=e;const onRestore=()=>{t=e},onLeave=()=>t===e?onRestore:void 0;Ft.add(onLeave);try{const l=a?a.run(e,d):d();return s||(t=void 0),await l}finally{Ft.delete(onLeave)}}}}({...e,...a})),t[s])}}()),getContext=(e,t={})=>Wt.get(e,t),$t="__unctx_async_handlers__",Ft=Mt[$t]||(Mt[$t]=new Set);function executeAsync(e){const t=[];for(const e of Ft){const s=e();s&&t.push(s)}const restore=()=>{for(const e of t)e()};let s=e();return s&&"object"==typeof s&&"catch"in s&&(s=s.catch(e=>{throw restore(),e})),[s,restore]}getContext("nitro-app",{asyncContext:!1,AsyncLocalStorage:void 0});const Zt=toRouteMatcher(createRouter$1({routes:useRuntimeConfig().nitro.routeRules}));function createRouteRulesHandler(e){return it(t=>{const s=getRouteRules(t);if(s.headers&&st(t,s.headers),s.redirect){let e=s.redirect.to;if(e.endsWith("/**")){let a=t.path;const d=s.redirect._redirectStripBase;d&&(a=withoutBase(a,d)),e=joinURL(e.slice(0,-3),a)}else if(t.path.includes("?")){e=withQuery(e,getQuery$1(t.path))}return function(e,t,s=302){return e.node.res.statusCode=sanitizeStatusCode(s,e.node.res.statusCode),e.node.res.setHeader("location",t),send(e,`<!DOCTYPE html><html><head><meta http-equiv="refresh" content="0; url=${t.replace(/"/g,"%22")}"></head></html>`,et.html)}(t,e,s.redirect.statusCode)}if(s.proxy){let a=s.proxy.to;if(a.endsWith("/**")){let e=t.path;const d=s.proxy._proxyStripBase;d&&(e=withoutBase(e,d)),a=joinURL(a.slice(0,-3),e)}else if(t.path.includes("?")){a=withQuery(a,getQuery$1(t.path))}return proxyRequest(t,a,{fetch:e.localFetch,...s.proxy})}})}function getRouteRules(e){return e.context._nitro=e.context._nitro||{},e.context._nitro.routeRules||(e.context._nitro.routeRules=getRouteRulesForPath(withoutBase(e.path.split("?")[0],useRuntimeConfig().app.baseURL))),e.context._nitro.routeRules}function getRouteRulesForPath(e){return qe({},...Zt.matchAll(e).reverse())}function _captureError(e,t){console.error(`[${t}]`,e),useNitroApp().captureError(e,{tags:[t]})}function joinHeaders(e){return Array.isArray(e)?e.join(", "):String(e)}function normalizeCookieHeader(e=""){return splitCookiesString(joinHeaders(e))}function normalizeCookieHeaders(e){const t=new Headers;for(const[s,a]of e)if("set-cookie"===s)for(const e of normalizeCookieHeader(a))t.append("set-cookie",e);else t.set(s,joinHeaders(a));return t}function hasReqHeader(e,t,s){const a=getRequestHeader(e,t);return a&&"string"==typeof a&&a.toLowerCase().includes(s)}function defaultHandler(e,t,s){const a=e.unhandled||e.fatal,d=e.statusCode||500,l=e.statusMessage||"Server Error",c=getRequestURL(t,{xForwardedHost:!0,xForwardedProto:!0});if(404===d){const e="/";if(/^\/[^/]/.test(e)&&!c.pathname.startsWith(e)){return{status:302,statusText:"Found",headers:{location:`${e}${c.pathname.slice(1)}${c.search}`},body:"Redirecting..."}}}if(a&&!s?.silent){const s=[e.unhandled&&"[unhandled]",e.fatal&&"[fatal]"].filter(Boolean).join(" ");console.error(`[request error] ${s} [${t.method}] ${c}\n`,e)}const u={"content-type":"application/json","x-content-type-options":"nosniff","x-frame-options":"DENY","referrer-policy":"no-referrer","content-security-policy":"script-src 'none'; frame-ancestors 'none';"};setResponseStatus(t,d,l),404!==d&&getResponseHeader(t,"cache-control")||(u["cache-control"]="no-cache");return{status:d,statusText:l,headers:u,body:{error:!0,url:c.href,statusCode:d,statusMessage:l,message:a?"Server Error":e.message,data:a?void 0:e.data}}}const Kt=[async function(e,t,{defaultHandler:s}){if(t.handled||function(e){return!hasReqHeader(e,"accept","text/html")&&(hasReqHeader(e,"accept","application/json")||hasReqHeader(e,"user-agent","curl/")||hasReqHeader(e,"user-agent","httpie/")||hasReqHeader(e,"sec-fetch-mode","cors")||e.path.startsWith("/api/")||e.path.endsWith(".json"))}(t))return;const a=await s(e,t,{json:!0});if(404===(e.status||e.statusCode||500)&&302===a.status)return setResponseHeaders(t,a.headers),setResponseStatus(t,a.status,a.statusText),send(t,JSON.stringify(a.body,null,2));const d=a.body,l=new URL(d.url);d.url=withoutBase(l.pathname,useRuntimeConfig(t).app.baseURL)+l.search+l.hash,d.message||="Server Error",d.data||=e.data,d.statusText||=e.statusText||e.statusMessage,delete a.headers["content-type"],delete a.headers["content-security-policy"],setResponseHeaders(t,a.headers);const c=getRequestHeaders(t),u=t.path.startsWith("/__nuxt_error")||!!c["x-nuxt-error"]?null:await useNitroApp().localFetch(withQuery(joinURL(useRuntimeConfig(t).app.baseURL,"/__nuxt_error"),d),{headers:{...c,"x-nuxt-error":"true"},redirect:"manual"}).catch(()=>null);if(t.handled)return;if(!u){const{template:e}=await import("../_/error-500.mjs");return setResponseHeader(t,"Content-Type","text/html;charset=UTF-8"),send(t,e(d))}const h=await u.text();for(const[e,s]of u.headers.entries())"set-cookie"!==e?setResponseHeader(t,e,s):appendResponseHeader(t,e,s);return setResponseStatus(t,u.status&&200!==u.status?u.status:a.status,u.statusText||a.statusText),send(t,h)},function(e,t){const s=defaultHandler(e,t);return setResponseHeaders(t,s.headers),setResponseStatus(t,s.status,s.statusText),send(t,JSON.stringify(s.body,null,2))}];let Vt=null;function getProjectRoot(){if(Vt)return Vt;const t=e.cwd();if(N(H(t,"data","appdata")))return Vt=t,t;const s=H(t,"..");return N(H(s,"data","appdata"))?(Vt=s,s):(Vt=t,t)}const Gt=[{id:"2026-02-14-clean-savegame-deletions",description:"Remove all deleted:true overrides from savegame files (bug caused all objects to be marked deleted)",action:"clean-deleted-overrides"}],Qt=".data-migrations.json";async function cleanDeletedOverrides(e){const t=I(e,"savegame");let s;try{s=await M(t)}catch{return}for(const e of s){if(!e.endsWith(".json"))continue;const s=I(t,e);try{const t=JSON.parse(await L(s,"utf-8"));if(!t||!t.overrides||"object"!=typeof t.overrides)continue;let a=!1;for(const[e,s]of Object.entries(t.overrides))!0===(null==s?void 0:s.deleted)&&(delete t.overrides[e],a=!0);a&&(await D(s,JSON.stringify(t,null,2),"utf-8"),console.log(`[DataMigrations]   cleaned: ${e}`))}catch(t){console.warn(`[DataMigrations]   failed to clean: ${e}`,t)}}}async function purgeAll(e){let t;try{t=await M(e)}catch{return}for(const s of t){if(s===Qt)continue;const t=I(e,s);try{await q(t,{recursive:!0,force:!0}),console.log(`[DataMigrations]   deleted: ${s}`)}catch(e){console.warn(`[DataMigrations]   failed to delete: ${s}`,e)}}}async function purgePaths(e,t){const s=H(e);for(const a of t){if(!a||a.includes("..")||a.startsWith("/")||a.startsWith("\\")){console.warn(`[DataMigrations]   SKIPPED unsafe path: "${a}"`);continue}if(a===Qt||a.endsWith("/"+Qt)){console.warn("[DataMigrations]   SKIPPED migrations file");continue}const t=H(e,a);if(t.startsWith(s+"/")||t===s)try{await q(t,{recursive:!0,force:!0}),console.log(`[DataMigrations]   deleted: ${a}`)}catch(e){console.warn(`[DataMigrations]   failed to delete: ${a}`,e)}else console.warn(`[DataMigrations]   SKIPPED path escaping room3d: "${a}"  ${t}`)}}const _m_AZ14OMNgKSzOh7N2rH2oVnPmBiQsBx_0pUoUG8VeY=async()=>{const e=I(getProjectRoot(),"data","room3d"),t=I(e,Qt);let s={applied:[]};try{const e=await L(t,"utf-8"),a=JSON.parse(e);a&&Array.isArray(a.applied)&&(s=a)}catch{}const a=new Set(s.applied.map(e=>e.id)),d=Gt.filter(e=>!a.has(e.id));if(0!==d.length){console.log(`[DataMigrations] ${d.length} pending migration(s)`);for(const t of d){console.log(`[DataMigrations] Running: ${t.id}  ${t.description}`);try{if("clean-deleted-overrides"===t.action)await cleanDeletedOverrides(e);else if("purge-all"===t.action)await purgeAll(e);else{if("purge-paths"!==t.action||!t.paths){console.warn(`[DataMigrations]   Unknown action: ${t.action}`);continue}await purgePaths(e,t.paths)}s.applied.push({id:t.id,appliedAt:(new Date).toISOString()}),console.log(`[DataMigrations] Completed: ${t.id}`)}catch(e){console.error(`[DataMigrations] FAILED: ${t.id}`,e)}}try{await U(e,{recursive:!0})}catch{}await D(t,JSON.stringify(s,null,2),"utf-8"),console.log("[DataMigrations] Migration state saved")}},Yt=["APP_PASSWORD"],_AEEeMTFNr_SsDahNT9SwV4Wo9fgM_a479NM14J71HA=()=>{try{const t=H(getProjectRoot(),".env"),s=B(t,"utf-8");for(const t of s.split("\n")){const s=t.trim();if(!s||s.startsWith("#"))continue;const a=s.indexOf("=");if(-1===a)continue;const d=s.slice(0,a).trim(),l=s.slice(a+1).trim();Yt.includes(d)&&(e.env[d]=l)}}catch{}},Jt=[()=>{e.on("unhandledRejection",e=>{"ECONNRESET"!==(null==e?void 0:e.code)&&"EPIPE"!==(null==e?void 0:e.code)&&"ECONNABORTED"!==(null==e?void 0:e.code)&&console.error("[unhandledRejection]",e)})},_m_AZ14OMNgKSzOh7N2rH2oVnPmBiQsBx_0pUoUG8VeY,_AEEeMTFNr_SsDahNT9SwV4Wo9fgM_a479NM14J71HA],Xt={"/sw.js":{type:"text/javascript; charset=utf-8",etag:'"f0b-ul7BY75PBfxZkaTGt3zrj2i/FdY"',mtime:"2026-02-22T06:00:41.646Z",size:3851,path:"../public/sw.js"},"/workers/audio-capture.worklet.js":{type:"text/javascript; charset=utf-8",etag:'"620-QXBuoy+qk0OtJWTvi6oRfeIp1Xo"',mtime:"2026-02-22T06:00:41.646Z",size:1568,path:"../public/workers/audio-capture.worklet.js"},"/workers/audio-playback.worklet.js":{type:"text/javascript; charset=utf-8",etag:'"940-kEh17q17aOogTjCX6/sCoVUkFn4"',mtime:"2026-02-22T06:00:41.646Z",size:2368,path:"../public/workers/audio-playback.worklet.js"},"/_nuxt/9CnbiGX4.js":{type:"text/javascript; charset=utf-8",etag:'"368-3SfNOS38q+P5lRgSXCiWSAcQmnk"',mtime:"2026-02-22T06:00:41.637Z",size:872,path:"../public/_nuxt/9CnbiGX4.js"},"/_nuxt/9dOeXmI9.js":{type:"text/javascript; charset=utf-8",etag:'"70d-s5ZQp0Z0yZtWo6EsbG2CDJx88+A"',mtime:"2026-02-22T06:00:41.637Z",size:1805,path:"../public/_nuxt/9dOeXmI9.js"},"/_nuxt/0ooJOp3T.js":{type:"text/javascript; charset=utf-8",etag:'"237e2-MhsI7OG4DZSBrS16Lqcej5GrNrY"',mtime:"2026-02-22T06:00:41.637Z",size:145378,path:"../public/_nuxt/0ooJOp3T.js"},"/_nuxt/BLB10YUZ.js":{type:"text/javascript; charset=utf-8",etag:'"20a-7Dm38koPSR4uQkawpKfVbM1PXLg"',mtime:"2026-02-22T06:00:41.637Z",size:522,path:"../public/_nuxt/BLB10YUZ.js"},"/_nuxt/BNBIU_St.js":{type:"text/javascript; charset=utf-8",etag:'"e8a-Pz/gcotFJP2M+gS7/nMrGyL+0Co"',mtime:"2026-02-22T06:00:41.637Z",size:3722,path:"../public/_nuxt/BNBIU_St.js"},"/_nuxt/BNsxpt_W.js":{type:"text/javascript; charset=utf-8",etag:'"dfe-dw0uqng1ozZLp/kaOmvifkXIaEA"',mtime:"2026-02-22T06:00:41.637Z",size:3582,path:"../public/_nuxt/BNsxpt_W.js"},"/_nuxt/B4jEw4nY.js":{type:"text/javascript; charset=utf-8",etag:'"1fb53-MW5/jYyHtMVyZa2xDrQ1owPnXeQ"',mtime:"2026-02-22T06:00:41.637Z",size:129875,path:"../public/_nuxt/B4jEw4nY.js"},"/_nuxt/BVUotoKX.js":{type:"text/javascript; charset=utf-8",etag:'"b89f-wQ6IUnLhT2X7jWAN7qGH78y8hvg"',mtime:"2026-02-22T06:00:41.637Z",size:47263,path:"../public/_nuxt/BVUotoKX.js"},"/_nuxt/B_Qh0Dli.js":{type:"text/javascript; charset=utf-8",etag:'"1550-3VN/42YSyNJXABthmK1cJtybNR8"',mtime:"2026-02-22T06:00:41.637Z",size:5456,path:"../public/_nuxt/B_Qh0Dli.js"},"/_nuxt/BbZyGZUZ.js":{type:"text/javascript; charset=utf-8",etag:'"ecf-vu3uMFN347YHwPRtIPKjUkwCiyk"',mtime:"2026-02-22T06:00:41.637Z",size:3791,path:"../public/_nuxt/BbZyGZUZ.js"},"/_nuxt/BbKE9h6Q.js":{type:"text/javascript; charset=utf-8",etag:'"1de69-G2Pkw4f7AS337GfLawBqhSGEsC0"',mtime:"2026-02-22T06:00:41.637Z",size:122473,path:"../public/_nuxt/BbKE9h6Q.js"},"/_nuxt/BeMZGlXN.js":{type:"text/javascript; charset=utf-8",etag:'"265-RxJMqdu1FvhoB1CdPaG9GC4Jr1c"',mtime:"2026-02-22T06:00:41.637Z",size:613,path:"../public/_nuxt/BeMZGlXN.js"},"/_nuxt/BhJav5R2.js":{type:"text/javascript; charset=utf-8",etag:'"25e-j8BQRgEHzOhPHm/qh2A8JQZmemU"',mtime:"2026-02-22T06:00:41.637Z",size:606,path:"../public/_nuxt/BhJav5R2.js"},"/_nuxt/C0E292J0.js":{type:"text/javascript; charset=utf-8",etag:'"393-YMGULVjldvRx0G6EfbY9GluRFPI"',mtime:"2026-02-22T06:00:41.637Z",size:915,path:"../public/_nuxt/C0E292J0.js"},"/_nuxt/C3gWS42n.js":{type:"text/javascript; charset=utf-8",etag:'"6a8-ohqwm/zDlfkHwGB4RIaIgeRqwKg"',mtime:"2026-02-22T06:00:41.637Z",size:1704,path:"../public/_nuxt/C3gWS42n.js"},"/_nuxt/C7n6PzI9.js":{type:"text/javascript; charset=utf-8",etag:'"1c9-FnNk0KEBDxl48pBboxwKdsOH3DQ"',mtime:"2026-02-22T06:00:41.637Z",size:457,path:"../public/_nuxt/C7n6PzI9.js"},"/_nuxt/CHpsBT05.js":{type:"text/javascript; charset=utf-8",etag:'"1ab-exNdya7hk4W3Z5DqgAmrXzCN/2I"',mtime:"2026-02-22T06:00:41.638Z",size:427,path:"../public/_nuxt/CHpsBT05.js"},"/_nuxt/CL8zVUiS.js":{type:"text/javascript; charset=utf-8",etag:'"4ae6-wSAStYNpauIX5/lVDc0pyDzNUsU"',mtime:"2026-02-22T06:00:41.638Z",size:19174,path:"../public/_nuxt/CL8zVUiS.js"},"/_nuxt/CQFNeBSk.js":{type:"text/javascript; charset=utf-8",etag:'"184-Arzvvl46ZP+PMWdgU8N0RAGvm+Y"',mtime:"2026-02-22T06:00:41.638Z",size:388,path:"../public/_nuxt/CQFNeBSk.js"},"/_nuxt/B-1bL4-x.js":{type:"text/javascript; charset=utf-8",etag:'"afd08-pPSmwUTdOY5sVJUW2GhjWIZ798Y"',mtime:"2026-02-22T06:00:41.637Z",size:720136,path:"../public/_nuxt/B-1bL4-x.js"},"/_nuxt/BcRpfRfp.js":{type:"text/javascript; charset=utf-8",etag:'"c73ad-ZFgtVHyCRp0NsB+Hc+xixXclBLw"',mtime:"2026-02-22T06:00:41.638Z",size:816045,path:"../public/_nuxt/BcRpfRfp.js"},"/_nuxt/BW2llBe6.js":{type:"text/javascript; charset=utf-8",etag:'"15bcf3-cqNi9SkvVS3Q0Zth1j8/YuKs26I"',mtime:"2026-02-22T06:00:41.638Z",size:1424627,path:"../public/_nuxt/BW2llBe6.js"},"/_nuxt/CVY7zcRG.js":{type:"text/javascript; charset=utf-8",etag:'"f4-VnNK6TV92SHlEU9jNXzWjiZKvHg"',mtime:"2026-02-22T06:00:41.638Z",size:244,path:"../public/_nuxt/CVY7zcRG.js"},"/_nuxt/CWjXTmTM.js":{type:"text/javascript; charset=utf-8",etag:'"2ad-WYPS4Djvd66iPkT4UDOQoc9rEZs"',mtime:"2026-02-22T06:00:41.638Z",size:685,path:"../public/_nuxt/CWjXTmTM.js"},"/_nuxt/CZklLOuI.js":{type:"text/javascript; charset=utf-8",etag:'"40-w6zGGHXN8IL+bhqUd3NcXpazIx0"',mtime:"2026-02-22T06:00:41.638Z",size:64,path:"../public/_nuxt/CZklLOuI.js"},"/_nuxt/C_8y3F6N.js":{type:"text/javascript; charset=utf-8",etag:'"b11-RqydcMIi/9h5HIBTI9e0zb/t53U"',mtime:"2026-02-22T06:00:41.638Z",size:2833,path:"../public/_nuxt/C_8y3F6N.js"},"/_nuxt/Cc7Ca6Qt.js":{type:"text/javascript; charset=utf-8",etag:'"6aa-wsaBRiQkIRnmFnFYMbDMtbTqbek"',mtime:"2026-02-22T06:00:41.638Z",size:1706,path:"../public/_nuxt/Cc7Ca6Qt.js"},"/_nuxt/CeYmwSpz.js":{type:"text/javascript; charset=utf-8",etag:'"557-/EaWfJnWXzNxs9KS6nBPDpBieVM"',mtime:"2026-02-22T06:00:41.638Z",size:1367,path:"../public/_nuxt/CeYmwSpz.js"},"/_nuxt/CZvMPnKY.js":{type:"text/javascript; charset=utf-8",etag:'"26b05-VF3mOl/iL6voflQhHt5IqakGMVM"',mtime:"2026-02-22T06:00:41.638Z",size:158469,path:"../public/_nuxt/CZvMPnKY.js"},"/_nuxt/CqX_UuA0.js":{type:"text/javascript; charset=utf-8",etag:'"1b7c-VIbrahhqdtxYM0YATnYsQc4GQHY"',mtime:"2026-02-22T06:00:41.638Z",size:7036,path:"../public/_nuxt/CqX_UuA0.js"},"/_nuxt/Chq5WpSy.js":{type:"text/javascript; charset=utf-8",etag:'"b9d9-jJuBe5pulsjmL37XMCE+W5OVcv4"',mtime:"2026-02-22T06:00:41.638Z",size:47577,path:"../public/_nuxt/Chq5WpSy.js"},"/_nuxt/CqYR4YeN.js":{type:"text/javascript; charset=utf-8",etag:'"8cf-RWaMK07fjoYbHKaG84jHgoWBrIw"',mtime:"2026-02-22T06:00:41.638Z",size:2255,path:"../public/_nuxt/CqYR4YeN.js"},"/_nuxt/CqYFChgv.js":{type:"text/javascript; charset=utf-8",etag:'"2ede5-/w9vwax7R5RW7NBlI6PNe0Xyfe4"',mtime:"2026-02-22T06:00:41.638Z",size:191973,path:"../public/_nuxt/CqYFChgv.js"},"/_nuxt/Cucx4OwN.js":{type:"text/javascript; charset=utf-8",etag:'"1f2-ZBqwLtIz3vYMo9z3FBLnvEC8aYU"',mtime:"2026-02-22T06:00:41.638Z",size:498,path:"../public/_nuxt/Cucx4OwN.js"},"/_nuxt/Cy3V24HR.js":{type:"text/javascript; charset=utf-8",etag:'"745-sJxsXdsB+WFSlULt7Ki090oOA+8"',mtime:"2026-02-22T06:00:41.638Z",size:1861,path:"../public/_nuxt/Cy3V24HR.js"},"/_nuxt/D72jF2TD.js":{type:"text/javascript; charset=utf-8",etag:'"416-syNXdiOjK7v+Mq5kSM2Seb3H2RA"',mtime:"2026-02-22T06:00:41.638Z",size:1046,path:"../public/_nuxt/D72jF2TD.js"},"/_nuxt/CrOvi5ql.js":{type:"text/javascript; charset=utf-8",etag:'"2e0d5-UflA7HRbCVFaiMrmx2B8ErtE3B4"',mtime:"2026-02-22T06:00:41.638Z",size:188629,path:"../public/_nuxt/CrOvi5ql.js"},"/_nuxt/D5OFWNdF.js":{type:"text/javascript; charset=utf-8",etag:'"1cc4f-A+4aRezzhj53UZ7lqPYuIItNpqg"',mtime:"2026-02-22T06:00:41.638Z",size:117839,path:"../public/_nuxt/D5OFWNdF.js"},"/_nuxt/DABl-8-8.js":{type:"text/javascript; charset=utf-8",etag:'"40cb-n7notD5pinh4B7Ab/iIEh/QoWH4"',mtime:"2026-02-22T06:00:41.638Z",size:16587,path:"../public/_nuxt/DABl-8-8.js"},"/_nuxt/DAUAQgeF.js":{type:"text/javascript; charset=utf-8",etag:'"4b2-Vf3IxMzMPoHloAJZZMOpkKrv4mU"',mtime:"2026-02-22T06:00:41.638Z",size:1202,path:"../public/_nuxt/DAUAQgeF.js"},"/_nuxt/DCarf3Du.js":{type:"text/javascript; charset=utf-8",etag:'"9fb-H5FSdM4PVB6C/sAQUyk7bwtjzT4"',mtime:"2026-02-22T06:00:41.638Z",size:2555,path:"../public/_nuxt/DCarf3Du.js"},"/_nuxt/DKNUl-jY.js":{type:"text/javascript; charset=utf-8",etag:'"15e-HRKYf9Lwk/VzrslgLNsDxRzg5F8"',mtime:"2026-02-22T06:00:41.639Z",size:350,path:"../public/_nuxt/DKNUl-jY.js"},"/_nuxt/DGrIGiqA.js":{type:"text/javascript; charset=utf-8",etag:'"d020-3+AeSfyqLtT5as945s//50jhZJ0"',mtime:"2026-02-22T06:00:41.639Z",size:53280,path:"../public/_nuxt/DGrIGiqA.js"},"/_nuxt/DLeZR4-D.js":{type:"text/javascript; charset=utf-8",etag:'"1dd-n2i2LY+ILluLQc2EKBPKW4JuQG8"',mtime:"2026-02-22T06:00:41.639Z",size:477,path:"../public/_nuxt/DLeZR4-D.js"},"/_nuxt/DXygS-hN.js":{type:"text/javascript; charset=utf-8",etag:'"319-+AC0bBsxQLg/NRppfDmNrCO843o"',mtime:"2026-02-22T06:00:41.639Z",size:793,path:"../public/_nuxt/DXygS-hN.js"},"/_nuxt/D93w9sP1.js":{type:"text/javascript; charset=utf-8",etag:'"e54bb-IiYXPZm7JLURW2TkdlholdQX7PU"',mtime:"2026-02-22T06:00:41.639Z",size:939195,path:"../public/_nuxt/D93w9sP1.js"},"/_nuxt/Dki5py_8.js":{type:"text/javascript; charset=utf-8",etag:'"338-VK0Vfw6svCOSRA3qWDH3WvS/NlE"',mtime:"2026-02-22T06:00:41.639Z",size:824,path:"../public/_nuxt/Dki5py_8.js"},"/_nuxt/DlAUqK2U.js":{type:"text/javascript; charset=utf-8",etag:'"5b-eFCz/UrraTh721pgAl0VxBNR1es"',mtime:"2026-02-22T06:00:41.639Z",size:91,path:"../public/_nuxt/DlAUqK2U.js"},"/_nuxt/DrMtWeIT.js":{type:"text/javascript; charset=utf-8",etag:'"2a5-z556CB8tF8ZmDBaArNfoXDGZg6Q"',mtime:"2026-02-22T06:00:41.639Z",size:677,path:"../public/_nuxt/DrMtWeIT.js"},"/_nuxt/DspdD5uO.js":{type:"text/javascript; charset=utf-8",etag:'"306-aNDz/RRG99onCv+UUeGKVl1IbBk"',mtime:"2026-02-22T06:00:41.639Z",size:774,path:"../public/_nuxt/DspdD5uO.js"},"/_nuxt/Dz-tZIKD.js":{type:"text/javascript; charset=utf-8",etag:'"4a5-+m5ZTwI2duF288PUh7G95fYacjM"',mtime:"2026-02-22T06:00:41.639Z",size:1189,path:"../public/_nuxt/Dz-tZIKD.js"},"/_nuxt/F_BWUYta.js":{type:"text/javascript; charset=utf-8",etag:'"c97-7NNC5sPj95+1zi49KHbcRao/1VE"',mtime:"2026-02-22T06:00:41.639Z",size:3223,path:"../public/_nuxt/F_BWUYta.js"},"/_nuxt/ERSb2hnj.js":{type:"text/javascript; charset=utf-8",etag:'"120a1-8T9RnuxX8Efk1dvCWO1HTWArG8U"',mtime:"2026-02-22T06:00:41.639Z",size:73889,path:"../public/_nuxt/ERSb2hnj.js"},"/_nuxt/bRcyhnmz.js":{type:"text/javascript; charset=utf-8",etag:'"4cf-YAF6/UUr0KZ4UcC1FdjPH3DjCBI"',mtime:"2026-02-22T06:00:41.639Z",size:1231,path:"../public/_nuxt/bRcyhnmz.js"},"/_nuxt/_hH15yuy.js":{type:"text/javascript; charset=utf-8",etag:'"d573-nLoIXRehBCQbwAjM132jj4pTwBo"',mtime:"2026-02-22T06:00:41.639Z",size:54643,path:"../public/_nuxt/_hH15yuy.js"},"/_nuxt/default.DVzyD16k.css":{type:"text/css; charset=utf-8",etag:'"1624-Ifqi5Yd+jJiN2Omyj4EZKOmq0uo"',mtime:"2026-02-22T06:00:41.639Z",size:5668,path:"../public/_nuxt/default.DVzyD16k.css"},"/_nuxt/dzkcA_gK.js":{type:"text/javascript; charset=utf-8",etag:'"14ce-//A9UKYunEsEXyD0DJOE/4B0TjQ"',mtime:"2026-02-22T06:00:41.639Z",size:5326,path:"../public/_nuxt/dzkcA_gK.js"},"/_nuxt/error-404.C-Ezrlz-.css":{type:"text/css; charset=utf-8",etag:'"97e-YLcQ2HBNLea0KJoUeqSqSCendIU"',mtime:"2026-02-22T06:00:41.639Z",size:2430,path:"../public/_nuxt/error-404.C-Ezrlz-.css"},"/_nuxt/error-500.DBWf9FGj.css":{type:"text/css; charset=utf-8",etag:'"773-9MNIE+ztUss3x7HN62QKMFz0rhs"',mtime:"2026-02-22T06:00:41.639Z",size:1907,path:"../public/_nuxt/error-500.DBWf9FGj.css"},"/_nuxt/fc5qf64g.js":{type:"text/javascript; charset=utf-8",etag:'"d96-sxXPjpzPpP6eAcLANk0/xb2AfgQ"',mtime:"2026-02-22T06:00:41.639Z",size:3478,path:"../public/_nuxt/fc5qf64g.js"},"/_nuxt/i36olnfu.js":{type:"text/javascript; charset=utf-8",etag:'"253-i5A2GG/C2uKidaXX8ttHnga/mJ8"',mtime:"2026-02-22T06:00:41.639Z",size:595,path:"../public/_nuxt/i36olnfu.js"},"/_nuxt/entry.BzfH9u9r.css":{type:"text/css; charset=utf-8",etag:'"37d71-GEbPSv6MRz9W8jeP0zLvtxzg1BI"',mtime:"2026-02-22T06:00:41.639Z",size:228721,path:"../public/_nuxt/entry.BzfH9u9r.css"},"/_nuxt/index.CyfznbnK.css":{type:"text/css; charset=utf-8",etag:'"1ef-KCo5smGSXHWoIZ4SVXEQk0suly0"',mtime:"2026-02-22T06:00:41.639Z",size:495,path:"../public/_nuxt/index.CyfznbnK.css"},"/_nuxt/f5mqXgsP.js":{type:"text/javascript; charset=utf-8",etag:'"15dee-tNjF/UCnVbJ2Jv2qWDhrsSo19Eo"',mtime:"2026-02-22T06:00:41.639Z",size:89582,path:"../public/_nuxt/f5mqXgsP.js"},"/_nuxt/j1zCby7Q.js":{type:"text/javascript; charset=utf-8",etag:'"375-ilpKJ05Lp03iWj2/Yj2goNAwL94"',mtime:"2026-02-22T06:00:41.639Z",size:885,path:"../public/_nuxt/j1zCby7Q.js"},"/_nuxt/kVEvyfi8.js":{type:"text/javascript; charset=utf-8",etag:'"1400-SfAZxCMSXqdnbqxXNliAlLNzkao"',mtime:"2026-02-22T06:00:41.639Z",size:5120,path:"../public/_nuxt/kVEvyfi8.js"},"/_nuxt/laboratory.nCNx9KA8.css":{type:"text/css; charset=utf-8",etag:'"4966-kfhJ+RUFYf7qvA64JhyRhsRRWHs"',mtime:"2026-02-22T06:00:41.639Z",size:18790,path:"../public/_nuxt/laboratory.nCNx9KA8.css"},"/_nuxt/r0gahtD5.js":{type:"text/javascript; charset=utf-8",etag:'"52b-EmBrUWwna3bA8C0JlwDzzp8opjw"',mtime:"2026-02-22T06:00:41.639Z",size:1323,path:"../public/_nuxt/r0gahtD5.js"},"/_nuxt/room3d.DFAShanB.css":{type:"text/css; charset=utf-8",etag:'"5c4f-t7ZwvlEvqs0CHTU3UwZWC4KMbhc"',mtime:"2026-02-22T06:00:41.639Z",size:23631,path:"../public/_nuxt/room3d.DFAShanB.css"},"/_nuxt/sm5j8f8j.js":{type:"text/javascript; charset=utf-8",etag:'"693-/+JKP4in2kERce14A/ix0H+mvzU"',mtime:"2026-02-22T06:00:41.639Z",size:1683,path:"../public/_nuxt/sm5j8f8j.js"},"/_nuxt/triggers.DtyppsDD.css":{type:"text/css; charset=utf-8",etag:'"dd1-Zbm1y4Qcfz7SoTfU/LSoIcnhdGA"',mtime:"2026-02-22T06:00:41.639Z",size:3537,path:"../public/_nuxt/triggers.DtyppsDD.css"},"/_nuxt/useMultiplayer.BuNA_LkE.css":{type:"text/css; charset=utf-8",etag:'"f09-t2qVqRNS+Cav/DgLxEKmEVaQyWk"',mtime:"2026-02-22T06:00:41.639Z",size:3849,path:"../public/_nuxt/useMultiplayer.BuNA_LkE.css"},"/_nuxt/xfQjjOew.js":{type:"text/javascript; charset=utf-8",etag:'"1e1f-RCQ1eB2PpjuS/a6S86lsYaQyOZQ"',mtime:"2026-02-22T06:00:41.639Z",size:7711,path:"../public/_nuxt/xfQjjOew.js"},"/_nuxt/builds/latest.json":{type:"application/json",etag:'"47-ddc7Ymji4stXcPZygxmrsdIUqfU"',mtime:"2026-02-22T06:00:41.618Z",size:71,path:"../public/_nuxt/builds/latest.json"},"/_nuxt/builds/meta/20d036bd-5a69-4f49-b1a5-7c63da88e8ad.json":{type:"application/json",etag:'"58-xygYIzHVh6TCxB4JNEHwwA7Iyy0"',mtime:"2026-02-22T06:00:41.614Z",size:88,path:"../public/_nuxt/builds/meta/20d036bd-5a69-4f49-b1a5-7c63da88e8ad.json"},"/lab/plants/germ.png":{type:"image/png",etag:'"880e1-ktFsu9lggG/9n3qCw26gcEQNUf4"',mtime:"2026-02-22T06:00:41.647Z",size:557281,path:"../public/lab/plants/germ.png"},"/lab/plants/buds.png":{type:"image/png",etag:'"d9be0-10JnPz1JE6hMXjgg81bbMcJbtYA"',mtime:"2026-02-22T06:00:41.646Z",size:891872,path:"../public/lab/plants/buds.png"},"/lab/plants/prebuds.png":{type:"image/png",etag:'"d896d-63DEjishcvp0WNgWdT2zjF3mLSw"',mtime:"2026-02-22T06:00:41.648Z",size:887149,path:"../public/lab/plants/prebuds.png"},"/lab/plants/preflower.png":{type:"image/png",etag:'"d8fb2-zh8likoiA3TU9+eebJzY8eyT53M"',mtime:"2026-02-22T06:00:41.647Z",size:888754,path:"../public/lab/plants/preflower.png"},"/lab/plants/veg.png":{type:"image/png",etag:'"d1845-Ub+1TMhF6hLLlpzU1HCTWB10Scc"',mtime:"2026-02-22T06:00:41.647Z",size:858181,path:"../public/lab/plants/veg.png"},"/lab/plants/croptime.png":{type:"image/png",etag:'"1818ff-LpTartLcYrIBt7Pr5EIURbnj5KE"',mtime:"2026-02-22T06:00:41.647Z",size:1579263,path:"../public/lab/plants/croptime.png"}},er=/^[A-Za-z]:\//;function normalizeWindowsPath(e=""){return e?e.replace(/\\/g,"/").replace(er,e=>e.toUpperCase()):e}const tr=/^[/\\](?![/\\])|^[/\\]{2}(?!\.)|^[A-Za-z]:[/\\]/,rr=/^[A-Za-z]:$/;function cwd(){return void 0!==e&&"function"==typeof e.cwd?e.cwd().replace(/\\/g,"/"):"/"}const isAbsolute=function(e){return tr.test(e)};function readAsset(e){const t=function(e){const t=normalizeWindowsPath(e).replace(/\/$/,"").split("/").slice(0,-1);return 1===t.length&&rr.test(t[0])&&(t[0]+="/"),t.join("/")||(isAbsolute(e)?"/":".")}(W(globalThis._importMeta_.url));return R.readFile(function(...e){let t="",s=!1;for(let a=(e=e.map(e=>normalizeWindowsPath(e))).length-1;a>=-1&&!s;a--){const d=a>=0?e[a]:cwd();d&&0!==d.length&&(t=`${d}/${t}`,s=isAbsolute(d))}return t=function(e,t){let s="",a=0,d=-1,l=0,c=null;for(let u=0;u<=e.length;++u){if(u<e.length)c=e[u];else{if("/"===c)break;c="/"}if("/"===c){if(d===u-1||1===l);else if(2===l){if(s.length<2||2!==a||"."!==s[s.length-1]||"."!==s[s.length-2]){if(s.length>2){const e=s.lastIndexOf("/");-1===e?(s="",a=0):(s=s.slice(0,e),a=s.length-1-s.lastIndexOf("/")),d=u,l=0;continue}if(s.length>0){s="",a=0,d=u,l=0;continue}}t&&(s+=s.length>0?"/..":"..",a=2)}else s.length>0?s+=`/${e.slice(d+1,u)}`:s=e.slice(d+1,u),a=u-d-1;d=u,l=0}else"."===c&&-1!==l?++l:l=-1}return s}(t,!s),s&&!isAbsolute(t)?`/${t}`:t.length>0?t:"."}(t,Xt[e].path))}const sr={"/_nuxt/builds/meta/":{maxAge:31536e3},"/_nuxt/builds/":{maxAge:1},"/_nuxt/":{maxAge:31536e3}};function getAsset(e){return Xt[e]}const or=new Set(["HEAD","GET"]),nr={gzip:".gz",br:".br"},ar=it(e=>{if(e.method&&!or.has(e.method))return;let t,s=decodePath(withLeadingSlash(withoutTrailingSlash(parseURL(e.path).pathname)));const a=[...String(getRequestHeader(e,"accept-encoding")||"").split(",").map(e=>nr[e.trim()]).filter(Boolean).sort(),""];for(const e of a)for(const a of[s+e,joinURL(s,"index.html"+e)]){const e=getAsset(a);if(e){t=e,s=a;break}}if(!t){if(function(e=""){if(Xt[e])return!0;for(const t in sr)if(e.startsWith(t))return!0;return!1}(s))throw function(e,t){e.node.res.removeHeader(t)}(e,"Cache-Control"),createError$1({statusCode:404});return}void 0!==t.encoding&&appendResponseHeader(e,"Vary","Accept-Encoding");if(getRequestHeader(e,"if-none-match")===t.etag)return setResponseStatus(e,304,"Not Modified"),"";const d=getRequestHeader(e,"if-modified-since"),l=new Date(t.mtime);return d&&t.mtime&&new Date(d)>=l?(setResponseStatus(e,304,"Not Modified"),""):(t.type&&!getResponseHeader(e,"Content-Type")&&setResponseHeader(e,"Content-Type",t.type),t.etag&&!getResponseHeader(e,"ETag")&&setResponseHeader(e,"ETag",t.etag),t.mtime&&!getResponseHeader(e,"Last-Modified")&&setResponseHeader(e,"Last-Modified",l.toUTCString()),t.encoding&&!getResponseHeader(e,"Content-Encoding")&&setResponseHeader(e,"Content-Encoding",t.encoding),t.size>0&&!getResponseHeader(e,"Content-Length")&&setResponseHeader(e,"Content-Length",t.size),readAsset(s))}),ir=defineEventHandler(t=>{const s=t.method;if("POST"!==s&&"PUT"!==s&&"DELETE"!==s)return;const a=t.path||"";if(a.startsWith("/api/")&&"/api/room3d/client-error"!==a)try{const s=e.env.APP_PASSWORD||"";if(!s)return;if((Qe(t,"x-auth-token")||"")!==s)throw createError$1({statusCode:401,statusMessage:"Unauthorized"})}catch(e){if(401===(null==e?void 0:e.statusCode))throw e;console.error("[auth middleware] Error:",e)}}),dr=defineEventHandler(()=>{}),_lazy_QQb5Jf=()=>import("../routes/renderer.mjs").then(function(e){return e.r}),lr=[{route:"",handler:ar,lazy:!1,middleware:!0,method:void 0},{route:"",handler:ir,lazy:!1,middleware:!0,method:void 0},{route:"/api/auth/verify",handler:()=>import("../routes/api/auth/verify.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/automation/blower-ai-mode",handler:()=>import("../routes/api/automation/blower-ai-mode.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/blower-ai-mode",handler:()=>import("../routes/api/automation/blower-ai-mode.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/automation/fan-ai-mode",handler:()=>import("../routes/api/automation/fan-ai-mode.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/fan-ai-mode",handler:()=>import("../routes/api/automation/fan-ai-mode.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/automation/flow/:id",handler:()=>import("../routes/api/automation/flow/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/automation/flow/:id",handler:()=>import("../routes/api/automation/flow/_id_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/flow/:id",handler:()=>import("../routes/api/automation/flow/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/automation/flows",handler:()=>import("../routes/api/automation/flows.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/flows",handler:()=>import("../routes/api/automation/flows.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/automation/logs",handler:()=>import("../routes/api/automation/logs.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/socket-ai-mode",handler:()=>import("../routes/api/automation/socket-ai-mode.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/automation/socket-ai-mode",handler:()=>import("../routes/api/automation/socket-ai-mode.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cache-manifest",handler:()=>import("../routes/api/cache-manifest.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/:id",handler:()=>import("../routes/api/cameras/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/cameras/:id",handler:()=>import("../routes/api/cameras/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/cameras/:id/capture",handler:()=>import("../routes/api/cameras/_id/capture.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/command",handler:()=>import("../routes/api/cameras/_id/command.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/overlay",handler:()=>import("../routes/api/cameras/_id/overlay.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/:id/overlay",handler:()=>import("../routes/api/cameras/_id/overlay.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/photos",handler:()=>import("../routes/api/cameras/_id/photos.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/:id/schedules",handler:()=>import("../routes/api/cameras/_id/schedules.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/:id/schedules",handler:()=>import("../routes/api/cameras/_id/schedules.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/test",handler:()=>import("../routes/api/cameras/_id/test.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/timelapse-cleanup",handler:()=>import("../routes/api/cameras/_id/timelapse-cleanup.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/timelapse-days",handler:()=>import("../routes/api/cameras/_id/timelapse-days.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/:id/timelapse-export",handler:()=>import("../routes/api/cameras/_id/timelapse-export.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/:id/timelapse-video",handler:()=>import("../routes/api/cameras/_id/timelapse-video.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras",handler:()=>import("../routes/api/index.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras",handler:()=>import("../routes/api/index.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/photos/**:path",handler:()=>import("../routes/api/cameras/photos/_...path_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/cameras/photos/**:path",handler:()=>import("../routes/api/cameras/photos/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/schedules/:scheduleId",handler:()=>import("../routes/api/cameras/schedules/_scheduleId_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/cameras/schedules/:scheduleId",handler:()=>import("../routes/api/cameras/schedules/_scheduleId_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/cameras/snapshot/:id",handler:()=>import("../routes/api/cameras/snapshot/_id_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/stream/:id",handler:()=>import("../routes/api/cameras/stream/_id_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/test",handler:()=>import("../routes/api/cameras/test.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/cameras/timelapse-videos/**:filename",handler:()=>import("../routes/api/cameras/timelapse-videos/_...filename_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/cameras/webrtc",handler:()=>import("../routes/api/cameras/webrtc.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/control/blower",handler:()=>import("../routes/api/control/blower.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/control/blower",handler:()=>import("../routes/api/control/blower.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/control/fan",handler:()=>import("../routes/api/control/fan.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/control/light",handler:()=>import("../routes/api/control/light.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/control/lights",handler:()=>import("../routes/api/control/lights.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/control/outlets",handler:()=>import("../routes/api/control/outlets.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/control/socket/toggle",handler:()=>import("../routes/api/control/socket/toggle.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/control/sockets",handler:()=>import("../routes/api/control/sockets.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/devices",handler:()=>import("../routes/api/devices.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/devices/:mac",handler:()=>import("../routes/api/devices/_mac_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/devices/:mac",handler:()=>import("../routes/api/devices/_mac_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/devices/:mac/wifi-events",handler:()=>import("../routes/api/devices/_mac/wifi-events.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/devices/capabilities",handler:()=>import("../routes/api/devices/capabilities.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/breeding-projects",handler:()=>import("../routes/api/lab/breeding-projects.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/breeding-projects",handler:()=>import("../routes/api/lab/breeding-projects.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/breeding-projects/:id",handler:()=>import("../routes/api/lab/breeding-projects/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/breeding-projects/:id",handler:()=>import("../routes/api/lab/breeding-projects/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/dashboard",handler:()=>import("../routes/api/lab/dashboard.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/harvests",handler:()=>import("../routes/api/lab/harvests.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/harvests",handler:()=>import("../routes/api/lab/harvests.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/harvests/:id",handler:()=>import("../routes/api/lab/harvests/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/harvests/:id",handler:()=>import("../routes/api/lab/harvests/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/notifications",handler:()=>import("../routes/api/lab/notifications.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/notifications",handler:()=>import("../routes/api/lab/notifications.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/observations",handler:()=>import("../routes/api/lab/observations.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/observations",handler:()=>import("../routes/api/lab/observations.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/observations/:id",handler:()=>import("../routes/api/lab/observations/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/observations/:id",handler:()=>import("../routes/api/lab/observations/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/plants",handler:()=>import("../routes/api/lab/plants.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/plants",handler:()=>import("../routes/api/lab/plants.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/plants/:id",handler:()=>import("../routes/api/lab/plants/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/plants/:id",handler:()=>import("../routes/api/lab/plants/_id_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/plants/:id",handler:()=>import("../routes/api/lab/plants/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/plants/:id/stage",handler:()=>import("../routes/api/lab/plants/_id/stage.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/pollen",handler:()=>import("../routes/api/lab/pollen.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/pollen",handler:()=>import("../routes/api/lab/pollen.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/pollen/:id",handler:()=>import("../routes/api/lab/pollen/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/pollen/:id",handler:()=>import("../routes/api/lab/pollen/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/rooms",handler:()=>import("../routes/api/lab/rooms.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/rooms",handler:()=>import("../routes/api/lab/rooms.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/rooms/:id",handler:()=>import("../routes/api/lab/rooms/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/rooms/:id",handler:()=>import("../routes/api/lab/rooms/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/scores",handler:()=>import("../routes/api/lab/scores.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/scores",handler:()=>import("../routes/api/lab/scores.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/strains",handler:()=>import("../routes/api/lab/strains.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/strains",handler:()=>import("../routes/api/lab/strains.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/lab/strains/:id",handler:()=>import("../routes/api/lab/strains/_id_.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/lab/strains/:id",handler:()=>import("../routes/api/lab/strains/_id_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/lab/strains/:id",handler:()=>import("../routes/api/lab/strains/_id_.put.mjs"),lazy:!0,middleware:!1,method:"put"},{route:"/api/lab/upload-photo",handler:()=>import("../routes/api/lab/upload-photo.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-anim-meta",handler:()=>import("../routes/api/room3d/asset-anim-meta.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-anim-meta",handler:()=>import("../routes/api/room3d/asset-anim-meta.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-binding-defaults",handler:()=>import("../routes/api/room3d/asset-binding-defaults.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-binding-defaults",handler:()=>import("../routes/api/room3d/asset-binding-defaults.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-delete",handler:()=>import("../routes/api/room3d/asset-delete.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-meta",handler:()=>import("../routes/api/room3d/asset-meta.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-meta",handler:()=>import("../routes/api/room3d/asset-meta.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-rotations",handler:()=>import("../routes/api/room3d/asset-rotations.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-rotations",handler:()=>import("../routes/api/room3d/asset-rotations.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-scales",handler:()=>import("../routes/api/room3d/asset-scales.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-scales",handler:()=>import("../routes/api/room3d/asset-scales.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-thumb-offsets",handler:()=>import("../routes/api/room3d/asset-thumb-offsets.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/asset-thumb-offsets",handler:()=>import("../routes/api/room3d/asset-thumb-offsets.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/asset-upload",handler:()=>import("../routes/api/room3d/asset-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/assets",handler:()=>import("../routes/api/room3d/assets.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/character-calibration",handler:()=>import("../routes/api/room3d/character-calibration.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/character-calibration",handler:()=>import("../routes/api/room3d/character-calibration.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/characters",handler:()=>import("../routes/api/room3d/characters.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/client-error",handler:()=>import("../routes/api/room3d/client-error.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/display-image-upload",handler:()=>import("../routes/api/room3d/display-image-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/display-images",handler:()=>import("../routes/api/room3d/display-images.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/font-upload",handler:()=>import("../routes/api/room3d/font-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/fonts",handler:()=>import("../routes/api/room3d/fonts.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/onion-peers",handler:()=>import("../routes/api/room3d/onion-peers.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/onion-rooms",handler:()=>import("../routes/api/room3d/onion-rooms.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-calibrations",handler:()=>import("../routes/api/room3d/room-calibrations.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-calibrations",handler:()=>import("../routes/api/room3d/room-calibrations.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-ducts",handler:()=>import("../routes/api/room3d/room-ducts.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-ducts",handler:()=>import("../routes/api/room3d/room-ducts.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-hidden-meshes",handler:()=>import("../routes/api/room3d/room-hidden-meshes.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-hidden-meshes",handler:()=>import("../routes/api/room3d/room-hidden-meshes.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-lighting-reset",handler:()=>import("../routes/api/room3d/room-lighting-reset.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-lighting",handler:()=>import("../routes/api/room3d/room-lighting.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-lighting",handler:()=>import("../routes/api/room3d/room-lighting.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-link/:code",handler:()=>import("../routes/api/room3d/room-link/_code_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-links",handler:()=>import("../routes/api/room3d/room-links.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-links",handler:()=>import("../routes/api/room3d/room-links.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-mesh-simplifications",handler:()=>import("../routes/api/room3d/room-mesh-simplifications.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-mesh-simplifications",handler:()=>import("../routes/api/room3d/room-mesh-simplifications.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-objects",handler:()=>import("../routes/api/room3d/room-objects.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-objects",handler:()=>import("../routes/api/room3d/room-objects.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-settings",handler:()=>import("../routes/api/room3d/room-settings.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-settings",handler:()=>import("../routes/api/room3d/room-settings.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-spawns",handler:()=>import("../routes/api/room3d/room-spawns.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/room-spawns",handler:()=>import("../routes/api/room3d/room-spawns.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/room-upload",handler:()=>import("../routes/api/room3d/room-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/rooms",handler:()=>import("../routes/api/room3d/rooms.delete.mjs"),lazy:!0,middleware:!1,method:"delete"},{route:"/api/room3d/rooms",handler:()=>import("../routes/api/room3d/rooms.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/rooms",handler:()=>import("../routes/api/room3d/rooms.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/savegame",handler:()=>import("../routes/api/room3d/savegame.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/savegame",handler:()=>import("../routes/api/room3d/savegame.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/texture-maps",handler:()=>import("../routes/api/room3d/texture-maps.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/thumbnail-save",handler:()=>import("../routes/api/room3d/thumbnail-save.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/thumbnails",handler:()=>import("../routes/api/room3d/thumbnails.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/tunnel-info",handler:()=>import("../routes/api/room3d/tunnel-info.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/tv-channels-system-remove",handler:()=>import("../routes/api/room3d/tv-channels-system-remove.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/room3d/tv-channels-user",handler:()=>import("../routes/api/room3d/tv-channels-user.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/room3d/tv-channels-user",handler:()=>import("../routes/api/room3d/tv-channels-user.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/sensor-names",handler:()=>import("../routes/api/sensor-names.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensor-names",handler:()=>import("../routes/api/sensor-names.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/sensors/blower-history",handler:()=>import("../routes/api/sensors/blower-history.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/current",handler:()=>import("../routes/api/sensors/current.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/fan-history",handler:()=>import("../routes/api/sensors/fan-history.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/history",handler:()=>import("../routes/api/sensors/history.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/oldest",handler:()=>import("../routes/api/sensors/oldest.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/period-stats",handler:()=>import("../routes/api/sensors/period-stats.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/soil/history",handler:()=>import("../routes/api/sensors/soil/history.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/soil/list",handler:()=>import("../routes/api/sensors/soil/list.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sensors/stats",handler:()=>import("../routes/api/sensors/stats.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/settings/day-night",handler:()=>import("../routes/api/settings/day-night.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/settings/light",handler:()=>import("../routes/api/settings/light.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/settings/power",handler:()=>import("../routes/api/settings/power.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/settings/power",handler:()=>import("../routes/api/settings/power.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/settings/socket",handler:()=>import("../routes/api/settings/socket.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/settings/targets",handler:()=>import("../routes/api/settings/targets.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/settings/targets",handler:()=>import("../routes/api/settings/targets.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/settings/vpd",handler:()=>import("../routes/api/settings/vpd.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/socket-names",handler:()=>import("../routes/api/socket-names.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/socket-names",handler:()=>import("../routes/api/socket-names.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/sockets/events",handler:()=>import("../routes/api/sockets/events.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/sockets/log",handler:()=>import("../routes/api/sockets/log.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/stats/power",handler:()=>import("../routes/api/stats/power.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/backup-delete",handler:()=>import("../routes/api/system/backup-delete.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/backup-download",handler:()=>import("../routes/api/system/backup-download.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/backup-restore",handler:()=>import("../routes/api/system/backup-restore.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/backup-upload",handler:()=>import("../routes/api/system/backup-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/backups",handler:()=>import("../routes/api/system/backups.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/backups",handler:()=>import("../routes/api/system/backups.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/cert-upload",handler:()=>import("../routes/api/system/cert-upload.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/cloudflare",handler:()=>import("../routes/api/system/cloudflare.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/cloudflare",handler:()=>import("../routes/api/system/cloudflare.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/config",handler:()=>import("../routes/api/system/config.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/config",handler:()=>import("../routes/api/system/config.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/ddns",handler:()=>import("../routes/api/system/ddns.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/ddns",handler:()=>import("../routes/api/system/ddns.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/device-request",handler:()=>import("../routes/api/system/device-request.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/ha-config",handler:()=>import("../routes/api/system/ha-config.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/ha-config",handler:()=>import("../routes/api/system/ha-config.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/mqtt-sources",handler:()=>import("../routes/api/system/mqtt-sources.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/mqtt-sources",handler:()=>import("../routes/api/system/mqtt-sources.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/nginx",handler:()=>import("../routes/api/system/nginx.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/phone-app-stream",handler:()=>import("../routes/api/system/phone-app-stream.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/proxy-config",handler:()=>import("../routes/api/system/proxy-config.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/proxy-config",handler:()=>import("../routes/api/system/proxy-config.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/relay",handler:()=>import("../routes/api/system/relay.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/relay",handler:()=>import("../routes/api/system/relay.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/service-control",handler:()=>import("../routes/api/system/service-control.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/api/system/services",handler:()=>import("../routes/api/system/services.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/updates",handler:()=>import("../routes/api/system/updates.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/api/system/updates",handler:()=>import("../routes/api/system/updates.post.mjs"),lazy:!0,middleware:!1,method:"post"},{route:"/_room3d-ws",handler:()=>import("../routes/_room3d-ws.mjs"),lazy:!0,middleware:!1,method:void 0},{route:"/_sse",handler:()=>import("../routes/_sse.mjs"),lazy:!0,middleware:!1,method:void 0},{route:"/_voice-ws",handler:()=>import("../routes/_voice-ws.mjs"),lazy:!0,middleware:!1,method:void 0},{route:"/_ws",handler:()=>import("../routes/_ws.mjs"),lazy:!0,middleware:!1,method:void 0},{route:"/appdata-display-images/**:path",handler:()=>import("../routes/appdata-display-images/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/cache/models/**:path",handler:()=>import("../routes/cache/models/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/data/**:path",handler:()=>import("../routes/data/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/defaults/**:path",handler:()=>import("../routes/defaults/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/fonts/**:path",handler:()=>import("../routes/fonts/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/images/**:path",handler:()=>import("../routes/images/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/lab/uploads/**:path",handler:()=>import("../routes/lab/uploads/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/models/**:path",handler:()=>import("../routes/models/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/room3d-display-images/**:path",handler:()=>import("../routes/room3d-display-images/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/room3d-fonts/**:path",handler:()=>import("../routes/room3d-fonts/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/sound/**:path",handler:()=>import("../routes/sound/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/user-models/**:path",handler:()=>import("../routes/user-models/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/user-rooms/**:path",handler:()=>import("../routes/user-rooms/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/video/**:path",handler:()=>import("../routes/video/_...path_.get.mjs"),lazy:!0,middleware:!1,method:"get"},{route:"/__nuxt_error",handler:_lazy_QQb5Jf,lazy:!0,middleware:!1,method:void 0},{route:"/__nuxt_island/**",handler:dr,lazy:!1,middleware:!1,method:void 0},{route:"/**",handler:_lazy_QQb5Jf,lazy:!0,middleware:!1,method:void 0}];const cr=function(){const e=useRuntimeConfig(),t=createHooks(),captureError=(e,s={})=>{const a=t.callHookParallel("error",e,s).catch(e=>{console.error("Error while capturing another error",e)});if(s.event&&isEvent(s.event)){const t=s.event.context.nitro?.errors;t&&t.push({error:e,context:s}),s.event.waitUntil&&s.event.waitUntil(a)}},s=createApp({debug:destr(!1),onError:(e,t)=>(captureError(e,{event:t,tags:["request"]}),async function(e,t){for(const s of Kt)try{if(await s(e,t,{defaultHandler:defaultHandler}),t.handled)return}catch(e){console.error(e)}}(e,t)),onRequest:async e=>{e.context.nitro=e.context.nitro||{errors:[]};const t=e.node.req?.__unenv__;t?._platform&&(e.context={_platform:t?._platform,...t._platform,...e.context}),!e.context.waitUntil&&t?.waitUntil&&(e.context.waitUntil=t.waitUntil),e.fetch=(t,s)=>fetchWithEvent(e,t,s,{fetch:localFetch}),e.$fetch=(t,s)=>fetchWithEvent(e,t,s,{fetch:l}),e.waitUntil=t=>{e.context.nitro._waitUntilPromises||(e.context.nitro._waitUntilPromises=[]),e.context.nitro._waitUntilPromises.push(t),e.context.waitUntil&&e.context.waitUntil(t)},e.captureError=(t,s)=>{captureError(t,{event:e,...s})},await cr.hooks.callHook("request",e).catch(t=>{captureError(t,{event:e,tags:["request"]})})},onBeforeResponse:async(e,t)=>{await cr.hooks.callHook("beforeResponse",e,t).catch(t=>{captureError(t,{event:e,tags:["request","response"]})})},onAfterResponse:async(e,t)=>{await cr.hooks.callHook("afterResponse",e,t).catch(t=>{captureError(t,{event:e,tags:["request","response"]})})}}),a=function(e={}){const t=createRouter$1({}),s={};let a;const d={},addRoute=(e,a,l)=>{let c=s[e];if(c||(s[e]=c={path:e,handlers:{}},t.insert(e,c)),Array.isArray(l))for(const t of l)addRoute(e,a,t);else c.handlers[l]=toEventHandler(a,0,e);return d};d.use=d.add=(e,t,s)=>addRoute(e,t,s||"all");for(const e of dt)d[e]=(t,s)=>d.add(t,s,e);const matchHandler=(e="/",s="get")=>{const d=e.indexOf("?");-1!==d&&(e=e.slice(0,Math.max(0,d)));const l=t.lookup(e);if(!l||!l.handlers)return{error:createError$1({statusCode:404,name:"Not Found",statusMessage:`Cannot find any route matching ${e||"/"}.`})};let c=l.handlers[s]||l.handlers.all;if(!c){a||(a=toRouteMatcher(t));const d=a.matchAll(e).reverse();for(const e of d){if(e.handlers[s]){c=e.handlers[s],l.handlers[s]=l.handlers[s]||c;break}if(e.handlers.all){c=e.handlers.all,l.handlers.all=l.handlers.all||c;break}}}return c?{matched:l,handler:c}:{error:createError$1({statusCode:405,name:"Method Not Allowed",statusMessage:`Method ${s} is not allowed on this route.`})}},l=e.preemptive||e.preemtive;return d.handler=it(e=>{const t=matchHandler(e.path,e.method.toLowerCase());if("error"in t){if(l)throw t.error;return}e.context.matchedRoute=t.matched;const s=t.matched.params||{};return e.context.params=s,Promise.resolve(t.handler(e)).then(e=>void 0===e&&l?null:e)}),d.handler.__resolve__=async e=>{e=withLeadingSlash(e);const t=matchHandler(e);if("error"in t)return;let s={route:t.matched.path,handler:t.handler};if(t.handler.__resolve__){const a=await t.handler.__resolve__(e);if(!a)return;s={...s,...a}}return s},d}({preemptive:!0}),d=toNodeListener(s),localFetch=(e,t)=>e.toString().startsWith("/")?async function(e,t,s={}){try{const a=await b(e,{url:t,...s});return new Response(a.body,{status:a.status,statusText:a.statusText,headers:v(a.headers)})}catch(e){return new Response(e.toString(),{status:Number.parseInt(e.statusCode||e.code)||500,statusText:e.statusText})}}(d,e,t).then(e=>function(e){return e.headers.has("set-cookie")?new Response(e.body,{status:e.status,statusText:e.statusText,headers:normalizeCookieHeaders(e.headers)}):e}(e)):globalThis.fetch(e,t),l=createFetch({fetch:localFetch,Headers:wt,defaults:{baseURL:e.app.baseURL}});globalThis.$fetch=l,s.use(createRouteRulesHandler({localFetch:localFetch}));for(const t of lr){let d=t.lazy?lazyEventHandler(t.handler):t.handler;if(t.middleware||!t.route){const a=(e.app.baseURL+(t.route||"/")).replace(/\/+/g,"/");s.use(a,d)}else{const e=getRouteRulesForPath(t.route.replace(/:\w+|\*\*/g,"_"));e.cache&&(d=cachedEventHandler(d,{group:"nitro/routes",...e.cache})),a.use(t.route,d,t.method)}}return s.use(e.app.baseURL,a.handler),{hooks:t,h3App:s,router:a,localCall:e=>b(d,e),localFetch:localFetch,captureError:captureError}}();function useNitroApp(){return cr}function defineRenderHandler(e){const t=useRuntimeConfig();return it(async s=>{const a=useNitroApp(),d={event:s,render:e,response:void 0};if(await a.hooks.callHook("render:before",d),!d.response){if(s.path===`${t.app.baseURL}favicon.ico`)return setResponseHeader(s,"Content-Type","image/x-icon"),send(s,"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");if(d.response=await d.render(s),!d.response){const e=getResponseStatus(s);return setResponseStatus(s,200===e?500:e),send(s,"No response returned from render handler: "+s.path)}}return await a.hooks.callHook("render:response",d.response,d),d.response.headers&&setResponseHeaders(s,d.response.headers),(d.response.statusCode||d.response.statusMessage)&&setResponseStatus(s,d.response.statusCode,d.response.statusMessage),d.response.body})}!function(e){for(const t of Jt)try{t(e)}catch(t){throw e.captureError(t,{tags:["plugin"]}),t}}(cr);function GracefulShutdown(s,a){a=a||{};const d=Object.assign({signals:"SIGINT SIGTERM",timeout:3e4,development:!1,forceExit:!0,onShutdown:e=>Promise.resolve(e),preShutdown:e=>Promise.resolve(e)},a);let l=!1;const c={};let u=0;const h={};let m=0,f=!1,g=!1;const _=d.signals.split(" ").map(e=>e.trim()).filter(e=>e.length>0),x=function(){let e=!1;return(t,s,a)=>{function call(){if(!e)return e=!0,Reflect.apply(a,this,arguments)}for(const e of s)t.on(e,call)}}();function destroy(e,s=!1){(e._isIdle&&l||s)&&(e.destroy(),e.server instanceof t.Server?delete c[e._connectionId]:delete h[e._connectionId])}function destroyAllConnections(e=!1){for(const t of Object.keys(c)){const s=c[t],a=s._httpMessage;a&&!e?a.headersSent||a.setHeader("connection","close"):destroy(s)}for(const t of Object.keys(h)){const s=h[t],a=s._httpMessage;a&&!e?a.headersSent||a.setHeader("connection","close"):destroy(s)}}function shutdown(t){if(d.development)return e.exit(0);function waitForReadyToShutDown(e){if(0===e)return d.timeout,Promise.resolve(!0);return 0===Object.keys(c).length&&0===Object.keys(h).length?Promise.resolve(!1):new Promise(t=>{setTimeout(()=>{t(waitForReadyToShutDown(e-1))},250)})}return l?Promise.resolve():d.preShutdown(t).then(()=>{l=!0,destroyAllConnections(),new Promise((e,t)=>{s.close(s=>s?t(s):e(!0))})}).then(()=>waitForReadyToShutDown(d.timeout?Math.round(d.timeout/250):0)).then(e=>(e&&destroyAllConnections(e),d.onShutdown(t))).then(function(){return g||(g=!0,d.finally&&function(e){const t=Object.prototype.toString.call(e);return/^\[object\s([A-Za-z]+)?Function]$/.test(t)}(d.finally)&&d.finally()),Promise.resolve()}).catch(e=>{const t="string"==typeof e?e:JSON.stringify(e);throw f=!0,t})}return x(e,_,t=>{shutdown(t).then(()=>{d.forceExit&&e.exit(f?1:0)}).catch(t=>{e.exit(1)})}),s.on("request",(e,t)=>{e.socket._isIdle=!1,l&&!t.headersSent&&t.setHeader("connection","close"),t.on("finish",()=>{e.socket._isIdle=!0,destroy(e.socket)})}),s.on("connection",e=>{if(l)e.destroy();else{const t=u++;e._isIdle=!0,e._connectionId=t,c[t]=e,e.once("close",()=>{delete c[e._connectionId]})}}),s.on("secureConnection",e=>{if(l)e.destroy();else{const t=m++;e._isIdle=!0,e._connectionId=t,h[t]=e,e.once("close",()=>{delete h[e._connectionId]})}}),e.on("close",()=>{}),function(){return shutdown("manual")}}const ur=e.env.NITRO_SSL_CERT,hr=e.env.NITRO_SSL_KEY,pr=useNitroApp(),mr=ur&&hr?new d({key:hr,cert:ur},toNodeListener(pr.h3App)):new s(toNodeListener(pr.h3App)),fr=destr(e.env.NITRO_PORT||e.env.PORT)||3e3,yr=e.env.NITRO_HOST||e.env.HOST,gr=e.env.NITRO_UNIX_SOCKET,_r=mr.listen(gr?{path:gr}:{port:fr,host:yr},t=>{t&&(console.error(t),e.exit(1));const s=ur&&hr?"https":"http",a=_r.address();if("string"==typeof a)return void console.log(`Listening on unix socket ${a}`);const d=(useRuntimeConfig().app.baseURL||"").replace(/\/$/,""),l=`${s}://${"IPv6"===a.family?`[${a.address}]`:a.address}:${a.port}${d}`;console.log(`Listening on ${l}`)});e.on("unhandledRejection",e=>_captureError(e,"unhandledRejection")),e.on("uncaughtException",e=>_captureError(e,"uncaughtException")),function(t,s){const a={disabled:!!e.env.NITRO_SHUTDOWN_DISABLED,signals:(e.env.NITRO_SHUTDOWN_SIGNALS||"SIGTERM SIGINT").split(" ").map(e=>e.trim()),timeout:Number.parseInt(e.env.NITRO_SHUTDOWN_TIMEOUT||"",10)||3e4,forceExit:!e.env.NITRO_SHUTDOWN_NO_FORCE_EXIT};a.disabled||GracefulShutdown(t,{signals:a.signals.join(" "),timeout:a.timeout,forceExit:a.forceExit,onShutdown:async()=>{await new Promise(e=>{const t=setTimeout(()=>{console.warn("Graceful shutdown timeout, force exiting..."),e()},a.timeout);s.hooks.callHook("close").catch(e=>{console.error(e)}).finally(()=>{clearTimeout(t),e()})})}})}(_r,pr);{const{handleUpgrade:e}=nodeAdapter(pr.h3App.websocket);mr.on("upgrade",e)}const br={};export{xt as $,getRouteRules as A,joinURL as B,useNitroApp as C,hasProtocol as D,isScriptProtocol as E,withQuery as F,sanitizeStatusCode as G,getContext as H,createHooks as I,executeAsync as J,qe as K,parseQuery as L,withTrailingSlash as M,withoutTrailingSlash as N,br as O,getQuery as a,getProjectRoot as b,createError$1 as c,defineEventHandler as d,Qe as e,send as f,getRouterParam as g,setResponseHeader as h,sendStream as i,setResponseStatus as j,readRawBody as k,readMultipartFormData as l,setResponseHeaders as m,ot as n,defineWebSocketHandler as o,getRequestURL as p,getRequestHeader as q,readBody as r,st as s,joinRelativeURL as t,useRuntimeConfig as u,getResponseStatusText as v,getResponseStatus as w,decodePath as x,defineRenderHandler as y,destr as z};
