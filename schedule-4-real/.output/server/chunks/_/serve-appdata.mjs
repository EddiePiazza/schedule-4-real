import{g as t,c as e,b as o,n as a,q as n,j as s,i}from"../nitro/nitro.mjs";import{createReadStream as p}from"fs";import{stat as m}from"fs/promises";import{join as g,extname as f}from"path";const r={".glb":"model/gltf-binary",".gltf":"model/gltf+json",".bin":"application/octet-stream",".png":"image/png",".jpg":"image/jpeg",".jpeg":"image/jpeg",".webp":"image/webp",".gif":"image/gif",".svg":"image/svg+xml",".ico":"image/x-icon",".exr":"application/octet-stream",".hdr":"application/octet-stream",".ktx2":"image/ktx2",".mp3":"audio/mpeg",".ogg":"audio/ogg",".wav":"audio/wav",".m4a":"audio/mp4",".woff2":"font/woff2",".woff":"font/woff",".ttf":"font/ttf",".otf":"font/otf",".eot":"application/vnd.ms-fontobject",".json":"application/json",".pdf":"application/pdf",".mp4":"video/mp4",".webm":"video/webm"};async function serveAppData(c,d){const l=t(c,"path")||"",u=decodeURIComponent(l);if(!u||u.includes("..")||u.includes("\\"))throw e({statusCode:400,message:"Invalid path"});const b=g(o(),"data","appdata",d,u);let w;try{w=await m(b)}catch{throw e({statusCode:404,message:"Not found"})}if(!w.isFile())throw e({statusCode:404,message:"Not found"});const h=f(b).toLowerCase(),C=r[h]||"application/octet-stream",j=w.size;a(c,"Content-Type",C),a(c,"Cache-Control","public, max-age=31536000, immutable"),a(c,"Accept-Ranges","bytes");const v=n(c,"range");if(v){const t=v.match(/bytes=(\d*)-(\d*)/);if(t){const e=t[1]?parseInt(t[1],10):0,o=t[2]?parseInt(t[2],10):j-1;return e>=j||o>=j||e>o?(s(c,416),a(c,"Content-Range",`bytes */${j}`),""):(s(c,206),a(c,"Content-Range",`bytes ${e}-${o}/${j}`),a(c,"Content-Length",o-e+1),i(c,p(b,{start:e,end:o})))}}return a(c,"Content-Length",j),i(c,p(b))}export{serveAppData as s};
