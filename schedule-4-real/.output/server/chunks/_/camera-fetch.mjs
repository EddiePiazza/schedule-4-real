import t from"https";import e from"http";const o=new t.Agent({rejectUnauthorized:!1});async function cameraFetch(r,n,s,a={}){const c=a.timeoutMs||8e3,u=[{url:`https://${r}:${n}${s}`,agent:o},{url:`http://${r}:${n}${s}`,agent:void 0}];for(const{url:o,agent:r}of u)try{return await new Promise((n,u)=>{const i=(o.startsWith("https")?t:e).get(o,{agent:r,timeout:c},t=>{const e=t.headers["content-type"]||"";if(a.expectImage&&e.includes("text/html"))return i.destroy(),void u(new Error("Got HTML instead of image"));if(!s.includes(".html")&&e.includes("text/html")&&!a.expectImage)return i.destroy(),void u(new Error("Got HTML response"));const o=[];t.on("data",t=>o.push(t)),t.on("end",()=>{n({ok:(t.statusCode||0)>=200&&(t.statusCode||0)<300,status:t.statusCode||0,body:Buffer.concat(o),contentType:e})}),t.on("error",u)});i.on("error",u),i.on("timeout",()=>{i.destroy(),u(new Error("Timeout"))})})}catch{continue}return{ok:!1,status:0,body:Buffer.from("Cannot reach camera"),contentType:"text/plain"}}export{cameraFetch as c};
