import{query as e,sanitizeString as t,sanitizeInt as a}from"./db.mjs";async function loadCameras(){try{return(await e("\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM cameras\n      )\n      WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n      ORDER BY sort_order ASC, name ASC\n    ")||[]).map(rowToCamera)}catch{return[]}}async function saveCamera(n){const s=1e3*Date.now();await e(`\n    INSERT INTO cameras (\n      timestamp, id, name, protocol, host, port, path,\n      username, password, enabled, sort_order, is_deleted\n    ) VALUES (\n      ${s},\n      '${t(n.id)}',\n      '${t(n.name)}',\n      '${t(n.protocol)}',\n      '${t(n.host)}',\n      ${a(n.port)},\n      '${t(n.path)}',\n      '${t(n.username)}',\n      '${t(n.password)}',\n      ${n.enabled?1:0},\n      ${a(n.order)},\n      0\n    )\n  `)}async function deleteCamera(n){const s=(await loadCameras()).find(e=>e.id===n);if(!s)return;const r=1e3*Date.now();await e(`\n    INSERT INTO cameras (\n      timestamp, id, name, protocol, host, port, path,\n      username, password, enabled, sort_order, is_deleted\n    ) VALUES (\n      ${r},\n      '${t(s.id)}',\n      '${t(s.name)}',\n      '${t(s.protocol)}',\n      '${t(s.host)}',\n      ${a(s.port)},\n      '${t(s.path)}',\n      '${t(s.username)}',\n      '${t(s.password)}',\n      0,\n      ${a(s.order)},\n      1\n    )\n  `)}function rowToCamera(e){return{id:e.id,name:e.name,protocol:e.protocol||"rtsp",host:e.host,port:e.port||554,path:e.path||"/",username:e.username||"",password:e.password||"",enabled:1===e.enabled,order:e.sort_order||0}}async function loadSchedules(a){try{return(await e(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM camera_timelapse_schedules\n      )\n      WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n        AND camera_id = '${t(a)}'\n      ORDER BY timestamp DESC\n    `)||[]).map(rowToSchedule)}catch{return[]}}async function saveSchedule(n){const s=1e3*Date.now();await e(`\n    INSERT INTO camera_timelapse_schedules (\n      timestamp, id, camera_id, enabled, interval_minutes,\n      start_time, end_time, days_active, is_deleted\n    ) VALUES (\n      ${s},\n      '${t(n.id)}',\n      '${t(n.camera_id)}',\n      ${n.enabled?1:0},\n      ${a(n.interval_minutes)},\n      '${t(n.start_time)}',\n      '${t(n.end_time)}',\n      '${t(n.days_active)}',\n      0\n    )\n  `)}async function deleteSchedule(n){const s=await e(`\n    SELECT * FROM (\n      SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n      FROM camera_timelapse_schedules\n    )\n    WHERE rn = 1 AND id = '${t(n)}'\n  `);if(!s||0===s.length)return;const r=rowToSchedule(s[0]),o=1e3*Date.now();await e(`\n    INSERT INTO camera_timelapse_schedules (\n      timestamp, id, camera_id, enabled, interval_minutes,\n      start_time, end_time, days_active, is_deleted\n    ) VALUES (\n      ${o},\n      '${t(r.id)}',\n      '${t(r.camera_id)}',\n      0,\n      ${a(r.interval_minutes)},\n      '${t(r.start_time)}',\n      '${t(r.end_time)}',\n      '${t(r.days_active)}',\n      1\n    )\n  `)}function rowToSchedule(e){return{id:e.id,camera_id:e.camera_id,enabled:1===e.enabled,interval_minutes:e.interval_minutes||30,start_time:e.start_time||"",end_time:e.end_time||"",days_active:e.days_active||"all"}}const n={enabled:!1,position:"bottom-left",show_date:!0,date_format:"YYYY-MM-DD",show_time:!0,show_day_counter:!1,day_counter_start:"",day_counter_label:"Day",custom_text:"",font_size:36,text_color:"white"};async function loadOverlaySettings(a){try{const n=await e(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY camera_id ORDER BY timestamp DESC) as rn\n        FROM camera_overlay_settings\n      )\n      WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n        AND camera_id = '${t(a)}'\n    `);if(n&&n.length>0)return{camera_id:(s=n[0]).camera_id,enabled:1===s.enabled,position:s.position||"bottom-left",show_date:1===s.show_date,date_format:s.date_format||"YYYY-MM-DD",show_time:1===s.show_time,show_day_counter:1===s.show_day_counter,day_counter_start:s.day_counter_start||"",day_counter_label:s.day_counter_label||"Day",custom_text:s.custom_text||"",font_size:s.font_size||36,text_color:s.text_color||"white"}}catch{}var s;return{camera_id:a,...n}}async function saveOverlaySettings(n){const s=1e3*Date.now();await e(`\n    INSERT INTO camera_overlay_settings (\n      timestamp, camera_id, enabled, position,\n      show_date, date_format, show_time,\n      show_day_counter, day_counter_start, day_counter_label,\n      custom_text, font_size, text_color, is_deleted\n    ) VALUES (\n      ${s},\n      '${t(n.camera_id)}',\n      ${n.enabled?1:0},\n      '${t(n.position)}',\n      ${n.show_date?1:0},\n      '${t(n.date_format)}',\n      ${n.show_time?1:0},\n      ${n.show_day_counter?1:0},\n      '${t(n.day_counter_start)}',\n      '${t(n.day_counter_label)}',\n      '${t(n.custom_text)}',\n      ${a(n.font_size)},\n      '${t(n.text_color)}',\n      0\n    )\n  `)}export{n as D,loadOverlaySettings as a,saveOverlaySettings as b,loadSchedules as c,deleteCamera as d,saveSchedule as e,deleteSchedule as f,loadCameras as l,saveCamera as s};
