import{d as t,r,c as o}from"../../nitro/nitro.mjs";import{randomBytes as e}from"crypto";import{l as p,s}from"../../_/cameras.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../../_/db.mjs";import"pg";const i=t(async t=>{const i=await r(t);if(!i.name||!i.host||!i.port)throw o({statusCode:400,message:"name, host, and port are required"});const a=await p(),m={id:e(8).toString("hex"),name:String(i.name).slice(0,50),protocol:["rtsp","rtsp-tcp","onvif","http-mjpeg"].includes(i.protocol)?i.protocol:"rtsp",host:String(i.host).slice(0,255),port:Math.max(1,Math.min(65535,parseInt(i.port)||554)),path:String(i.path||"/").slice(0,500),username:String(i.username||"").slice(0,100),password:String(i.password||"").slice(0,100),enabled:!1!==i.enabled,order:a.length};return await s(m),await async function(){try{await fetch("http://127.0.0.1:1985/reload",{method:"POST"})}catch{}}(),{success:!0,camera:m}});export{i as default};
