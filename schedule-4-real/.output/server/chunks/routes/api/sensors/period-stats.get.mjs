import{d as i,a as m}from"../../../nitro/nitro.mjs";import{query as t}from"../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const o=i(async i=>{const{since:o,until:s}=m(i);if(!o||"string"!=typeof o)return{error:'Missing or invalid "since" parameter'};try{const i=new Date(o);if(isNaN(i.getTime()))return{error:'Invalid date format for "since" parameter'};const m=i.toISOString();let a="";if(s&&"string"==typeof s){const i=new Date(s);isNaN(i.getTime())||(a=` AND timestamp < '${i.toISOString()}'`)}const[e,n]=await Promise.all([t(`\n        SELECT\n          min(temp) as temp_min, max(temp) as temp_max, avg(temp) as temp_avg,\n          min(humi) as humi_min, max(humi) as humi_max, avg(humi) as humi_avg,\n          min(vpd) as vpd_min, max(vpd) as vpd_max, avg(vpd) as vpd_avg\n        FROM sensors_environment\n        WHERE timestamp > '${m}'${a}\n      `),t(`\n        SELECT\n          min(temp_soil) as temp_soil_min, max(temp_soil) as temp_soil_max, avg(temp_soil) as temp_soil_avg,\n          min(humi_soil) as humi_soil_min, max(humi_soil) as humi_soil_max, avg(humi_soil) as humi_soil_avg,\n          min(ec_soil) as ec_soil_min, max(ec_soil) as ec_soil_max, avg(ec_soil) as ec_soil_avg\n        FROM sensors_soil\n        WHERE timestamp > '${m}'${a}\n      `).catch(()=>[])]),p={};if(e.length>0){const i=e[0];p.temp={min:i.temp_min,max:i.temp_max,avg:i.temp_avg},p.humi={min:i.humi_min,max:i.humi_max,avg:i.humi_avg},p.vpd={min:i.vpd_min,max:i.vpd_max,avg:i.vpd_avg}}if(n.length>0){const i=n[0];p.temp_soil={min:i.temp_soil_min,max:i.temp_soil_max,avg:i.temp_soil_avg},p.humi_soil={min:i.humi_soil_min,max:i.humi_soil_max,avg:i.humi_soil_avg},p.ec_soil={min:i.ec_soil_min,max:i.ec_soil_max,avg:i.ec_soil_avg}}return p}catch(i){return console.error("Failed to fetch period sensor stats:",i),{}}});export{o as default};
