import{d as m,a as i}from"../../../nitro/nitro.mjs";import{query as t}from"../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const a=m(async m=>{const{range:a="24h"}=i(m),o=function(m){return{"1h":1,"6h":6,"24h":24,"7d":168,"30d":720}[m]||24}(a);try{const[m,i]=await Promise.all([t(`\n        SELECT\n          min(temp) as temp_min, max(temp) as temp_max, avg(temp) as temp_avg,\n          min(humi) as humi_min, max(humi) as humi_max, avg(humi) as humi_avg,\n          min(vpd) as vpd_min, max(vpd) as vpd_max, avg(vpd) as vpd_avg\n        FROM sensors_environment\n        WHERE timestamp > dateadd('h', -${o}, now())\n      `),t(`\n        SELECT\n          min(temp_soil) as temp_soil_min, max(temp_soil) as temp_soil_max, avg(temp_soil) as temp_soil_avg,\n          min(humi_soil) as humi_soil_min, max(humi_soil) as humi_soil_max, avg(humi_soil) as humi_soil_avg,\n          min(ec_soil) as ec_soil_min, max(ec_soil) as ec_soil_max, avg(ec_soil) as ec_soil_avg\n        FROM sensors_soil\n        WHERE timestamp > dateadd('h', -${o}, now())\n      `).catch(()=>[])]),a={};if(m.length>0){const i=m[0];a.temp={min:i.temp_min,max:i.temp_max,avg:i.temp_avg},a.humi={min:i.humi_min,max:i.humi_max,avg:i.humi_avg},a.vpd={min:i.vpd_min,max:i.vpd_max,avg:i.vpd_avg}}if(i.length>0){const m=i[0];a.temp_soil={min:m.temp_soil_min,max:m.temp_soil_max,avg:m.temp_soil_avg},a.humi_soil={min:m.humi_soil_min,max:m.humi_soil_max,avg:m.humi_soil_avg},a.ec_soil={min:m.ec_soil_min,max:m.ec_soil_max,avg:m.ec_soil_avg}}return a}catch(m){return console.error("Failed to fetch sensor stats:",m),{}}});export{a as default};
