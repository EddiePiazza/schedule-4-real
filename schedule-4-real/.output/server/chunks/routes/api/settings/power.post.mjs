import{d as t,r as o,c as s}from"../../../nitro/nitro.mjs";import{query as r}from"../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const e=t(async t=>{const e=await o(t),{sockets:a,lights:i}=e;try{if(a)for(const[t,o]of Object.entries(a)){const s=Math.max(0,Math.round(o.watts||0)),e=Math.max(0,o.costPerKwh||0);await r("\n          INSERT INTO socket_wattage (timestamp, socket, watts, cost_per_kwh)\n          VALUES (now(), $1, $2, $3)\n        ",[t,s,e])}if(i)for(const[t,o]of Object.entries(i)){const s=-1===o.watts?-1:Math.max(0,Math.round(o.watts||0)),e=Math.max(0,o.costPerKwh||0);await r("\n          INSERT INTO socket_wattage (timestamp, socket, watts, cost_per_kwh)\n          VALUES (now(), $1, $2, $3)\n        ",[t,s,e])}return{success:!0}}catch(t){throw console.error("Failed to save power settings:",t),s({statusCode:500,message:"Failed to save power settings"})}});export{e as default};
