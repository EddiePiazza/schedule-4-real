import{d as t,r as o,c as e}from"../../../../nitro/nitro.mjs";import{g as s,b as r,s as i,a,c as m,u as p}from"../../../../_/mqtt.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"mqtt";import"child_process";const n=t(async t=>{var n,d;const c=await o(t),{socket:l,mOnOff:u}=c;if(!l)throw e({statusCode:400,message:"Socket ID is required"});const f=s();if(!r(f).hasOutlets)throw e({statusCode:404,message:"This device type does not have outlets"});try{const t=["outlet",l];let o={};try{const e=await i({method:"getConfigField",params:{keyPath:t}},f,3e3);o=(null==(n=null==e?void 0:e.data)?void 0:n[l])||{}}catch{}const e={...o,modeType:0,mOnOff:u},s={method:"setConfigField",params:{keyPath:t,[l]:e}};await a(s,f);const r=m(f),c=(null==(d=null==r?void 0:r.data)?void 0:d.outlet)||{};return p(f,{outlet:{...c,[l]:e}}),{success:!0,socket:l,mOnOff:u}}catch(t){throw console.error("Failed to toggle socket:",t),e({statusCode:500,message:"Failed to toggle socket"})}});export{n as default};
