import{d as t,g as o,c as e}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as n,query as r,sanitizeString as i}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const s=t(async t=>{var s;const m=o(t,"id");if(!m)throw e({statusCode:400,message:"Room ID is required"});let a;try{a=n(m)}catch{throw e({statusCode:400,message:"Invalid room ID format"})}try{const t=await r(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_grow_rooms\n        WHERE id = '${a}'\n      )\n      WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n    `);if(!t.length)throw e({statusCode:404,message:"Room not found"});const o=t[0],n=1e3*Date.now();return await r(`\n      INSERT INTO lab_grow_rooms (\n        timestamp, id, name, description, room_type, dimensions_cm,\n        cover_color, icon, layout_data, device_macs, light_ids,\n        outlet_ids, sensor_ids, active_plant_ids, environment_profile,\n        status, sort_order, is_deleted\n      ) VALUES (\n        ${n},\n        '${a}',\n        '${i(o.name)}',\n        ${o.description?`'${i(o.description)}'`:"NULL"},\n        '${o.room_type||"tent"}',\n        ${o.dimensions_cm?`'${i(o.dimensions_cm)}'`:"NULL"},\n        ${o.cover_color?`'${i(o.cover_color)}'`:"NULL"},\n        ${o.icon?`'${i(o.icon)}'`:"NULL"},\n        ${o.layout_data?`'${i(o.layout_data)}'`:"NULL"},\n        '${i(o.device_macs||"[]")}',\n        '${i(o.light_ids||"[]")}',\n        '${i(o.outlet_ids||"[]")}',\n        '${i(o.sensor_ids||"[]")}',\n        '${i(o.active_plant_ids||"[]")}',\n        ${o.environment_profile?`'${i(o.environment_profile)}'`:"NULL"},\n        '${o.status||"inactive"}',\n        ${null!=(s=o.sort_order)?s:0},\n        1\n      )\n    `),{success:!0,id:a}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to delete room:",t),e({statusCode:500,message:"Failed to delete room"})}});export{s as default};
