import{d as t,g as e,c as n}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as o,query as r}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const a=t(async t=>{var a,_,s,i,d,l,p;const $=e(t,"id");if(!$)throw n({statusCode:400,message:"Plant ID is required"});let m;try{m=o($)}catch{throw n({statusCode:400,message:"Invalid plant ID format"})}try{const t=await r(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_plants\n        WHERE id = '${m}'\n      )\n      WHERE rn = 1 AND is_deleted = 0\n    `);if(!t.length)throw n({statusCode:404,message:"Plant not found"});const e=t[0];return await r(`\n      INSERT INTO lab_plants (\n        timestamp, id, strain_id, seed_batch_id, zone_id, plant_code, pheno_label,\n        origin_type, parent_plant_id, project_goal, status, selection_status,\n        is_keeper, keeper_notes, sex, sex_confirmed_date,\n        date_started, date_to_veg, date_to_flower, date_harvested,\n        current_week, current_day, total_veg_days, total_flower_days,\n        final_height_cm, final_score, container_size, grow_medium,\n        nutrients_type, training_methods, cull_reason, cull_date,\n        hof_category, hof_notes, breeding_project_id, is_deleted\n      ) VALUES (\n        now(),\n        '${$}',\n        ${e.strain_id?`'${e.strain_id}'`:"NULL"},\n        ${e.seed_batch_id?`'${e.seed_batch_id}'`:"NULL"},\n        ${e.zone_id?`'${e.zone_id}'`:"NULL"},\n        '${e.plant_code}',\n        ${e.pheno_label?`'${e.pheno_label}'`:"NULL"},\n        '${e.origin_type||"seed"}',\n        ${e.parent_plant_id?`'${e.parent_plant_id}'`:"NULL"},\n        ${e.project_goal?`'${e.project_goal}'`:"NULL"},\n        '${e.status||"germinating"}',\n        '${e.selection_status||"active"}',\n        ${e.is_keeper?1:0},\n        ${e.keeper_notes?`'${e.keeper_notes}'`:"NULL"},\n        '${e.sex||"unknown"}',\n        ${e.sex_confirmed_date?`'${e.sex_confirmed_date}'`:"NULL"},\n        ${e.date_started?`'${e.date_started}'`:"NULL"},\n        ${e.date_to_veg?`'${e.date_to_veg}'`:"NULL"},\n        ${e.date_to_flower?`'${e.date_to_flower}'`:"NULL"},\n        ${e.date_harvested?`'${e.date_harvested}'`:"NULL"},\n        ${null!=(a=e.current_week)?a:1},\n        ${null!=(_=e.current_day)?_:1},\n        ${null!=(s=e.total_veg_days)?s:"NULL"},\n        ${null!=(i=e.total_flower_days)?i:"NULL"},\n        ${null!=(d=e.final_height_cm)?d:"NULL"},\n        ${null!=(l=e.final_score)?l:"NULL"},\n        ${null!=(p=e.container_size)?p:"NULL"},\n        ${e.grow_medium?`'${e.grow_medium}'`:"NULL"},\n        ${e.nutrients_type?`'${e.nutrients_type}'`:"NULL"},\n        ${e.training_methods?`'${e.training_methods}'`:"NULL"},\n        ${e.cull_reason?`'${e.cull_reason}'`:"NULL"},\n        ${e.cull_date?`'${e.cull_date}'`:"NULL"},\n        ${e.hof_category?`'${e.hof_category}'`:"NULL"},\n        ${e.hof_notes?`'${e.hof_notes}'`:"NULL"},\n        ${e.breeding_project_id?`'${e.breeding_project_id}'`:"NULL"},\n        1\n      )\n    `),{success:!0,id:$}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to delete plant:",t),n({statusCode:500,message:"Failed to delete plant"})}});export{a as default};
