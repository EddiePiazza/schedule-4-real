import{d as t,g as e,c as o}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as n,query as r}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const i=t(async t=>{var i,a,s;const l=e(t,"id");if(!l)throw o({statusCode:400,message:"Pollen record ID is required"});let d;try{d=n(l)}catch{throw o({statusCode:400,message:"Invalid pollen record ID format"})}try{const t=await r(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_pollen_storage\n        WHERE id = '${d}'\n      )\n      WHERE rn = 1\n    `);if(!t.length)throw o({statusCode:404,message:"Pollen record not found"});const e=t[0];if("depleted"===e.status)throw o({statusCode:404,message:"Pollen record not found"});const n=1e3*Date.now();return await r(`\n      INSERT INTO lab_pollen_storage (\n        timestamp, id, male_plant_id, strain_id, batch_code,\n        collection_date, quantity_grams, viability_at_collection,\n        last_viability_test, current_viability,\n        storage_method, storage_location, desiccant_type, container_type,\n        status, notes\n      ) VALUES (\n        ${n},\n        '${d}',\n        '${e.male_plant_id||""}',\n        '${e.strain_id||""}',\n        '${e.batch_code||""}',\n        '${e.collection_date||""}',\n        ${null!=(i=e.quantity_grams)?i:0},\n        ${null!=(a=e.viability_at_collection)?a:100},\n        '${e.last_viability_test||""}',\n        ${null!=(s=e.current_viability)?s:100},\n        '${e.storage_method||"refrigerated"}',\n        '${e.storage_location||""}',\n        '${e.desiccant_type||""}',\n        '${e.container_type||""}',\n        'depleted',\n        '${e.notes||""}'\n      )\n    `),{success:!0,id:d}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to delete pollen record:",t),o({statusCode:500,message:"Failed to delete pollen record"})}});export{i as default};
