import{d as e,g as t,c as s}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as n,query as i}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const o=e(async e=>{var o,a,r,d,p;const _=t(e,"id");if(!_)throw s({statusCode:400,message:"Observation ID is required"});let l;try{l=n(_)}catch{throw s({statusCode:400,message:"Invalid observation ID format"})}try{const e=await i(`\n      SELECT * FROM lab_observations\n      WHERE id = '${l}' AND is_deleted = 0\n      ORDER BY timestamp DESC\n      LIMIT 1\n    `);if(!e.length)throw s({statusCode:404,message:"Observation not found"});const t=e[0];return await i(`\n      INSERT INTO lab_observations (\n        timestamp, id, plant_id, observed_at, week_number, day_number, stage, obs_type,\n        height_cm, health_score, vigor_score, pest_issues, pest_details,\n        disease_issues, disease_details, deficiency_issues, deficiency_details,\n        watering_notes, feeding_notes, training_applied, general_notes,\n        photos, checklist_data, env_snapshot_id, is_deleted\n      ) VALUES (\n        now(),\n        '${l}',\n        '${t.plant_id}',\n        '${t.observed_at}',\n        ${null!=(o=t.week_number)?o:"NULL"},\n        ${null!=(a=t.day_number)?a:"NULL"},\n        ${t.stage?`'${t.stage}'`:"NULL"},\n        '${t.obs_type||"general"}',\n        ${null!=(r=t.height_cm)?r:"NULL"},\n        ${null!=(d=t.health_score)?d:"NULL"},\n        ${null!=(p=t.vigor_score)?p:"NULL"},\n        ${t.pest_issues?1:0},\n        ${t.pest_details?`'${t.pest_details}'`:"NULL"},\n        ${t.disease_issues?1:0},\n        ${t.disease_details?`'${t.disease_details}'`:"NULL"},\n        ${t.deficiency_issues?1:0},\n        ${t.deficiency_details?`'${t.deficiency_details}'`:"NULL"},\n        ${t.watering_notes?`'${t.watering_notes}'`:"NULL"},\n        ${t.feeding_notes?`'${t.feeding_notes}'`:"NULL"},\n        ${t.training_applied?`'${t.training_applied}'`:"NULL"},\n        ${t.general_notes?`'${t.general_notes}'`:"NULL"},\n        ${t.photos?`'${t.photos}'`:"NULL"},\n        ${t.checklist_data?`'${t.checklist_data}'`:"NULL"},\n        ${t.env_snapshot_id?`'${t.env_snapshot_id}'`:"NULL"},\n        1\n      )\n    `),{success:!0,id:_}}catch(e){if(e.statusCode)throw e;throw console.error("Failed to delete observation:",e),s({statusCode:500,message:"Failed to delete observation"})}});export{o as default};
