import{d as e,r as n,c as t}from"../../../nitro/nitro.mjs";import{query as i}from"../../../_/db.mjs";import{randomUUID as r}from"crypto";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const o=e(async e=>{var o,s,a,d,l,c,_,p,m,u;const g=await n(e);if(!g.name)throw t({statusCode:400,message:"Strain name is required"});const f=r();(new Date).toISOString();try{return await i(`\n      INSERT INTO lab_strains (\n        timestamp, id, name, generation, lineage, breeder, seed_type,\n        indica_ratio, expected_flowering_days, expected_thc, expected_cbd,\n        dominant_terpenes, grow_difficulty, description, breeder_notes,\n        acquisition_date, acquisition_source, total_seeds, seeds_remaining,\n        is_clone_only, is_deleted\n      ) VALUES (\n        now(),\n        '${f}',\n        '${g.name.replace(/'/g,"''")}',\n        ${g.generation?`'${g.generation}'`:"NULL"},\n        ${g.lineage?`'${g.lineage.replace(/'/g,"''")}'`:"NULL"},\n        ${g.breeder?`'${g.breeder.replace(/'/g,"''")}'`:"NULL"},\n        '${g.seed_type||"feminized"}',\n        ${null!=(o=g.indica_ratio)?o:50},\n        ${null!=(s=g.expected_flowering_days)?s:"NULL"},\n        ${null!=(a=g.expected_thc)?a:"NULL"},\n        ${null!=(d=g.expected_cbd)?d:"NULL"},\n        ${g.dominant_terpenes?`'${JSON.stringify(g.dominant_terpenes)}'`:"NULL"},\n        '${g.grow_difficulty||"moderate"}',\n        ${g.description?`'${g.description.replace(/'/g,"''")}'`:"NULL"},\n        ${g.breeder_notes?`'${g.breeder_notes.replace(/'/g,"''")}'`:"NULL"},\n        ${g.acquisition_date?`'${g.acquisition_date}'`:"NULL"},\n        ${g.acquisition_source?`'${g.acquisition_source.replace(/'/g,"''")}'`:"NULL"},\n        ${null!=(l=g.total_seeds)?l:"NULL"},\n        ${null!=(_=null!=(c=g.seeds_remaining)?c:g.total_seeds)?_:"NULL"},\n        ${g.is_clone_only?1:0},\n        0\n      )\n    `),{id:f,name:g.name,generation:g.generation||null,lineage:g.lineage||null,breeder:g.breeder||null,seed_type:g.seed_type||"feminized",indica_ratio:null!=(p=g.indica_ratio)?p:50,expected_flowering_days:g.expected_flowering_days||null,expected_thc:g.expected_thc||null,expected_cbd:g.expected_cbd||null,dominant_terpenes:g.dominant_terpenes||[],grow_difficulty:g.grow_difficulty||"moderate",description:g.description||null,breeder_notes:g.breeder_notes||null,acquisition_date:g.acquisition_date||null,acquisition_source:g.acquisition_source||null,total_seeds:g.total_seeds||null,seeds_remaining:null!=(u=null!=(m=g.seeds_remaining)?m:g.total_seeds)?u:null,is_clone_only:g.is_clone_only||!1,is_deleted:!1}}catch(e){throw console.error("Failed to create strain:",e),t({statusCode:500,message:"Failed to create strain"})}});export{o as default};
