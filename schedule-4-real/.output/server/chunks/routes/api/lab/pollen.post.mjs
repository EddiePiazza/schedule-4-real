import{d as t,r as i,c as n}from"../../../nitro/nitro.mjs";import{sanitizeUUID as o,query as e,sanitizeString as r,sanitizeFloat as a}from"../../../_/db.mjs";import{v4 as s}from"uuid";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const p=t(async t=>{const p=await i(t);if(!p.strain_id&&!p.male_plant_id)throw n({statusCode:400,message:"strain_id or male_plant_id is required"});try{const t=p.id?o(p.id):s(),i=1e3*Date.now(),n=p.batch_code||`POL-${Date.now().toString(36).toUpperCase()}`;return await e(`\n      INSERT INTO lab_pollen_storage (\n        timestamp,\n        id,\n        male_plant_id,\n        strain_id,\n        batch_code,\n        collection_date,\n        quantity_grams,\n        viability_at_collection,\n        last_viability_test,\n        current_viability,\n        storage_method,\n        storage_location,\n        desiccant_type,\n        container_type,\n        status,\n        notes\n      ) VALUES (\n        ${i},\n        '${t}',\n        '${r(p.male_plant_id||"")}',\n        '${r(p.strain_id||"")}',\n        '${r(n)}',\n        '${r(p.collection_date||(new Date).toISOString().split("T")[0])}',\n        ${a(String(p.quantity_grams||0))},\n        ${a(String(p.viability_at_collection||100))},\n        '${r(p.last_viability_test||"")}',\n        ${a(String(p.current_viability||p.viability_at_collection||100))},\n        '${r(p.storage_method||"refrigerated")}',\n        '${r(p.storage_location||"")}',\n        '${r(p.desiccant_type||"")}',\n        '${r(p.container_type||"")}',\n        '${r(p.status||"available")}',\n        '${r(p.notes||"")}'\n      )\n    `),{success:!0,id:t,batch_code:n}}catch(t){throw console.error("Failed to save pollen record:",t),n({statusCode:500,message:"Failed to save pollen record"})}});export{p as default};
