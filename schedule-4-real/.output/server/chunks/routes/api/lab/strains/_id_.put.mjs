import{d as e,g as n,r as t,c as i}from"../../../../nitro/nitro.mjs";import{query as o}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const r=e(async e=>{var r,s,d,a,l,_,c,p,u,m,g,f,L,$,y,b,w,h,N,x,U,q,E,S;const C=n(e,"id"),I=await t(e);if(!C)throw i({statusCode:400,message:"Strain ID is required"});try{const e=await o(`\n      SELECT * FROM lab_strains\n      WHERE id = '${C}' AND is_deleted = 0\n      ORDER BY timestamp DESC\n      LIMIT 1\n    `);if(!e.length)throw i({statusCode:404,message:"Strain not found"});const n=e[0],t={name:null!=(r=I.name)?r:n.name,generation:null!=(s=I.generation)?s:n.generation,lineage:null!=(d=I.lineage)?d:n.lineage,breeder:null!=(a=I.breeder)?a:n.breeder,seed_type:null!=(l=I.seed_type)?l:n.seed_type,indica_ratio:null!=(_=I.indica_ratio)?_:n.indica_ratio,expected_flowering_days:null!=(c=I.expected_flowering_days)?c:n.expected_flowering_days,expected_thc:null!=(p=I.expected_thc)?p:n.expected_thc,expected_cbd:null!=(u=I.expected_cbd)?u:n.expected_cbd,dominant_terpenes:null!=(m=I.dominant_terpenes)?m:n.dominant_terpenes,grow_difficulty:null!=(g=I.grow_difficulty)?g:n.grow_difficulty,description:null!=(f=I.description)?f:n.description,breeder_notes:null!=(L=I.breeder_notes)?L:n.breeder_notes,acquisition_date:null!=($=I.acquisition_date)?$:n.acquisition_date,acquisition_source:null!=(y=I.acquisition_source)?y:n.acquisition_source,total_seeds:null!=(b=I.total_seeds)?b:n.total_seeds,seeds_remaining:null!=(w=I.seeds_remaining)?w:n.seeds_remaining,is_clone_only:null!=(h=I.is_clone_only)?h:n.is_clone_only},escapeStr=e=>e?String(e).replace(/'/g,"''"):null;return await o(`\n      INSERT INTO lab_strains (\n        timestamp, id, name, generation, lineage, breeder, seed_type,\n        indica_ratio, expected_flowering_days, expected_thc, expected_cbd,\n        dominant_terpenes, grow_difficulty, description, breeder_notes,\n        acquisition_date, acquisition_source, total_seeds, seeds_remaining,\n        is_clone_only, is_deleted\n      ) VALUES (\n        now(),\n        '${C}',\n        '${escapeStr(t.name)}',\n        ${t.generation?`'${escapeStr(t.generation)}'`:"NULL"},\n        ${t.lineage?`'${escapeStr(t.lineage)}'`:"NULL"},\n        ${t.breeder?`'${escapeStr(t.breeder)}'`:"NULL"},\n        '${t.seed_type||"feminized"}',\n        ${null!=(N=t.indica_ratio)?N:50},\n        ${null!=(x=t.expected_flowering_days)?x:"NULL"},\n        ${null!=(U=t.expected_thc)?U:"NULL"},\n        ${null!=(q=t.expected_cbd)?q:"NULL"},\n        ${t.dominant_terpenes?`'${"string"==typeof t.dominant_terpenes?t.dominant_terpenes:JSON.stringify(t.dominant_terpenes)}'`:"NULL"},\n        '${t.grow_difficulty||"moderate"}',\n        ${t.description?`'${escapeStr(t.description)}'`:"NULL"},\n        ${t.breeder_notes?`'${escapeStr(t.breeder_notes)}'`:"NULL"},\n        ${t.acquisition_date?`'${t.acquisition_date}'`:"NULL"},\n        ${t.acquisition_source?`'${escapeStr(t.acquisition_source)}'`:"NULL"},\n        ${null!=(E=t.total_seeds)?E:"NULL"},\n        ${null!=(S=t.seeds_remaining)?S:"NULL"},\n        ${t.is_clone_only?1:0},\n        0\n      )\n    `),{id:C,...t,is_deleted:!1}}catch(e){if(e.statusCode)throw e;throw console.error("Failed to update strain:",e),i({statusCode:500,message:"Failed to update strain"})}});export{r as default};
