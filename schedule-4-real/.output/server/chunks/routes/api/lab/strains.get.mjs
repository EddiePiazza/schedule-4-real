import{d as t,a as r}from"../../../nitro/nitro.mjs";import{sanitizeInt as o,sanitizeString as e,query as n}from"../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const i=t(async t=>{var i,m;const p=r(t),s=p.search,a=Math.min(o(p.limit||"100"),500);try{let t="rn = 1 AND is_deleted = 0";if(s){const r=e(s);t+=` AND (name ILIKE '%${r}%' OR breeder ILIKE '%${r}%')`}return(await n(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_strains\n      )\n      WHERE ${t}\n      ORDER BY name ASC\n      LIMIT ${a}\n    `)).map(t=>({...t,dominant_terpenes:t.dominant_terpenes?JSON.parse(t.dominant_terpenes):[]}))}catch(t){return(null==(i=t.message)?void 0:i.includes("does not exist"))||(null==(m=t.message)?void 0:m.includes("table not found"))||console.error("Failed to fetch strains:",t),[]}});export{i as default};
