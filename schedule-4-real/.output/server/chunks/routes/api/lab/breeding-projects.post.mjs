import{d as t,r as e,c as n}from"../../../nitro/nitro.mjs";import{sanitizeUUID as o,query as r,sanitizeString as i,sanitizeInt as s}from"../../../_/db.mjs";import{v4 as a}from"uuid";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const p=t(async t=>{const p=await e(t);if(!p.name)throw n({statusCode:400,message:"Project name is required"});try{const t=p.id?o(p.id):a(),e=1e3*Date.now(),n=p.code||`BP-${Date.now().toString(36).toUpperCase()}`;return await r(`\n      INSERT INTO lab_breeding_projects (\n        timestamp,\n        id,\n        name,\n        code,\n        project_type,\n        status,\n        primary_goal,\n        target_traits,\n        traits_to_avoid,\n        female_strain_id,\n        male_strain_id,\n        female_plant_id,\n        male_plant_id,\n        started_at,\n        target_completion,\n        completed_at,\n        total_seeds_produced,\n        seeds_tested,\n        successful_phenos,\n        notes,\n        is_deleted\n      ) VALUES (\n        ${e},\n        '${t}',\n        '${i(p.name)}',\n        '${i(n)}',\n        '${i(p.project_type||"line_creation")}',\n        '${i(p.status||"active")}',\n        '${i(p.primary_goal||"")}',\n        '${JSON.stringify(p.target_traits||[])}',\n        '${JSON.stringify(p.traits_to_avoid||[])}',\n        '${i(p.female_strain_id||"")}',\n        '${i(p.male_strain_id||"")}',\n        '${i(p.female_plant_id||"")}',\n        '${i(p.male_plant_id||"")}',\n        '${i(p.started_at||(new Date).toISOString().split("T")[0])}',\n        '${i(p.target_completion||"")}',\n        '${i(p.completed_at||"")}',\n        ${s(String(p.total_seeds_produced||0))},\n        ${s(String(p.seeds_tested||0))},\n        ${s(String(p.successful_phenos||0))},\n        '${i(p.notes||"")}',\n        0\n      )\n    `),{success:!0,id:t,code:n}}catch(t){throw console.error("Failed to save breeding project:",t),n({statusCode:500,message:"Failed to save breeding project"})}});export{p as default};
