import{d as t,a as e}from"../../../nitro/nitro.mjs";import{sanitizeString as o,query as r}from"../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const i=t(async t=>{const i=e(t),s=i.status,n=Math.min(parseInt(i.limit)||100,500);try{let t="";s&&(t=` AND status = '${o(s)}'`);return(await r(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_grow_rooms\n      )\n      WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)${t}\n      ORDER BY sort_order ASC, name ASC\n      LIMIT ${n}\n    `)).map(t=>({...t,dimensions_cm:t.dimensions_cm?JSON.parse(t.dimensions_cm):null,device_macs:t.device_macs?JSON.parse(t.device_macs):[],light_ids:t.light_ids?JSON.parse(t.light_ids):[],outlet_ids:t.outlet_ids?JSON.parse(t.outlet_ids):[],sensor_ids:t.sensor_ids?JSON.parse(t.sensor_ids):[],active_plant_ids:t.active_plant_ids?JSON.parse(t.active_plant_ids):[],environment_profile:t.environment_profile?JSON.parse(t.environment_profile):null,layout_data:t.layout_data?JSON.parse(t.layout_data):null}))}catch(t){return console.error("Failed to fetch rooms:",t),[]}});export{i as default};
