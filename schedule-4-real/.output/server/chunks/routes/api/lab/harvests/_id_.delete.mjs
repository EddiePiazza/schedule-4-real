import{d as t,g as o,c as r}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as e,query as s,sanitizeString as i}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const a=t(async t=>{const a=o(t,"id");if(!a)throw r({statusCode:400,message:"Harvest ID is required"});let n;try{n=e(a)}catch{throw r({statusCode:400,message:"Invalid harvest ID format"})}try{const t=await s(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_harvest_data\n        WHERE id = '${n}'\n      )\n      WHERE rn = 1\n    `);if(!t.length)throw r({statusCode:404,message:"Harvest not found"});const o=t[0];return await s(`\n      INSERT INTO lab_harvest_data (\n        timestamp, id, plant_id, notes\n      ) VALUES (\n        now(),\n        '${n}',\n        '${i(o.plant_id)}',\n        '__DELETED__'\n      )\n    `),{success:!0,id:n}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to delete harvest:",t),r({statusCode:500,message:"Failed to delete harvest"})}});export{a as default};
