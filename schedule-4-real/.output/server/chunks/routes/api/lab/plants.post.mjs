import{d as t,r as e,c as n}from"../../../nitro/nitro.mjs";import{query as i}from"../../../_/db.mjs";import{randomUUID as r}from"crypto";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const a=t(async t=>{const a=await e(t);if(!a.strain_id&&!a.plant_code)throw n({statusCode:400,message:"Either strain_id or plant_code is required"});const o=r(),s=(new Date).toISOString();let _=a.plant_code;if(!_){_=`P-${Date.now().toString(36).toUpperCase()}`}try{return await i(`\n      INSERT INTO lab_plants (\n        timestamp, id, strain_id, seed_batch_id, zone_id, plant_code, pheno_label,\n        origin_type, parent_plant_id, project_goal, status, selection_status,\n        is_keeper, sex, date_started, current_week, current_day,\n        container_size, grow_medium, nutrients_type, training_methods,\n        is_deleted\n      ) VALUES (\n        now(),\n        '${o}',\n        ${a.strain_id?`'${a.strain_id}'`:"NULL"},\n        ${a.seed_batch_id?`'${a.seed_batch_id}'`:"NULL"},\n        ${a.zone_id?`'${a.zone_id}'`:"NULL"},\n        '${_}',\n        ${a.pheno_label?`'${a.pheno_label}'`:"NULL"},\n        '${a.origin_type||"seed"}',\n        ${a.parent_plant_id?`'${a.parent_plant_id}'`:"NULL"},\n        '${a.project_goal||"keeper"}',\n        '${a.status||"germinating"}',\n        'active',\n        0,\n        'unknown',\n        '${a.date_started||s.split("T")[0]}',\n        1,\n        1,\n        ${a.container_size||"NULL"},\n        ${a.grow_medium?`'${a.grow_medium}'`:"NULL"},\n        ${a.nutrients_type?`'${a.nutrients_type}'`:"NULL"},\n        ${a.training_methods?`'${JSON.stringify(a.training_methods)}'`:"NULL"},\n        0\n      )\n    `),await i(`\n      INSERT INTO lab_stage_log (\n        timestamp, id, plant_id, stage, started_at, notes\n      ) VALUES (\n        now(),\n        '${r()}',\n        '${o}',\n        '${a.status||"germinating"}',\n        '${a.date_started||s.split("T")[0]}',\n        'Plant created'\n      )\n    `),{id:o,strain_id:a.strain_id||null,seed_batch_id:a.seed_batch_id||null,zone_id:a.zone_id||null,plant_code:_,pheno_label:a.pheno_label||null,origin_type:a.origin_type||"seed",parent_plant_id:a.parent_plant_id||null,project_goal:a.project_goal||"keeper",status:a.status||"germinating",selection_status:"active",is_keeper:!1,sex:"unknown",date_started:a.date_started||s.split("T")[0],current_week:1,current_day:1,container_size:a.container_size||null,growing_medium:a.growing_medium||a.grow_medium||null,nutrients_type:a.nutrients_type||null,training_methods:a.training_methods||[],is_deleted:!1}}catch(t){throw console.error("Failed to create plant:",t),n({statusCode:500,message:"Failed to create plant"})}});export{a as default};
