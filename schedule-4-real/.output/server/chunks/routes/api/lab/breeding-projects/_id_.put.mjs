import{d as t,g as e,r as a,c as o}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as s,query as i,sanitizeString as r,sanitizeInt as d}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const _=t(async t=>{var _,n,p;const l=e(t,"id"),m=await a(t);if(!l)throw o({statusCode:400,message:"Breeding project ID is required"});let c;try{c=s(l)}catch{throw o({statusCode:400,message:"Invalid breeding project ID format"})}try{const t=await i(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_breeding_projects\n        WHERE id = '${c}'\n      )\n      WHERE rn = 1 AND is_deleted = 0\n    `);if(!t.length)throw o({statusCode:404,message:"Breeding project not found"});const e=t[0],a={name:void 0!==m.name?r(m.name):e.name,code:void 0!==m.code?r(m.code):e.code,project_type:void 0!==m.project_type?r(m.project_type):e.project_type,status:void 0!==m.status?r(m.status):e.status,primary_goal:void 0!==m.primary_goal?r(m.primary_goal):e.primary_goal,target_traits:void 0!==m.target_traits?JSON.stringify(m.target_traits):"string"==typeof e.target_traits?e.target_traits:JSON.stringify(e.target_traits||[]),traits_to_avoid:void 0!==m.traits_to_avoid?JSON.stringify(m.traits_to_avoid):"string"==typeof e.traits_to_avoid?e.traits_to_avoid:JSON.stringify(e.traits_to_avoid||[]),female_strain_id:void 0!==m.female_strain_id?r(m.female_strain_id):e.female_strain_id,male_strain_id:void 0!==m.male_strain_id?r(m.male_strain_id):e.male_strain_id,female_plant_id:void 0!==m.female_plant_id?r(m.female_plant_id):e.female_plant_id,male_plant_id:void 0!==m.male_plant_id?r(m.male_plant_id):e.male_plant_id,started_at:void 0!==m.started_at?r(m.started_at):e.started_at,target_completion:void 0!==m.target_completion?r(m.target_completion):e.target_completion,completed_at:void 0!==m.completed_at?r(m.completed_at):e.completed_at,total_seeds_produced:void 0!==m.total_seeds_produced?d(String(m.total_seeds_produced)):e.total_seeds_produced,seeds_tested:void 0!==m.seeds_tested?d(String(m.seeds_tested)):e.seeds_tested,successful_phenos:void 0!==m.successful_phenos?d(String(m.successful_phenos)):e.successful_phenos,notes:void 0!==m.notes?r(m.notes):e.notes},s=1e3*Date.now();return await i(`\n      INSERT INTO lab_breeding_projects (\n        timestamp, id, name, code, project_type, status,\n        primary_goal, target_traits, traits_to_avoid,\n        female_strain_id, male_strain_id, female_plant_id, male_plant_id,\n        started_at, target_completion, completed_at,\n        total_seeds_produced, seeds_tested, successful_phenos,\n        notes, is_deleted\n      ) VALUES (\n        ${s},\n        '${c}',\n        '${a.name||""}',\n        '${a.code||""}',\n        '${a.project_type||"line_creation"}',\n        '${a.status||"active"}',\n        '${a.primary_goal||""}',\n        '${a.target_traits}',\n        '${a.traits_to_avoid}',\n        '${a.female_strain_id||""}',\n        '${a.male_strain_id||""}',\n        '${a.female_plant_id||""}',\n        '${a.male_plant_id||""}',\n        '${a.started_at||""}',\n        '${a.target_completion||""}',\n        '${a.completed_at||""}',\n        ${null!=(_=a.total_seeds_produced)?_:0},\n        ${null!=(n=a.seeds_tested)?n:0},\n        ${null!=(p=a.successful_phenos)?p:0},\n        '${a.notes||""}',\n        0\n      )\n    `),{id:c,...a,is_deleted:!1}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to update breeding project:",t),o({statusCode:500,message:"Failed to update breeding project"})}});export{_ as default};
