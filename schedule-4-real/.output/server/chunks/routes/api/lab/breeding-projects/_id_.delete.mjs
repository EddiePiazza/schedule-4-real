import{d as t,g as e,c as r}from"../../../../nitro/nitro.mjs";import{sanitizeUUID as o,query as n}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const s=t(async t=>{var s,i,a;const d=e(t,"id");if(!d)throw r({statusCode:400,message:"Breeding project ID is required"});let p;try{p=o(d)}catch{throw r({statusCode:400,message:"Invalid breeding project ID format"})}try{const t=await n(`\n      SELECT * FROM (\n        SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n        FROM lab_breeding_projects\n        WHERE id = '${p}'\n      )\n      WHERE rn = 1 AND is_deleted = 0\n    `);if(!t.length)throw r({statusCode:404,message:"Breeding project not found"});const e=t[0],o=1e3*Date.now();return await n(`\n      INSERT INTO lab_breeding_projects (\n        timestamp, id, name, code, project_type, status,\n        primary_goal, target_traits, traits_to_avoid,\n        female_strain_id, male_strain_id, female_plant_id, male_plant_id,\n        started_at, target_completion, completed_at,\n        total_seeds_produced, seeds_tested, successful_phenos,\n        notes, is_deleted\n      ) VALUES (\n        ${o},\n        '${p}',\n        '${e.name||""}',\n        '${e.code||""}',\n        '${e.project_type||"line_creation"}',\n        '${e.status||"active"}',\n        '${e.primary_goal||""}',\n        '${"string"==typeof e.target_traits?e.target_traits:JSON.stringify(e.target_traits||[])}',\n        '${"string"==typeof e.traits_to_avoid?e.traits_to_avoid:JSON.stringify(e.traits_to_avoid||[])}',\n        '${e.female_strain_id||""}',\n        '${e.male_strain_id||""}',\n        '${e.female_plant_id||""}',\n        '${e.male_plant_id||""}',\n        '${e.started_at||""}',\n        '${e.target_completion||""}',\n        '${e.completed_at||""}',\n        ${null!=(s=e.total_seeds_produced)?s:0},\n        ${null!=(i=e.seeds_tested)?i:0},\n        ${null!=(a=e.successful_phenos)?a:0},\n        '${e.notes||""}',\n        1\n      )\n    `),{success:!0,id:p}}catch(t){if(t.statusCode)throw t;throw console.error("Failed to delete breeding project:",t),r({statusCode:500,message:"Failed to delete breeding project"})}});export{s as default};
