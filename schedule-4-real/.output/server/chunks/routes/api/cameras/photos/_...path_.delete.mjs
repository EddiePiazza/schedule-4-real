import{d as t,g as o,c as s,b as e}from"../../../../nitro/nitro.mjs";import{existsSync as r,unlinkSync as i,readdirSync as a,rmdirSync as p}from"fs";import{join as m,dirname as n,resolve as d}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const h=d(e(),"data","webcam"),f=t(async t=>{const e=o(t,"path");if(!e)throw s({statusCode:400,message:"Missing path"});if(e.includes("..")||e.includes("~"))throw s({statusCode:400,message:"Invalid path"});const d=e.split("/");if(4!==d.length)throw s({statusCode:400,message:"Invalid photo path"});const[f,c,l,u]=d;if(!f||!["manual","timelapse"].includes(c))throw s({statusCode:400,message:"Invalid path components"});if(!/^\d{4}-\d{2}-\d{2}$/.test(l))throw s({statusCode:400,message:"Invalid date format"});if(!u.endsWith(".jpg"))throw s({statusCode:400,message:"Only JPEG files can be deleted"});const g=m(h,f,c,l,u);if(!r(g))throw s({statusCode:404,message:"Photo not found"});i(g);const w=n(g);try{0===a(w).length&&p(w)}catch{}return{success:!0}});export{f as default};
