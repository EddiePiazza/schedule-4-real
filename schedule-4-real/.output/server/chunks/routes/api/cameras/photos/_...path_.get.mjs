import{d as t,g as o,c as e,s,f as i,b as r}from"../../../../nitro/nitro.mjs";import{existsSync as a,readFileSync as p}from"fs";import{join as n,resolve as m}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const d=m(r(),"data","webcam"),h=t(async t=>{const r=o(t,"path");if(!r)throw e({statusCode:400,message:"Missing path"});if(r.includes("..")||r.includes("~"))throw e({statusCode:400,message:"Invalid path"});const m=r.split("/");if(4!==m.length)throw e({statusCode:400,message:"Invalid photo path"});const[h,f,l,g]=m;if(!h||!["manual","timelapse"].includes(f))throw e({statusCode:400,message:"Invalid path components"});if(!/^\d{4}-\d{2}-\d{2}$/.test(l))throw e({statusCode:400,message:"Invalid date format"});if(!g.endsWith(".jpg"))throw e({statusCode:400,message:"Only JPEG files are served"});const u=n(d,h,f,l,g);if(!a(u))throw e({statusCode:404,message:"Photo not found"});const c=p(u);return s(t,{"Content-Type":"image/jpeg","Content-Length":String(c.length),"Cache-Control":"public, max-age=86400"}),i(t,c,"image/jpeg")});export{h as default};
