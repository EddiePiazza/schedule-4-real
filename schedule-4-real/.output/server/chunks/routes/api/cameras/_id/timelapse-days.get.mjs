import{d as t,g as o,c as e,b as r}from"../../../../nitro/nitro.mjs";import{existsSync as i,readdirSync as s,statSync as a}from"fs";import{join as p,resolve as m}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const n=m(r(),"data","webcam"),d=m(r(),"data","webcam-videos"),l=t(async t=>{const r=o(t,"id");if(!r||r.includes("..")||r.includes("/"))throw e({statusCode:400,message:"Invalid camera id"});const m=p(n,r,"timelapse");if(!i(m))return{days:[],totalPhotos:0,totalVideoSize:0,hasExport:!1};const l=[];let c=0,f=0;try{const t=s(m).filter(t=>/^\d{4}-\d{2}-\d{2}$/.test(t)).sort().reverse();for(const o of t){const t=p(m,o),e=s(t).filter(t=>t.endsWith(".jpg"));let n=0;for(const o of e)try{n+=a(p(t,o)).size}catch{}let h,u=!1,v=0;if(i(d)){const t=s(d).filter(t=>t.startsWith(`${r}_${o}_`)&&t.endsWith(".mp4"));if(t.length>0){u=!0,h=`/api/cameras/timelapse-videos/${t[0]}`;try{v=a(p(d,t[0])).size}catch{}f+=v}}c+=e.length,l.push({date:o,photoCount:e.length,photoSize:n,hasVideo:u,videoUrl:h,videoSize:v})}}catch(t){console.error(`[Camera] Error reading timelapse days for ${r}:`,null==t?void 0:t.message)}let h,u=!1,v=0;if(i(d)){const t=`${r}_full_timelapse.mp4`,o=p(d,t);if(i(o)){u=!0,h=`/api/cameras/timelapse-videos/${t}`;try{v=a(o).size}catch{}}}return{days:l,totalPhotos:c,totalVideoSize:f,hasExport:u,exportUrl:h,exportSize:v}});export{l as default};
