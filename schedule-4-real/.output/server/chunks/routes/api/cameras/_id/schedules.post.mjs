import{d as t,g as e,c as s,r as i}from"../../../../nitro/nitro.mjs";import{randomUUID as r}from"crypto";import{c as a,e as o}from"../../../../_/cameras.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../../../../_/db.mjs";import"pg";const m=t(async t=>{const m=e(t,"id");if(!m)throw s({statusCode:400,message:"Missing camera id"});const n=await i(t)||{},d=parseInt(n.interval_minutes)||30;if(d<1||d>1440)throw s({statusCode:400,message:"Interval must be between 1 and 1440 minutes"});const p=/^([01]\d|2[0-3]):[0-5]\d$/;if(n.start_time&&!p.test(n.start_time))throw s({statusCode:400,message:"Invalid start_time format (HH:MM)"});if(n.end_time&&!p.test(n.end_time))throw s({statusCode:400,message:"Invalid end_time format (HH:MM)"});const u=["all","mon","tue","wed","thu","fri","sat","sun"],c=n.days_active||"all";if(!c.split(",").map(t=>t.trim().toLowerCase()).every(t=>u.includes(t)))throw s({statusCode:400,message:"Invalid days_active"});if((await a(m)).length>=3)throw s({statusCode:400,message:"Maximum 3 schedules per camera"});const l={id:r(),camera_id:m,enabled:!1!==n.enabled,interval_minutes:d,start_time:n.start_time||"",end_time:n.end_time||"",days_active:c};return await o(l),{success:!0,schedule:l}});export{m as default};
