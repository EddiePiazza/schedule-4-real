import{d as t,g as o,c as e,r as s,b as i}from"../../../../nitro/nitro.mjs";import{existsSync as r,readdirSync as n,statSync as d,unlinkSync as p,rmdirSync as a}from"fs";import{join as m,resolve as c}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const l=c(i(),"data","webcam"),f=c(i(),"data","webcam-videos"),h=t(async t=>{const i=o(t,"id");if(!i||i.includes("..")||i.includes("/"))throw e({statusCode:400,message:"Invalid camera id"});const c=await s(t)||{},h=c.action,u=c.dates||[];if(!["photos","videos","all"].includes(h))throw e({statusCode:400,message:"Invalid action (photos|videos|all)"});let v=0,b=0,y=0;const g=m(l,i,"timelapse");if(("photos"===h||"all"===h)&&r(g)){const t=n(g).filter(t=>/^\d{4}-\d{2}-\d{2}$/.test(t)).filter(t=>0===u.length||u.includes(t));for(const o of t){if("photos"===h){let t=!1;if(r(f)&&(t=n(f).some(t=>t.startsWith(`${i}_${o}_`)&&t.endsWith(".mp4"))),!t)continue}const t=m(g,o),e=n(t).filter(t=>t.endsWith(".jpg"));for(const o of e){const e=m(t,o);try{y+=d(e).size,p(e),v++}catch{}}try{0===n(t).length&&a(t)}catch{}}}if(("videos"===h||"all"===h)&&r(f)){const t=n(f).filter(t=>t.startsWith(`${i}_`)&&t.endsWith(".mp4")).filter(t=>0===u.length||!t.includes("_full_")&&u.some(o=>t.includes(o)));for(const o of t){const t=m(f,o);try{y+=d(t).size,p(t),b++}catch{}}}return{success:!0,photosDeleted:v,videosDeleted:b,bytesFreed:y,bytesFreedMB:(y/1024/1024).toFixed(1)}});export{h as default};
