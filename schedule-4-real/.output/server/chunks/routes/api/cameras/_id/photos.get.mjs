import{d as t,g as o,c as r,a as e,b as s}from"../../../../nitro/nitro.mjs";import{existsSync as i,readdirSync as p,statSync as a}from"fs";import{join as m,resolve as n}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const l=n(s(),"data","webcam"),d=t(async t=>{const s=o(t,"id");if(!s||s.includes("..")||s.includes("/"))throw r({statusCode:400,message:"Invalid camera id"});const n=e(t),d="timelapse"===n.type?"timelapse":"manual",c=Math.min(parseInt(String(n.limit))||50,200),f=m(l,s,d);if(!i(f))return{photos:[],total:0};const h=[];try{const t=p(f).filter(t=>/^\d{4}-\d{2}-\d{2}$/.test(t)).sort().reverse();for(const o of t){if(h.length>=c)break;const t=m(f,o),r=p(t).filter(t=>t.endsWith(".jpg")).sort().reverse();for(const e of r){if(h.length>=c)break;const r=m(t,e),i=a(r),p=e.replace(".jpg",""),n=`${s}/${d}/${o}/${e}`;h.push({path:n,filename:e,date:o,time:p.replace(/-/g,":"),size:i.size,type:d,url:`/api/cameras/photos/${n}`})}}}catch(t){console.error(`[Camera] Error reading photos for ${s}:`,null==t?void 0:t.message)}return{photos:h,total:h.length}});export{d as default};
