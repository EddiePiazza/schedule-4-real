import{d as t,g as o,c as e,h as r,i as s}from"../../../../nitro/nitro.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";const p=t(async t=>{const p=o(t,"id");if(!p)throw e({statusCode:400,message:"Camera ID required"});try{const o=await fetch(`http://127.0.0.1:1984/api/stream.mp4?src=${encodeURIComponent(p)}`);if(!o.ok)throw e({statusCode:o.status,message:`go2rtc error: ${o.statusText}`});return r(t,"Content-Type",o.headers.get("content-type")||"video/mp4"),r(t,"Cache-Control","no-cache, no-store"),r(t,"Connection","keep-alive"),s(t,o.body)}catch(t){if(t.statusCode)throw t;throw e({statusCode:502,message:`go2rtc unreachable: ${t.message}`})}});export{p as default};
