import{d as t,g as o,c as e}from"../../../../nitro/nitro.mjs";import{f as r}from"../../../../_/cameras.mjs";import{query as s,sanitizeString as i}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const m=t(async t=>{const m=o(t,"scheduleId");if(!m)throw e({statusCode:400,message:"Missing schedule id"});const p=await s(`\n    SELECT * FROM (\n      SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n      FROM camera_timelapse_schedules\n    )\n    WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n      AND id = '${i(m)}'\n  `);if(!p||0===p.length)throw e({statusCode:404,message:"Schedule not found"});return await r(m),{success:!0}});export{m as default};
