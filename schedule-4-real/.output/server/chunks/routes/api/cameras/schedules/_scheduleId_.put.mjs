import{d as t,g as e,c as s,r as i}from"../../../../nitro/nitro.mjs";import{e as a}from"../../../../_/cameras.mjs";import{query as r,sanitizeString as o}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const m=t(async t=>{const m=e(t,"scheduleId");if(!m)throw s({statusCode:400,message:"Missing schedule id"});const n=await r(`\n    SELECT * FROM (\n      SELECT *, ROW_NUMBER() OVER (PARTITION BY id ORDER BY timestamp DESC) as rn\n      FROM camera_timelapse_schedules\n    )\n    WHERE rn = 1 AND (is_deleted = 0 OR is_deleted IS NULL)\n      AND id = '${o(m)}'\n  `);if(!n||0===n.length)throw s({statusCode:404,message:"Schedule not found"});const d=n[0],p=await i(t)||{};if(void 0!==p.interval_minutes){const t=parseInt(p.interval_minutes);if(isNaN(t)||t<1||t>1440)throw s({statusCode:400,message:"Interval must be between 1 and 1440 minutes"})}const _=/^([01]\d|2[0-3]):[0-5]\d$/;if(p.start_time&&!_.test(p.start_time))throw s({statusCode:400,message:"Invalid start_time format (HH:MM)"});if(p.end_time&&!_.test(p.end_time))throw s({statusCode:400,message:"Invalid end_time format (HH:MM)"});if(p.days_active){const t=["all","mon","tue","wed","thu","fri","sat","sun"];if(!p.days_active.split(",").map(t=>t.trim().toLowerCase()).every(e=>t.includes(e)))throw s({statusCode:400,message:"Invalid days_active"})}const l={id:m,camera_id:d.camera_id,enabled:void 0!==p.enabled?!!p.enabled:1===d.enabled,interval_minutes:void 0!==p.interval_minutes?parseInt(p.interval_minutes):d.interval_minutes,start_time:void 0!==p.start_time?p.start_time:d.start_time||"",end_time:void 0!==p.end_time?p.end_time:d.end_time||"",days_active:void 0!==p.days_active?p.days_active:d.days_active||"all"};return await a(l),{success:!0,schedule:l}});export{m as default};
