import{d as t,g as o,c as r,h as e}from"../../../../nitro/nitro.mjs";import{l as s}from"../../../../_/cameras.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../../../../_/db.mjs";import"pg";const a=t(async t=>{const a=o(t,"id"),p=(await s()).find(t=>t.id===a);if(!p)throw r({statusCode:404,message:"Camera not found"});try{const o=await fetch(`http://127.0.0.1:1984/api/frame.jpeg?src=${encodeURIComponent(p.id)}`);if(!o.ok)throw r({statusCode:o.status,message:"Snapshot unavailable"});const s=await o.arrayBuffer();return e(t,"Content-Type","image/jpeg"),e(t,"Cache-Control","no-cache"),Buffer.from(s)}catch(t){if(t.statusCode)throw t;throw r({statusCode:502,message:`go2rtc unreachable: ${t.message}`})}});export{a as default};
