import{d as t,g as e,c as o,e as s,j as n,s as r,i,b as p}from"../../../../nitro/nitro.mjs";import{existsSync as a,statSync as m,createReadStream as d}from"fs";import{join as c,basename as f,resolve as l}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const g=l(p(),"data","webcam-videos"),u=t(async t=>{const p=e(t,"filename");if(!p)throw o({statusCode:400,message:"Missing filename"});if(p.includes("..")||p.includes("/"))throw o({statusCode:400,message:"Invalid filename"});if(!p.endsWith(".mp4"))throw o({statusCode:400,message:"Only MP4 files are served"});const l=c(g,f(p));if(!a(l))throw o({statusCode:404,message:"Video not found"});const u=m(l).size,h=s(t,"range");if(h){const e=h.replace(/bytes=/,"").split("-"),o=parseInt(e[0],10),s=e[1]?parseInt(e[1],10):u-1,p=s-o+1;return n(t,206),r(t,{"Content-Range":`bytes ${o}-${s}/${u}`,"Accept-Ranges":"bytes","Content-Length":String(p),"Content-Type":"video/mp4","Cache-Control":"public, max-age=86400"}),i(t,d(l,{start:o,end:s}))}return r(t,{"Content-Type":"video/mp4","Content-Length":String(u),"Accept-Ranges":"bytes","Cache-Control":"public, max-age=86400"}),i(t,d(l))});export{u as default};
