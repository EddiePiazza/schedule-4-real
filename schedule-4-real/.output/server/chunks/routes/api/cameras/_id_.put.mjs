import{d as t,g as o,r,c as i}from"../../../nitro/nitro.mjs";import{l as e,s as p}from"../../../_/cameras.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"../../../_/db.mjs";import"pg";const s=t(async t=>{const s=o(t,"id"),a=await r(t),m=(await e()).find(t=>t.id===s);if(!m)throw i({statusCode:404,message:"Camera not found"});return void 0!==a.name&&(m.name=String(a.name).slice(0,50)),void 0!==a.protocol&&["rtsp","rtsp-tcp","onvif","http-mjpeg"].includes(a.protocol)&&(m.protocol=a.protocol),void 0!==a.host&&(m.host=String(a.host).slice(0,255)),void 0!==a.port&&(m.port=Math.max(1,Math.min(65535,parseInt(a.port)||m.port))),void 0!==a.path&&(m.path=String(a.path).slice(0,500)),void 0!==a.username&&(m.username=String(a.username).slice(0,100)),void 0!==a.password&&(m.password=String(a.password).slice(0,100)),void 0!==a.enabled&&(m.enabled=Boolean(a.enabled)),void 0!==a.order&&(m.order=parseInt(a.order)||0),await p(m),await async function(){try{await fetch("http://127.0.0.1:1985/reload",{method:"POST"})}catch{}}(),{success:!0,camera:m}});export{s as default};
