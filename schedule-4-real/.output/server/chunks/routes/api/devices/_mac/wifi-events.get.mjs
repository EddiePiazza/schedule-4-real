import{d as t,g as e,a as r,c as o}from"../../../../nitro/nitro.mjs";import{query as s}from"../../../../_/db.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const i=t(async t=>{var i;const m=e(t,"mac"),p=r(t),n=parseInt(p.limit)||50;if(!m)throw o({statusCode:400,message:"MAC address is required"});try{return{mac:m,events:await s(`\n      SELECT timestamp, event_type, rssi, duration_seconds\n      FROM device_wifi_events\n      WHERE mac = '${m}'\n      ORDER BY timestamp DESC\n      LIMIT ${n}\n    `)||[]}}catch(t){if(null==(i=t.message)?void 0:i.includes("does not exist"))return{mac:m,events:[]};throw console.error("Error fetching WiFi events:",t.message),o({statusCode:500,message:"Failed to fetch WiFi events"})}});export{i as default};
