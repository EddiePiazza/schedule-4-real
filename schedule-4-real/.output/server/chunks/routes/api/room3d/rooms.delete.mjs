import{d as t,r as o,c as r,b as s}from"../../../nitro/nitro.mjs";import{readFile as i,writeFile as e,unlink as m}from"fs/promises";import{join as a}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const p=t(async t=>{const p=await o(t);if(!p||"string"!=typeof p.id)throw r({statusCode:400,message:"id (string) required"});const n="system"===p.source?"system":"user",d=a(s(),"data","system"===n?"appdata":"room3d","models","rooms","rooms.json");let c=[];try{c=JSON.parse(await i(d,"utf-8"))}catch{return{ok:!0}}const f=c.findIndex(t=>t.id===p.id);if(f<0)return{ok:!0};const u=c.splice(f,1)[0];if(await e(d,JSON.stringify(c,null,2),"utf-8"),"user"===n&&u.file){const t=u.file.replace(/^\/user-rooms\//,"");if(t&&!t.includes("..")){const o=a(s(),"data","room3d","models","rooms",t);try{await m(o)}catch{}}if(u.image){const t=u.image.replace(/^\/user-rooms\//,"");if(t&&!t.includes("..")){const o=a(s(),"data","room3d","models","rooms",t);try{await m(o)}catch{}}}}return{ok:!0}});export{p as default};
