import{d as t,r as o,c as r,b as a}from"../../../nitro/nitro.mjs";import{mkdir as e,readFile as i,writeFile as s}from"fs/promises";import{join as n}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const p=t(async t=>{const p=await o(t);if(!p||"string"!=typeof p.filename||!p.rotation||"number"!=typeof p.rotation.x)throw r({statusCode:400,message:"filename (string) and rotation ({ x, y, z }) required"});const m=p.filename.replace(/[^a-zA-Z0-9._-]/g,"");if(!m.endsWith(".glb"))throw r({statusCode:400,message:"Invalid filename"});const d=!0===p.system,f=d?n(a(),"data","appdata","defaults"):n(a(),"data","room3d");await e(f,{recursive:!0});const u=n(f,"asset-rotations.json");let l={};const c=d?n(a(),"data","room3d"):n(a(),"data","appdata","defaults");for(const t of[u,n(c,"asset-rotations.json")])try{l=JSON.parse(await i(t,"utf-8"));break}catch{}return l[m]={x:Math.round(1e4*p.rotation.x)/1e4,y:Math.round(1e4*p.rotation.y)/1e4,z:Math.round(1e4*p.rotation.z)/1e4},await s(u,JSON.stringify(l,null,2),"utf-8"),{ok:!0,rotations:l}});export{p as default};
