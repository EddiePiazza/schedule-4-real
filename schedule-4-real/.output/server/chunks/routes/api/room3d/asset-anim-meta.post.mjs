import{d as t,r as o,c as a,b as e}from"../../../nitro/nitro.mjs";import{mkdir as r,readFile as s,writeFile as n}from"fs/promises";import{join as i}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=t(async t=>{const m=await o(t);if(!m||"string"!=typeof m.filename||"boolean"!=typeof m.onIsEnd)throw a({statusCode:400,message:"filename (string) and onIsEnd (boolean) required"});const p=m.filename.replace(/[^a-zA-Z0-9._-]/g,"");if(!p.endsWith(".glb"))throw a({statusCode:400,message:"Invalid filename"});const d=!0===m.system,f=d?i(e(),"data","appdata","defaults"):i(e(),"data","room3d");await r(f,{recursive:!0});const l=i(f,"asset-anim-meta.json");let c={};const u=d?i(e(),"data","room3d"):i(e(),"data","appdata","defaults");for(const t of[l,i(u,"asset-anim-meta.json")])try{c=JSON.parse(await s(t,"utf-8"));break}catch{}return c[p]={onIsEnd:m.onIsEnd},await n(l,JSON.stringify(c,null,2),"utf-8"),{ok:!0,meta:c}});export{m as default};
