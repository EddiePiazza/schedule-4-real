import{d as t,r as e,c as o,b as r}from"../../../nitro/nitro.mjs";import{mkdir as s,readFile as a,writeFile as i}from"fs/promises";import{join as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=t(async t=>{const m=await e(t);if(!m||"string"!=typeof m.filename||"number"!=typeof m.scale)throw o({statusCode:400,message:"filename (string) and scale (number) required"});const n=m.filename.replace(/[^a-zA-Z0-9._-]/g,"");if(!n.endsWith(".glb"))throw o({statusCode:400,message:"Invalid filename"});const f=p(r(),"data","appdata","defaults");await s(f,{recursive:!0});const d=p(f,"asset-scales.json");let l={};for(const t of[d,p(r(),"data","room3d","asset-scales.json")])try{l=JSON.parse(await a(t,"utf-8"));break}catch{}return l[n]=Math.round(1e4*m.scale)/1e4,await i(d,JSON.stringify(l,null,2),"utf-8"),{ok:!0,scales:l}});export{m as default};
