import{d as t,r as o,c as i,b as e}from"../../../nitro/nitro.mjs";import{mkdir as r,readFile as s,writeFile as m}from"fs/promises";import{join as a}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const p=t(async t=>{const p=await o(t);if(!p||"string"!=typeof p.id||!p.id.trim())throw i({statusCode:400,message:"id (string) required"});const n="system"===p.source?"system":"user",d=a(e(),"data","system"===n?"appdata":"room3d","models","rooms","rooms.json"),f=a(e(),"data","system"===n?"appdata":"room3d","models","rooms");await r(f,{recursive:!0});let c=[];try{c=JSON.parse(await s(d,"utf-8"))}catch{}const l=p.id.replace(/[^a-zA-Z0-9._-]/g,"_"),u=c.findIndex(t=>t.id===l),h={id:l,name:(p.name||l).slice(0,100),description:(p.description||"").slice(0,500),file:p.file||"",size:p.size||"",icon:p.icon||"CubeIcon"};return p.image&&(h.image=p.image),"boolean"==typeof p.animated&&(h.animated=p.animated),"boolean"==typeof p.hidden&&(h.hidden=p.hidden),u>=0?c[u]=h:c.push(h),await m(d,JSON.stringify(c,null,2),"utf-8"),{ok:!0,room:h}});export{p as default};
