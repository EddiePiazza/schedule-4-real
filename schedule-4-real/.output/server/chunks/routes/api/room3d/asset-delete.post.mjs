import{d as t,r as s,c as e,b as o}from"../../../nitro/nitro.mjs";import{stat as r,unlink as i}from"fs/promises";import{join as a}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=t(async t=>{const m=await s(t);if(!m||"string"!=typeof m.path||"string"!=typeof m.source)throw e({statusCode:400,message:'path (string) and source ("system" | "user") required'});const p=m.path,n=m.source,d=!0===m.isAdmin;if(p.includes("..")||p.includes("\\")||p.startsWith("/"))throw e({statusCode:400,message:"Invalid path"});if(!p.toLowerCase().endsWith(".glb"))throw e({statusCode:400,message:"Only .glb files can be deleted"});if("system"===n&&!d)throw e({statusCode:403,message:"Only administrators can delete system models"});const f=a(o(),"data","system"===n?"appdata":"room3d","models","assets"),h=a(f,p);if(!h.startsWith(f))throw e({statusCode:400,message:"Invalid path"});try{if(!(await r(h)).isFile())throw new Error("Not a file")}catch{throw e({statusCode:404,message:"File not found"})}return await i(h),{ok:!0,deleted:p}});export{m as default};
