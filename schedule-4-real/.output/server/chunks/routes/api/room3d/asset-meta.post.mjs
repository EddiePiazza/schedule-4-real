import{d as t,r as o,c as e,b as r}from"../../../nitro/nitro.mjs";import{mkdir as a,readFile as s,writeFile as i}from"fs/promises";import{join as m}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const p=t(async t=>{const p=await o(t);if(!p||"string"!=typeof p.filename||!p.meta||"object"!=typeof p.meta)throw e({statusCode:400,message:"filename (string) and meta (object) required"});const n=p.filename.replace(/[^a-zA-Z0-9._-]/g,"");if(!n.endsWith(".glb"))throw e({statusCode:400,message:"Invalid filename"});const f=m(r(),"data","appdata","defaults");await a(f,{recursive:!0});const d=m(f,"asset-meta.json");let c={};for(const t of[d,m(r(),"data","room3d","asset-meta.json")])try{c=JSON.parse(await s(t,"utf-8"));break}catch{}return c[n]={...c[n]||{},...p.meta},await i(d,JSON.stringify(c,null,2),"utf-8"),{ok:!0}});export{p as default};
