import{d as t,r as e,c as r,b as a}from"../../../nitro/nitro.mjs";import{mkdir as o,readFile as i,writeFile as s}from"fs/promises";import{join as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const n=t(async t=>{const n=await e(t);if(!n||"string"!=typeof n.filename||"number"!=typeof n.scaleMultiplier)throw r({statusCode:400,message:"filename (string) and scaleMultiplier (number) required"});const m=n.filename.replace(/[^a-zA-Z0-9._\- ]/g,"").trim();if(!m)throw r({statusCode:400,message:"Invalid filename"});const l=!0===n.system,f=l?p(a(),"data","appdata","defaults"):p(a(),"data","room3d");await o(f,{recursive:!0});const d=p(f,"character-calibration.json");let c={};const u=l?p(a(),"data","room3d"):p(a(),"data","appdata","defaults");for(const t of[d,p(u,"character-calibration.json")])try{c=JSON.parse(await i(t,"utf-8"));break}catch{}return c[m]={scaleMultiplier:Math.round(1e4*n.scaleMultiplier)/1e4,yOffset:Math.round(1e4*(n.yOffset||0))/1e4,labelOffset:Math.round(1e4*(n.labelOffset||0))/1e4},await s(d,JSON.stringify(c,null,2),"utf-8"),{ok:!0,calibrations:c}});export{n as default};
