import{d as t,a as e,l as o,c as a}from"../../../nitro/nitro.mjs";import{mkdir as i,writeFile as r}from"fs/promises";import{extname as s,join as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=new Set([".jpg",".jpeg",".png",".gif",".webp",".svg",".mp4",".webm"]),d=t(async t=>{const d=e(t),n="1"===d.editor||"true"===d.editor,l=await o(t);if(!l||0===l.length)throw a({statusCode:400,message:"No file uploaded"});const f=l.find(t=>"file"===t.name);if(!f||!f.data||!f.filename)throw a({statusCode:400,message:"No image file in upload"});const g=s(f.filename).toLowerCase();if(!m.has(g))throw a({statusCode:400,message:`Only image/video files allowed (${[...m].join(", ")})`});if(f.data.length>52428800)throw a({statusCode:400,message:"File too large (max 50 MB)"});const h=p(process.cwd(),"data",n?"appdata":"room3d","display-images"),u=n?"/appdata-display-images/":"/room3d-display-images/",w=f.filename.replace(/[^a-zA-Z0-9._-]/g,"_").toLowerCase();return await i(h,{recursive:!0}),await r(p(h,w),f.data),{ok:!0,name:w,path:`${u}${w}`}});export{d as default};
