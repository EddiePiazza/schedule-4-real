import{d as t,l as o,c as e}from"../../../nitro/nitro.mjs";import{mkdir as a,writeFile as i}from"fs/promises";import{extname as r,join as s}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=s(process.cwd(),"data","room3d","display-images"),p=new Set([".jpg",".jpeg",".png",".gif",".webp",".svg",".mp4",".webm"]),n=t(async t=>{const n=await o(t);if(!n||0===n.length)throw e({statusCode:400,message:"No file uploaded"});const d=n.find(t=>"file"===t.name);if(!d||!d.data||!d.filename)throw e({statusCode:400,message:"No image file in upload"});const l=r(d.filename).toLowerCase();if(!p.has(l))throw e({statusCode:400,message:`Only image/video files allowed (${[...p].join(", ")})`});if(d.data.length>52428800)throw e({statusCode:400,message:"File too large (max 50 MB)"});const f=d.filename.replace(/[^a-zA-Z0-9._-]/g,"_").toLowerCase();return await a(m,{recursive:!0}),await i(s(m,f),d.data),{ok:!0,name:f,path:`/room3d-display-images/${f}`}});export{n as default};
