import{d as t,l as o,c as e,b as r}from"../../../nitro/nitro.mjs";import{mkdir as s,writeFile as a}from"fs/promises";import{join as i}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=t(async t=>{var m;const p=await o(t);if(!p||0===p.length)throw e({statusCode:400,message:"No file uploaded"});const n=p.find(t=>"file"===t.name),d=p.find(t=>"isAdmin"===t.name);if(!n||!n.data||!n.filename)throw e({statusCode:400,message:"No file in upload"});const l=n.filename,f=l.toLowerCase().split(".").pop()||"",u=["glb","webp","jpg","jpeg","png"];if(!u.includes(f))throw e({statusCode:400,message:`Only ${u.join(", ")} files are allowed`});const c=l.replace(/[^a-zA-Z0-9._-]/g,"_").toLowerCase();if(n.data.length>104857600)throw e({statusCode:400,message:"File too large (max 100 MB)"});const g="true"===(null==(m=null==d?void 0:d.data)?void 0:m.toString()),h=i(r(),"data",g?"appdata":"room3d","models","rooms");await s(h,{recursive:!0});const w=i(h,c);await a(w,n.data);return{ok:!0,path:g?`/models/rooms/${c}`:`/user-rooms/${c}`,filename:c,source:g?"system":"user",size:n.data.length}});export{m as default};
