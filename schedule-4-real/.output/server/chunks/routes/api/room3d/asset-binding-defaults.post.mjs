import{d as t,r as i,c as e,b as o}from"../../../nitro/nitro.mjs";import{mkdir as n,readFile as r,writeFile as a}from"fs/promises";import{join as s}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const d=t(async t=>{const d=await i(t);if(!d||"string"!=typeof d.filename)throw e({statusCode:400,message:"filename (string) required"});const p=d.filename.replace(/[^a-zA-Z0-9._-]/g,"");if(!p.endsWith(".glb"))throw e({statusCode:400,message:"Invalid filename"});const m=!0===d.system,f=m?s(o(),"data","appdata","defaults"):s(o(),"data","room3d");await n(f,{recursive:!0});const c=s(f,"asset-binding-defaults.json");let l={};const g=m?s(o(),"data","room3d"):s(o(),"data","appdata","defaults");for(const t of[c,s(g,"asset-binding-defaults.json")])try{l=JSON.parse(await r(t,"utf-8"));break}catch{}return d.binding&&"object"==typeof d.binding?l[p]={deviceType:d.binding.deviceType,deviceId:d.binding.deviceId,invertAnimation:!!d.binding.invertAnimation,...d.binding.isDecorative&&{isDecorative:!0},...d.binding.configLocked&&{configLocked:!0}}:delete l[p],await a(c,JSON.stringify(l,null,2),"utf-8"),{ok:!0,defaults:l}});export{d as default};
