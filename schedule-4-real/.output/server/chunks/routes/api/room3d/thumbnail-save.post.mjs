import{d as t,r as o,c as r,b as e}from"../../../nitro/nitro.mjs";import{mkdir as i,writeFile as a}from"fs/promises";import{join as m}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const s=t(async t=>{const s=await o(t),p=String((null==s?void 0:s.filename)||"").replace(/[^a-zA-Z0-9._-]/g,""),n=String((null==s?void 0:s.dataUrl)||"");if(!p||!n.startsWith("data:image/jpeg;base64,"))throw r({statusCode:400,message:"filename and valid JPEG dataUrl required"});const d=m(e(),"data","cache","models");await i(d,{recursive:!0});const l=n.split(",")[1],f=Buffer.from(l,"base64");if(f.length>512e3)throw r({statusCode:400,message:"Thumbnail too large (max 500KB)"});return await a(m(d,`${p}.jpg`),f),{ok:!0}});export{s as default};
