import{d as t,b as o}from"../../../nitro/nitro.mjs";import{readFile as r,readdir as e,stat as s}from"fs/promises";import{join as a}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";async function discoverGlbs(t,o,r){let i;try{i=await e(t)}catch{return}const p=new Set(o.map(t=>{const o=(t.file||"").split("/");return o[o.length-1]}));for(const e of i){if(!e.endsWith(".glb")||p.has(e))continue;const i=e.replace(/\.glb$/,"").replace(/[^a-zA-Z0-9._-]/g,"_");if(o.some(t=>t.id===i))continue;let m="";try{m=((await s(a(t,e))).size/1048576).toFixed(0)+" MB"}catch{}const n=e.replace(/\.glb$/,"");let c="";for(const o of["webp","jpg","jpeg","png"])try{await s(a(t,`${n}.${o}`)),c=`${r}${n}.${o}`;break}catch{}const d=n.replace(/[_-]+/g," ").replace(/\b\w/g,t=>t.toUpperCase());o.push({id:i,name:d,description:"",file:`${r}${e}`,size:m,icon:"CubeIcon",...c?{image:c}:{}})}}const i=t(async()=>{const t=a(o(),"data","appdata","models","rooms"),e=a(o(),"data","room3d","models","rooms"),s=a(t,"rooms.json"),i=a(e,"rooms.json");let p=[],m=[];try{p=JSON.parse(await r(s,"utf-8"))}catch{}try{m=JSON.parse(await r(i,"utf-8"))}catch{}await discoverGlbs(t,p,"/data/appdata/models/rooms/"),await discoverGlbs(e,m,"/data/room3d/models/rooms/");for(const t of p)t.source="system";for(const t of m)t.source="user";return{system:p,user:m}});export{i as default};
