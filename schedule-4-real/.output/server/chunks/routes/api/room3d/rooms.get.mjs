import{d as t,b as o}from"../../../nitro/nitro.mjs";import{readFile as r,readdir as e,stat as s}from"fs/promises";import{join as i}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";async function discoverGlbs(t,o,r){let p;try{p=await e(t)}catch{return}const a=new Set(o.map(t=>{const o=(t.file||"").split("/");return o[o.length-1]}));for(const e of p){if(!e.endsWith(".glb")||a.has(e))continue;const p=e.replace(/\.glb$/,"").replace(/[^a-zA-Z0-9._-]/g,"_");if(o.some(t=>t.id===p))continue;let n="";try{n=((await s(i(t,e))).size/1048576).toFixed(0)+" MB"}catch{}const m=e.replace(/\.glb$/,"");let c="";for(const o of["webp","jpg","jpeg","png"])try{await s(i(t,`${m}.${o}`)),c=`${r}${m}.${o}`;break}catch{}const l=m.replace(/[_-]+/g," ").replace(/\b\w/g,t=>t.toUpperCase());o.push({id:p,name:l,description:"",file:`${r}${e}`,size:n,icon:"CubeIcon",...c?{image:c}:{}})}}const p=t(async()=>{const t=i(o(),"data","appdata","models","rooms"),e=i(o(),"data","room3d","models","rooms"),s=i(t,"rooms.json"),p=i(e,"rooms.json");let a=[],n=[];try{a=JSON.parse(await r(s,"utf-8"))}catch{}try{n=JSON.parse(await r(p,"utf-8"))}catch{}await discoverGlbs(t,a,"/models/rooms/"),await discoverGlbs(e,n,"/user-rooms/");for(const t of a)t.source="system";for(const t of n)t.source="user";return{system:a,user:n}});export{p as default};
