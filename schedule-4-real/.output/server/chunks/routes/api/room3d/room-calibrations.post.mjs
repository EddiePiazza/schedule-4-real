import{d as t,r as o,c as r,b as a}from"../../../nitro/nitro.mjs";import{mkdir as e,readFile as i,writeFile as s}from"fs/promises";import{join as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const m=t(async t=>{var m,n;const d=await o(t);if(!d||"string"!=typeof d.roomId)throw r({statusCode:400,message:"roomId (string) required"});const f=d.roomId.replace(/[^a-zA-Z0-9._-]/g,""),l=!0===d.system,u=l?p(a(),"data","appdata","defaults"):p(a(),"data","room3d");await e(u,{recursive:!0});const c=p(u,"room-calibrations.json");let h={};const b=l?p(a(),"data","room3d"):p(a(),"data","appdata","defaults");for(const t of[c,p(b,"room-calibrations.json")])try{h=JSON.parse(await i(t,"utf-8"));break}catch{}return h[f]={floorY:Math.round(1e4*(null!=(m=d.floorY)?m:0))/1e4,unitPerMeter:Math.round(1e4*(null!=(n=d.unitPerMeter)?n:1))/1e4},await s(c,JSON.stringify(h,null,2),"utf-8"),{ok:!0,calibrations:h}});export{m as default};
