import{d as t,r as o,c as r,b as a}from"../../../nitro/nitro.mjs";import{mkdir as e,readFile as p,writeFile as s}from"fs/promises";import{join as n}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const i=t(async t=>{var i,m,d,u,l;const f=await o(t);if(!f||"string"!=typeof f.roomId)throw r({statusCode:400,message:"roomId (string) required"});const c=f.roomId.replace(/[^a-zA-Z0-9._-]/g,""),h=!0===f.system,y=h?n(a(),"data","appdata","defaults"):n(a(),"data","room3d");await e(y,{recursive:!0});const w=n(y,"room-spawns.json");let b={};const g=h?n(a(),"data","room3d"):n(a(),"data","appdata","defaults");for(const t of[w,n(g,"room-spawns.json")])try{b=JSON.parse(await p(t,"utf-8"));break}catch{}return b[c]={x:Math.round(1e4*(null!=(i=f.x)?i:0))/1e4,y:Math.round(1e4*(null!=(m=f.y)?m:0))/1e4,z:Math.round(1e4*(null!=(d=f.z)?d:0))/1e4,...null!=f.yaw&&{yaw:Math.round(1e4*(null!=(u=f.yaw)?u:0))/1e4},...null!=f.pitch&&{pitch:Math.round(1e4*(null!=(l=f.pitch)?l:0))/1e4}},await s(w,JSON.stringify(b,null,2),"utf-8"),{ok:!0,spawns:b}});export{i as default};
