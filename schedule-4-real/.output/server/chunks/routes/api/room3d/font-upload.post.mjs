import{d as t,l as o,c as e,a,b as r}from"../../../nitro/nitro.mjs";import{mkdir as s,writeFile as i}from"fs/promises";import{extname as m,join as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const n=new Set([".ttf",".otf",".woff"]),f=t(async t=>{const f=await o(t);if(!f||0===f.length)throw e({statusCode:400,message:"No file uploaded"});const d=f.find(t=>"file"===t.name);if(!d||!d.data||!d.filename)throw e({statusCode:400,message:"No font file in upload"});const l=m(d.filename).toLowerCase();if(!n.has(l))throw e({statusCode:400,message:`Only font files allowed (${[...n].join(", ")})`});if(d.data.length>5242880)throw e({statusCode:400,message:"File too large (max 5 MB)"});const u=a(t),c="1"===u.editor||"true"===u.editor,h=d.filename.replace(/[^a-zA-Z0-9._-]/g,"_").toLowerCase();let w,g,C;return c?(w=p(r(),"data","appdata","fonts"),g=`/fonts/${h}`,C="system"):(w=p(r(),"data","room3d","fonts"),g=`/room3d-fonts/${h}`,C="user"),await s(w,{recursive:!0}),await i(p(w,h),d.data),{ok:!0,name:h.replace(/\.[^.]+$/,"").replace(/[-_]/g," "),path:g,source:C}});export{f as default};
