import{d as t,r as o,c as r,b as e}from"../../../nitro/nitro.mjs";import{mkdir as s,readFile as i,writeFile as a}from"fs/promises";import{join as m}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const p=t(async t=>{const p=await o(t);if(!p||"string"!=typeof p.roomId)throw r({statusCode:400,message:"roomId (string) required"});if(!p.ratios||"object"!=typeof p.ratios)throw r({statusCode:400,message:"ratios (Record<string, number>) required"});const n=p.roomId.replace(/[^a-zA-Z0-9._-]/g,""),d={};for(const[t,o]of Object.entries(p.ratios)){const r=parseInt(t);!Number.isInteger(r)||r<0||("number"!=typeof o||o<.05||o>1||(d[String(r)]=Math.round(100*o)/100))}const f=!0===p.system,c=f?m(e(),"data","appdata","defaults"):m(e(),"data","room3d");await s(c,{recursive:!0});const u=m(c,"room-mesh-simplifications.json");let l={};const h=f?m(e(),"data","room3d"):m(e(),"data","appdata","defaults");for(const t of[u,m(h,"room-mesh-simplifications.json")])try{l=JSON.parse(await i(t,"utf-8"));break}catch{}return 0===Object.keys(d).length?delete l[n]:l[n]=d,await a(u,JSON.stringify(l,null,2),"utf-8"),{ok:!0}});export{p as default};
