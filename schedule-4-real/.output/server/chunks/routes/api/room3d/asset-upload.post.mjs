import{d as t,l as o,c as e,b as a}from"../../../nitro/nitro.mjs";import{mkdir as i,writeFile as r}from"fs/promises";import{join as s}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"node:url";const n=t(async t=>{var n,m,l;const d=await o(t);if(!d||0===d.length)throw e({statusCode:400,message:"No file uploaded"});const p=d.find(t=>"file"===t.name),f=d.find(t=>"category"===t.name),u=d.find(t=>"isAdmin"===t.name);if(!p||!p.data||!p.filename)throw e({statusCode:400,message:"No .glb file in upload"});const g=p.filename;if(!g.toLowerCase().endsWith(".glb"))throw e({statusCode:400,message:"Only .glb files are allowed"});const c=g.replace(/[^a-zA-Z0-9._-]/g,"_").toLowerCase();if(!c.endsWith(".glb"))throw e({statusCode:400,message:"Invalid filename"});if(p.data.length>52428800)throw e({statusCode:400,message:"File too large (max 50 MB)"});const h=(null==(m=null==(n=null==f?void 0:f.data)?void 0:n.toString())?void 0:m.trim())||"",w="true"===(null==(l=null==u?void 0:u.data)?void 0:l.toString()),v=s(a(),"data",w?"appdata":"room3d","models","assets"),b=h?h.replace(/[^a-zA-Z0-9/_-]/g,"_").replace(/^\/+|\/+$/g,""):"",C=b?s(v,b):v;await i(C,{recursive:!0});const y=s(C,c);await r(y,p.data);return{ok:!0,path:b?`${b}/${c}`:c,source:w?"system":"user",filename:c}});export{n as default};
