import{d as e,r as o,c as t}from"../../../nitro/nitro.mjs";import{query as m}from"../../../_/db.mjs";import{g as i,s as r,a as p,u as d}from"../../../_/mqtt.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";import"mqtt";import"child_process";const s=e(async e=>{var s,a,l,n,c,f;const u=await o(e),y=i();try{if(u.aiMode){const e=["device","blower"];let o={};try{const t=await r({method:"getConfigField",params:{keyPath:e}},y,3e3);o=(null==(s=null==t?void 0:t.data)?void 0:s.blower)||{}}catch{}const t={modeType:0,minSpeed:null!=(a=o.minSpeed)?a:0,maxSpeed:null!=(l=o.maxSpeed)?l:0,closeCO2:null!=(n=o.closeCO2)?n:0,mOnOff:null!=(c=o.mOnOff)?c:0,mLevel:null!=(f=o.mLevel)?f:50};o.timePeriod&&(t.timePeriod=o.timePeriod),o.cycleTime&&(t.cycleTime=o.cycleTime),await p({method:"setConfigField",params:{keyPath:e,blower:t}},y),d(y,{blower:{on:1===t.mOnOff,level:t.mLevel,modeType:t.modeType,closeCO2:1===t.closeCO2,minSpeed:t.minSpeed,maxSpeed:t.maxSpeed,timePeriod:t.timePeriod,cycleTime:t.cycleTime}})}return await m("\n      INSERT INTO blower_ai_mode (timestamp, device, ai_mode, updated_by)\n      VALUES (now(), 'blower', $1, 'user')\n    ",[u.aiMode?1:0]),{success:!0,aiMode:u.aiMode}}catch(e){throw console.error("Failed to set blower AI mode:",e),t({statusCode:500,message:"Failed to set blower AI mode"})}});export{s as default};
