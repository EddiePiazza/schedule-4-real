import{d as t,r as o,c as e}from"../../../nitro/nitro.mjs";import{query as r}from"../../../_/db.mjs";import{randomUUID as n}from"crypto";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"pg";const i=t(async t=>{const i=await o(t);if(!i.name)throw e({statusCode:400,message:"Flow name is required"});const a=n(),m=JSON.stringify(i.flow||{nodes:[],connections:[]}),s=i.enabled?1:0;try{return await r("\n      INSERT INTO automation_flows (id, name, description, enabled, flow_json, created_at, updated_at)\n      VALUES ($1, $2, $3, $4, $5, now(), now())\n    ",[a,i.name,i.description||null,s,m]),{id:a,name:i.name,description:i.description||null,enabled:i.enabled||!1,flow:i.flow||{nodes:[],connections:[]},createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}}catch(t){throw console.error("Failed to create automation flow:",t),e({statusCode:500,message:"Failed to create automation flow"})}});export{i as default};
