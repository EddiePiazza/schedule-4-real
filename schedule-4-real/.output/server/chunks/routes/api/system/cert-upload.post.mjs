import{d as t,l as o,c as e,b as r}from"../../../nitro/nitro.mjs";import{mkdirSync as s,writeFileSync as i}from"fs";import{resolve as p}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const a=t(async t=>{var a;try{const m=await o(t);if(!m||0===m.length)throw e({statusCode:400,message:"No files uploaded"});const n=p(r(),"proxy/certs");s(n,{recursive:!0});const c=[];for(const t of m){if(!t.data||!t.filename)continue;const o=null==(a=t.filename.split(".").pop())?void 0:a.toLowerCase();if(!["pem","crt","key"].includes(o||""))continue;const e=t.filename.replace(/[^a-zA-Z0-9._-]/g,"_"),r=p(n,e);i(r,t.data),c.push(e)}if(0===c.length)throw e({statusCode:400,message:"No valid certificate files (.pem, .crt, .key)"});return{success:!0,files:c}}catch(t){if(t.statusCode)throw t;throw e({statusCode:500,message:"Failed to upload certificates: "+t.message})}});export{a as default};
