import{d as t,b as o}from"../../../nitro/nitro.mjs";import{existsSync as e,readFileSync as r}from"fs";import{resolve as s}from"path";import{networkInterfaces as p}from"os";import{isHaBridgeEnabled as i}from"../../../_/ha-bridge.mjs";import{b as m,e as n,k as a}from"../../../_/mqtt.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";import"mqtt";import"child_process";function getLocalIp(){const t=p();for(const o of Object.keys(t))for(const e of t[o]||[])if("IPv4"===e.family&&!e.internal)return e.address;return"127.0.0.1"}const c=t(()=>{const t=s(o(),"ha-config.json");let p={enabled:!1};try{e(t)&&(p=JSON.parse(r(t,"utf-8")))}catch{}const c=a().macs||{};let f=0;const h=[];for(const[t,o]of Object.entries(c)){if(!o)continue;const e=m(t),r=[];if("ps5"!==t&&"cb"!==t&&"lc"!==t||(r.push("Temperature","Humidity","CO2","VPD"),f+=4),e.hasOutlets){for(let t=1;t<=5;t++)r.push(`Outlet ${t}`);f+=5}r.push("Light 1"),f++,e.hasLight2&&(r.push("Light 2"),f++),e.hasFan&&(r.push("Blower"),f++),h.push({type:t.toUpperCase(),mac:o.toUpperCase(),entities:r})}const u=Object.keys(c).some(t=>{const o=n(t);return o&&Date.now()-o.timestamp<6e4});return{enabled:p.enabled,active:i(),serverIp:getLocalIp(),brokerPort:parseInt(process.env.MQTT_LAN_PORT||"1884"),entityCount:f,devices:h,hasData:u}});export{c as default};
