import{d as t,e as o,a as e,c as s,b as i,m as r,i as n}from"../../../nitro/nitro.mjs";import{existsSync as p,statSync as a,createReadStream as m}from"fs";import{resolve as d}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs/promises";import"node:url";const f=t(async t=>{const f=process.env.APP_PASSWORD||"";if(f){if((o(t,"x-auth-token")||e(t).token||"")!==f)throw s({statusCode:401,statusMessage:"Unauthorized"})}const u=e(t).file;if(!u)throw s({statusCode:400,message:"Missing file parameter"});if(u.includes("..")||u.includes("/"))throw s({statusCode:400,message:"Invalid filename"});const c=d(i(),"database/backups",u);if(!p(c))throw s({statusCode:404,message:"Backup not found"});const h=u.endsWith(".gz"),l=a(c);return r(t,{"Content-Type":h?"application/gzip":"application/json","Content-Disposition":`attachment; filename="${u}"`,"Content-Length":String(l.size)}),n(t,m(c))});export{f as default};
