import{o as t}from"../nitro/nitro.mjs";import{p as o,m as e}from"../_/mqtt.mjs";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"fs";import"path";import"fs/promises";import"node:url";import"mqtt";import"child_process";const r=new Set,a=t({open(t){r.add(t),console.log(`[WS] Client connected (${r.size} total)`),o()},close(t){r.delete(t),console.log(`[WS] Client disconnected (${r.size} total)`)},error(t,o){r.delete(t),console.error("[WS] Error:",o.message)}});function broadcast(t){if(0===r.size)return;const o=JSON.stringify(t);for(const t of r)try{t.send(o)}catch{r.delete(t)}}e.on("sensor",t=>{broadcast({type:"sensor",data:t})}),e.on("outlet",t=>{broadcast({type:"outlet",data:t})}),e.on("light",t=>{broadcast({type:"light",data:t})}),e.on("soil",t=>{broadcast({type:"soil",data:t})}),e.on("mqtt-raw",t=>{broadcast({type:"mqtt-raw",data:t})}),e.on("device",t=>{broadcast({type:"device",data:t})}),e.on("blower",t=>{broadcast({type:"blower",data:t})}),e.on("fan",t=>{broadcast({type:"fan",data:t})}),e.on("update-progress",t=>{broadcast({type:"update-progress",data:t})});export{a as default};
