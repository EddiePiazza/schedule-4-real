import{d as t,g as o,c as e,b as s,n,q as r,j as p,i as a}from"../../nitro/nitro.mjs";import{createReadStream as i}from"fs";import{stat as m}from"fs/promises";import{join as d,extname as g}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:url";const c=t(async t=>{const c=o(t,"path")||"",f=decodeURIComponent(c);if(!f||f.includes("..")||f.includes("\\"))throw e({statusCode:400,message:"Invalid path"});const l=d(s(),"data","room3d","models","rooms",f);let h;try{h=await m(l)}catch{throw e({statusCode:404,message:"Not found"})}if(!h.isFile())throw e({statusCode:404,message:"Not found"});const u=g(l).toLowerCase();n(t,"Content-Type",{".glb":"model/gltf-binary",".gltf":"model/gltf+json",".webp":"image/webp",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png"}[u]||"application/octet-stream"),n(t,"Cache-Control","public, max-age=31536000, immutable"),n(t,"Accept-Ranges","bytes");const b=h.size,C=r(t,"range");if(C){const o=C.match(/bytes=(\d*)-(\d*)/);if(o){const e=o[1]?parseInt(o[1],10):0,s=o[2]?parseInt(o[2],10):b-1;return e>=b||s>=b||e>s?(p(t,416),n(t,"Content-Range",`bytes */${b}`),""):(p(t,206),n(t,"Content-Range",`bytes ${e}-${s}/${b}`),n(t,"Content-Length",s-e+1),a(t,i(l,{start:e,end:s})))}}return n(t,"Content-Length",b),a(t,i(l))});export{c as default};
