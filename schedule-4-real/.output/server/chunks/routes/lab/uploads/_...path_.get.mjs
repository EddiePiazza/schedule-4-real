import{d as t,g as o,c as e,b as p,n as i,i as r}from"../../../nitro/nitro.mjs";import{createReadStream as a}from"fs";import{stat as s}from"fs/promises";import{join as m,extname as n}from"path";import"node:http";import"node:https";import"node:crypto";import"stream";import"events";import"http";import"crypto";import"buffer";import"zlib";import"https";import"net";import"tls";import"url";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:url";const c={".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".webp":"image/webp",".gif":"image/gif"},d=t(async t=>{const d=o(t,"path")||"";if(!d||d.includes("..")||d.includes("\\"))throw e({statusCode:400,message:"Invalid path"});const g=m(p(),"data","uploads",d),f=m(p(),"public","lab","uploads",d);let l="";try{await s(g),l=g}catch{try{await s(f),l=f}catch{throw e({statusCode:404,message:"Not found"})}}const u=n(l).toLowerCase(),h=c[u]||"application/octet-stream",b=await s(l);return i(t,"Content-Type",h),i(t,"Content-Length",b.size),i(t,"Cache-Control","public, max-age=86400"),r(t,a(l))});export{d as default};
